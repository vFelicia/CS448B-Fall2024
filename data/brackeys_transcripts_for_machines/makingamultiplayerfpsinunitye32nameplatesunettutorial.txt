thanks for tuning in at brakus hello and welcome to this video in creating multi player fits in unity today we are going to be creating some name plates which means a piece of UI that floats above our players head and it can pretty much display any kind of information our today we're going to be implementing the username of the player and the current amount of health the player has but you could easily display other stuff such as ammo on there or some statistics or whatever so really exciting video and let's just jump right into it so as you can see immunity and what I want to begin with is kind of just bringing our player in here and then sketching out the UI so if we just focus on our player right click and go to UI and then canvas we can create a new canvas that sits as a child object of the player and we want to change this canvas to a world space canvas so that it will follow our play around let's also reset the rect transform here in order to kind of bring it in but it's still huge so let's just go to the scale here and change that to something like point zero run one on all axes and hit F again and you can see that's much more manageable so now we can kind of bring this UI up we can switch into 2d mode and it will be viewed from behind but that's alright we'll just fix that in a second now we can maybe bring it down a tiny bit as well so under this canvas let's go ahead and create a new UI element and let's just create a text object and we can maybe just size this to fit on the size of our canvas so just do something like that and we can maybe scale it down a bit and it's also on center this on the horizontal and the vertical axis so that looks pretty good already and let's change the texture to something like user name just for filler and let's also change the color to white you could go in here and add a shadow or different kind of colors but I actually just want to keep it totally white I think that works just fine and you can see again here that it's currently flip so let's just go in and select our canvas and rotate it by 180 degrees so you should see now that our user name faces in the R in the right direction and go ahead and change the text name here to username and of course I also want to add a health bar but I think we should begin with the username just to get that working and then we can add the health bar in in just a second so for now I just want to take the canvas here and move it down a little bit just to make it look a bit better and that is pretty much all I want to do for the UI so far so what we should do now is add some kind of script that will set the username equal to the actual username of our player and let's do this by adding a new component to our canvas here and it's call it something like our player name plate and it's just a double click on that to open it up in visual studio we'll have a look at how we can get the user name from our player component so it opened up on my secondary monitor here I'm just going to drag it over and I'm also just going to get rid of all of the different scripts that we had opened before so the first thing that we want is a reference to a UI element and therefore we need to include Unity engine UI we also need to go in here and create a public of course we can make this a sterilized field so we don't need to make it public but we want to have a text object which is our user name text and we also want a reference to our actual player so the player component and let's just call that one player so what we could do is easily put this inside of the start method however we want to make sure that our player has a place user name has actually been said once the start method is called and so we have to be a little bit careful there because it might take some time for the server to link that or to synchronize that to all of the different clients and since this is going to be displayed on all clients we can't be totally sure that the start method will work for that we could put in a small delay that would work fine we would also kind of reference the play name play script with the player setup script so that once the player's user name has changed we call the function on this one but I think that's just going way overboard instead what I want to do is simply shoot it into the update method and that is of course a tiny bit more taxing but we're really going to using the update method anyways because we want to update our health all the time so we'll just include it in here again if you're super worried about performance you can go ahead and put that maybe on a co routine on a fixed loop or again synchronize it with the player but I think this is going to work just fine for our needs really this isn't what you should worry about when you talk about performance not for the first many hours at least cool so inside of our update loop we can simply go and say username dot username text text equals player and then dot user name and remember username is a variable that sits on the player it's just a public string and we've made sure to mark it as a sync variable so if we just find a player here you can see the username there and we also have it here and by default it just sets s loading and it's set through our player setup script and because it's a sync var it means that we can use it even though we're not on the server or we're not on a client we can use it from anywhere we don't have to worry about kind of our position in the whole network hierarchy so we can just go ahead and set it directly here and that should work just fine so again this should actually work right out the bat so if we just go in here now find our canvas where we have I'll play a nameplate script then let's actually just rename this to player actually let's just do name plate canvas we should be able to just drag in our username text and our player which sits on do the player and we should be able to just hit apply and delete that player and now when we run the game we should see that working so if we just go into our locking menu here to make sure that we log in with an appropriate username and we go through and type in something like test 1 2 3 test 1 2 3 which is our test user and it's going to login and I can see that someone there that's awesome we can host a test game and now we should see that it says test 1 2 3 s joined and if we go into the scene view now and find our player here you can see that have our UI element in here so that's awesome and it's going to follow around follow the player around one problem with this is that we if we have multiple players so let's say we have a player over here you can see that it doesn't look too good when we view it from this side and this is where we are going to need some kind of billboarding script and billboarding is basically the act of rotating some kind of 2d element to always face the camera so that no matter where you view it from it's going to look great and not well distorting and almost disappearing from from the side here so we're just simply going to rotate the entire arm nameplate here to towards on the camera that is viewing it and we'll do that in a second but firstly I really want to go ahead and make sure that it works in all other ways in terms of the functionality that we want to have so let's just go and find our main level again here let's drag in our player and um let's just fix a thing so one problem that we currently have with this is that if we were to go ahead and kill our player what would happen is our player would of course not disappear from the scene instead what we do is we kind of disable all of the components that we might that are visible in the scene so we basically you can see in here under the player we have this disabled on death we disabled the shoot we disabled these on the controller there and we also disabled these on objects here we disabled all of the graphics and we disabled the camera which means the camera itself and the weapons so that makes the player kind of disappear from the scene but we're still able to do some stuff behind the scenes and what I want to do and I just need to make sure that Irene abled everything it looks like it what I want to do is also disable the name play catalyst or else it's just going to sit there or float there after a player has died and that's going to look super weird I mean some some games do this and have the UI just sit there so you can see Oh a player just died there especially if you want to not just disable the player but maybe have them fall to the ground and have some kind of death animation then you probably want the UI to stay there but I think in our case we definitely want to get rid of it so basically we'll just go under the player script here and utilize the fact that we already have an array that we can just add another element to and drag in the name plate canvas and there we go now it's going to be disabled when the player dies and we can go ahead and hit apply on that awesome so now we can go ahead and add some health to this name plate canvas and in order to do this I actually want to utilize the fact that we've almost created this in the previous video under the player UI so let's just drag in our play UI here and have a look at how we set that up so let's shift into 2d mode and you can see that we have in here a thrust of fuel and a health bar and the health bar here is set up in a very simple way you can just copy the settings we have this background image here which we which we can see if we just scale this down you can see there's the background image it's just a tinted black image with a bit of transparency and then on top we have a colored image here with also a bit of transparency on that we simply size up and down depending on our health percentage and we also have an icon but we don't really need that so you could of course go ahead and set this up once again but instead I'm just going to utilize the fact that we already have it in here and just copy that by hitting ctrl C or command C if you're on the Mac and then let's duplicate it under our nameplate canvas and you can see that it currently doesn't want to go into there so let's just drag it under as a child let's also reset the rect transform so now if we hit F it focuses in on it and you can see that it is indeed here so let's just go into 2d and we can easily work with this even though it's flipped all we need to do is just kind of scale this down on the X or on the Y drag it down I want to scale it down even more I also want to get rid of that icon there's no reason for us to have it there it's very clear what this is let's scale it down to somewhere around there maybe and also maybe scale it in a tiny bit I don't think that's any reason for it to be that charge and I think the spacing between the two elements is fine so let's just take both of them and drag them up a bit let's shift out a 2d view and see how that looks and I think that looks really really cool actually so we'll just go with this for now and you can of course always spend more time styling around with it and I definitely recommend that you do so this is these tiny details are what kind of differentiates a pulley quickly made game from one that feels polished and ready to go so awesome so now that we have our health bar in here of course we also need to change it through this script so let's go into our name plate canvas and then our player name plate and let's add the functionality here and again it's going to be done the exact same way that we did um the health bar file player UI basically we just want a serialize field here a reference to a rect transform which is going to be our health bar field so let's call it health bar field and then in the update method all we do is set health bar field local scale local scale equal to a new vector3 where the coordinates are the kind of health percentage and then one one for the other axis because we wanted to always be scaled one on the y and one on the z the C really doesn't matter but we just put one there and then for a health percentage here we use the fact that we just created a function under a player that divides our current amount of health with the max amount amount of health that we have in order to get a value between zero and one so we simply go player dot get health percentage and again if you haven't watched the previous video and this is confusing to you go back watch it it makes a lot of sense so now we can just save this out and if we make sure to reference everything inside of unity it should actually be working right away so we can just go and take our health bar drag it under our health bar fill and we should be able to now just hit apply on the player and Iligan also delete the player UI and I actually just want to make a quick test build so just hit control V or command B if you're on the Mac and basically this is not of course going to work with the billboarding and still going to look kind of weird but we'll fix that in a second I just want to make sure that all of our core ARM kind of mechanics when it comes to on this you IPS are working so let's just go into a login menu let's log in with our test user test one two three six one two three let's do the same on our secondary build here tests one two three four we'll use a secondary test user let's create a test host game let's do the same over here test and wait for it to join and hopefully we should see a health bar and a username for both users we do and if I shoot this guy now you can see that decreasing okay so that's one thing that we have to fix and this is why it's always great to play test things sometimes I just refuse I think this is too simple I don't have to test this and then of course something stupid isn't working so the problem here is that we've sent set the anchor point for our image here in the wrong place so you can see it scales towards the center you could want that but I don't think that it's really nice so but you can see it works and you can see how resets wants to play a response there we go it's back to normal and it works on the other player as well awesome so let's just leave the room here let's kick out this player and let's quickly fix that bug all we need to do is go in Tommy level dragging our player find our nameplate canvas find our health bar and let's focus on it switch to 2d mode and you can see our anchor under the host bar fill here it's currently set to the bottom center so let's just change that you can either just drag it over or you could set it manually we want a pivot of one on the X 0 y on the eggs apparently no no that's the right all right it's just cuz it's flip we want is zero on the X and a point 5 on the Y so that should set it up so that are helped by once we actually scale it down should kind of decrease in that direction awesome so that looks a lot better cool so let's have a look at implementing a camera facing billboard and I kind of thought about this and thought I'm just going to do this on my own it can't be that difficult and it really isn't that difficult but what I thought was I would just go in and then I would rotate the UI piece to always point towards the camera that is looking at it I mean that makes sense right so if we're standing over here we would want the armed UI piece to point in this direction that's actually not correct what you want instead is have the UI piece point in the direction that the camera that is facing it is looking and that's the difference there because if we are say looking over here then we want on let's say we're looking like this then we don't want this UI thing here to point towards us we wanted to point in the same direction that we are looking and um it's really simple to do this through code but the way that I discovered this was a thing I just thought you should know this is I went into Google and I just typed camera facing field born unity you can see it's there and the first thing that pops up is of course on the unified community wiki it's an awesome place and you can see there's always already a script in here that works so I just took this part of the code here inside of the update loop that actually does the transformation and copied it so let's just do that now you can copy it from here and I'm just going to quickly go through we can find on nameplate canvas we can create a new script you could also put it under the player name plate and we'll just call this one camera facing billboard and let's doubleclick on that open it up and all we really want is to do a bit of code inside of the update loop what we want to do and you can see here let's just paste in the code then using a variable that they declared called M camera let's instead create a reference to our main camera here so a camera cam equals our camera dot main and then we'll just use cam here and here so basically what they're doing is they're using transform to look at to look in the direction that the camera is looking and they do this by taking our position and adding onto that the cameras rotation multiplied with the forward vector so on the that gives us the arm ah that gives us a vector that points in the direction that the camera is looking and then on we kind of rotate this along the cam transformed rotation multiplied with victor three done up so that's what we use to orient ourselves I'm going to have to draw this out and let's explain it more carefully but just know that this piece of code makes the arm you eyepiece rotate in the direction that our camera is looking awesome so now let's just save this and you can see how awesome it is that you can just let some of the best probably the best thing about using unity is the community and that the fact that there's so much learning material here so let's just save this now and it should work only one thing is we need to make sure that camera that main is actually referencing the correct camera because you can see in the scene here we have both a scene camera that tactics main camera we also have the camera of our player and all of the other players have cameras up as well so basically what the camera main does is it returns the first instance of an active camera tagged as main camera so in our case scene camera is going to be disabled it is tagged as main camera but it's not active and therefore it's not going to be chosen unless we die and it shift to the scene camera in which case main camera is going to use the scene camera so that's exactly what we want and in case of all of the other players we don't want it to face towards them we want to face towards our local player well luckily we disabled the cameras and all those players so only our player has an active camera so actually right out of the gate it should work as long as we go and select our players camera and tag that as main camera as well and now we can go ahead and hit apply we can delete our player we can go into our login menu we can make a build and now everything should actually just be working hopefully and I say hopefully so I I'm just gonna have a sip of water here and let's see so let's hit play here let's log in with our test user let's login with our second test user let's create a room awesome and let's join that room over here and we should see at all of it it's working so if I now just kind of move this over so we can see both screens and I'm actually just going to jump down here you can see that the UI now always faces the player that's awesome and if we were to say kill this play here so look over on this side kill this player oh but I see we still have some kind of offset there so we still have to fix the anchor point I don't know why that didn't apply but you can see here that it still works even though we switch to the same camera so that's awesome so let's just leave the room here have a look at our anchor I might not have applied that correctly so that's just dragging our player in here let's find our name play canvas our health bar health bar Phil and um yeah for some reason the pivot is still off so I don't know why but it is so what we'll do is simply shift to tuning mode here so we can see what's happening shift to the 2d controls so actually why is this happening so we have zero on the X we have point five on the Y that should be just fine just a moment I'm just going to figure out what's going wrong here and I will be right back alright so find out what the problem was and it was actually a little bit tricky to wrap my head around but here we go so if we just throw in our player here into the scene and we find the nameplate canvas and have a look under the health bar and the health bar fill we can see that the anchor point is indeed set to the correct side however if we have a look at how the our image stretches you can see that we currently have it set to stretch to fill the entire health bar that won't work that mean that means that essentially when we do the local scaling it's going to do it's going to do so on both sides at the same time and that's not what we want we want instead to set the stretch to the center here so on that our angle point here is centered and you can go ahead and move it over here but you can also leave it in the center this is just going to make sure that when we stretch we stretch using the anchor point set over here so that should be fixed now and another thing that I thought of while I was fixing this bug is the fact that our player will currently be able to see his own UI and that might be visible if you're just looking straight up into the air so um in order to get rid of this I kind of thought well we could go in and add to the player set up a reference to the name plate canvas and we can disable it there or something but that's really way too complicated what we could do it's Ted is utilize the fact that we already have a game object here called graphics that is enabled and disabled using the player setup so what we'll do instead is just take our names like canvas drag it into the graphics hit continue there and we'll go under our player find our player script let's now remove that third entry we made and just have it you stick the graphics one instead so that means that it will be disabled on death and because the player setup already have a reference to the player graphics it will also be disabled on the local player so now we should be just to play on this player and remove him from the scene and it's also take our two scripts and drag them under the scripts folder just to clean up night clean up nicely and we can then go into our login menu here and shift over to 2d mode and let's have a look at it here it is and let's also hit our control be to build the player and now I think everything should be working so hopefully we will do it right this time so we can see that booting up let's go and hit play it's going to play this term one more time hit test one two three test one two three do the same over here just one two three four test one two three four I should really have made some easier passwords and then we can create a test room and we can join that test room over here you can see already now that when we look up it's not there and if we were to inspect this inside of the scene we can see if we shift out of 2d mode and go and find our player here you can see that we are able to see it but the difference is the game object is not disabled but it's actually set as the layer don't draw so if we have a look at our nameplate canvas you can see that it's set to don't draw which means that all that our camera won't actually display it awesome so our other players in here and I should we should be able to just shoot this guy and you can see the health bar goes down in the appropriate direction and we can kill him and he disappeared disappears correctly so everything is now working and it should be on the same for the other client here awesome great so that was basically all I wanted to show you in this video I hope you enjoyed it um let me know what you want to see next I have a few things that I want to do also a few bugs that we have to fix one thing that I'm is that I am aware of is the fact that our mo does not reset whenever we die so I know that um but it's not enough for one video so I will shoot it in somewhere but yeah thanks for watching and I will see you in the next video thanks for the awesome patreon supporters who donated in November and a special thanks to sultan al sharif fight samara fire james Calhoun and Robert Bonham become a patron yourself at patreon.com slash practice