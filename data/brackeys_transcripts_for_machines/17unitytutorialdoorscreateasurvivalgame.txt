hello everyone and welcome to the 17th video in our Survival game series done by brais I the city of brais and in this video we are finally going to take a look at scripting doors so uh door functionality opening and closing and uh also some GUI that will ask the player whether or not he wants to open the door or um and until what key the player needs to press um also how to delay functionality um using the yield wait for seconds some more on that and uh keep in mind throughout this video that this this technique can be applied to pretty much uh anything that you want to open and close or move based on player input so that could be chests uh L larger Gates and um you get the point all right so as always I've opened up unity and uh you can see that uh a few things has changed uh first of all I have gone ahead and made a wall and a door uh I modeled them inside of Maya and they're not perfect there are some mistakes here and there uh but it was just a quick model to get um to get something to work with and uh they will of course be included in the uh updated version of the assets pack uh so if we go into the Imports folder here you can see that I have the door uh which is which includes both objects and I have set the scale factor to 0.5 and uh then I have the door UV the door UV with a normal map so that the light will reflect even prettier and a door wall UV and a normal map for that also so if we take a look at how I've set it up inside of unity we have a uh game object called the house piece in which we have both the house door and the house wall and and on them we have two materials on the door we have one called door UV and this is just a bump diffuse so that we can apply the normal map to it and as well we have the house wall bump the fuse and apply the normal map okay so uh that's it for importing it into unity and getting it set up like I have here um now let's go ahead and actually um make the door so uh here we have the house door and uh let's go ahead and hit the add component new script and also uh a lot of you have asked uh what if we don't have the add component button um the add component button was added in unity 4 um so all of the four versions will have the add component but if you don't you can either go ahead and update Unity or go to the component up here uh or right click down here and then hit create and then JavaScript and then drag it on all right so house door add component new script and we're going to call this door logic going to be a type JavaScript create an ad double click to open it up in mono develop and just waiting for it to open so I think we are there cool uh now we are going to keep the function update for later but the function start we can go ahead and delete and just space out the bracket keys and the function update cool so let's start with a uh variable no actually let's start with a ont trigger enter so uh new function and call this ont trigger enter all with capitals and we want to store some information we have talked about how this works in earlier tutorials uh so I'm just going to go through it really quickly so we called going to call the information the collider and it's going to be a type collider and uh inside of this we're going to type if the collider tag is equal to player then we want something to happen and uh let's just write a debug.log and then we can write working so uh this code will make sure that uh if we apply it to a trigger collider it will check if something enters it will then store some information on what entered and in this if statement it will check if what uh if the object that entered has a tag called player so if the object is the player and if it is the player it will just type working in the console window so to let us know that it actually worked um but one thing we don't want this applied to uh to the actual house door we want it applied to a trigger so I'll just go ahead and remove the component and uh if I just go ahead and hit play and run over here and keep on running you will notice that I can run right through the door so we want to create some colliders for this house wall I think I will use a mesh collider you could also create a lot of different box colliders to uh make sure that um you get accurate Collision if you want to know more about how Collision Works inside of unity and how you can make great Collision without um being too harsh on the computer then you can go and watch are mastering Collision tutorial for now I'm just going to hit add component physics mesh collider so now we can interact with this correctly and the door I'll just go ahead and create a box collider for the door so physics box collider and uh let's just tweak this a little bit so we could go ahead and just disable the house wall and uh let's have a look so we can TW tweak the centry settings and the size of it scale it down a little on the Y maybe a little more actually uh let's drag it down a bit and to the sides it looks fine but let's tweak the Z oh now the a to about there and position it accordingly in the X also so that actually looks really fine um I'm just going to push it down a little more cool so as you can see it isn't perfect but it will do um I'm sure it will do so now let's reenable the house wall and when we hit play and run over to the door we can't run through it and the same thing happens with the wall awesome now uh let's go ahead and make what will actually trigger a player uh be triggered by our player so let's go ahead and create a new empty game object so game object create empty drag it under the house door just so we can Center it on the door so censor the position on the rotation and one one one on the scale oh oh I selected the wrong object I selected our enemy that was not on purpose so game object create empty drag it under the house door 0 0 Z 1 1 1 cool uh now let's position it the right way so let's set all of these set that one to centry and this one to Global uh actually local and we can make sure it's centered on the door about there and now we want to create a collider for it so add component physics box Collider this could be any type of collider you want now we can just go ahead and scale it so we'll make it about as high as the door and as wide maybe a little wider actually and uh on the X here we are going to scale it quite a bit because this won't actually open the door this will just uh enable the player to open in the door so we want him to be able to do it from quite a distance and uh let's rename this to house house door trigger and uh to see if the trigger is placed well we can go ahead and hit play now without enabling the is trigger and therefore we can see when we collide with it so from here you you are going to be able to open the door that looks fine uh I actually well yeah that looks fine so let's just go with that and let's remember to check the is trigger this is very important let's also remember to select the player and tag him as player if you haven't done that already now we can go ahead and uh take a look at the script so this should be working now because we have tagged the player and we have set the object to a trigger so now we can go ahead and drag on the doll logic all right so that hits let's hit play and when we enter we can see that working is being called in the console cool now let's add to the script so we're going to do some uh we are going to make a variable which is going to be private because we don't want to actually change it in the uh in the inside of unity going to and we're going to call it draw gii and by default it's going to be equal to false then uh we're going to wait a second with implementing this first we're going to make the actual GUI so let's type a new function and GUI uh uh or gy is uh what we use whenever we want something to be drawn on the screen um so we use it for 2D elements so uh in this case we're going to use it for making some text actually a text label um so we are going to have a box around it now uh GUI elements can only be made through scripting inside of a function called undi and make sure you type it exactly like this with the capital letters now inside of this we are going to type G dobox and then open up a parenthesis rect for rectangle open up another parenthesis and then we are going to need four values the first two values will determine where on the screen it needs to be drawn so that would be first on the width on the X where we need it to be on the x axis and then on the Y so if I if I just go ahead and type hm uh 10 comma 10 and then we'll Define how long it should be and then I want to be 102 by 22 uh that works with the text we are going to be entering then end up the parenthesis comma and we're going to type press e to open like that and end everything up and end it with a semicolon now let's see how that look this looks so let's hit play and you can see that it's getting drawn in the upper left hand corner but we want it to be more like in the center of the screen you can have it wherever you want I'm going to decapitalize the o o in the open and I'm going to make sure that this is drawn in the center of the x value and this is done by using the screen. width the screen do width is simply how long is the screen and we're going to make sure that it's halfway so we are going to time uh say times 0.5 you could also divide by two then we're going to make sure that we calculate in the actual width of our um of our label so we are going to minus with half of our width so we're going to minus 51 now let's see if this works it's in the center of the xaxis now let's move it a little down on the Y uh let's just type 200 hit play I'm pretty satisfied with that great now let's make sure that this only appears whenever we are inside of the range where we can open the door so this will be done using our draw GUI so inside of this on trigger enter we're going to type draw gii equals true and now we're going to go inside of our function on guy and type if draw DUI is equal to true and then make some brackets around ri. boox and this will make sure that the gii is only drawn when the draw GUI is equal to true and it will be true once we enter the range so now let's hit play walk over here and you can see that now the GUI is drawn but watch What's happen what happens when we leave the sound it's still getting drawn so now let's make sure that it will uh that the draw DUI will turn turn false whenever we leave the trigger so create a new function called ont trigger exit and it's also going to store the uh collider information you can store it the exact same way and inside of here we are going to type if the collider tag is equal to player so it's going to be exactly the same you can just go ahead and duplicate what we made up here so if the collider tag is equal to player then we want the draw DUI to be false and remember this need to be on trigger exit all right so when we go into Unity now the GUI is drawn as long as we stay in the collider and when we leave the trigger it's not uh the draw GUI turns false and it won't be drawn great so that's it for enabling the uh and enabling and disabling the GUI now let's make a new function and this one is going to be the function update so we have it up here if uh if draw DUI is equal to true and input. get key down key code. e then open up the brackets then change door state so what we doing here is we are saying that if the draw GUI is equal to true so if we are inside of the trigger and the player presses the E button then we want to change the door State meaning that we want it to open or close now uh because I've written it this way the change door State and then open close parenthesis and a semic calling that means that I want to create this inside of a separate function called change door State you could also create this here and yet again you couldn't and I'm going to show you why so now let's type function change door State the parentheses and the brackets inside of this we going to type let just hold on a moment we're going to type if door is closed so here we're going to need a new variable so let's go up to the top and create a new variable so this is also going to be a private VAR and this is going to allow us to determine whether or not the the door is closed or not so door is closed and it's going to equal be equal to True by default so if door is closed is equal to true then we want something to happen and uh this is where you can insert your own logic I'm going to give you an example of how I would do it so I would say the door do animation do Crossfade and then open or whatever your animation is called so this requires that you make an actual animation and the reason for uh why I ride the door is because we are going to have to actually reference the house door because we have this house trigger and uh if we just animate this it's not going to be visible in game and uh actually let's go ahead and drag out this this house door trigger under the house piece so that it won't be uh influenced by the position of our door so when we animate the door um we we want to reference it from the trigger so let's go back into Mon develop and create our last variable this one is not going to be private because we want to apply it in unity it's going to be called VAR the door is going to be a type transform now we can just go into Unity wait for the script to update oh I can see we have an error door. animation. Crossfade says Crossfade is not a member of unity animation I think I've spelled it wrong might be cross fade yeah I spelled it one wrong and uh so we're going to do it like that so remember to capitalize the F now we have no errors and we can see a variable called the door appear in our script now we can just drag on the house door and that is it great so now let's write out the rest of the logic and then we can create the animations you could after the door animation starts playing also make it play a sound so we could do the door. audio do playay one shot this would play whatever audio Source you attach to the door so inside of this door here we could um we could apply a audio component so we could drag drag on a door squir king or um like a old wooden sound effect or something like that but for now I'm just going to go ahead and not do that so I'm just going to comment it out like this now let's move on door is closed will then be equal to F false because now we have opened the door the animation has started playing and the audio has started playing so the door is no longer closed now we want to wait a couple of seconds and then we want the door to close automatically and this is the reason why we are doing it in a separate function other than just to keep it keep the script looking clean it's because we want to use what is called a yield you're going to type yield space wait for seconds oops wait 4 seconds and inside of the parentheses you're going to type hm let's say three a yield statement cannot be used inside of the function update that's just the nature of it and uh the reason why is because in the function update it is called every time the computer draws a frame and so if the function update is slowed the computer would stop drawing frames so you cannot yield in the function update you have to call a separate function to yield sweet now let's yield the 3 seconds then say the door do animation do Crossfade and then close you could also use the open animation again and then just reverse it though that's a little bit more difficult then we could again insert some audio we could say the door. audio. playay one shot like this but uh or just doplay but again this wouldn't wouldn't really do anything except uh add the authentity to it so you can you could leave it there you can use it it's up to you so I'll just leave that commented and then door is closed equals true because now the door has closed again let's see if this works hit play go over to the door and now we should press e now keep in mind that we have still not added an animation so let's go ahead and make that first so I'll just quickly save to make sure that we don't lose all of this work now I want to select the door go to window animation and press the record it then asks me to add an animation component which which we will do we're going to go and save it onto the animations folder call this open and save now I've prepared the story for actually for making this animation and I've done that by making sure that the pivot point or the Anchor Point is in the right side actually down here to be more specific and this way when I go up here and change the pivot point to Pivot and not Center I can just rotate it along the Y AIS and it will work fine as a door animation so let's go under the rotation y hit add key then go move forward about uh half a second and and animate the door and you can make it open whatever want uh way you want and you can also choose how much I'm just going to write a prefix value of 90 or minus 90 actually minus 90 great so now if we hit play the door will open we can also make it fade a little bit by selecting the key frame of the start and hit flat select selecting the key frame at the end and hit flat now it should smooth out the animation a bit awesome now let's create the close animation the same way so go to the where it says open here and create new clip again we going to go under the animations folder and we just going to call this close and I'm just quickly going to make it the same way so this time we'll start at minus 90 we'll move forward and then whoops didn't start at minus 90 uh so we're going to start at minus 90 then go for it half a second and then go back to zero and I'm going to select all of the key frames and flatten them like that like that so when we hit play we can see the door closing again now let's hit the stop record and see if this works play and uh we can see that the door opens all by itself that's because we have the animation set to play automatically so select the house door and disable the play automatically and now we should see it working so I hit play walk to the door it says press e to open we press e and we can now move through and the door will close automatically behind our back so that's it for making a door open and close I hope you enjoyed the video and I'll see you in the next one a