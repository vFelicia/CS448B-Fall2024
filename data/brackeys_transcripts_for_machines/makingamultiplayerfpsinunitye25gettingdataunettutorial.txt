this video is brought to you by our rune Mela I'm really sorry if I butchered your name thank you so much for donating if you want to support brackets yourself you can go to patreon.com/scishow thanks for tuning in at brac ease hello and welcome to this video and making a multiplayer fist in unity today we are going to be continuing a bit on our user account system one specifically will finally take a look at synchronizing usually bound data so some data that is bound to the player that will persist through scenes and play sessions and what we are going to be using it for in this video is on players stats so we'll be adding a kill kill count and a death count and we'll be showing that in the menu and this video is focused on getting the data from the server and then in the next video we'll have a look at sending that when we're in the game and killing people and all of that so um I will just put a very quick disclaimer here and that is the way that we are doing this is definitely not safe so if you're really worried about hackers or if you want to expand this to a much larger system to save a lot of stuff what I really recommend is either you check out the database control Pro asset on the asset store that duck does cost a little bit but frankly when you do this kind of stuff it's it's very hard to do everything yourself and do it completely for free the other way is setting up your own MySQL database and then hosting it on some server but again then you have to pay for service space or pay for your own servers and it very quickly gets complicated and costly so that is why I chose to show it in this way in in this video and just to get it working and to show you kind of the basics of how it works and yeah I just wanted to mention that so I don't mislay mislead anyone and without further ado let's just jump right into it so you can see that I'm here you need I'm just gonna go ahead and clear my console and what I want to begin by doing is going on to our login menu here double click that to open it up in Visual Studio and this is the one script that takes care of the entire login process and I'm going to search for hello world and the reason why is right now when we are successfully registered here register register button when we register what on this login menu does is that it populates our it populates our data string our text variable with hello what and instead we want to publish it with something else now the way that we are doing it here is a bit limiting because the free version of database control only gives you a single text variable to sync across the network and that means that if you want to store multiple pieces of information such as both a kill count and a death count you will have to embed all of it into that string and then have some way of reading that string to retrieve it again and the way that we are going to be doing this is using our own little syntax to display that this is the kill count part and this is the death count you can also hook this up to either XML or JSON which is our two different ways of basically formatting some data to easily be written and read in basically just a text file or a string so you can of course hook it up to one of those that's XML or JSON but for what we're going to be doing we'll just do it the only our own way also so you can see kind of how this actually works so the way that I thought that we would do this is that we would have these tags these symbols that mark whether or not it's the kill account on the death count and I'm going to put these in square brackets so this is the amount of kills followed by a number which is of course our kill count so I'm going to put 0 here you could also put 128 or whatever you want to do this is the amount of kills that we want to begin with then we do a slash that's going to mean or are we going to program it in in such a way that that's a now separated piece of data so we have kills here and then we separate that and then we have a new piece of data which is going to be our deaths and I'm just going to put 0 there as well and you can see right theoretically have a lot of different things in here we could then go I don't know Katie you could calculate that so I don't know playtime or whatever and then just keep on going but is how I want to format my string and I suggest unless you know what you're doing that you might format yours in the same way cool so let's say that and that just means that new users will have that information however if you're already existing users will not they will have hello world in there so what you can do is go window database control I'm not gonna press here or I have to blur out my ID and then clear out the database using the clear database or remove database or something our button and that will just clear out out all of the users or you can make a script saying that if this variable is equal to hello world change it to something else in case you already have a lot of users in your game I have just cleared out my database for this I suggest you you do the same and then we can continue code so what we want to do here is that now that we have set this up we want to use this information inside of a lobby screen so you can see here we have a joint game and a host game I want to create a new module over here with on the player stats so let's start by just drawing this out on the UI so let's go into canvas and let's create a new empty object here and I'm just gonna call this one modules so I'm gonna go up here modules I'm just gonna scale them to fit the two modules we already have here something like that and then we can take our host game and join game and move them under modules and I'm going to have this a scale on the vertical but not on the horizontal and I'm going to drag it out a bit and then what I'll do is I'll go here and add a layout and then horizontal layout group so it will lay those out automatically and then we can go ahead and maybe move the host game down here and duplicate it and rename this one to our player stats and rename the host game title to player stats title and then we can delete those two pieces of UI there and we can actually go in and change the text to you to player stats so this will of course display our player stats and what we can do here is maybe just select these three modules and then set the child alignment to upper center I think that looks better and then we can maybe add some padding in here or we could just go ahead and change the size of our module so I'm going to do that and I think that looks a lot better and then what we can do is we can duplicate the player stats title we can change the font size to something like maybe 18 we can have both of these maybe anchored to the right here so change that so the text Orient's itself to the right and then we can have this be our kill count and we're just going to put I don't know for now let's actually just put loading in here so that when we haven't retrieved any data it's just gonna say say loading but you could also put in something like 999 kills here that's the idea but I'll just put in loading and we'll duplicate that and then have this be the death count and we'll put in loading there as well so I think that already looks fairly decent and yep without further ado let's let's continue the video here so let's add a new component here called player stats and let's double click this to open it up in visual studio and this is going to take care of loading in the player stats which is going to be our kill count and death count so the first thing that we really want here is a reference to that UI element so we're going to do to be using Unity engine UI and down here we'll be using public text and we're going to call this the on death count and public text and we're going to call this our kill count ah cool I'm just gonna switch the audio on those I I did that by holding down alt and then pressing up that's just gonna move the line there alright so now we can reference those inside of the edit and I'm just gonna do that right away so that we don't forget to do this at a later point so let's take our kill count and drag it in there and my death count and drag it in there cool so now we are able to actually change these so now the idea is that in our user account manager so if we go user account manager then dot instance then we have a function called get data and remember we if we find our user account manager we move this from the login menu from the script that was created by the guy who made database control inside of this user account manager so we would be able to access it from anywhere and on what this basically does here is that you can see if we are locked in it sends a request to get some data and if it successfully does that then it says sets locked in data which is a static string equal to that data I'm gonna change the way that this works just a little bit because instead of having this unlocked in data what I want to do is I want to use this get data request and then have a function that is called when it successfully gets the data that then that you can then choose or okay I'm gonna put this a bit differently you're going to call the get data function and then you couldn't go into input of another method that you want to get data function to call when it's successfully gotten some data and then the data itself can be passed in as a string to that function so how do we actually allow ourselves to pass in a function as an argument that means in here we're going to have some function here we're going to have a void on received data for example and it's going to take in a string with the data here and then we simply pass on receive data into that get data method here so that once get data finishes it's going to call on receive data how do we do this well it's actually really simple we use delegates so delegates are ways to UM so to create kind of a event that different functions can subscribe to and then be called when that event happens so we'll create a public delegate void and we're going to call this the on data received callback and it's going to take in a string with the data and we're going to close that off and what this allows us to do is now go down here under get data and take this on data receive callback as an argument and we're just going to call this on data received and we can call it then pass it on to the coroutine as well because we call this function as well so we'll have to call or pass on this on data received to that method down here and we'll have to allow that by adding another argument here there we go so we pass it on to the di enumerated D coroutine here and then down here instead of setting login data equal to data what we can then do is we can say on data received dot invoke and that will just go ahead and call that function whatever it is whatever method that we passed in will be called and it will be called using the data as the argument so that is how you can do that and we can then say if on data received is not equal to null so just in case something wasn't passed in then we don't want to go ahead and call it because that's going to lead to an error it can't call something that is not so in our player stats we have now set this on receive data and here we'll will then receive the data the reason why we have to do all of this is because it takes some time to get the data from the server and so if we were just going get data and then using the data here right afterwards in the side we if we went user account manager god I don't remember logged in and then data that would still be no it would be nothing because it has it hasn't actually received the data yet this is called right after it's a matter of milliseconds and it might take several seconds for it to get this data from the server so instead we use this way so that we're sure that we only use the data once it is actually received so here we can actually go ahead and say kill account equals text equals data however our data is currently in the weed formatted State it has both the kill count and the death count so we have to somehow translate this data but we'll do that in a sec what we'll do right now is we'll just debug that lock out our data here so we can see if it our coast code is at least working so far so what we should see now is that if we just hit play nothing is going to happen and the reason why is that it's only going to okay we get at no reference actually so let's see here okay we're calling the instance so we have to put in here if our user account manager Dodd is locked in we only want to do this if we're actually locked into the account man here there we go so now we should see that nothing happens here because we're not locked in however if we then trend oh I see someone playing here oh that's cool so if we now actually transition over to our let's see our login menu and log in with the user and I'm just gonna put in test one two three and test one two three login it's not going to work of course because I have to create a new user so we'll go ahead and do that test one two three test one two three and test one two three register hopefully this will work cool and you can see it says loading there but down here after a little while it gets our string so now all we have to do is on search loop through that string for the amount of kills and for the amount of deaths and then load that in and for that I think we should create a separate class so let's create a new C subscript here and we'll call this one the data maybe user account data translator or we could just do data translator which I think I'm going to do so we'll just have this be the data translator and let's double click that to open up in Visual Studio and everything we're going to be doing in here is going to be static we're not going to be using systems or collections or anything else we might actually be using system so I'm just gonna put this in here um cool so let's make a public static void and this is going to be the get or let's say data to kills and it's going to take in a string with the data and it's going to return an integer that is the amount of kills so what do we want to do here well first off we want to use our data here what do we want to use it for well we want to split it up into the different values so we have the first value with witches our kill symbol and then the the actual amount of kills and then we have the second value with a which is our deaths and then the amount of deaths so we're going to split that up by searching for this exact symbol here this slash so we'll separate the string into an array of strings where the first one will be kills and the second one will be deaths separated by the slash and the way that we do this is that we create a string array first of all in a a list of strings it's not a list it's an array and we call this um the we could do pieces or values or whatever I'm just going to call this pieces our data pieces and we are going to set that equal to data dot and I believe it is split there we go and it splits it using the slash and I am actually going to use this as a character there we go and it's really that easy so now we'll get two pieces we'll get a 1 with the index of 0 and 1 with the index of 1 and the first one will be equal to the first part and the second one will be but equal to the second part then we can loop through this list so we can go for each string piece in pieces what we can then do is we can say if peace dot begins with or starts with there we go starts with so if the first part of the the the piece here is and then we can input kills like that so in case the first part of the string here is kills then we can get the value right after that is the amount of kills we know we've found the right part of the string however instead of just hard coding this in what I'm going to do is I'm going to go up here and make this into a private static string and we can make actually make it a private static constant string I believe there shouldn't be anything wrong with that and we can set that equal to kills here and we want to call this our kills are simple or tag or whatever you want to do with that so I'm just gonna call it the kill symbol here and close that off and then we can put kill symbol the constant okay so we can make a constant static I should I should have known that there we go our kill symbol and we can put that down there so in case we start the piece starts with the kill simple then we can go ahead and remove the kill simple part of the codes that we are only left with arm the numbers so we can imagine that our string goes like this kills and then a number and this is currently our piece so what we want to do is we want to remove this part and we do that by using piece dot substring and then the start index and we want to start at kill symbol dot length so basically piece that substring will basically just go enter string and find a certain part of it in our case because we've just inputted one index it's just going to skip to that index and the index is of course given by of this kills symbol here so that's what we're doing here and that means that we will get the number 0 smart good but we can actually make this code a bit more efficient but in because in a moment we're going to be covering this over to do the same with public static public static int data to deaths string data and I don't want to copy the entire code here so what we'll do is we'll separate this out into a separate method and this is going to be a private static string and we'll make this our data to value and it's going to take in a string data and it's also going to take in a string simple okay so we're kind of getting there now so what we can do here is we can say that we want to loop through the data and all that and once you find that something starts with and now we don't want to use kill symbol we want to use the symbol passed in then we can go and skip through that symbol that we passed in and then return that code if that makes any sense to you that's awesome and in case we didn't find anything we're just going to return an empty string here and we're going to debug log error we're going to say symbol not found in and then data and I need a plus sign there as well and we can close this off there we go and now we can just use this very conveniently up here we're going to say data to value the data is here this symbol is kills symbol and that should get the amount of kills as a string so all we need to do now is return that as an integer and the way that we do that this is using int dot parse that is going to convert it into an integer if that is possible and then it's going to return that and we can do the exact same thing down here except now we don't want to use kill cymbal we want to use death symbol which we need to create up here so we'll have a deaths symbol and it's going to simply say deaths in here and we can put that down there so that is our data translator I know that this can be a bit confusing confusing but if you are at least able to follow along with most of it it is kind of the way that you work with strings and embed data into them this syntax is completely made up by me and you can totally make your own if you find something to be more logical for what you're doing but I just wanted to show some ways that we could work with strings in order to save and load things from them so now on receive data what we are going to do is we are going to set kill count dot text equal to and then we can go down a translator and we can pass in and or data translated dot data to kills data to kills and we can pass in the data and that is going to return an integer for us and then we can go to string of course and we can also add on to that maybe just kills something like that so it just displays that this is our kills count and we can also do the same for our death count so death count of text data two deaths and then deaths back here so if we did this correctly we should now see that once we lock in and we are going to do that now test one two three test one two three it's going to say loading up here in the stats and then once it gets it it says zero kills and zero deaths and if we were to change this it would now update once we load this back in so that was all I wanted to show for this video I know it was a lot to get not much working but that is kind of how it works when you want to do some of this on your own but I definitely think that this was an important lesson it is important to learn how to work with strings and saving data and what if you made it hold the way through thumbs up for that so on that's pretty much all I want to show for now I can't wait to the next video and I'll see you then thank you so much to all of the awesome patreon supporters who donated in August and the special thanks to our and Metta Robert Roche James Calhoun Mixon P and Andrew K