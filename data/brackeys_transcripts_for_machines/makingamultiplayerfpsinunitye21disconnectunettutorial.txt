thanks for tuning in at brakus hello everyone and welcome to this video in creating a multiplayer FPS in unity today we are going to be creating a pause menu that will allow us to leave the room we're currently in so we will disconnect from the server also we'll be upgrading the entire project 25.4 fixing a bunch of issues that we were having before that you might not have noticed but that I ran into when trying to prepare for this video so I tried to make some functionality for disconnecting from a room and unity gave me a bunch of errors even for the simplest of stuff stuff like disconnecting from some kind of server and then connecting back in if you weren't the host in the first place and it would just throw an error it simply wouldn't work and I went on to the forums and people were getting mad and it was all kind of crazy and then I updated and everything is solved thank you so that will be working something that more advanced like whose migration is not something we'll be looking at today because it's actually not supported yet using the Unity matchmaker but when it is we will definitely have a look at it so without further ado let's dive right into today's video so you can see that I'm here in a unity 5.4 and right off the bat you will get some errors that's because unity has made some API changes so let's just go ahead and double click on the first error here and it will take us here and what I have used here to figure out kind of what how to write things is a very useful little guide unity has made in that documentation so you can search for that or input the URL here I will try and remember and put it in the description and I'm simply under working in unity upgrade guides and then upgrading to unity 5.4 under the API changes and it basically states how things were on before 5.4 and how they are now so it allows you to very quickly just add some things to a code you can see here that before we use the network ID and then we input it an empty string and then a callback method now we just need to do a bunch more into strings and to see ropes so if we go in here on the matchmaker dot this is list matches I wanted to find the joint match down here so we put in the network ID we put in an empty string there another empty string another interesting 0 and then 0 and you can of course read what these variables are doing here so that should work now also match description and it also states this in the guide is now called match info snapshot don't ask me why they would change it to such a name but they have so just change that all over mmm cool then we don't use then we find the match maker list matches and this has changed as well so let's go in here and search for list matches and we can see that this now takes in a trooper a MIDI parameter and a 0 and then 0 so we'll just do comma true comma zero comma zero and again you can read what that does right here and then the callback method has changed we don't use the lit list match response anymore instead instead we use a pool whether or not it was a success we use a string with the extended info so string extended info and finally a list of matching phone app shots so a list of match info snapshots which we are just going to call match list and then of course here we check if match list is equal to null well we also want to check now and you might be able to get away with only doing this but I'm just going to leave both in if it wasn't a success well then we couldn't get the room this time we returned great and down here for each match info snapshot match in match list there we go we don't need that matches and then we set up the match here and that is the match info snapshot and the join room I think that's correct but we need to go in and edit this method here so if we go down here and lower into unity and find the room list item we can go ahead and double click on that and we need to change this to a match info snapshot duplicate that over there and over there and now we should stop getting errors from those two scripts and then we only have to change one thing inside of our host game script so double click on that and that is the actual create match method here and again we'll just reference our manual and if we find the create match there so before it was this short now it is of course longer so two more strings and two more integers so we'll put on string a string and integer an integer and that should indeed be working and I think I think that was it so if we go back into unity here you can see that we are now errorfree whoa we weren't errorfree but I actually got rid of them I think what that was is that I got some weird error messages that simply disappeared when I restarted unity and it looks like this might have been the same so when we are not getting getting any sticky sticky errors it's simply most of the time just an edited thing on that unity just well it's not important to us and they will take care of it so things are working now so that's great and we can go ahead and actually expand upon our game so what I want to do is I want to go into our main level and basically in here when we play what we do is we instantiate a prefab called player UI and this is where I want to add our actual pause menu so if we go and drag our player UI in here so we can edit it and then go on to UI and panel and just reset this and make sure it scales to the entire screen I'm going to remove the background here and I'm going to tin this our black so that it will kind of wash out the background so we can have some we're elements on top of this I'm going to rename this to the pause menu and then let's rightclick on that go on the UI and add a button and this button is of course going to be the leave room button so let's make this very dramatic let's make it very red and let's go under your text here and call this leave room let's bump up the size to something like 20 maybe let's make it white and let's make it bold something like that I mean it's not the prettiest thing in the world but it gets the job done you can try and maybe actually I like it complete the square there or do I know I don't so this is fine and again you should play around more with these UI elements I just don't have time for it here so this is our leave room button and that's perfect so now we can go ahead and add a new component to this and this is going to be the pause game script or it pause pause menu and this will take care of everything related to the pause menu such as the leave room button and I'm just going to double click this to open it up in Visual Studio just so we have it here and you can see all of these warnings are related to the crossplatform input of the standard asset spec they're really non important so we can just go ahead and hit clear and then on side inside of a play UI if we double click that what I want to do here is I want to be able to toggle on and off our pass menu by using the Escape key so undo our update method we will check if input dot get key down and the key that we want to check for is the key code dot escape so if we've pressed the escape key we want to toggle on the pause menu let's now create a function for this so void charcoal pause menu and we need of course the reference to a pause menu so we're going to make this a serialize filled and this is going to be of type game object and we're going to call it pause menu so we can reference this in the inspector and then we say pause menu dot set active and we want it the active state to be the opposite of what it currently is so if it's on we want it off if it's off we want it on and therefore we can simply use pause menu dot active self to get the current active state of the object cool so that will enable and disable it what I also want to do is have some kind of static variable that is easily accessible accessible from within the other scripts that will allow us to easily check if the upgrade or if the pause menu is enabled well then we don't want to be able to shoot we don't want to be able to move or look around stuff like that we can simply use this static variable inside of other scripts so if we go into the pass menu here I'm just going to make a public static bowl code is on and we'll just default that to false and then inside of our player UI we can set pass menu dot is on equal to the new state of our pass menu there we go and we can also make sure that pass menu that is on is set to false in the start method oops so pause menu oops pause menu dot is on equals false when we are starting your game cool so this won't disable anything but it will toggle on and off the pause menu so if we just toggle that off from the beginning and hit up and of course drag it in there hit apply and delete that and then we go into our save that go into our lobby and host a new game and this is just going to be a test hit create room and then hit escape nothing happens and why is this so if we find our player UI here we have the pause menu and for some reason it's not toggling and that's because we want it to be the opposite of its current active self so of course that makes more sense so let's try and hit a play here you can see the room hasn't been cleaned up yet but it will in a moment that's my phone going off so just just a moment whoops sorry about that too many things happening at once so we can go ahead and create a new room here just call it room and now when we hit escape you can see that it pops up and when you hit escape again it disappears cool and so what we want to do now is make sure that we don't move when it pops up and that we don't shoot while it's popped up so to do this we find our player prefab and we find I'll play a shoot script and we go in here under our update method and add a little if statement we simply say if pause menu dot is on well then we can simply return then we don't want to do anything with the shooting mechanics and we can go in and do the same thing with our player controller so if we go into a player controller under the update method right in the beginning if pause menu dot is on then we return and that should actually be all we need to do here so if we hit play again and create a new room here so test room create room and hit escape you can see that we cannot move or shoot and if I toggle it back off we can move and shooting it so that's perfect so the next thing that we want to do is make our a leave room button actually do something and we do this from within the pause menu script so if we double click here we're going to make a new method here a public board called leave room and all this is pretty much going to do is call some functions on the network manager so in order to do that we need to be using unity engine dot networking and it would be a good idea to store a temporary reference to our network manager so let's go up here and make a private network manager and let's just call this well we could just call it network manager let's just do that we could also just call it nm for short let's do the full name here network manager there we go and then inside of our start method is where we will set network manager equal to network manager dot singleton cool and this is just an easier way of writing things out so our code down here won't get very long and then a network manager dot match maker dot drop connection so we want to tell on matchmaker that it should drop the connection to this client and we do that by using network manager dot match info and we want to get multiple things from this match info so that story that so let's make a match or a match info dot let me just see the type of this match info here so this is a match info yon so what we need to do up here is say using unity engine done networking dot match and now we should be able to store a match info here exactly and just call this match info and set that equal to network manager dot match info and then here we can say match info network ID match info dot node ID and then finally a callback method or zero and then a callback method and they've gone ahead and created one of these a default one in five point four so what we'll say is network manager dot on draw connection there we go and unity will take care of the rest and then all we want to do is simply on the network manager called stop we'll stop host and even though we are the client it works fine to just call the stop host method you cannot get away with just calling the stop client it will not clean up the scene properly so just call the stop host and of course we are going to have to change this if we want to do the host migration at a later point but fine now this is going to work so that if you are joining a room hosted by another player and quitting that you can rejoin if you're quitting as a host everyone will get thrown out of the room and it will get cleaned up so if we say that and hit back into unity make sure we are arrow three error free we should be able to actually see this working however one thing that we do need to do is go under prefabs find our player UI drag it in here and make sure that our live roof room button has an on click event that references our past menu and that calls the leave room method and now just hit apply on that and we can delete it again from the scene and it should be working so let's try and build this client into a separate one so we can see it working with another player and this should open up and you can see the new mate with unity intro screen here and I'm going to hit play on this one I'm going to make a test room hit create room you can see it joins on this client then I'm going to go in here and hit refresh and you can see it says my test room is right here so I'm going to click test room it's going to say joining and it's going to join right in in a second there we go so we've now joined the room and established the connection between these two players and we could do this even though they were on two separate computers on two differ in connect internet connections and even cross country and all that it works and you don't have to setup any firewall you don't have to do any of all that stuff cool and what we want to do now is of course drop this connection once again I'm going to escape leave room and you can see it disappears from over here and we've dropped the connection over here and you can see again it is completely gone then we can go back in here hit refresh you can see the room is still there and we can now click it and rejoin and this was the thing that I was having problems with when testing it out before five point four and a lot of other people we're having the same issue but now you can see we can easily rejoin and I'm just going to show you now what happens if I escape or if I leave the room over here on the host I'm going to say leave room and you can see we get kicked out here and we get kicked out here as well and you can still see the test room in here but that's because unity takes about 30 seconds for the room to destroy itself where it keeps checking if there's any players in there and if there isn't at the end of those 30 seconds it's going to destroy the room from the queue and it's not happened yet but it will happen in a moment the problem with this is with retry and reconnect to the room before it's been destroyed while there is no host then it's just going to connect infinitely or you're going to get an error and that's super annoying and there are really great ways to get around this there are ways to get around this I think we're not going to mess with that yet because it's kind of it's not really a net case but it's not something that is really important for functionality and if unity is going to fix this soon anyways that's not much of a reason for us to write all kinds of code you can see it's it's gone now so that's where I'm going to leave you today I hope you found this kind of interesting I hope that we can soon continue to more advanced networking concepts and yeah thanks for watching this video and I'll see you in the next one thank you so much to all of the awesome patrons Porter's who donated in July and a special thanks to vixen famous own Andrew K and Lux game TV these videos wouldn't be possible without you