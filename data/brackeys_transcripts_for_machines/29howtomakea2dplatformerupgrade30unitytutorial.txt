thanks for tuning in at brakus hello and welcome to this video in the how to make a 2d platformer course today we are going to be upgrading our upgrade menu and we are going to be centralizing our player stats in a separate script where we can have stuff like our health which we already have and then a speed variable you can also add stuff like weapon damage multipliers and everything in one place so that other components and other scripts can sync up to that change the values and then get them back and that's going to make it much easier for our upgrade menu to just connect to the player stats and handle everything there so that's going to be super fun hopefully we're also going to be hooking it up to the UI so we can actually see some upgrading and yeah without further ado let's just take right into it so you can see that I'm here in unity and the first thing that I want to do is find our player and double click on the player script itself when we open this up in monodevelop you'll notice that we of course have this stats class and we also have an instance of that class so let me just drag over the window here and we can actually just delete the system that collections actually we're going to be using that in a second so let's not do that however you can see that we have this system that's realisable and this is a public class and it's actually separate from the rest in the script and this is what I want to use as a base for our new monobehaviour that we're going to be adding so let's copy that using control X let's just cut it out and then delete this a player stats reference let's say that hit back into unity and of course now we're going to get some errors because these stats no longer exist and then we can go in here or I mean not on the player but on the game object and here add the player stats this way we are separating our player stats from the actual player game object so that we can remember what stats we have and what upgrades we have applied even though our player dies and then responds so we can apply that back in that's a much better way of doing it so let's double click on this now opening up in monodevelop and now we can simply copy the class from before in here and sure to make this a monobehaviour we can remove the system that serializable and we can change this from a public void in it that we need to call from somewhere else and simply make this a void wake so we can simply set that up in the awake method so that was pretty easy we can delete the system dark collections there and now we need a way for our player to reference this player stats and just like we did with our game master where we had this static variable that stored the instance of our player of our game master we're going to do the same with our players stats I'm just going to show you what it is I'm talking about so if we go on our game master you can see that we have this public static game master called GM and this is the actual instance that lives in our scene and we set that equal to our game master in the awake method so we're going to be doing the same here with the player stats it's a very simple design pattern that makes everything much easier so let's do a public static player stats and we can just go ahead and call this instance and then we can make inside of the awake function we can say if instance oops if instance is equal to null well then we want to set instance equal to this and this of course refers to the player stats instance that the awake function is running on cool and this way we can simply go into our player script and we can delete the stats that in it and then the stats here every time it says that we are going to replace that with player stats dot instance and if we want to optimize this instead of using player stats that instance every time we can cast this in a variable so that's exactly what we're going to do so up here we can create a private I'll play your stats and we're just going to call this player stats or if we want to keep the same naming convention we can just call it stats and but then in the start method method we set stats equal to our player stats that instance and this way we have a reference to that stat subject so that's perfect then we can just save everything and leave it in here and we don't really need to do anything at all and we can just head out into unity make sure we don't have any errors which we don't and you can see here now that the player stats is the one that has the ability to change these this stuff so the max health of our player is now controlled under the TM object under the player stats script so if we play here we should see that everything is currently working and it seems that it is you can see here if I let this guy hit me we actually lose health so that's perfect and I'm just going to go ahead and disable the ha my monitors here so that the audio won't be feeding through the mic great so the next thing that we can do is add some kind of health regeneration because if we want our player to level up his health his max health it would be great if we could actually you just utilize that the max health has changed so let's just have the health go up over time and this is a very easy thing to do we simply head into our player script we find the actually we could do this inside of the update method but instead instead let's create some kind of our repeating invoke so some kind of method that repeats itself as at a fixed rate and it's great to do it this way because we want health only to go up in discrete numbers we have an integer we only wanted to go up with whole numbers so we can say something like two times a second we should add one to our health for example so let's first off go ahead and make a public float here and this is going to be the health regen rate but again instead of having this inside of our player script let's go ahead and decentralized or or centralize this into our players stat script so we can have a public float and this is going to be the region raid and we can default that to to perfect and then we can go inside of our player and then what we can do is we can make some kind of method here called regen health and this is just going to regen one health each time it's cold so we can say that we want our stats dot health or current health to be plus equals and then one it's that simple and then we need to of course update this on the status indicator so you can see here we need to call status indicator that said health using stat stat current health and stat stat max health great and what we can then do is we can have the stat method invoke this so under a start method we can use invoke repeating and we can give the method name regen health we can give it a time until it starts rejoining and that's just going to be the same as our repeat rate so that it doesn't regen right when we spawn but after the repeat rate it it does and we can simply use that's that regen rate mmm and maybe we should actually rename this to our health regen rate just to be more specific and you can see easily updates in here and then we can use again stats that health regen rate for the amount of time that it should wait before repeating so now this should actually be working and we can try and hit play here and of course we will need to lose some health so let's wait for an enemy to appear there is one and wait for him to damages and you can see now that our health goes up but it goes up only once every two seconds and that's because we need to use one divided by our region rate because right now our region rate rate specifying the amount of times that we needed to wait we need to actually have the rate be one divided by that so this is perfect and now we can try this again and see if it's working and now we should see we generate two times a second and indeed it does it might be a bit too small on your screen I'm going to maximize this in a second so you can see that it's actually working but trust me it is so that's perfect then we can drum jump down and respond here and you will notice that when we respond we have an issue and that's because when we respawn our maximum health is still zero and that's because when we are if I'm the update function here if we jump down we damage the player with a lot and then you can see here that we are check if our current health is less than or equal to zero which is it then is it would be exactly zero well then we want to kill the player but there's nowhere in here where we set our current health back to the maximum health you can see here we have the kill player and then under our if I find our game manager or game master here we have the kill player there we go it simply destroys the object and it goes in two remaining lives and all this but it doesn't actually reinitialize the stats and we don't want it to we only wanted to go back to the maximum amount of health everything else that we have upgraded such as our speed we don't want that to be reset so all we need to really do is inside of the play script here on the damage player after we kill the player so that needs to be up here in the start method all we need to do here is simply say that's that that current health should be equal to stats that maximum health just to make sure we do this inside of our players stats right at the beginning down here in the awake but we actually don't need to do that we can do it inside of our player method instead so now when we try and hit play here and we jump down we should see that when we respawn our health resets to the max health and indeed it does so that's perfect and that's pretty much all we needed to do there now we can go ahead and maybe move our speed inside of this player stats as well so if we take a look at our player we have a platformer character 2d script and this has a max speed that is indeed our movement speed so if we doubleclick on this we can go ahead and just remove this from in here we don't want it there anymore then we can go into the player stats and add a new variable in here instead and this is just going to be the public float and we're going to call this movement speed and set it equal to the default 10 as it was in the other one and then all we need to do is inside of a platformer character 2d script find the place where we use the max speed which was here and then instead of max speed right player stats dot instance and then dot movement speed cool and now it will draw from that every time we need to move less of course ways to optimize this but it's really not going to matter in most cases so now let's try and hit play you can see we can still move and if I go into the DM object and tie this up you can see we now move a lot quicker so we have the opportunity to now upgrade that as well and you can do this with any kind of variable in the game for example under the player we have a pistol you can do this with the fire rate and the weapon as or and the damage as well however if you want to change out the weapon it doesn't make sense to directly take these stats from the arm from the player stats because then it won't change depending on the weapon so what you could do instead is have some kind of multiplier on the players stats here just something like 1 1.2 1.3 that multiplies the damage and the fire rate for the given weapon and you can simply implement that in the weapon by instead of using the damage variable directly used damage dot or damaged x player stats instance dot damage multiplier and then you can upgrade that inside the menu so that would be a great way to do that I'm not going to show it here but if it's something you want to see also weapon switching and maybe buying other weapons definitely leave that suggestion in the comment and we might do it so cool that was it for moving everything inside of the player stats now we can go ahead and actually make this changeable or editable in the upgrade menu so if we go under UI overlay and find our upgrade menu we need to create a script to handle this upgrade menu and you can see that our hierarchy hughes or a project panel is getting a bit cluttered so let's go ahead and take a on your manager drag it under the scripts and do the same with our player stats and our money County UI perfect then we can go ahead and find our upgrade menu again hit add component and now we want to add an upgrade menu cool and we need to remember that this is only enabled whenever the whenever the game object is enabled which means when we have the upgrade menu open on our screen so that's perfect we don't need to take care of that so the first thing that I want to do is display our current health and our current speed and in order to do that we need a reference to the UI elements we have for displaying that so I'm going to be using unity engine unity engine UI and we want to serialize field here the first one is going to be a private text and this is going to be our health or maybe um your health text you could do something like current health text or whatever but it's it's actually the max health so yeah just health text is fine for now and excuse me we don't want to default this to anything we want to edit this inside the inspector okay so we can simply duplicate that and use it down here and this is going to be our speed text and then what I want to do is I want to well okay so they're multiple way of ways of doing this one is to have some kind of method that updates the health text and the speed text and then we call that method let's say whenever we open the upgrade menu and then we call it whenever we press a button to upgrade something because then it might change another way is simply to do it every frame but let's actually do a bit of optimization here and do it the first way the correct way sort of say the best way at least and that is to have a void which is going to update values and this is going to set health text text equal to player stats and let's also actually do a reference to our player stats so let's have a private actually let's do that beneath our fields here a private player stats and we're just going to call that stats and then inside of a void start we're going to set stats equal to players stats dot instance great so health text dot text equals stat stud max health dot two string cool and we can just do speed text dot text equal stats dot movement speed dot two string perfect and that should basically be all we need to do except we need to of course call this so we want this to be called whenever this game object is enabled that means whenever we will bring up our upgrade menu so void on enable and we simply update the values there then we can also call it whenever we change something so this should now load in the correct value so let's try and hit play here oh of course we need a reference to the to object so under our upgrade menu and there are attributes on our health attribute we have the health amount let's drag that in there under the Speed attribute we have the amount there and that should be all so let's try and hit play and now we hit you and this says 120 hundred 610 that's not correct object reference not set to instance off an object so what's going on here let's double click this and for some reason that isn't working I think that maybe our stats are never set which would be annoying so what we'll do is instead we'll have this reference inside of the unable let's try that okay so hit you and now it's working so you can see it says 100 and it says 10 however we of course wanted to say health 120 and speed 10 so we simply need to add on to this so we'll go like this health and speed good and you can of course make this into some kind of variable you committed in the inspector or something like health prefix or whatever but now for now we're just going to hard code that in that's not super important and you can see that these two values now update so that's perfect the next thing we need is some kind of way to upgrade this so whenever we're dealing with UI buttons inside of you you need a screwy system all we need to do is make some kind of publicly available function that they can call so we simply need to say public void and this is going to be upgrade health and we'll call that from the button and all this needs to do is edit the our player stats in some kind of wait so we can say stats dot max health and then x equals and then some kind of multiplier and I think that multiplet multiplier should either be available inside of the upgrade menu or inside of the our player stats script for now we are just going to make this available in the upgrade menu itself so what I want to do is have a serialized field here so we're not going to be using an outside of this script and make it private and this is going to be a float and it's going to be the health multiplier that's not correct multi prior I think that's correct and we can make that something like 1.3 so every time that we upgrade our health it's going to get give it 30% more health than before so stats that max health x equals health multiplier and then we want to update values good and that is not working and the reason why it's not working is because this is an integer variable and now it needs to convert that so we say that this is equal to max health times health multiplayer multiplier stats and if we convert read this to an integer how do we need to go about this one second so we need some kind of way to tell it ah I think this is correct so let's just try this of course we need to call this from the button right so we have the health upgrade button here and you can see that we've already added an on click event so all we need to do here is simply take the upgrade menu there drag it in there go on the function upgrade menu and find the upgrade health so now when we hit play and we hit you I'm hit you can see that it upgrades to 129 and it rounds down there because that's just what integers do by default so you can see here that we can now upgrade our health and this will of course scale nonlinearly because we are adding by a percentage so that's just fine and if we want there are multiple ways to do this we can add some fancy math we can instead of adding just 30% each time we can have it go by it's some kind of polynomial function and there are many weights and ways to do this but for now this is going to work just fine if you if you want to investigate this further you can go on on google and search for something like stat scaling function or something like that and check out the many different possibilities for how you want your stats to scale good and we of course need to add the same here for our speed so upgrade speed and that's going to do the same except now we're not talking about max health now we're talking about movement speed we're doing that there and we of course now need a movement speed multiplier so speed multiplier habits do movement speed both supplier and that's just going to be the same for us right now you can tweak these numbers and it's important you do to make the game the most fun as possible and this is already in a float so that's fine movement speed multiplied with multiplied with movement speed multiplier that's going to be fine and then it upgrades the values and all we need to do is find our speed attribute our upgrade button and drag in our upgrade menu and find the function called upgrade speed perfect so let's try and hit play here and pressed you upgrade upgrade everything is working and it's also updating inside of the games you can see here that our max max health I'll wind up and of course it needs to regenerate to that amount of health but it is indeed working and if I just upgrade our speed a bunch here whoa that went crazy so it's clipping now because it's it's so crazy our speed multipliers way too big here and we also kind of need to truncate the numbers here so let me just find the best way to truncate that number and I'll be right back okay so I think all we need to really do here simply use math that round to round this off to an integer number we could add some kind of amount of decimals but I think this is going to be plenty for what we're doing and I also want to maybe tweak our movement multiplier just a bid so if we find our upgrade menu here take our movement speed multiplier and change it to something like one point one so if we hit upgrade here and I'll great a few times ah that's a bit too little so let's do one point to see how that works so this is fun so we can quickly get moving very very fast so that's perfect and everything should be working now so the last thing that we really have to do on this upgrade menu is some kind of way to spend our money and to disable our ability to upgrade things when we don't have enough money so that's going to be for the next video since this is already very long I hope you enjoyed this introduction on kind of how to shave an upgrade menu through code and how you can have player stats that other scripts have a reference to and just use but knots that are not spread out through the game that's a lot less confusing good so thanks for watching I hope you enjoyed it and I'll see you in the next video