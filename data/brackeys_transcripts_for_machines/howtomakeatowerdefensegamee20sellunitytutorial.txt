thanks for tuning in at braies hello everyone and welcome to this video on creating a t defense game in unity today we're going to be adding some functionality for selling turrets two videos ago we U made some functionality for selecting turrets on the map and a node UI would put up uh pop up with two different buttons one for upgrading the turret and one for selling it and in the last video we made all the functionality for upgrading the turet so in this one we are going to be making this stuff that will allow us to remove the card off our map and in return get some sum of money we'll also be uh adding the upgraded versions of the missile launcher and the laser Beamer because in the last one we only set up an upgraded version of our standard turret so without further Ado let's just jump right into it so as you can see I'm here in unity and what I want to begin with is just adding these upgraded versions so we can totally close off our upgrade system you can see currently if we hit play here and uh create a standard turret we can easily upgrade that but if we do the same with our missile launcher it says that the upgrade price is zero and it's just going to disappear off the map with a null reference exception because we haven't referenced an upgraded object so let's go into our prefabs folder here let's find our missile launcher and let's hit contrl D to duplicate that and let's call this one missile launcher upgraded upgraded and let's uh drag this into our map and we can just kind of style this differently and give it some different properties over here so the the first thing that I want to do is bump up the scale to 1.2 on all the axes and then I want to uh up the range to something like 40 the fire rate to something like4 and um everything else we're just going to leave as this you can also include a new missile if you wanted to fire something that looks a bit different you might want to make it bigger or totally red or uh do something like that but I think we're just going to keep this as uh as is for now and the next thing that I wanted to do with this is uh change the materials uh a tiny bit to just kind of recolor it and make it really clear that it's now a new separate thing so in order to do this I actually don't want to change any of the materials I just want to flip this material here for the tip and on this material here for the head so you can see over here we have a primary and a secondary material and then they are currently under Imports and then missile launcher and materials and you can see I played around with having an upgraded folder here we're just going to delete that and basically I just want to drag our primary into the first slot instead of the second one and our secondary into the second slot instead of the first one and let is just uh switch the two and it's maybe it's maybe kind of a hack but I think it looks fairly decent especially if we zoom out a little it makes it really really clear that something else is going on with this turret so let's just hit apply on that and remove this and now we can go into our uh shop which is under overlay canvas and then shop and in here we have the uh shop script which has a missile launcher and all the data for that and here we need to reference our new prefab that we just made the missile launcher upgraded along with adding a cost and that's going to be something like 150 you could easily automate the cost to but just be a percentage of the original cost um but I like to have more control so now we can go in here hit play select the missile launcher build it and we can now easily upgrade it as well and that just works awesome uh and I basically just want to do the same thing for the missile launcher so let's take our missile launch or uh the laser Beamer so let's duplicate our laser Beamer and let's do underscore upgraded once again let's move this into our scene so we can easily see our edits and uh let's change the range here something like 30 and let's also change the damage over time to say 40 and this slow amount to something like8 I want this to be really notice uh noticeably uh better then we can hit apply on that and I also kind of want to bump up the size of this laser here so let's just change the start width from3 to4 and do the same on the end width just to make that a tiny bit bigger and um also we can make the turet itself bigger so let's do a scale of Point 1.2 again on all the axes and and we can also go under the impact effect and just edit this a tiny bit so if you focus on it you can see what that looks like and it's a really nice effect we can go under glow and change the start size to be between three and four instead of two and three and just bump up the range on the light to something like 15 instead of 10 cool uh that's pretty much all we need to edit for this I believe so we can just hit apply now and again remove it off the map and then we can find our shop and reference it so so in here under our laser Beamer we want the upgrade cost to be somewhere around 200 maybe even 250 actually I think I'm going to go for 250 and let's take our upgraded prefab the laser beam upgraded here and put it in there so now when we H play we should be able able to upgrade this as well so let's uh spawn in a laser Beamer and hit upgrade and you can see that indeed that works just fine however I want to recolor this a tiny bit so let just take our upgraded here have a look at it and instead of again modifying the original materials uh this time I want to basically just find our laser Beamer um is this floating this is for some reason floating so I think the fact that we scaled this up made it float a tiny bit uh so what we'll do is just uh take these elements here the base and the part to rotate and I think we'll just move those down a bit something like that just to make sure that it will uh stay on the Node even though we've sized it up so now we can go on our Imports and then you can see I've already created a m a folder for this earlier but let's just delete that let's duplicate the entire materials folder and let's call this one materials upgraded and now we can go ahead and Swap all of these out so let's go under the um base first and we change the bolts here and the B Bas to the new base then we can take our head and change the pipe the main turret and the turret accent there we go and currently we can't notice a difference but now we can go in and actually change these materials and it will only affect this version and pretty much all I want to do is take the pipe here and make this green and I want them to be a very bright saturated green something like that and I also want to kind of go in and change the bolts here to be green as well I think that could be a pretty cool little detail something like that and I might want to change the accent even so let's find our third accent and let's just try this in green as well I actually really like that it's it's more simple but it's very noticeable noticeably different so let's hit apply and let's remove this and remember you don't have to just change the materials or just change change the properties you can change anything about the turret you can change the uh bullet the prefab that spawned anything about the effects and you can even make a totally new model with different animation and put that in there instead because we're just hot swapping out a game object so now let's just try this one last time and see that all of our turrets are working so let's do one of each and let's just try and upgrade them that looks nice okay so they all look really awesome in their new upgraded version cool so next up is the selling part so what do we want to do here well so far on each node uh on each node we have a node script and inside of this script we have functionality for um for um we have call backs that register when our Mouse is hovering over it we have uh callbacks that register when um let me just close down all of this stuff um uh when we click on it and we have different stuff that happens when we do so we have something called build turret um a method that builds a new turret we have another one that upgrades the current turret and in line with these functions let let's add a new one called uh cell tart and what we want to do in here is of course destroy the current tet add on some amount of money and maybe also some kind of effect so let's start by adding on some some money so let's go into player stats and let's do money and let's add onto this um some amount of the cost so I think here we're just going to automate it you can go in and put a um sell amount for each individual turret but I think for now we'll just take half of the uh purchase price so we're going to ignore upgrades and we're going to ignore everything else about the uh turret the amount that it sell sells for is just going to be half what we originally bought it for so what and that is of course stored inside of our T blueprint so this is our current turret and we can just do turet blueprint. cost and then multiply that with say 0.5 but we might want to get the cost or the amount that we can sell something for multiple places and we don't want this 0.5 to be hi coded because then we would have to go through and remember where we wrote this code and change it in each place so what we'll do instead is add a small helper function to our T blueprint that Returns the um sell amount what the how much money the uh turd can be sold for so let's find our turd blueprint here and open it up and in here we're just going to add a uh quick little function this is going to be a public and it's not going to be void because we want to return something we want to return an integer um with the amount and this is going to be something like get sell amount ount and all we do is take our cost and uh and return our cost multiply with our some value and let's just take half of it so in our case we can just divide by two so that's pretty much all we need to do we just cut our cost in half in half and this way we can easily just in here change how we calculate this and it's going to update in all places where we simply go tur blueprint. getet cost whoops uh get cell amount there we go awesome so what we can then do is of course destroy the turret so we have a reference to it as the turret here we're just going to destroy that we're also going to set our turret blueprint uh equal to null um and that is pretty much it and then we can uh spawn a cool effect but we can take care of that in a second let's just figure out if this is working so this function should indeed work now but we of course to need to call it somewhere as well and we need to call it in the same place that we are calling our upgrade turret and that is through our node UI so our node UI here is what pops up whenever we select a turd it has this canvas with the different UI elements for uh upgrading and selling so what we do is edit this node UI and in here we just want to add on a new uh method just like we have the public void upgrade we also want call called cell and we just go target. cell turret and the target is what we are currently uh we currently have selected and then we go build manager. instance. deselect node because after selling the turret we want to deselect any kind of nodes that we might have selected just the same way that we have built our upgrade me uh method it's the exact same thing except instead of calling upgrade turret we're calling sell turret so now we just need toook this up to our button and we do that by going through our canvas finding the button under buttons the cell button here and adding a new onclick event that references our node UI where our script is and calls on that script calls the cell function that we just created so now everything should be nicely hooked up and that there that right there is the strength of the way that we've built this system because we've built it in such a clear way where our UI elements all reference this Central UI script that is then able to um or that then keeps track of what we currently have selected and is able to call methods on that node because we are using this very modular way of building it it's so easy to add new functionality to modify nodes in different ways so now we can hit uh play here and hopefully uh we should be able to now uh build any kind of turret and sell it and indeed we are and you can see here that I spend 350 I click here and I sell and right now it says sell 450 that's not true it's going to sell for 350 divided by 2 and you can see indeed it does that so all we need to do now is just update that amount so we're not updating uh the cell cost here and that's going to be the cell amount here we're not updating this UI element you can see all we need to do is go in here and modify this to say something like 125 in case we are selling the missile launcher or whatever so what we do in order to get that working is just reference it inside of our node UI and update it when we set a new Target the exact same way that we do with our upgrade cost so we just create a public text here and this is going to be the sell amount and we'll reference that in the inspector and then down here we go sell amount. text equals and we'll put a dollar sign here just for fanciness and plus target. tet turret blueprint Dot and remember to use the method here so we'll use get cell amount and this is where our uh Little Helper method here comes in handy because now we've already implemented the cell amount in two different places and so we would already have two different places that we would have to update our code instead of just this Central one cool so that should indeed update that and everything should be working so let's try this out so let's find our node UI script let's drag our amount here the text object right into that field let's hit play and now let's build one of each turret and let's select them so this one here sells for 175 this for 125 and this for 50 and we can sell them for those appropriate amounts you can see how money went back up awesome so the last thing that I wanted to do was just create some kind of sell um not animation I wanted to create some kind of cell effect so in order to do this let's use an effect that we uh already have and uh let's create the effect and then implement it in code or the other way around let's do the coding uh thing first so uh in order to do this all we need to do is um find the place in our node where we set the tart and you can see we've already made a comment here so we want to do the exact same thing as when we're instantiating uh an effect up here when building it so let's just duplicate that code and all we're doing is instantiating build manager Dot and then instead of build effect we want to have a new uh reference called a cell effect and we'll create that in a second and we get the build position which is also the cell position which is the central point for our turret we have a cian do identity uh which is just um a rot of none and then we destroy that effect after 5 seconds so uh let's now go and that's basically all we need to do here so let's just go into our build manager and we'll find that in our scripts folder here the build manager and let's add just another public game object here so public game object and this is going to be our cell effect cool so that was all we needed to do in code so now we can just uh build this inside a Unity so let's go to prefabs and let's base this around our build effect and let's rename this one to cell effect and create a new prefab out of it and uh let's have a look at our particles here so these particles are let's turn on looping here and let's simulate these particles are floating upwards and since it's kind of a semipositive thing that is happening it is something kind of intangible uh the fact that you are getting coins um let's have the same effect but now let's color it differently so it's clearly uh coins or some kind of money or gold that is floating upwards so let's create a new material for this and let's instead of uh let's just actually duplicate the build effect let's call this one the cell effect and inside of our particles we then want to reference that cell effect so under the renderer drag in the cell effect under the material field and we can now uh select this material and we can make it kind of orange yellowish we want no metallic um we want to kind of bump up the smoothness and I actually want to saturate this more something something like that looks pretty nice that's just no metallic that's not good and let's also uh give it a tiny bit of emission because when we give it some emission it's going to have this very nice glowy feel and it's not actually going to illuminate the map it's just going to give us this nice uh color on the material and it's give it an emission of say Point uh three so let's see what that looks like I think that's a pretty nice combination between reacting to the LI in our scene and actually emitting shadows as well and then still having that glowy uh glowy feel I kind of also want to add some particle effect that are uh is thrown to the ground because our uh turret is currently just dematerializing and just disappearing in an instant let's create the um illusion that some parts of the turrets are that it's being split up into parts and falling down so in order to do that uh let's use another effect that we already have lying around and we could maybe use um the bullet would be a pretty good one we could also use one for destroying enemies so we have the enemy death effect here and I think this can very easily be modified to suit our needs so of course we don't want this to be a prefer uh a prefab right now and so I believe that we could just hit revert here nope um how is it that we disconnect this from being a prefab I actually never really do this so it's kind of you know what we'll do we'll just trick this so delete that and then we can go in here and we can create a new object and we can just paste that component in there and it won't have an effect on the prefab there we go so let's reset the Transformer on that and uh this one is going to be um kind of the debris and uh let's simulate this that already looks pretty good let's put on looping here so we can see what's going on and of course we want this to have a different material as well because this one is made for our enemies and that is pretty clear and let's actually maybe also bump down the emission a tiny bit to be between 10 and 15 I think that's enough actually no let's just go full particle overboard so this is the debris and uh let's find a material that matches here so we could actually just go ahead and use one of the materials uh that we use on our turrets and then in fact I think we should just do that so let's go under Imports onto the standard tart let's find our materials here and let's find our main color this gray tinted a tiny bit blue color and let's drag that in there and see how that looks so I think that looks pretty good it definitely gives the impression that there's some kind of debris lying around so now let's try and hit um let's select these particle systems and turn off looping that's a pretty important part let's try and hit play uh let's try and hit apply and let's now delete this prefab and uh let's also reference it so inside of our game master is where our build manager sits and now we just need to drag in our new cell effect cell effect into the empty slot and yeah let's try and hit play and let's try and sell something so I actually really like the effect we have going on here it's it's really subtle um but it's just there's something there and it feels nice I do think however that I want to modify it a tiny bit more before we close up here so let's find our sell effect here the debris um I'm not fully satisfied with this I want to move it up a bit first of all that's okay and then we can take uh and edit the shape here a tiny bit I want to um maybe do this in a hemisphere shape and I want to rotate this um by 90 so it kind of shoots upwards a little bit and I maybe also want to add a tiny bit of speed so something like between one and five that's a bit better just to give it a bit of bounciness like that that's a bit better and then let's also modify the material for this so um let's create a separate one changed my mind so let's create a separate one create material and this is going to be our cell effect and this is going to be the debris and this is going to be our cell effect um uh which is going to be our gold so this is going to be our gold there we go let's take our debris and drag it into the render Rod to replace here there we go and let's simulate and pause so we can see what's going on here and let's adjust this so um a bit of metallic maybe down with the smoothness and then we're going to need some blue tinted um kind of grayish color something like that is pretty nice I think the other one was simply too black so let's try and hit apply on that hit play see what this feels like so let's try and sell that and I actually really like this effect now that's perfect it might even be a tiny bit uh too bright so let's just try and do that and now I won't fiddle with this anymore uh I guess it makes for a bad video if I just sit here adjusting settings so we'll take our game over script and our node UI and drag that under the scripts and we'll have one last view of uh what this effect looks like and uh yeah I hope you enjoyed this video I definitely think that uh these features the UI here some selling and some upgrading are are very Central to almost any um tower defense game so it feels nice to have them in here and um if you have any other suggestions as to what I might cover definitely leave them in the um description or in the comment section down below uh because this was pretty much all of the really Central stuff that I wanted to cover so yeah let me know what you guys want to see and without further Ado I will see you in the next video thanks to all the awesome patreon supporters who donated in October and a special thanks to Sultan elative face of the marifi and James Kell Hound become a supporter at