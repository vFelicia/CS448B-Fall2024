hello everyone and welcome to video number 31 in a survival game series it's been a long time since the last one I've been busy with many things especially the new inventory system which you can get on the unity asset store for free links in the description and maybe even an annotation let's see how lazy I am and really check it out it's super cool and we're also going to be using it just a bit in this video so that's awesome okay so let's go ahead and dive into today's subject we are basically going to continue with weapon switching and we are going to make the weapon switching work with the inventory system so unless you download the inventory system and set it up using the inventory basics tutorial then you won't be able to follow along with the two first steps here so that's really all at least the second step so that's really necessary that you go ahead and watch that one okay cool so we're going to expand on that and then we are going to make the new weapon script which will make our character punch enemies and hit them as with swords and do all kinds of crazy stuff and also damage them awesome so let's get to it first off we will remove the old melee system and just have a look at what how we have it set up at the moment so so far we have been using the weapon switching to to switch between weapons and if we go under the player you can see now that we have in D&D inventory basics video we set this up so we have an inventory object here and we have all of the different stuff and if we hit play and go ahead and hit I it will bring up the inventory windows the character in the inventory window so that's what we have been doing so far so that's basically it and if we go into the main camera we can see that our old melee object is still here and remember in the old days we had the Emil easy switching script sitting here we're still going to have that but we're going to have another one which is included in the inventory pack and then on each weapon we have a script called melee system which would then damage the opponent this is it this is the script we're going to be creating just in a new version more advanced version we are just going to call it weapon so that's really cool so we can just go ahead and delete that now we know how it was set up before and under the arms the arm armature master inner arm right arm right hand right and then hold right melee Wow this is where our new weapon switching script is going to be and under that we can see that I have a empty game object with a position of 0 0 0 and the rotation should also be triple zero which is disabled we can go ahead and enable that and it's important that this is called fists within a capital F sore go ahead and call it that and make sure that that's the only game object parented to the meaty cool so now that we have all that in place we can go ahead and drag the weapon switching to under our scripts folder to get rid of that so like that whoops my computer is having some issues with dragging so let's just leave it but you can go ahead and drag it under the scripts folder I'll take care of that later now under the inventory folder here on this is the one you get when you install the inventory system we can go under scripts other and then we can see the weapon switch script this is what we are going to drag onto the fists object whoops not the fists object the melee object there and you can see once we apply that we have some different variables that we have to fill out and basically what the script is going to do it's going to check how many items we have equipped so if I run the game here you can see it's already working somewhat up in the left hand corner and this is right now interacting with our time of day slider but we can go ahead and move that in a second but you can see that it shows us the weapons we have equipped right now it's just a fist and that's because we don't have any weapons equipped so the default is two fists and it will make sure that if we have no weapons equipped it will spawn a fists object if we have one it will be that weapon and a fist subject if we have two weapons it will be those two weapons and a fists object and if we have three the first object gets destroyed and so we just can we can just select the three weapons it's a pretty advanced way to do it but it feels very natural in game that you can select only your hands when you have an empty slot available so okay cool so we're not going to go into scripting and that's I just wanted to point out how it works and now let's set it up so the way we have it here it wants the fist object and that's not the one under the melee that's a prefab so let's go ahead and drag the empty fists woops annoying dragging we should be able to drag oh man I can get this to work maybe I'll just go ahead and pause wait I got to work that but need to pause a few times in the middle of the video but we've made a prefab out of the fists and now we can go ahead and drag that prefab under the transform and remember this is still just an empty game object so let's see if we select the melee here maybe we can select it from the project pane nope it has to be done the hard way there we go drag the fists under the maximum number of weapons you want this to be too as long as you it is three in the inventory and the first an object we want that to be true because our character starts out with fists the skin you can choose whatever you want here if we just hit play a skin will be selected for you included in the inventory so I'll just go ahead and leave that then we have the switch between animation which will include the possibility for our weapon switching script to make sure that our hands will switch between punching and swinging a weapon so this is really only for this setup we have here so we are going to check that and then we are going to drag in the animator so if we select our arms or actually let's just go ahead and select it here so click there and then select the arms here and I've seen that's the animated we're going to be using if we just double click this weapon switching scripts just to see how it works and soomin on it a lot of you guys have been asking that i zoom in closer to the text so here we are that might be a too much there we go we can see that the animator what it does is that we check if it's a fist subject and if it is we will access the animator and say that weapon is not on so weapon is on equals false meaning that our whip our fists will be punching and in other cases the weapon is on will be true meaning that we will swing something so that handles all of the animation for us and of course you can go ahead and change up these different string values so if you have called it something else you can go in and use control F to find it and then change it awesome so moving on this is a lot of rambling but there's a lot of things I have to clear up now that we have that working we can go ahead and first of all test it and it seems to be working you can see we have open hands which means that our animators being exists and it knows that it's the fist we're using you can also see that we have enabled shadows again because in the new version of unity version of unity for 4.2 we can have hard shadows in unity 3 so that's really great so you can go ahead and enable that on the directional lights awesome so now that's that that's working let's go ahead and add the weapon script and I know that the fists here aren't really a weapon they're just hands but we will still wake make the weapon script for them also and the weapon script is going to be great because we're going to be able to use it on all kinds of different weapons and we don't have to change anything inside the script we can just play around with the variables to tweak the weapon to be how we want it so that's awesome let's go to fists then add component new script then the reason why I'm only using the fists is because I haven't made a video on how to make items that works with our inventory system yet so once that come once that comes out we can test it with other weapons and switch between them and you will see how cool it looks so let's just hit add component and let's name this weapon the language is going to be JavaScript create an ad and double click this this is the scripting part and it's going to get long and it's probably also going to get a bit boring for most and it's definitely enough for beginners so now that we have that warning out there let's go ahead and adventure out on it and let's just delete those two points because it makes me feel happy so great now let's make the new weapon and yes this is definitely going to be split up into several parts at least to Cole so first off we have the function start we can just go ahead and delete that and let's declare some variables the first one is going to be the damage you know that one and yes I am aware that I spelled the damage wrong but that's because I did it way back and then I just stuck to it because it doesn't really matter so the damage is selfexplanatory then we are going to have the distance or just distance which is going to be a type float then the max distance which this which is also going to be a type float but it's going to be equal 1.5 by default and this is going to be the range within our web where our weapon will be able to hit then we have the animator of type animator and this will allow us to access our animator or our controller to to do stuff like playing the hit animation and then another variable called damage delay of type float equals 0.6 and this is the time from we hit the button to where we want the damage to influence the enemy and this is great because swing animations usually take some times some time before the weapon actually hits the enemy and so we can use this to delay it before we use the event options we had with the builtin animation system in unity but now that we have imported a model with all of the animations built into that we can't really use that it's a kind of a fault of Meccan 'm if you asked me but we'll live with it we'll just make the damage delay then we're going to be two new lines and here we're going to do hit zero one streak and that's going to be equal to zero and then we have the hit zero two streak which is also going to be zero and these two variables are going to be used to making sure that whenever we randomize what hand is going to be hitting I'm sorry know what kind of attack we are going to be using so that I won't play the same attack animation all the time so whenever we randomize that we usually get the same animation playing three or four times in a row sometimes because we only have two and what we're going to do here is we're going to control that they jut don't go out in a streak but only play a maximum of like two times so it's still going to feel random but it's not going to be completely random but we'll get into that awesome now in the function update we can write if input that get buttondown fire 1 close parenthesis open new brackets and then we are going to do attack damage and this is a function we are going to be making right now this is just to make it easier for us so stay more organized and also because we're going to be using yield statements which you can't do inside of the update function so the function attack damage and open and close some brackets whoops there we go cool now the first thing we are going to be doing is let's say not doing any of the animation let's just begin with the basics of damaging and waiting and all that stuff yeah let's do that so now type a yield wait for seconds and yield wait for seconds is great for just delaying something and then using the damage delay you can also just type too and it would wait for two seconds it's that easy then we're going to be doing the actual attacking and here we are going to be using a ray cast actually let me just go ahead and explain what we could do instead but what we're not going to do because it's it's harder and more complicated and it's also usually more prone to errors let me show you here if I can so actually that's if I can use brushes yeah I can cool so basically many places in many games you you have this kind of combat where you have the the cylinder which is our let's say our players so this is our player and he holds the sword so this is his hand and in his hand we have a sword on that sword we then attack Collider so we then have a maybe a box Collider here and a nother box Collider here we then put scripts on to that checking if if we hit something so that's just basically a trigger object and I excuse my handwriting I really do but I'm using a mouse to do this so that's trigger object and they are going to look for our opponent capsule and this way we can use the builtin system physics system in unity to make combat but this really requires some great animation work and it relies a bit too much on the building physics system I think it's normally better you just to send out the array even though it feels more natural and then check the distance and whether or not it's hitting so that's what we're going to be doing with the raycast great so var hit rate of type ray cast hit then the VAR r ay equals camera dot main dot screen points array vector 3 and basically we are just telling it to send out a ray from the middle of our screen so screen dot width divided by 2 which makes the center of the width then screen that height and you guessed it divided by 2 so we have the center now and then 0 because we have surrounded Z and close it up empty parentheses so now we're sending out the Ray then we are going to check if the sixth ray cast so if we hit something the raycast ray come ahead then we want the hit that transform that sent message we want to send a message called apply damage remember to get the right amounts of MS in there with the damage we want to send that along with it and we want to not require a receiver or we are going to get a lot of errors whenever we hit something that's not an enemy so basically we are sending out the Ray we are gathering any information and what we want to do is we want to create an if statement now that will check the distance to our whatever we hit so distance equals hit that distance and if distance is less than max distance then we want to send to damage the enemy here so create some brackets around that there we go awesome so right below that if statements we are going to actually that has to do with the animation we'll just type it in so now let me explain how we can access the Meccan m animation and make changes to it it's done by of course using our reference variable up here so this way we have the controller and then we can change things inside of the controller by using the animator dot and now we can access the D mecanim controller then we want to do set bull for set boolean which means that we can make something true or false and then inside some parentheses we are going to type hit one this is the name of the parameter we are going to to tweak and then comma then what you want to declare this and we want to make it false like that and we are going to make another one called the animator set ball hit two is going to be false also and we can go ahead and save that up and that was 22 minutes so I'm going to go ahead and cut the video off here and then make another pot so look forward to that and thank you for watching I'll see you in the next video