With timestamps:

00:00 - hello everybody and welcome to the next
00:01 - video in this tutorial Series where
00:04 - we'll be continuing from where we left
00:05 - off and writing the rest of the front
00:07 - end now in the previous video we handled
00:10 - creating a challenge in this video we're
00:12 - going to be handling listing the
00:14 - challenges and then obviously accepting
00:16 - them and revealing our answer so let's
00:18 - get started by creating a new component
00:20 - that will show us all of the current
00:22 - challenges that are active once we're
00:24 - viewing the different challenges then we
00:25 - can start interacting with them by
00:27 - accepting them revealing the answer
00:29 - seeing who won Etc so I'm going to go to
00:32 - my source directory and I'm going to
00:34 - make a component and I'll just call this
00:37 - list
00:38 - challenges. JS now inside of here let's
00:41 - start by saying import
00:44 - react use State and use effect from
00:49 - react like that we're also going to
00:51 - import some components so we'll say
00:54 - import a button and a heading from our
00:58 - at this slash react I am then going to
01:03 - go here and create the component so
01:05 - we'll say function list
01:09 - challenges like before we want to take
01:11 - in our signer we need the signer so we
01:13 - can send transactions and we can get the
01:15 - address of our account and I'm going to
01:17 - set a bunch of state now the idea here
01:21 - is that I'm going to call my backend and
01:22 - I'm going to use an inspect request to
01:25 - get all of the challenges once I have
01:27 - them on the front end I'm going to sort
01:29 - the those challenges so I'm going to get
01:31 - all of the challenges that I created
01:33 - that I'm currently a part of that I was
01:35 - in before and then the ones that were
01:37 - submitted by other people that way we
01:39 - can have these curated lists of
01:40 - challenges and we can kind of organize
01:42 - them into a few different categories so
01:44 - I'm going to start by saying const
01:46 - current
01:48 - challenges and then Set current
01:52 - challenges is equal to use State and
01:56 - we'll start by making this a list I'm
01:58 - then going to say const my
02:00 - challenge set my
02:03 - challenge is equal to use State and for
02:07 - now this will be undefined now current
02:09 - challenges will be kind of the active
02:11 - challenges the ones where someone needs
02:14 - to uh what do you call accept the
02:16 - challenge or where there's no winner yet
02:18 - in the challenge okay my challenge will
02:20 - be any challenge I'm currently a part of
02:23 - so the one that I created or the one I'm
02:24 - an opponent in we're then going to say
02:27 - const my old challenges
02:30 - and then set my old
02:33 - challenges is equal to use State and
02:36 - this will be a list now this will be a
02:38 - history of all the challenges that are
02:40 - finished that have a winner that I
02:41 - participated in in the past we're then
02:44 - going to say const old challenges like
02:48 - this and then set
02:51 - old
02:53 - challenges is equal to use State and
02:57 - same thing here this will be a list and
02:59 - then we need a few last things we're
03:01 - going to say const loading set loading
03:06 - is equal to use State and that will be
03:09 - false we then are going to say const
03:12 - address this will be our address and
03:14 - then set address is equal to use
03:18 - State and this will just be an empty
03:21 - string to start okay I know that's quite
03:24 - a bit of code already but that is the
03:26 - state that we need now that we have that
03:27 - we're going to set up a use effect hook
03:30 - and as soon as this component is mounted
03:32 - what we are going to do is we are going
03:34 - to get the address from our signer so
03:38 - we're going to put in the dependency
03:39 - array here signer which means anytime
03:40 - the signer changes we'll refresh this
03:43 - and we're going to say signer question
03:45 - mark doget address now the reason I'm
03:48 - doing a question mark is because it's
03:50 - possible that we don't have a signer so
03:51 - I want to make sure we don't have an
03:52 - error so I put a question mark here I'm
03:54 - going to say doget address and then then
03:57 - and I'm going to say addr standing for
03:59 - address and then set addr or set address
04:03 - sorry and this is addr do to lowercase
04:07 - just to make sure that we don't get any
04:09 - errors with the
04:10 - capitalization okay so that is our first
04:13 - use effect now we're going to write a
04:14 - few functions we're going to say async
04:17 - function and then get
04:20 - challenges okay now inside of the
04:22 - challenges we'll say set loading is
04:24 - equal to true and then we'll just put a
04:26 - set loading equal to false here and this
04:29 - is where we'll do all of the code so get
04:33 - challenges we'll write that in a minute
04:35 - I just want to kind of hook everything
04:36 - up first and then we can write the
04:38 - individual functions I find it's easier
04:40 - to uh do it that way so we have get
04:42 - challenges now what I'm going to do is
04:43 - write another use effect and inside of
04:46 - this use
04:46 - effect I am going to say if the address
04:52 - changes then we want to get challenges
04:56 - now what I'm pretty much saying here is
04:58 - okay as soon as we set the address
04:59 - address and the address is modified
05:01 - we're just going to call the get
05:02 - challenges function so we reload those
05:05 - challenges and kind of resort them into
05:08 - their respective list because if the
05:10 - address changes that means we have a new
05:12 - player that we're looking at so their
05:14 - challenge or their previous challenges
05:16 - are going to be different so we want to
05:17 - refresh all of those challenges okay
05:19 - this is not really the most efficient
05:21 - way to go about doing things but for now
05:22 - this is perfectly fine okay so now that
05:26 - we have that we will just write a little
05:29 - bit of the what do you call it kind of
05:31 - UI and then we can write the get
05:32 - challenges function so let's say let
05:36 - button props equal to an empty object
05:40 - and we'll say if loading then button
05:44 - props do loading is equal to true so
05:47 - pretty much the same thing we had before
05:49 - and we're also going to say if not
05:51 - address then we're simply going to
05:53 - return just an empty jsx component
05:56 - because if we don't have an address then
05:57 - we're not going to have any challenges
05:58 - to display so we can just display
06:00 - nothing now other than that we are going
06:03 - to start returning our jsx code or our
06:06 - HTML so we're going to say return div we
06:09 - can give this a class name so we can say
06:12 - class name is equal to and I'll just put
06:15 - Center because I want this to be in the
06:16 - center of the screen we'll write that in
06:17 - a second and for now we'll set up a few
06:19 - headings and then we'll set up some more
06:21 - components and we'll kind of go through
06:22 - that but I'm going to say heading I'm
06:24 - going to say size is equal to large and
06:28 - the first heading will be the active
06:31 - challenges
06:33 - okay then we will go here and we're
06:35 - going to have another heading this is
06:37 - going to be old
06:39 - challenges and then this is going to be
06:42 - my history and where there any other
06:45 - ones we need we have my history old
06:47 - challenges and then active challenges
06:49 - that's actually fine for now we're going
06:51 - to write some more logic in a minute now
06:53 - we'll also put a button down here and
06:55 - inside of this button we'll say dot dot
06:57 - dot button props so we'll kind of Mark
06:59 - it as loading if we need to be we'll say
07:02 - on click is equal to get challenges the
07:06 - text in here will say update challenges
07:09 - so we can manually update the challenges
07:11 - by pressing this button and then we can
07:13 - say type is equal to submit or actually
07:18 - I don't think we need the type I think
07:20 - is actually fine if we leave that out
07:22 - and then we'll say the color scheme is
07:24 - equal to Blue and just make that a blue
07:26 - button now let's format our code okay
07:29 - perfect
07:29 - and let's start writing the get
07:31 - challenges function now remember that
07:33 - with get challenges we're actually going
07:35 - to use an inspect request so this means
07:37 - that we're not going to be sending an
07:38 - input we're just going to be inspecting
07:40 - the state of the caresan machine so to
07:42 - do that we're going to go to UIL and
07:44 - we're going to write a new function here
07:46 - that allows us to send an inspect
07:48 - request so what we'll do here is we'll
07:51 - say export
07:53 - const
07:54 - inspect and this will be equal to an
07:57 - asnc function this is going to take in
07:59 - some
08:00 - payload which is the inspect data so the
08:02 - method essentially that we're going to
08:03 - be calling now what we're going to do is
08:06 - create a response variable so we're
08:08 - going to say const response is equal to
08:10 - a wait and we can just use a very simple
08:12 - fetch so just a normal kind of HTTP get
08:15 - request that we'll send to our server so
08:18 - if we go look at util or not util sorry
08:20 - constants notice we have the default URL
08:23 - which is where the inspect endpoint
08:24 - exists so all we actually need to do is
08:27 - use this and then we need to append the
08:29 - payload here that we want to send and
08:31 - when we send that to our back end it's
08:33 - just a normal HTTP request and it will
08:36 - return the data for us so if we go back
08:37 - to util here I've put in some back ticks
08:40 - and I'm going to embed my variables so
08:42 - I'm going to say the default URL from
08:44 - constants make sure you import that and
08:47 - then we're going to say that this is
08:48 - going to be
08:50 - json. stringify and we are going to
08:53 - stringify the payload and that's all we
08:55 - need to do so we're just sending a
08:57 - simple fetch get request so now we're
08:59 - going to say if the
09:03 - response. status is equal to 200 which
09:06 - means it was successful and we'll just
09:08 - do three equal signs so we don't get
09:09 - yelled at by JavaScript then we'll say
09:12 - the result is equal to a wait the
09:15 - responsejson and then we will return the
09:18 - result. reports now what we're able to
09:21 - do is access this reports object this
09:24 - will contain any of the reports that
09:26 - were generated when we sent this inspect
09:28 - request could be one report could be
09:30 - multiple reports Etc in our case it will
09:32 - just be one and that report will contain
09:35 - all of the different challenges so then
09:37 - we'll be able to access those challenges
09:38 - and utilize them how we see fit now
09:41 - otherwise we'll just say console.log and
09:44 - we'll say jon. stringify and we'll say a
09:47 - wait
09:49 - response. text like that because if it
09:52 - was not a status of 200 then we got some
09:54 - kind of error message so we'll get the
09:56 - text from the response and we'll just
09:58 - display that here
09:59 - okay that's all we need for inspect uh
10:01 - that should be that function so let's go
10:03 - back to list challenges and we can now
10:05 - utilize that function uh to actually get
10:07 - all of the challenges so we'll go inside
10:09 - of here and we will start by saying let
10:14 - results we can then say results are
10:17 - equal to a wait and we can call the
10:19 - inspect function from our util file and
10:21 - what we need to pass is our Json so
10:23 - we're going to say the method is equal
10:25 - to get challenges because that's what
10:28 - the back request is that we want we'll
10:31 - then say that the results are equal to
10:35 - json.parse and what I need to actually
10:37 - do is I need to convert what's going to
10:39 - be a hexad decimal uh value into a
10:42 - string so what's going to happen if we
10:44 - go to util here is we are going to get
10:46 - the Json and inside of the Json here
10:49 - what we're actually going to have is a
10:51 - list of reports right so we access those
10:53 - list of reports now all of those reports
10:55 - are going to be hexadecimal because we
10:57 - have to only send and receive hex
10:59 - decimal data so what I need to do is
11:01 - actually convert that hex decimal data
11:03 - to a string so what I'm going to do is
11:04 - use a utility function here called hex
11:07 - to string that will do the conversion
11:08 - for me so I'm going to go here and I'm
11:10 - going to make another function I'm going
11:11 - to say export const hex to string this
11:15 - is going to take in some hex data and
11:18 - it's just going to return a string so
11:19 - we're going to say try and this is going
11:21 - to be ethers doils do2 and then utf8
11:27 - bytes like that this is how we convert
11:29 - the hex decimal value to a string so
11:31 - we'll just pass hex and we will simply
11:34 - return that we'll then say catch e so a
11:37 - catch some exception and we will just
11:40 - return whatever the hex decimal value
11:42 - was now I'll just put an underscore here
11:44 - so it get doesn't get marked as an
11:45 - unused variable okay so we have our hex
11:48 - to string now we'll go back here and we
11:50 - will utilize that function so inside of
11:53 - here we are going to say Json parse and
11:56 - then this is going to be hex to string
11:59 - and it's going to be results
12:01 - z. payload and then we're going to take
12:04 - the Json and we're going to access the
12:08 - challenges now what are we doing here
12:10 - well we're going to have a list of
12:13 - reports that's what's returned here
12:15 - those reports well there could be
12:17 - multiple but in our case there's just
12:18 - going to be one so what we do is we
12:20 - access the first report and then we get
12:22 - the payload associated with that report
12:24 - which is the data that contains all of
12:26 - our reports we then convert this hex
12:28 - decimal value into a string we parse it
12:31 - as Json and we access the challenges key
12:35 - now to refresh you if we go back in to
12:37 - main.py and we have a look at get
12:39 - challenges notice that what we're
12:41 - returning is an object that has the key
12:43 - challenges so this is going to access
12:45 - the list of challenges for us that's
12:47 - what we're doing okay so that's what
12:49 - we're getting here with our results now
12:51 - that we have that we need to take all
12:52 - these results and we need to sort them
12:54 - into their appropriate categories so
12:56 - we're going to say con current
12:59 - challenges is equal to an empty list
13:01 - we're going to say let my challenge
13:04 - equal to undefined we're going to say
13:08 - const old challenges is equal to an
13:12 - empty list we're going to say const my
13:14 - old challenges is equal to an Mt list as
13:16 - well now we're going to iterate through
13:18 - all of our challenges so we're going to
13:20 - say
13:21 - const if we can type that correctly and
13:23 - this will be challenge of results and
13:26 - this needs to be a for Loop okay that
13:29 - will fix it for us so con challenge of
13:31 - results and what we need to do is sort
13:34 - these challenges so we need to figure
13:35 - out first of all is the current user so
13:38 - the person signed in whatever their
13:39 - address or account is are they a part of
13:41 - this challenge so the way we can do that
13:43 - so we can say const user
13:47 - participated okay if we spell that
13:49 - correctly is equal to and this will be
13:51 - the challenge do opponent is equal to
13:56 - the address or the challenge. Creator is
14:01 - equal to the address remember address is
14:03 - the address of the person signed in on
14:05 - our challenge we have an opponent and we
14:07 - have a Creator if they are either the
14:09 - Creator or the opponent so our current
14:11 - address then they participate in this
14:13 - challenge let me just format that code
14:16 - okay now what we'll say is
14:19 - if the challenge. winner and the user
14:24 - participated what that means that the
14:26 - challenge is finished so it's no longer
14:27 - active because there's a winner so as
14:29 - soon as we have a winner we know the
14:30 - challenge is done and if our user
14:32 - participated in that that means that
14:33 - this is part of their history so we're
14:35 - going to say my old
14:37 - challenges. push and we'll simply push
14:40 - the challenge inside of there now we'll
14:42 - have an else if and we'll say else if
14:44 - the user participated so if there was no
14:46 - winner but the user participated that
14:49 - means this is currently an active
14:50 - challenge so we're going to say my
14:52 - challenge is equal to user participated
14:56 - because the user can only be in one
14:57 - challenge at a time so if the challenge
14:58 - is not yet finished and they're part of
15:00 - it that means this is the challenge
15:01 - they're currently active in we're going
15:04 - to have another else if and we're going
15:05 - to say else if challenge. winner so what
15:08 - this is really checking now is if there
15:09 - was a winner and the user did not
15:11 - participate because if there was a
15:12 - winner and the user did participate it
15:14 - would have already been caught then what
15:15 - we can do is say old
15:18 - challenges. push and then this will be
15:22 - the challenge and then
15:25 - lastly if there was no winner and the
15:27 - user was not a part of it that means
15:29 - that this is an active challenge that
15:31 - the user could potentially join so we're
15:33 - going to say current challenges. push
15:37 - and then challenge like so okay so now
15:41 - that we've done that inside of the for
15:42 - Loop we need to set all of our state so
15:44 - we're going to say Set current
15:46 - challenges and then current challenges
15:49 - we're going to say set my Challenge and
15:52 - this will be my challenge we're going to
15:54 - say set old
15:56 - challenges and we'll set this to old
15:58 - challenge challenges and lastly we'll
15:59 - say set my old challenges so let's fix
16:03 - that and this will be my old challenges
16:06 - okay and then we'll set loading to false
16:08 - and that is the get challenges function
16:11 - Okay so we've now written the get
16:12 - challenges function we have pretty much
16:14 - everything done for this component what
16:16 - we need to do now though is we need to
16:17 - start actually viewing our different
16:20 - challenges now to be able to view these
16:22 - we need to have a list of challenges and
16:24 - we need to display those now to display
16:27 - those I'm going to make another
16:28 - component
16:29 - because there's quite a bit of data we
16:30 - want to display for any given challenge
16:32 - so I'm going to make a new component
16:33 - here inside of
16:34 - source I'm going to call this
16:38 - challenges. JS now this will take a list
16:41 - of challenges and it will display it for
16:43 - us so let's start writing this we're
16:45 - going to say
16:46 - import
16:48 - react use state from react we're going
16:53 - to say import and this will be button
16:57 - use toast
17:00 - heading and select from and this will be
17:04 - the Chara UI react we then are going to
17:09 - import a few other things we need we're
17:10 - going to say import generate commitment
17:14 - so we have that here as well as the send
17:18 - input because we'll need this when we
17:19 - want to accept a challenge or reveal a
17:21 - challenge we then will say import and
17:25 - we're going to import the move key as
17:27 - well as the key from local storage
17:30 - because when we end up revealing our
17:31 - answer we're going to do that from this
17:32 - component so now we're going to have a
17:35 - function which is our component we'll
17:37 - call this
17:39 - challenges and this will take in the
17:41 - following a list of challenges the
17:44 - address of the current user the signer
17:48 - and it will have show accept which is
17:50 - equal to false now show accept is going
17:53 - to tell us if we should show the
17:55 - accepting of the challenge or not so
17:57 - show the button that says accept
17:58 - challenge essentially means this
18:00 - challenge is active but we've not yet uh
18:02 - what do you call it accepted or we're
18:04 - not a part of it now up here we have a
18:06 - few basic things we need we're going to
18:07 - say con toast is equal to use toast
18:09 - again we're going to use this when we
18:11 - end up sending an input so that's why we
18:12 - need that we're going to have const
18:15 - Choice which is a state variable and
18:17 - then set choice is equal to use State
18:20 - and for now we'll set that equal to one
18:22 - and the reason why we have this is
18:24 - because we're going to need to have the
18:25 - user be able to select what choice want
18:28 - if they accept a challenge so this
18:30 - component here is what's going to handle
18:32 - displaying a list of challenges and then
18:33 - also displaying if we should accept a
18:35 - challenge or if we should reveal our
18:37 - answer so we'll write those U functions
18:39 - in a minute but for now we just want to
18:40 - display the challenges so we're going to
18:42 - say return a div and we're going to say
18:45 - the class name is equal to and this can
18:48 - be challenges now we'll style this all
18:50 - later but for now we want to map out the
18:52 - challenges so inside of here we're going
18:54 - to take our challenges and we're going
18:56 - to map them and we're going to say
18:58 - challenge like this and what we're going
19:01 - to do is actually set up a few variables
19:03 - that we're going to use when we kind of
19:05 - return information about our challenge
19:07 - so what we want to do with every single
19:08 - challenge is we want to understand if
19:10 - we're a part of this Challenge and we
19:12 - want to know if we're the opponent of
19:13 - this challenge or if we're the person
19:15 - who created it so what we're going to do
19:17 - is have a variable and we're going to
19:18 - say let data is equal to an object and
19:20 - we're going to say the opponent
19:22 - underscore move is equal to an empty
19:25 - string we're going to say your move is
19:28 - equal to an empty string and then we'll
19:30 - say the opponent is equal to an empty
19:33 - string now I'm just going to fix this so
19:34 - it's not snake case because I thought I
19:37 - was typing in Python there and then what
19:40 - we can do is the following so what we're
19:42 - going to figure out now is okay are we a
19:45 - part of this Challenge and are we the
19:47 - opponent or are we the Creator the
19:49 - reason why I've set up these variables
19:51 - here is because I want to know who I'm
19:52 - playing against so I'm going to say the
19:55 - opponent whoever I'm playing against not
19:57 - necessarily the opponent associated with
19:58 - the challenge but if I was the opponent
20:00 - of the challenge then who we'd put here
20:02 - is the creator of the challenge I'm not
20:04 - sure if that's making sense but if we
20:06 - look at main.py for example every
20:08 - challenge has a Creator and an opponent
20:10 - now if we are the opponent technically
20:13 - our opponent in this challenge is the
20:15 - creator of the challenge I know it's a
20:17 - bit confusing how I set it up if I did
20:18 - like player one player two that might
20:20 - have been a bit easier to understand but
20:22 - that's why I'm going to use this data
20:23 - and you'll see how it works so I'm going
20:24 - to say
20:26 - if the challenge
20:29 - do Creator is equal to the address so
20:32 - that means if the creator of the
20:34 - challenge is us then what we're going to
20:36 - do is say data is equal to the following
20:40 - we're going to say the opponent move is
20:42 - equal to the challenge dot the opponent
20:47 - uncore move we're going to say your
20:50 - move is equal to the challenge. the
20:55 - Creator move because we're the Creator
20:56 - so our move is whatever the Creator's
20:57 - move is is and then we're going to say
20:59 - the opponent is equal to the
21:02 - challenge do opponent now otherwise
21:05 - we're simply going to do the opposite
21:07 - we're going to say data is equal to and
21:10 - we're going to say the opponent move is
21:13 - equal to the challenge.the Creator move
21:17 - we're going to say your move so let's
21:19 - type this correctly is equal to the
21:22 - challenge dot the opponent move and we
21:26 - need to put this with an score because
21:28 - that's how it's returned from our back
21:30 - end and we are going to say that the
21:32 - opponent is equal to the challenge.
21:36 - Creator okay so now we've mapped out who
21:39 - the opponent is and uh who the creator
21:42 - of the challenge is so now that we have
21:44 - that we'll go down here and we'll start
21:46 - returning some information about the
21:48 - challenge so we got to do this inside of
21:53 - our curly brace and inside of the map so
21:57 - we're going to say return div
21:58 - and this is one individual challenge
22:00 - that we're returning so I'm going to say
22:02 - class name is equal to a
22:05 - challenge let's close off our div let me
22:09 - just format this code a little bit so
22:10 - it's bit easier to read let's go inside
22:13 - of the div and return our information so
22:15 - first we're going to set up a heading
22:17 - now inside of the heading we're going to
22:19 - say this is Challenge number and then
22:22 - the
22:23 - challenge dot challengecore ID again if
22:28 - we want the data being returned we can
22:29 - have a look here we have the challenge
22:31 - ID so we're going to put the challenge
22:33 - ID so we know what number this challenge
22:35 - is we're then going to say the following
22:38 - data.
22:39 - opponent and so let's go and here we're
22:43 - going to put a paragraph tag and inside
22:45 - of the paragraph tag we're going to have
22:47 - a strong tag and we're going to say the
22:51 - opponent colon and then data do opponent
22:56 - now the reason why I'm doing this I'm
22:57 - saying okay if there's an opponent of
22:59 - the challenge then we'll display who
23:01 - that opponent is if there's non opponent
23:03 - because it's possible that we don't have
23:05 - one and it's just the Creator so this
23:06 - challenge maybe just was made we don't
23:08 - want to display that now we're going to
23:10 - do the same thing here we're going to
23:12 - say challenge Dot and this will be
23:15 - winner and we're going to do pretty much
23:18 - the same thing so we're going to have a
23:20 - P tag a strong tag we're going to say
23:23 - winner and then this will be colon and
23:26 - then we will say the
23:28 - challenge. winner however if we are the
23:32 - winner we don't want to just display our
23:35 - address because we might not know our
23:36 - address off hand what we want to do
23:38 - instead is we want to display you right
23:40 - we want to say you were the winner we
23:41 - don't want to just display the address
23:43 - of this user or the address of the
23:45 - opponent we want to say the opponent was
23:46 - the winner or you were the winner so we
23:48 - we know if we won or lost so what we're
23:50 - going to do is write a function here and
23:52 - this function is going to pretty much
23:54 - tell us if we are the address or not so
23:57 - we're going to say cont
23:59 - is address user okay and we're going to
24:03 - take in some
24:05 - address and we're going to say if the
24:09 - addr is equal to the address then we're
24:12 - going to return a strong tag and the
24:15 - style of this tag is going to be
24:18 - color green and we're going to say you
24:22 - now otherwise we'll copy this we'll put
24:25 - this here and we'll just return red and
24:28 - this will say
24:30 - opponent okay so let's save and format
24:33 - so what I'm doing is I'm having this
24:34 - function that takes in an address and it
24:36 - tells me if the address is equal to
24:39 - myself so if it is I just return this
24:41 - code that says youu in green otherwise I
24:43 - say opponent in Red so now what I can do
24:45 - is rather than displaying the challenge.
24:47 - winner I can wrap this in is address
24:52 - user and it will either say you or it
24:54 - will say opponent so that's what I'm
24:56 - going to display here
24:58 - now after we have the winner we want to
25:00 - show the different moves and we also
25:02 - want to show the buttons to either
25:04 - reveal or to accept the challenge so
25:06 - we're going to say data do opponent move
25:11 - does not equal
25:13 - undefined and so let's have and end here
25:17 - we're going to display a paragraph
25:20 - tag again we're going to have strong
25:22 - we're going to say opponent move colon
25:25 - and then we want to display what their
25:27 - move is
25:28 - so we're going to say
25:29 - data. opponent
25:32 - move okay now we're going to do the same
25:35 - thing here for our move so we're going
25:37 - to say data. your move and then we're
25:40 - going to say your move and we're going
25:43 - to fix this to say your move now
25:45 - similarly to the function we have here
25:47 - I'm going to write a function that will
25:49 - take the move and convert this move into
25:53 - uh the string representation so if we go
25:55 - to main. Pi when we return the the move
25:58 - the move is going to be an integer and
26:00 - this integer is 0o through uh three
26:03 - right so zero is none one is Rock two is
26:05 - paper three is scissors so what I want
26:07 - to do is take that number and I want to
26:09 - convert that into what the actual move
26:12 - is so I'm going to make a function I'm
26:15 - going to say const and this is going to
26:16 - say move to string and we're going to
26:19 - take in the
26:20 - move and we're going to return the
26:22 - string representation so we're going to
26:24 - return an object inside the object we're
26:27 - going to have zero
26:28 - and this is going to map to Hidden now
26:30 - if the move is zero that either means
26:33 - the player has not made the move yet or
26:36 - the move is currently hidden so we're
26:37 - going to say zero is hidden we're going
26:39 - to say one is Rock we're going to say
26:43 - two is paper and
26:46 - three is
26:47 - scissors we're then going to index at
26:50 - move and simply return that so again
26:52 - just kind of doing a very simple mapping
26:54 - here for the move to string and now
26:56 - we're going to wrap this so move to
26:59 - string for data. opponent we can copy
27:03 - this function paste it here and wrap
27:05 - this so now again it will display
27:08 - whether it's hidden or if it's rock
27:09 - paper or scissors okay I know we did a
27:12 - lot of stuff here for now I think this
27:14 - will actually display our different
27:16 - challenges so what we need to make sure
27:18 - we do now is export this so we're going
27:19 - to say export default Challenge and
27:23 - actually do we call this challenge or
27:25 - challenges we call it challenges so
27:26 - let's do challenges and later in here
27:28 - we're going to write the different
27:29 - buttons associated with the challenge so
27:31 - again like accepting the challenge
27:32 - revealing the move Etc so let's go to
27:36 - list challenges and what we want to do
27:37 - now is use that component we just wrote
27:40 - so first of all let's export this one as
27:41 - well let's say export default list
27:45 - challenges and now we're going to import
27:47 - the component we just made so we're
27:50 - going to say import and this will
27:52 - be challenges from do challenges and
27:56 - we're going to start to displaying them
27:58 - under the correct heading so first of
28:01 - all we'll go here to where it says
28:02 - active
28:03 - challenges and we'll check if we have a
28:07 - challenge so if we're currently in a
28:08 - challenge so my challenge right if we
28:10 - have an active challenge that's the one
28:12 - that we want to display so we're going
28:13 - to say my challenge we're going to say
28:16 - challenges and then what we need to pass
28:18 - is all of our properties so we're going
28:20 - to say challenges is equal to we're
28:22 - going to pass a list that contains my
28:24 - challenge we're then going to say the
28:26 - address is equal to the address and the
28:31 - signer is equal to the
28:33 - signer okay now we're going to say
28:36 - otherwise so if we don't have our
28:38 - current challenge so if we're not in a
28:40 - challenge we're going to display any of
28:42 - the other challenges that are active
28:44 - that we could accept so we're going to
28:46 - say
28:47 - challenges same thing we'll copy these
28:50 - so paste those in and this time for
28:54 - challenges this will be equal to the
28:56 - current challenges these are ones that
28:58 - we could accept and we're going to pass
29:00 - another prop that says show accept equal
29:03 - to True let's format that so you're able
29:06 - to read it and here we go so we're
29:08 - saying okay if we have a challenge that
29:10 - we're currently a part of display that
29:12 - otherwise display any of the challenges
29:15 - that are currently active that we could
29:17 - join great so that handles that now
29:20 - we'll go handle old challenges and my
29:22 - history so we're going to do this we're
29:25 - going to say old challenges length is
29:28 - greater than zero if that's the case
29:31 - then we want to display the following so
29:34 - we're just going to do an empty
29:35 - component here and inside we're going to
29:37 - put a heading let's format that and then
29:40 - below this we're going to put challenges
29:42 - we'll just copy this okay we're going to
29:43 - get rid of show accept and for the
29:45 - challenges we want to display it's not
29:46 - going to be current challenges it's
29:48 - going to be old challenges let's format
29:50 - that let's copy this exact same thing
29:53 - let's replace my history here with the
29:57 - heading
29:58 - okay and then for challenges rather than
29:59 - old challenges we're going to say my old
30:03 - challenges because that will be our
30:05 - history okay quick recap again showing
30:08 - the active challenges ones that we're a
30:10 - part of or that we could accept
30:12 - otherwise we're showing a history of all
30:14 - of the old challenges and then all of
30:15 - the old challenges that we are a part of
30:17 - now we just need to change this to say
30:19 - my old challenges so this matches with
30:22 - what we're displaying okay so that
30:24 - should now allow us to list all of the
30:26 - challenges and we can't interact with
30:28 - them yet but we can list them now what
30:30 - we're going to do is go to app.js and
30:32 - we're just going to write the component
30:34 - that will list the challenges so to do
30:37 - that we can just put a div here so list
30:40 - challenges like that and we have to pass
30:43 - our signer equal to the signer okay now
30:47 - I'm just going to wrap the create
30:49 - Challenge in a div as well we'll do some
30:52 - styling in a minute but for now that
30:54 - should be okay and obviously I imported
30:57 - list challenges here just happened
30:58 - automatically when I started typing it
31:00 - but you could see I have that imported
31:01 - here from my component okay so now what
31:03 - we want to do is to rerun our react
31:06 - application not sure if this is
31:08 - currently running but we will restart it
31:11 - that'll take a second once it's running
31:13 - I be back and we'll make sure that this
31:15 - is working all right so I just load up
31:17 - the page and I can see that I'm getting
31:18 - an error already here for uh one of the
31:21 - components we have so let's just make a
31:22 - very quick fix we're going to go over to
31:25 - list challenges and where we have have
31:27 - this loading here so for the button
31:29 - props we just need to change this to say
31:31 - is loading so I just made a mistake
31:33 - there we're just going to set that to is
31:35 - loaded okay go back here and we should
31:38 - see now if we
31:39 - refresh that this fixes itself and for
31:43 - some reason this is loading when it
31:45 - really should have stopped loading which
31:47 - tells me we're probably getting an error
31:49 - or we're not sending the request
31:51 - successfully so let's have a look at our
31:52 - back end here and let's see if the back
31:54 - end is receiving a request okay it's not
31:56 - receiving a request so let me just rerun
31:58 - this because it's possible uh that I
32:00 - made a mistake here and there you go we
32:02 - see now that if we refresh
32:05 - this okay we're getting an error let me
32:08 - have a look here and I will be right
32:09 - back all right so I was just doing a bit
32:11 - of debugging and I realized that the
32:12 - error we have here is that in our hex to
32:15 - string method we're doing two utf8 bytes
32:18 - when I want two
32:19 - utf8 string so we were actually
32:22 - converting a heximal value to a heximal
32:25 - array which was causing an issue for us
32:28 - so if we go here now and refresh we
32:31 - should see that I was just doing some
32:32 - logging and we're getting challenges
32:34 - with an empty list and now this update
32:36 - challenges is working so if we go back
32:39 - to list challenges I was just printing
32:40 - out this value before what was happening
32:43 - is this hexa string was giving us the
32:44 - wrong value so when we tried to parse it
32:46 - with Json we were getting an error now
32:48 - though it is working so if we go back
32:51 - here we can have a look at our back end
32:54 - and we'll see that it's generating
32:55 - reports every time time we press this
32:58 - button so we're sending a request and
33:00 - pretty instantly generating the report
33:02 - now what we'll do is we'll make a new
33:04 - challenge and we'll actually see if we
33:06 - get the updated challenge here so I
33:08 - might need to change accounts but we can
33:10 - try this confirm we'll see if this goes
33:13 - to our back end and then we can update
33:15 - our challenges all right so our input
33:17 - has been added we're going to update
33:19 - challenges here uh and we got an issue
33:21 - here it says challenge object has no
33:23 - attribute commitment did you mean
33:25 - commitments okay so we probably just
33:27 - made an error here challenge.
33:29 - commitment. getet in line 150 so let's
33:32 - go fix that in our
33:34 - main.py okay main.py and I have
33:37 - commitment when that needs to be
33:39 - commitments silly error but hopefully
33:41 - now if we rerun our backend let's go
33:44 - here and rerun it and we go back to our
33:47 - front end we can now refresh and we can
33:50 - send another request so let's go create
33:54 - Challenge and let's go ahead and make
33:56 - one here
33:58 - okay we should see that pop up in the
33:59 - back end let's give this one
34:01 - second okay any minute now we'll see
34:04 - that it will make a new challenge for us
34:06 - okay so adding notice challenge with ID
34:08 - was created and now let's go to update
34:11 - challenges and again we got an issue
34:13 - with say challenge object has no
34:15 - attribute winner okay we probably called
34:17 - it winner address again we can go and
34:20 - fix that so we're trying to access a
34:23 - winner if we go to look at our challenge
34:26 - so let's go to challenges. py we have
34:30 - winner address okay so what do we call
34:32 - it here winner address winner address
34:34 - okay so let's go back and change this to
34:37 - winner address of course and we're going
34:40 - to have to test it again okay so
34:44 - rerun and let's refresh and let's make
34:47 - another
34:49 - challenge okay go ahead and run same
34:53 - thing wait for our backend to pick this
34:55 - up and then maybe maybe third times the
34:57 - charm will be able to actually receive
35:00 - this new challenge okay notice created
35:02 - let's click the button and challenge is
35:05 - popping up now for some reason it's not
35:06 - really displaying any data for us as
35:08 - challenge ID the Creator is here the
35:10 - opponent is null winner is null opponent
35:13 - committed false opponent move and
35:14 - Creator move it's not showing us the
35:16 - data that we want to see let's go have a
35:17 - look at our console and see if we're
35:19 - getting any error and it says we should
35:21 - have the unique key prop okay we can fix
35:23 - that uh but it should still be showing
35:25 - some stuff for us so let's go and debug
35:27 - this and figure out what the issue is
35:29 - all right so silly mistake here but I
35:31 - have my challenge equal to user
35:33 - participated when it should really be
35:35 - equal to challenge okay so if we go back
35:39 - now it should just pop up and it says
35:41 - Challenge number zero your move is
35:43 - hidden okay so that's what we were
35:44 - looking for now we could display some
35:46 - text that says we're waiting for an
35:47 - opponent or something but for now that
35:49 - is what we were looking for again we're
35:51 - going to do the styling after but this
35:53 - is working it's now displaying this
35:55 - challenge now we want a way to be able
35:57 - to accept these challenges so that's
35:59 - what we'll work on next and once we
36:01 - accept them we'll be able to actually
36:02 - display some more information about the
36:04 - challenge okay so let's go ahead and do
36:06 - that we're going to go into challenges
36:08 - and we're going to start popping up the
36:10 - button that allows us to actually accept
36:12 - the challenge so how we going to do that
36:15 - well first of all we need to know if we
36:16 - should be displaying it or not so we're
36:18 - going to go inside of this div and we're
36:21 - going to write a condition where we say
36:23 - okay well if we passed show accept that
36:25 - means this is a challenge that's active
36:27 - that we can accept so we'll say show
36:29 - accept and then we're going to put an
36:31 - empty jsx component and inside of here
36:34 - we're going to put a select field that
36:36 - will allow the user to actually select
36:38 - what option it is that they want when
36:40 - they kind of accept the challenge and
36:41 - we'll challenge this person so we're
36:43 - going to say Focus border color is equal
36:45 - to Yellow we're going to say the size is
36:48 - medium we're going to say the value is
36:51 - equal to choice and we're going to say
36:54 - onchange this is equal to a function
36:58 - this function takes in the
37:00 - event okay so we'll say set Choice and
37:03 - then event. target. value just like we
37:08 - had in the other input component okay so
37:10 - this is our select field inside of the
37:12 - select field we need our options so
37:14 - we'll
37:15 - say option if we could type this
37:19 - correctly we're going to say value is
37:21 - equal to one option one is
37:25 - Rock then we will copy this and have
37:28 - value two and value three and this will
37:30 - be
37:32 - paper and this will be scissors like so
37:36 - okay those are our three options we then
37:38 - need the button for the button we'll
37:40 - have the onclick the on click will be
37:43 - equal to a function that we'll write in
37:44 - 1 second and we'll have the color scheme
37:48 - equal to green and then we will say
37:51 - accept
37:52 - challenge okay so now we need a function
37:54 - that we're going to call when we press
37:56 - this button however we can test that the
37:58 - button is appearing correctly by going
38:00 - here refreshing and changing our account
38:03 - to someone who did not create this so
38:05 - we're going to go to account six and
38:07 - connect this guy and then refresh and
38:10 - now you can see it says the opponent is
38:12 - this the opponent moves is hidden and
38:13 - it's showing us that we can accept the
38:15 - challenge again we'll fix the styling
38:17 - later on don't worry about that now we
38:19 - will fix this key prop so let's go ahead
38:21 - and do that we're going to go here to
38:23 - our div we're just going to say key is
38:26 - is equal to challenge. challenge ID just
38:30 - so that uh we don't get that error from
38:32 - react okay so now we need the function
38:34 - that we're going to call when we click
38:35 - the button so let's go ahead and make
38:37 - that function we're going to say const
38:40 - accept
38:41 - challenge is equal to a function this
38:45 - will be an async function and this
38:47 - function will take in the challenge ID
38:51 - that we want to accept and in fact we
38:53 - can just call this ID now what we need
38:55 - to do to accept to challenge is we need
38:57 - to generate our commitment string and we
39:00 - then need to send that to the back end
39:02 - so we're going to say con commitment is
39:04 - equal to await generate
39:07 - commitment we're going to generate the
39:09 - commitment with whatever our choices and
39:12 - with our CER we're then going to say
39:15 - wait send input and for our input we're
39:19 - going to say Json do stringify and we're
39:23 - going to write what it is that we need
39:24 - to pass so we're going to say the method
39:26 - is
39:28 - acceptor challenge because that's what
39:30 - we want to do we're going to say the
39:32 - commitment is equal to the
39:34 - commitment and the challenge ID is the
39:37 - ID then now that we have that let's
39:40 - format and we're also going to pass our
39:42 - signer because we need that to send the
39:44 - transaction and toast for the popups
39:47 - okay so that's all we need for accepting
39:48 - the challenge that will simply accept it
39:51 - for us let's go here and for our onclick
39:54 - we will just call the function which is
39:58 - accept Challenge and we'll pass the
40:01 - challenge. challenge ID so we know which
40:04 - one it is that we're accepting so now
40:06 - this should actually allow us to become
40:08 - the opponent of that challenge we'll see
40:10 - though because always there are errors
40:13 - let's
40:14 - refresh okay we should be able to accept
40:16 - the challenge so let's pop open our back
40:19 - end okay doesn't look like there's any
40:21 - errors so that's good and we're going to
40:23 - go accept
40:24 - challenge okay pops up met ask go ahead
40:28 - and click on confirm and we'll wait for
40:30 - that notice to appear on the back end
40:32 - and then we can refresh our challenges
40:34 - and we can see if we accept it okay so
40:36 - we got a uh notice here that says
40:39 - received Advanced request data method
40:41 - accept challenge says adding notice
40:43 - challenge with ID zero was accepted by
40:44 - this address okay that's a good sign
40:46 - let's update the challenges and there we
40:48 - go we now have the opponent the opponent
40:51 - move and our move so that's great now if
40:53 - we go back to our different account
40:57 - so let's switch this up and go to
40:58 - account 7even and refresh we see now
41:01 - that the opponent is the other person
41:04 - and both the moves are appearing so now
41:05 - we need to be able to reveal our answer
41:08 - all right so now we need to write some
41:10 - logic that tells us whether or not we
41:13 - should show the button that says reveal
41:16 - your answer because once we've accepted
41:18 - the challenge now both players have made
41:19 - their commitments and now we need to
41:21 - reveal and once both players reveal then
41:23 - we know who won so we're going to write
41:24 - some logic in a function called show
41:27 - reveal okay now this is going to take in
41:30 - the challenge and it's simply going to
41:32 - make sure that both players have already
41:33 - made their commitments and if they have
41:36 - it will show the reveal button so what
41:38 - we're going to do here is say if
41:40 - challenge.
41:42 - opponent and the challenge. opponent
41:46 - unor move does not equal zero then
41:50 - return false now let me explain this
41:51 - because this function is actually a bit
41:53 - complicated what we need to do in here
41:55 - is we need to only show the reveal
41:57 - button if both players have made a move
42:00 - but if we have not yet revealed our move
42:04 - so that's why you're going to see a
42:05 - little bit of logic here that might not
42:06 - make sense at first it's because we need
42:08 - to check two things first of all we need
42:09 - to make sure that both players have made
42:11 - a commitment we then need to make sure
42:13 - that ourselves have not already revealed
42:15 - because we don't want to display the
42:16 - button if we already revealed because
42:18 - that's going to be confusing right we
42:20 - only want to show the button if we need
42:21 - to still reveal so the first check is
42:23 - all right if this is equal to address
42:26 - which is what I meant to add here so if
42:29 - the opponent is equal to us and the
42:31 - opponent move is not equal to zero now
42:34 - if the opponent move is not equal to
42:35 - zero what that means is that either we
42:37 - haven't made a move so we haven't
42:39 - committed or we have already revealed
42:42 - our move because if the move is 1 two or
42:44 - three that means we've revealed what it
42:46 - is because it's now displayed on the
42:48 - blockchain so that's what we're checking
42:49 - here now we do the exact same thing so
42:52 - if challenge. Creator is equal to
42:55 - address
42:57 - and the challenge. Creator move does not
43:00 - equal zero then return false so same
43:02 - thing here but now we're just checking
43:03 - if we the Creator because we could be
43:05 - the opponent or we could be the Creator
43:06 - we don't know then once we've handled
43:10 - those cases we're going to return the
43:11 - following we're going to say return
43:13 - challenge. opponent move does not equal
43:17 - undefined and the challenge. Creator
43:21 - move does not equal
43:22 - undefined
43:24 - and the challenge does not have a winner
43:28 - so as a quick fix we can actually make
43:29 - these the double equal to sign that
43:32 - should work we might have to fix this
43:33 - but I think this is fine for right now
43:35 - and what we're checking in this
43:37 - condition is okay has the opponent made
43:40 - a move so if they have made a move and
43:43 - we have made a move and there's not a
43:45 - winner if there's a winner that means
43:46 - the challenge is over then we can go
43:48 - ahead and display the reveal button now
43:51 - when we check is not equal to undefined
43:53 - well we're saying okay have you
43:54 - submitted a commitment or alternatively
43:57 - have you already revealed your move if
43:59 - both the opponent and the Creator have
44:01 - done that and we don't have a winner we
44:03 - can go ahead and display the reveal
44:04 - button so now we need to use that
44:06 - function so we're going to go and write
44:09 - some logic here inside of this so after
44:12 - your move we're going to have show
44:16 - reveal we're going to pass in the
44:18 - challenge and we're going to say
44:20 - question mark and we're going to put a
44:22 - button here this button will say reveal
44:24 - move we will say that the color scheme
44:27 - of this
44:28 - button so color scheme is equal to
44:34 - Kine and then we'll say on click and
44:38 - we're going to call a reveal function
44:39 - which we'll write in a second and then
44:41 - otherwise we're just going to put some
44:43 - text so we'll put a P tag
44:45 - here and we'll say waiting dot dot dot
44:49 - okay because we're waiting on something
44:51 - to occur before we show this button so
44:54 - if we go here it shows the the reveal
44:56 - button which is what we want because at
44:58 - this point the challenge has been
45:00 - created and both players have accepted
45:02 - it now let's just make sure it works
45:03 - from the other side so if we switch over
45:05 - to account six and then refresh you can
45:08 - see it is working here as well okay so
45:10 - now we need to write the actual Logic
45:12 - for revealing the move now we've been
45:14 - through this a few times but I will
45:16 - explain it again so let's write a
45:17 - function this will actually be the last
45:19 - bit of code we need to write we're going
45:21 - to say reveal
45:23 - move okay now this is going to be an
45:26 - sync function and the first thing we
45:27 - need to do to reveal move is we need to
45:29 - get what the move is which is stored in
45:31 - local storage and we need to get our
45:32 - secret key because we need to submit
45:34 - those to the blockchain so we're going
45:36 - to say Conn is equal to local storage.
45:40 - get item and then this is going to be
45:42 - the nons key plus the address Dot and I
45:46 - don't think we need to convert it to
45:47 - lowercase because I think we already did
45:49 - when we passed the address so I think
45:50 - it's actually fine if we just say plus
45:52 - address that's fine so that should get
45:54 - us our nonski we going to say cons move
45:57 - is equal to local storage. getet item
46:00 - and this is going to be the move key put
46:02 - that inside of brackets plus address
46:05 - okay we then are going to say await send
46:08 - input and this is going to be json.
46:12 - stringify and we're going to say our
46:14 - method is that we'd like to reveal the
46:16 - move and then to reveal the move we need
46:18 - to submit both the move and the Nots
46:22 - okay so move and Nots and then we need
46:26 - to pass here is the signer and the toast
46:30 - let me just format that and I think we
46:34 - are good to go okay so that should
46:36 - actually be it for revealing the move uh
46:40 - I did not pass the toast so let me fix
46:42 - that and I think we are good to just
46:45 - call this function so let's now go here
46:47 - to the on click and just call reveal
46:49 - move and let's go back and let's test
46:51 - this out so fingers crossed we are good
46:54 - to go we're just going to refresh for a
46:55 - good measures and we're going to reveal
46:58 - now it's going to pop up metamask here
47:00 - okay let's go ahead and confirm now
47:02 - we'll check our back end here and we'll
47:04 - see if we get any notices and if it
47:06 - tells us if we revealed
47:08 - successfully okay so it says adding
47:10 - notice this address revealed their move
47:12 - of rock okay very good now if we refresh
47:15 - you can see it's displaying our move is
47:17 - rock and we are currently waiting on the
47:19 - opponent now at this point again the
47:21 - opponent cannot cheat because of how
47:22 - we've set this up so if we go to account
47:24 - seven and and we refresh here it says
47:28 - the opponent move is rock your move is
47:29 - hidden you can reveal so let's go ahead
47:31 - and reveal and
47:33 - confirm okay we're going to give this a
47:35 - second and we need to have the Notice
47:37 - come in here so let's wait for the
47:39 - notice okay receiving notice challenge
47:42 - ended in a draw so let's update the
47:44 - challenges and it says Rock okay now it
47:47 - says waiting we actually wanted this to
47:49 - go into the old challenges so if I
47:51 - refresh this here yeah it's not going
47:53 - into Old challenges yet I guess that's
47:55 - actually actually because there is no
47:57 - winner so we're going to have to change
47:58 - a bit of logic to display this correctly
48:01 - because when there's no winner yeah it's
48:03 - not handling so we had a draw and it
48:06 - wasn't handling the draw so let's go and
48:08 - just fix that logic this will be pretty
48:09 - quick all right so I just wrote some new
48:11 - logic and this changes a few things
48:13 - because of how we handle a draw anyways
48:16 - what I was having an issue with is that
48:18 - again if both players didn't win we
48:21 - don't have a winner marked in the field
48:23 - so we don't know if the challenge is
48:24 - done or not so the way we have to
48:26 - determine if the challenge is done based
48:27 - on how I've coded this is we have to
48:29 - check okay is there a winner or have
48:33 - both the opponent and the Creator
48:35 - revealed their move so that's kind of
48:37 - what we're checking here challenge.
48:39 - opponent move and challenge. Creator
48:40 - move does not equal undefined notice I
48:43 - have this with one does not equal now
48:45 - what that means is that if this is zero
48:47 - so if their move is hidden then that
48:49 - will uh not count for this condition
48:52 - okay so if their move are hidden then it
48:54 - won't go into the history so what I've
48:55 - done is said const is the challenge done
48:57 - equal to this I've then replaced where I
48:59 - had challenge. winner with challenge
49:01 - done so I've said if the challenge is
49:03 - done and the user participated then it's
49:05 - their history otherwise if the user
49:07 - participated okay and then same thing
49:09 - here if the challenge is done push it
49:11 - into Old challenges now the only thing
49:14 - we haven't uh kind of handled is
49:16 - displaying draw or not draw and also
49:20 - that kind of waiting that you saw so if
49:22 - we go back here and we refresh it says
49:24 - my history zero this is the opponent
49:26 - this is the opponent move and our move
49:28 - and then it says waiting we don't want
49:30 - to display waiting if the challenge is
49:33 - done so what we should display instead
49:36 - is like winner is equal to draw or
49:38 - something or like the challenge ended in
49:39 - a draw so we can write some Logic for
49:41 - that as well if we go to
49:44 - challenges okay so we have show reveal
49:47 - challenge reveal move waiting now again
49:51 - we only want to display waiting if the
49:53 - challenge is not done so we can do a
49:55 - similar thing to what we did before and
49:57 - we can write a variable here it says
50:00 - const
50:02 - challenge done okay and actually we can
50:06 - do this down here and we can utilize our
50:09 - data variable so we can say con
50:10 - challenge done is equal to
50:13 - data.you move does not equal undefined
50:17 - and the data do opponent move does not
50:22 - equal undefined if that's the case the
50:24 - challenge is complete delete so we'll go
50:27 - here to where it says waiting and we'll
50:28 - simply put a condition here so we'll say
50:30 - if that's the case then we'll check the
50:32 - following condition the condition is
50:34 - going to be challenge done and so we'll
50:37 - say not challenge done and then waiting
50:40 - like that and then we can do something
50:43 - where we
50:45 - say challenge
50:47 - done and not challenge.
50:52 - winner and we display some text ended in
50:56 - a draw let's format here and that should
50:59 - actually wrap up our logic so again we
51:01 - added a variable that tells us if the
51:03 - challenge is complete exact same thing
51:04 - we did before here we're now saying okay
51:07 - only display waiting if the challenge is
51:08 - not done if the challenge is done and
51:10 - there wasn't a winner it's a draw so
51:11 - we'll say end it in a draw so now it
51:13 - should say end it in a draw and it does
51:16 - that is working now to test this let's
51:18 - do the same thing but let's actually
51:20 - make a challenge that someone wins so we
51:21 - have Rock here so let's make a new one
51:24 - okay can
51:25 - confirm we can open up our backend to
51:28 - verify that this is working we want to
51:31 - see a new challenge created here give
51:34 - this a second to appear okay challenge
51:35 - was created let's now go to our
51:38 - different accounts let's go account six
51:40 - refresh the
51:41 - page okay and we've got two things here
51:45 - reveal move and accept challenge so for
51:47 - reveal move we're going to need to fix
51:49 - that obviously because we don't want to
51:50 - display reveal move yet I think the way
51:53 - we can fix that is if we go go to list
51:56 - challenges and we go to show reveal so
52:00 - wherever I have that so that's inside of
52:02 - challenges sorry scroll scroll scroll
52:05 - let's get rid of the double equal sign
52:07 - which I actually don't think I need and
52:09 - if we fix that now okay perfect gets rid
52:11 - of that so it says opponent hidden
52:14 - waiting okay we had Rock before let's do
52:17 - paper and let's accept the
52:20 - challenge okay let's go ahead and click
52:23 - confirm all right right we can give this
52:26 - a second on our back
52:29 - end okay let's refresh and now we have
52:33 - ended a draw which we did not want to
52:37 - display okay so obviously a few things
52:39 - going wrong here guys sorry handling the
52:40 - draw was not something I thought of
52:42 - before so I'm kind of coding this on the
52:43 - Fly let me do a few fixes just to make
52:46 - sure that I'm not misleading you with
52:47 - all these changes and I'll be right back
52:49 - so a few slight changes here that have
52:50 - now fixed things first of all from list
52:52 - challenges I simply removed the does not
52:55 - equal undefined from challenge done so
52:57 - now challenge done is equal to
52:58 - challenge. winner or challenge. opponent
53:00 - move and challenge. Creator move so as
53:02 - long as those are a truthy value so not
53:05 - zero or not undefined then the challenge
53:07 - is finished which is originally what I
53:08 - wanted to have but uh I kind of coded
53:10 - incorrectly so that's my bad then then
53:13 - from challenge. JS I just got rid of the
53:16 - um showing the draw and showing the
53:18 - waiting just to simplify things so all I
53:20 - did was just remove the code that was
53:22 - showing if there was a draw or showing
53:23 - if there was any waiting just to make
53:25 - sure I didn't kind of over complicate
53:27 - stuff so for now you can see active
53:29 - challenges is correct it's showing our
53:30 - active Challenge and then we have our
53:32 - challenge history so let's now go ahead
53:35 - and try to reveal our move and let's see
53:37 - if this works now when we actually have
53:39 - a winner okay so this guy reveal this
53:42 - move let's go over to our back end and
53:45 - it should show us popping up in a second
53:48 - okay uh removed paper or revealed move
53:51 - of paper okay so now we have our move
53:54 - paper and the button goes away
53:56 - and then if we switch over to account
53:59 - seven and we refresh okay opponent move
54:02 - is paper we can reveal our move let's go
54:05 - ahead and do
54:07 - that
54:08 - okay give this a second to run and we
54:13 - are going to update the challenge and
54:15 - there we go we have our history so we
54:17 - have the first move and then we have
54:18 - this challenge it says the winner was
54:19 - the opponent the opponent was was paper
54:21 - our move was Rock so that's exactly what
54:23 - we are looking for that it shows either
54:25 - us or the opponent and just to show you
54:27 - from the other side if we go here to the
54:30 - opponent and we refresh the page it says
54:33 - the winner was us which is exactly what
54:36 - we are looking for okay so that is it
54:38 - and that is going to wrap up this
54:40 - tutorial now I know there was a lot of
54:41 - mess at the very end there I apologize
54:43 - guys but I'm just keeping it real with
54:44 - you this stuff does happen this is the
54:46 - life of a developer and actually reminds
54:49 - me we need to style this so let's style
54:51 - this and then we can wrap it up uh but
54:53 - this is kind of the core logic which we
54:54 - just finished so let's do some basic
54:57 - styling to do the styling we have a few
55:00 - classes uh we have the challenge class
55:03 - right so we're going to want to space
55:04 - those out a little bit in create
55:06 - challenge we have the challenge form if
55:09 - we go to list challenge we have the
55:12 - center class so let's just go into
55:14 - index.js and we can do a fair bit of our
55:17 - styling inside of there so first we'll
55:19 - say do challenge now what we'll do is
55:22 - we'll say this is a flexbox so display
55:25 - Flex say the flex
55:28 - direction is a column we'll say align
55:32 - items Flex start we'll say padding is 10
55:38 - pixels we'll say the flex is one and the
55:42 - width is
55:44 - 33% so let's fix that and then we will
55:47 - align items actually in the center so I
55:50 - don't know why I had Flex start we're
55:51 - going to put them in the center okay
55:53 - then we're going to have Dot
55:56 - challenges we'll make sure we added that
55:58 - class after but this is going to be
56:01 - width
56:02 - 100% we then going to have the display
56:06 - Flex we're going to have the flex
56:09 - Direction equal to row we're going to
56:12 - have align items in the center we're
56:16 - going to have justify content in the
56:19 - center and we're going to have margin
56:21 - top equal to 10 pixels okay
56:25 - lastly we're going to have Center we're
56:27 - going to say align item Center display
56:32 - flex and then the flex direction of
56:37 - column and then last few things here dot
56:40 - challenge form we'll just add some
56:43 - padding here of 20 pixels and we'll just
56:46 - text align
56:47 - Center and then we will have a button
56:50 - and for all our buttons we'll just add
56:52 - some margin to the top of 10 pixels now
56:54 - now don't worry about copying all of
56:55 - this out I will have it available from
56:57 - the link in the description so you can
56:58 - just grab it there uh but this is kind
57:00 - of the main styling that we need now
57:02 - let's see what that actually did to the
57:04 - page notice now that all of our
57:06 - challenges are going to be aligned in a
57:07 - 3X3 grid the way I did that was by
57:10 - adding the width of 33% for all of our
57:12 - challenges and kind of aligning them in
57:14 - the center we then have the create
57:17 - challenge form with a bit of padding we
57:18 - have some padding between our headers
57:20 - some padding with our buttons looks
57:22 - quite a bit better okay so now that is
57:25 - going to wrap it up that will be the end
57:27 - of this video in the next videos we'll
57:29 - handle deployment talking more about
57:31 - architecture Etc hope you guys have
57:33 - enjoyed this so far again the code is
57:35 - available from the link in the
57:36 - description and I will see you in the
57:37 - next
57:39 - [Music]
57:46 - video

Cleaned transcript:

hello everybody and welcome to the next video in this tutorial Series where we'll be continuing from where we left off and writing the rest of the front end now in the previous video we handled creating a challenge in this video we're going to be handling listing the challenges and then obviously accepting them and revealing our answer so let's get started by creating a new component that will show us all of the current challenges that are active once we're viewing the different challenges then we can start interacting with them by accepting them revealing the answer seeing who won Etc so I'm going to go to my source directory and I'm going to make a component and I'll just call this list challenges. JS now inside of here let's start by saying import react use State and use effect from react like that we're also going to import some components so we'll say import a button and a heading from our at this slash react I am then going to go here and create the component so we'll say function list challenges like before we want to take in our signer we need the signer so we can send transactions and we can get the address of our account and I'm going to set a bunch of state now the idea here is that I'm going to call my backend and I'm going to use an inspect request to get all of the challenges once I have them on the front end I'm going to sort the those challenges so I'm going to get all of the challenges that I created that I'm currently a part of that I was in before and then the ones that were submitted by other people that way we can have these curated lists of challenges and we can kind of organize them into a few different categories so I'm going to start by saying const current challenges and then Set current challenges is equal to use State and we'll start by making this a list I'm then going to say const my challenge set my challenge is equal to use State and for now this will be undefined now current challenges will be kind of the active challenges the ones where someone needs to uh what do you call accept the challenge or where there's no winner yet in the challenge okay my challenge will be any challenge I'm currently a part of so the one that I created or the one I'm an opponent in we're then going to say const my old challenges and then set my old challenges is equal to use State and this will be a list now this will be a history of all the challenges that are finished that have a winner that I participated in in the past we're then going to say const old challenges like this and then set old challenges is equal to use State and same thing here this will be a list and then we need a few last things we're going to say const loading set loading is equal to use State and that will be false we then are going to say const address this will be our address and then set address is equal to use State and this will just be an empty string to start okay I know that's quite a bit of code already but that is the state that we need now that we have that we're going to set up a use effect hook and as soon as this component is mounted what we are going to do is we are going to get the address from our signer so we're going to put in the dependency array here signer which means anytime the signer changes we'll refresh this and we're going to say signer question mark doget address now the reason I'm doing a question mark is because it's possible that we don't have a signer so I want to make sure we don't have an error so I put a question mark here I'm going to say doget address and then then and I'm going to say addr standing for address and then set addr or set address sorry and this is addr do to lowercase just to make sure that we don't get any errors with the capitalization okay so that is our first use effect now we're going to write a few functions we're going to say async function and then get challenges okay now inside of the challenges we'll say set loading is equal to true and then we'll just put a set loading equal to false here and this is where we'll do all of the code so get challenges we'll write that in a minute I just want to kind of hook everything up first and then we can write the individual functions I find it's easier to uh do it that way so we have get challenges now what I'm going to do is write another use effect and inside of this use effect I am going to say if the address changes then we want to get challenges now what I'm pretty much saying here is okay as soon as we set the address address and the address is modified we're just going to call the get challenges function so we reload those challenges and kind of resort them into their respective list because if the address changes that means we have a new player that we're looking at so their challenge or their previous challenges are going to be different so we want to refresh all of those challenges okay this is not really the most efficient way to go about doing things but for now this is perfectly fine okay so now that we have that we will just write a little bit of the what do you call it kind of UI and then we can write the get challenges function so let's say let button props equal to an empty object and we'll say if loading then button props do loading is equal to true so pretty much the same thing we had before and we're also going to say if not address then we're simply going to return just an empty jsx component because if we don't have an address then we're not going to have any challenges to display so we can just display nothing now other than that we are going to start returning our jsx code or our HTML so we're going to say return div we can give this a class name so we can say class name is equal to and I'll just put Center because I want this to be in the center of the screen we'll write that in a second and for now we'll set up a few headings and then we'll set up some more components and we'll kind of go through that but I'm going to say heading I'm going to say size is equal to large and the first heading will be the active challenges okay then we will go here and we're going to have another heading this is going to be old challenges and then this is going to be my history and where there any other ones we need we have my history old challenges and then active challenges that's actually fine for now we're going to write some more logic in a minute now we'll also put a button down here and inside of this button we'll say dot dot dot button props so we'll kind of Mark it as loading if we need to be we'll say on click is equal to get challenges the text in here will say update challenges so we can manually update the challenges by pressing this button and then we can say type is equal to submit or actually I don't think we need the type I think is actually fine if we leave that out and then we'll say the color scheme is equal to Blue and just make that a blue button now let's format our code okay perfect and let's start writing the get challenges function now remember that with get challenges we're actually going to use an inspect request so this means that we're not going to be sending an input we're just going to be inspecting the state of the caresan machine so to do that we're going to go to UIL and we're going to write a new function here that allows us to send an inspect request so what we'll do here is we'll say export const inspect and this will be equal to an asnc function this is going to take in some payload which is the inspect data so the method essentially that we're going to be calling now what we're going to do is create a response variable so we're going to say const response is equal to a wait and we can just use a very simple fetch so just a normal kind of HTTP get request that we'll send to our server so if we go look at util or not util sorry constants notice we have the default URL which is where the inspect endpoint exists so all we actually need to do is use this and then we need to append the payload here that we want to send and when we send that to our back end it's just a normal HTTP request and it will return the data for us so if we go back to util here I've put in some back ticks and I'm going to embed my variables so I'm going to say the default URL from constants make sure you import that and then we're going to say that this is going to be json. stringify and we are going to stringify the payload and that's all we need to do so we're just sending a simple fetch get request so now we're going to say if the response. status is equal to 200 which means it was successful and we'll just do three equal signs so we don't get yelled at by JavaScript then we'll say the result is equal to a wait the responsejson and then we will return the result. reports now what we're able to do is access this reports object this will contain any of the reports that were generated when we sent this inspect request could be one report could be multiple reports Etc in our case it will just be one and that report will contain all of the different challenges so then we'll be able to access those challenges and utilize them how we see fit now otherwise we'll just say console.log and we'll say jon. stringify and we'll say a wait response. text like that because if it was not a status of 200 then we got some kind of error message so we'll get the text from the response and we'll just display that here okay that's all we need for inspect uh that should be that function so let's go back to list challenges and we can now utilize that function uh to actually get all of the challenges so we'll go inside of here and we will start by saying let results we can then say results are equal to a wait and we can call the inspect function from our util file and what we need to pass is our Json so we're going to say the method is equal to get challenges because that's what the back request is that we want we'll then say that the results are equal to json.parse and what I need to actually do is I need to convert what's going to be a hexad decimal uh value into a string so what's going to happen if we go to util here is we are going to get the Json and inside of the Json here what we're actually going to have is a list of reports right so we access those list of reports now all of those reports are going to be hexadecimal because we have to only send and receive hex decimal data so what I need to do is actually convert that hex decimal data to a string so what I'm going to do is use a utility function here called hex to string that will do the conversion for me so I'm going to go here and I'm going to make another function I'm going to say export const hex to string this is going to take in some hex data and it's just going to return a string so we're going to say try and this is going to be ethers doils do2 and then utf8 bytes like that this is how we convert the hex decimal value to a string so we'll just pass hex and we will simply return that we'll then say catch e so a catch some exception and we will just return whatever the hex decimal value was now I'll just put an underscore here so it get doesn't get marked as an unused variable okay so we have our hex to string now we'll go back here and we will utilize that function so inside of here we are going to say Json parse and then this is going to be hex to string and it's going to be results z. payload and then we're going to take the Json and we're going to access the challenges now what are we doing here well we're going to have a list of reports that's what's returned here those reports well there could be multiple but in our case there's just going to be one so what we do is we access the first report and then we get the payload associated with that report which is the data that contains all of our reports we then convert this hex decimal value into a string we parse it as Json and we access the challenges key now to refresh you if we go back in to main.py and we have a look at get challenges notice that what we're returning is an object that has the key challenges so this is going to access the list of challenges for us that's what we're doing okay so that's what we're getting here with our results now that we have that we need to take all these results and we need to sort them into their appropriate categories so we're going to say con current challenges is equal to an empty list we're going to say let my challenge equal to undefined we're going to say const old challenges is equal to an empty list we're going to say const my old challenges is equal to an Mt list as well now we're going to iterate through all of our challenges so we're going to say const if we can type that correctly and this will be challenge of results and this needs to be a for Loop okay that will fix it for us so con challenge of results and what we need to do is sort these challenges so we need to figure out first of all is the current user so the person signed in whatever their address or account is are they a part of this challenge so the way we can do that so we can say const user participated okay if we spell that correctly is equal to and this will be the challenge do opponent is equal to the address or the challenge. Creator is equal to the address remember address is the address of the person signed in on our challenge we have an opponent and we have a Creator if they are either the Creator or the opponent so our current address then they participate in this challenge let me just format that code okay now what we'll say is if the challenge. winner and the user participated what that means that the challenge is finished so it's no longer active because there's a winner so as soon as we have a winner we know the challenge is done and if our user participated in that that means that this is part of their history so we're going to say my old challenges. push and we'll simply push the challenge inside of there now we'll have an else if and we'll say else if the user participated so if there was no winner but the user participated that means this is currently an active challenge so we're going to say my challenge is equal to user participated because the user can only be in one challenge at a time so if the challenge is not yet finished and they're part of it that means this is the challenge they're currently active in we're going to have another else if and we're going to say else if challenge. winner so what this is really checking now is if there was a winner and the user did not participate because if there was a winner and the user did participate it would have already been caught then what we can do is say old challenges. push and then this will be the challenge and then lastly if there was no winner and the user was not a part of it that means that this is an active challenge that the user could potentially join so we're going to say current challenges. push and then challenge like so okay so now that we've done that inside of the for Loop we need to set all of our state so we're going to say Set current challenges and then current challenges we're going to say set my Challenge and this will be my challenge we're going to say set old challenges and we'll set this to old challenge challenges and lastly we'll say set my old challenges so let's fix that and this will be my old challenges okay and then we'll set loading to false and that is the get challenges function Okay so we've now written the get challenges function we have pretty much everything done for this component what we need to do now though is we need to start actually viewing our different challenges now to be able to view these we need to have a list of challenges and we need to display those now to display those I'm going to make another component because there's quite a bit of data we want to display for any given challenge so I'm going to make a new component here inside of source I'm going to call this challenges. JS now this will take a list of challenges and it will display it for us so let's start writing this we're going to say import react use state from react we're going to say import and this will be button use toast heading and select from and this will be the Chara UI react we then are going to import a few other things we need we're going to say import generate commitment so we have that here as well as the send input because we'll need this when we want to accept a challenge or reveal a challenge we then will say import and we're going to import the move key as well as the key from local storage because when we end up revealing our answer we're going to do that from this component so now we're going to have a function which is our component we'll call this challenges and this will take in the following a list of challenges the address of the current user the signer and it will have show accept which is equal to false now show accept is going to tell us if we should show the accepting of the challenge or not so show the button that says accept challenge essentially means this challenge is active but we've not yet uh what do you call it accepted or we're not a part of it now up here we have a few basic things we need we're going to say con toast is equal to use toast again we're going to use this when we end up sending an input so that's why we need that we're going to have const Choice which is a state variable and then set choice is equal to use State and for now we'll set that equal to one and the reason why we have this is because we're going to need to have the user be able to select what choice want if they accept a challenge so this component here is what's going to handle displaying a list of challenges and then also displaying if we should accept a challenge or if we should reveal our answer so we'll write those U functions in a minute but for now we just want to display the challenges so we're going to say return a div and we're going to say the class name is equal to and this can be challenges now we'll style this all later but for now we want to map out the challenges so inside of here we're going to take our challenges and we're going to map them and we're going to say challenge like this and what we're going to do is actually set up a few variables that we're going to use when we kind of return information about our challenge so what we want to do with every single challenge is we want to understand if we're a part of this Challenge and we want to know if we're the opponent of this challenge or if we're the person who created it so what we're going to do is have a variable and we're going to say let data is equal to an object and we're going to say the opponent underscore move is equal to an empty string we're going to say your move is equal to an empty string and then we'll say the opponent is equal to an empty string now I'm just going to fix this so it's not snake case because I thought I was typing in Python there and then what we can do is the following so what we're going to figure out now is okay are we a part of this Challenge and are we the opponent or are we the Creator the reason why I've set up these variables here is because I want to know who I'm playing against so I'm going to say the opponent whoever I'm playing against not necessarily the opponent associated with the challenge but if I was the opponent of the challenge then who we'd put here is the creator of the challenge I'm not sure if that's making sense but if we look at main.py for example every challenge has a Creator and an opponent now if we are the opponent technically our opponent in this challenge is the creator of the challenge I know it's a bit confusing how I set it up if I did like player one player two that might have been a bit easier to understand but that's why I'm going to use this data and you'll see how it works so I'm going to say if the challenge do Creator is equal to the address so that means if the creator of the challenge is us then what we're going to do is say data is equal to the following we're going to say the opponent move is equal to the challenge dot the opponent uncore move we're going to say your move is equal to the challenge. the Creator move because we're the Creator so our move is whatever the Creator's move is is and then we're going to say the opponent is equal to the challenge do opponent now otherwise we're simply going to do the opposite we're going to say data is equal to and we're going to say the opponent move is equal to the challenge.the Creator move we're going to say your move so let's type this correctly is equal to the challenge dot the opponent move and we need to put this with an score because that's how it's returned from our back end and we are going to say that the opponent is equal to the challenge. Creator okay so now we've mapped out who the opponent is and uh who the creator of the challenge is so now that we have that we'll go down here and we'll start returning some information about the challenge so we got to do this inside of our curly brace and inside of the map so we're going to say return div and this is one individual challenge that we're returning so I'm going to say class name is equal to a challenge let's close off our div let me just format this code a little bit so it's bit easier to read let's go inside of the div and return our information so first we're going to set up a heading now inside of the heading we're going to say this is Challenge number and then the challenge dot challengecore ID again if we want the data being returned we can have a look here we have the challenge ID so we're going to put the challenge ID so we know what number this challenge is we're then going to say the following data. opponent and so let's go and here we're going to put a paragraph tag and inside of the paragraph tag we're going to have a strong tag and we're going to say the opponent colon and then data do opponent now the reason why I'm doing this I'm saying okay if there's an opponent of the challenge then we'll display who that opponent is if there's non opponent because it's possible that we don't have one and it's just the Creator so this challenge maybe just was made we don't want to display that now we're going to do the same thing here we're going to say challenge Dot and this will be winner and we're going to do pretty much the same thing so we're going to have a P tag a strong tag we're going to say winner and then this will be colon and then we will say the challenge. winner however if we are the winner we don't want to just display our address because we might not know our address off hand what we want to do instead is we want to display you right we want to say you were the winner we don't want to just display the address of this user or the address of the opponent we want to say the opponent was the winner or you were the winner so we we know if we won or lost so what we're going to do is write a function here and this function is going to pretty much tell us if we are the address or not so we're going to say cont is address user okay and we're going to take in some address and we're going to say if the addr is equal to the address then we're going to return a strong tag and the style of this tag is going to be color green and we're going to say you now otherwise we'll copy this we'll put this here and we'll just return red and this will say opponent okay so let's save and format so what I'm doing is I'm having this function that takes in an address and it tells me if the address is equal to myself so if it is I just return this code that says youu in green otherwise I say opponent in Red so now what I can do is rather than displaying the challenge. winner I can wrap this in is address user and it will either say you or it will say opponent so that's what I'm going to display here now after we have the winner we want to show the different moves and we also want to show the buttons to either reveal or to accept the challenge so we're going to say data do opponent move does not equal undefined and so let's have and end here we're going to display a paragraph tag again we're going to have strong we're going to say opponent move colon and then we want to display what their move is so we're going to say data. opponent move okay now we're going to do the same thing here for our move so we're going to say data. your move and then we're going to say your move and we're going to fix this to say your move now similarly to the function we have here I'm going to write a function that will take the move and convert this move into uh the string representation so if we go to main. Pi when we return the the move the move is going to be an integer and this integer is 0o through uh three right so zero is none one is Rock two is paper three is scissors so what I want to do is take that number and I want to convert that into what the actual move is so I'm going to make a function I'm going to say const and this is going to say move to string and we're going to take in the move and we're going to return the string representation so we're going to return an object inside the object we're going to have zero and this is going to map to Hidden now if the move is zero that either means the player has not made the move yet or the move is currently hidden so we're going to say zero is hidden we're going to say one is Rock we're going to say two is paper and three is scissors we're then going to index at move and simply return that so again just kind of doing a very simple mapping here for the move to string and now we're going to wrap this so move to string for data. opponent we can copy this function paste it here and wrap this so now again it will display whether it's hidden or if it's rock paper or scissors okay I know we did a lot of stuff here for now I think this will actually display our different challenges so what we need to make sure we do now is export this so we're going to say export default Challenge and actually do we call this challenge or challenges we call it challenges so let's do challenges and later in here we're going to write the different buttons associated with the challenge so again like accepting the challenge revealing the move Etc so let's go to list challenges and what we want to do now is use that component we just wrote so first of all let's export this one as well let's say export default list challenges and now we're going to import the component we just made so we're going to say import and this will be challenges from do challenges and we're going to start to displaying them under the correct heading so first of all we'll go here to where it says active challenges and we'll check if we have a challenge so if we're currently in a challenge so my challenge right if we have an active challenge that's the one that we want to display so we're going to say my challenge we're going to say challenges and then what we need to pass is all of our properties so we're going to say challenges is equal to we're going to pass a list that contains my challenge we're then going to say the address is equal to the address and the signer is equal to the signer okay now we're going to say otherwise so if we don't have our current challenge so if we're not in a challenge we're going to display any of the other challenges that are active that we could accept so we're going to say challenges same thing we'll copy these so paste those in and this time for challenges this will be equal to the current challenges these are ones that we could accept and we're going to pass another prop that says show accept equal to True let's format that so you're able to read it and here we go so we're saying okay if we have a challenge that we're currently a part of display that otherwise display any of the challenges that are currently active that we could join great so that handles that now we'll go handle old challenges and my history so we're going to do this we're going to say old challenges length is greater than zero if that's the case then we want to display the following so we're just going to do an empty component here and inside we're going to put a heading let's format that and then below this we're going to put challenges we'll just copy this okay we're going to get rid of show accept and for the challenges we want to display it's not going to be current challenges it's going to be old challenges let's format that let's copy this exact same thing let's replace my history here with the heading okay and then for challenges rather than old challenges we're going to say my old challenges because that will be our history okay quick recap again showing the active challenges ones that we're a part of or that we could accept otherwise we're showing a history of all of the old challenges and then all of the old challenges that we are a part of now we just need to change this to say my old challenges so this matches with what we're displaying okay so that should now allow us to list all of the challenges and we can't interact with them yet but we can list them now what we're going to do is go to app.js and we're just going to write the component that will list the challenges so to do that we can just put a div here so list challenges like that and we have to pass our signer equal to the signer okay now I'm just going to wrap the create Challenge in a div as well we'll do some styling in a minute but for now that should be okay and obviously I imported list challenges here just happened automatically when I started typing it but you could see I have that imported here from my component okay so now what we want to do is to rerun our react application not sure if this is currently running but we will restart it that'll take a second once it's running I be back and we'll make sure that this is working all right so I just load up the page and I can see that I'm getting an error already here for uh one of the components we have so let's just make a very quick fix we're going to go over to list challenges and where we have have this loading here so for the button props we just need to change this to say is loading so I just made a mistake there we're just going to set that to is loaded okay go back here and we should see now if we refresh that this fixes itself and for some reason this is loading when it really should have stopped loading which tells me we're probably getting an error or we're not sending the request successfully so let's have a look at our back end here and let's see if the back end is receiving a request okay it's not receiving a request so let me just rerun this because it's possible uh that I made a mistake here and there you go we see now that if we refresh this okay we're getting an error let me have a look here and I will be right back all right so I was just doing a bit of debugging and I realized that the error we have here is that in our hex to string method we're doing two utf8 bytes when I want two utf8 string so we were actually converting a heximal value to a heximal array which was causing an issue for us so if we go here now and refresh we should see that I was just doing some logging and we're getting challenges with an empty list and now this update challenges is working so if we go back to list challenges I was just printing out this value before what was happening is this hexa string was giving us the wrong value so when we tried to parse it with Json we were getting an error now though it is working so if we go back here we can have a look at our back end and we'll see that it's generating reports every time time we press this button so we're sending a request and pretty instantly generating the report now what we'll do is we'll make a new challenge and we'll actually see if we get the updated challenge here so I might need to change accounts but we can try this confirm we'll see if this goes to our back end and then we can update our challenges all right so our input has been added we're going to update challenges here uh and we got an issue here it says challenge object has no attribute commitment did you mean commitments okay so we probably just made an error here challenge. commitment. getet in line 150 so let's go fix that in our main.py okay main.py and I have commitment when that needs to be commitments silly error but hopefully now if we rerun our backend let's go here and rerun it and we go back to our front end we can now refresh and we can send another request so let's go create Challenge and let's go ahead and make one here okay we should see that pop up in the back end let's give this one second okay any minute now we'll see that it will make a new challenge for us okay so adding notice challenge with ID was created and now let's go to update challenges and again we got an issue with say challenge object has no attribute winner okay we probably called it winner address again we can go and fix that so we're trying to access a winner if we go to look at our challenge so let's go to challenges. py we have winner address okay so what do we call it here winner address winner address okay so let's go back and change this to winner address of course and we're going to have to test it again okay so rerun and let's refresh and let's make another challenge okay go ahead and run same thing wait for our backend to pick this up and then maybe maybe third times the charm will be able to actually receive this new challenge okay notice created let's click the button and challenge is popping up now for some reason it's not really displaying any data for us as challenge ID the Creator is here the opponent is null winner is null opponent committed false opponent move and Creator move it's not showing us the data that we want to see let's go have a look at our console and see if we're getting any error and it says we should have the unique key prop okay we can fix that uh but it should still be showing some stuff for us so let's go and debug this and figure out what the issue is all right so silly mistake here but I have my challenge equal to user participated when it should really be equal to challenge okay so if we go back now it should just pop up and it says Challenge number zero your move is hidden okay so that's what we were looking for now we could display some text that says we're waiting for an opponent or something but for now that is what we were looking for again we're going to do the styling after but this is working it's now displaying this challenge now we want a way to be able to accept these challenges so that's what we'll work on next and once we accept them we'll be able to actually display some more information about the challenge okay so let's go ahead and do that we're going to go into challenges and we're going to start popping up the button that allows us to actually accept the challenge so how we going to do that well first of all we need to know if we should be displaying it or not so we're going to go inside of this div and we're going to write a condition where we say okay well if we passed show accept that means this is a challenge that's active that we can accept so we'll say show accept and then we're going to put an empty jsx component and inside of here we're going to put a select field that will allow the user to actually select what option it is that they want when they kind of accept the challenge and we'll challenge this person so we're going to say Focus border color is equal to Yellow we're going to say the size is medium we're going to say the value is equal to choice and we're going to say onchange this is equal to a function this function takes in the event okay so we'll say set Choice and then event. target. value just like we had in the other input component okay so this is our select field inside of the select field we need our options so we'll say option if we could type this correctly we're going to say value is equal to one option one is Rock then we will copy this and have value two and value three and this will be paper and this will be scissors like so okay those are our three options we then need the button for the button we'll have the onclick the on click will be equal to a function that we'll write in 1 second and we'll have the color scheme equal to green and then we will say accept challenge okay so now we need a function that we're going to call when we press this button however we can test that the button is appearing correctly by going here refreshing and changing our account to someone who did not create this so we're going to go to account six and connect this guy and then refresh and now you can see it says the opponent is this the opponent moves is hidden and it's showing us that we can accept the challenge again we'll fix the styling later on don't worry about that now we will fix this key prop so let's go ahead and do that we're going to go here to our div we're just going to say key is is equal to challenge. challenge ID just so that uh we don't get that error from react okay so now we need the function that we're going to call when we click the button so let's go ahead and make that function we're going to say const accept challenge is equal to a function this will be an async function and this function will take in the challenge ID that we want to accept and in fact we can just call this ID now what we need to do to accept to challenge is we need to generate our commitment string and we then need to send that to the back end so we're going to say con commitment is equal to await generate commitment we're going to generate the commitment with whatever our choices and with our CER we're then going to say wait send input and for our input we're going to say Json do stringify and we're going to write what it is that we need to pass so we're going to say the method is acceptor challenge because that's what we want to do we're going to say the commitment is equal to the commitment and the challenge ID is the ID then now that we have that let's format and we're also going to pass our signer because we need that to send the transaction and toast for the popups okay so that's all we need for accepting the challenge that will simply accept it for us let's go here and for our onclick we will just call the function which is accept Challenge and we'll pass the challenge. challenge ID so we know which one it is that we're accepting so now this should actually allow us to become the opponent of that challenge we'll see though because always there are errors let's refresh okay we should be able to accept the challenge so let's pop open our back end okay doesn't look like there's any errors so that's good and we're going to go accept challenge okay pops up met ask go ahead and click on confirm and we'll wait for that notice to appear on the back end and then we can refresh our challenges and we can see if we accept it okay so we got a uh notice here that says received Advanced request data method accept challenge says adding notice challenge with ID zero was accepted by this address okay that's a good sign let's update the challenges and there we go we now have the opponent the opponent move and our move so that's great now if we go back to our different account so let's switch this up and go to account 7even and refresh we see now that the opponent is the other person and both the moves are appearing so now we need to be able to reveal our answer all right so now we need to write some logic that tells us whether or not we should show the button that says reveal your answer because once we've accepted the challenge now both players have made their commitments and now we need to reveal and once both players reveal then we know who won so we're going to write some logic in a function called show reveal okay now this is going to take in the challenge and it's simply going to make sure that both players have already made their commitments and if they have it will show the reveal button so what we're going to do here is say if challenge. opponent and the challenge. opponent unor move does not equal zero then return false now let me explain this because this function is actually a bit complicated what we need to do in here is we need to only show the reveal button if both players have made a move but if we have not yet revealed our move so that's why you're going to see a little bit of logic here that might not make sense at first it's because we need to check two things first of all we need to make sure that both players have made a commitment we then need to make sure that ourselves have not already revealed because we don't want to display the button if we already revealed because that's going to be confusing right we only want to show the button if we need to still reveal so the first check is all right if this is equal to address which is what I meant to add here so if the opponent is equal to us and the opponent move is not equal to zero now if the opponent move is not equal to zero what that means is that either we haven't made a move so we haven't committed or we have already revealed our move because if the move is 1 two or three that means we've revealed what it is because it's now displayed on the blockchain so that's what we're checking here now we do the exact same thing so if challenge. Creator is equal to address and the challenge. Creator move does not equal zero then return false so same thing here but now we're just checking if we the Creator because we could be the opponent or we could be the Creator we don't know then once we've handled those cases we're going to return the following we're going to say return challenge. opponent move does not equal undefined and the challenge. Creator move does not equal undefined and the challenge does not have a winner so as a quick fix we can actually make these the double equal to sign that should work we might have to fix this but I think this is fine for right now and what we're checking in this condition is okay has the opponent made a move so if they have made a move and we have made a move and there's not a winner if there's a winner that means the challenge is over then we can go ahead and display the reveal button now when we check is not equal to undefined well we're saying okay have you submitted a commitment or alternatively have you already revealed your move if both the opponent and the Creator have done that and we don't have a winner we can go ahead and display the reveal button so now we need to use that function so we're going to go and write some logic here inside of this so after your move we're going to have show reveal we're going to pass in the challenge and we're going to say question mark and we're going to put a button here this button will say reveal move we will say that the color scheme of this button so color scheme is equal to Kine and then we'll say on click and we're going to call a reveal function which we'll write in a second and then otherwise we're just going to put some text so we'll put a P tag here and we'll say waiting dot dot dot okay because we're waiting on something to occur before we show this button so if we go here it shows the the reveal button which is what we want because at this point the challenge has been created and both players have accepted it now let's just make sure it works from the other side so if we switch over to account six and then refresh you can see it is working here as well okay so now we need to write the actual Logic for revealing the move now we've been through this a few times but I will explain it again so let's write a function this will actually be the last bit of code we need to write we're going to say reveal move okay now this is going to be an sync function and the first thing we need to do to reveal move is we need to get what the move is which is stored in local storage and we need to get our secret key because we need to submit those to the blockchain so we're going to say Conn is equal to local storage. get item and then this is going to be the nons key plus the address Dot and I don't think we need to convert it to lowercase because I think we already did when we passed the address so I think it's actually fine if we just say plus address that's fine so that should get us our nonski we going to say cons move is equal to local storage. getet item and this is going to be the move key put that inside of brackets plus address okay we then are going to say await send input and this is going to be json. stringify and we're going to say our method is that we'd like to reveal the move and then to reveal the move we need to submit both the move and the Nots okay so move and Nots and then we need to pass here is the signer and the toast let me just format that and I think we are good to go okay so that should actually be it for revealing the move uh I did not pass the toast so let me fix that and I think we are good to just call this function so let's now go here to the on click and just call reveal move and let's go back and let's test this out so fingers crossed we are good to go we're just going to refresh for a good measures and we're going to reveal now it's going to pop up metamask here okay let's go ahead and confirm now we'll check our back end here and we'll see if we get any notices and if it tells us if we revealed successfully okay so it says adding notice this address revealed their move of rock okay very good now if we refresh you can see it's displaying our move is rock and we are currently waiting on the opponent now at this point again the opponent cannot cheat because of how we've set this up so if we go to account seven and and we refresh here it says the opponent move is rock your move is hidden you can reveal so let's go ahead and reveal and confirm okay we're going to give this a second and we need to have the Notice come in here so let's wait for the notice okay receiving notice challenge ended in a draw so let's update the challenges and it says Rock okay now it says waiting we actually wanted this to go into the old challenges so if I refresh this here yeah it's not going into Old challenges yet I guess that's actually actually because there is no winner so we're going to have to change a bit of logic to display this correctly because when there's no winner yeah it's not handling so we had a draw and it wasn't handling the draw so let's go and just fix that logic this will be pretty quick all right so I just wrote some new logic and this changes a few things because of how we handle a draw anyways what I was having an issue with is that again if both players didn't win we don't have a winner marked in the field so we don't know if the challenge is done or not so the way we have to determine if the challenge is done based on how I've coded this is we have to check okay is there a winner or have both the opponent and the Creator revealed their move so that's kind of what we're checking here challenge. opponent move and challenge. Creator move does not equal undefined notice I have this with one does not equal now what that means is that if this is zero so if their move is hidden then that will uh not count for this condition okay so if their move are hidden then it won't go into the history so what I've done is said const is the challenge done equal to this I've then replaced where I had challenge. winner with challenge done so I've said if the challenge is done and the user participated then it's their history otherwise if the user participated okay and then same thing here if the challenge is done push it into Old challenges now the only thing we haven't uh kind of handled is displaying draw or not draw and also that kind of waiting that you saw so if we go back here and we refresh it says my history zero this is the opponent this is the opponent move and our move and then it says waiting we don't want to display waiting if the challenge is done so what we should display instead is like winner is equal to draw or something or like the challenge ended in a draw so we can write some Logic for that as well if we go to challenges okay so we have show reveal challenge reveal move waiting now again we only want to display waiting if the challenge is not done so we can do a similar thing to what we did before and we can write a variable here it says const challenge done okay and actually we can do this down here and we can utilize our data variable so we can say con challenge done is equal to data.you move does not equal undefined and the data do opponent move does not equal undefined if that's the case the challenge is complete delete so we'll go here to where it says waiting and we'll simply put a condition here so we'll say if that's the case then we'll check the following condition the condition is going to be challenge done and so we'll say not challenge done and then waiting like that and then we can do something where we say challenge done and not challenge. winner and we display some text ended in a draw let's format here and that should actually wrap up our logic so again we added a variable that tells us if the challenge is complete exact same thing we did before here we're now saying okay only display waiting if the challenge is not done if the challenge is done and there wasn't a winner it's a draw so we'll say end it in a draw so now it should say end it in a draw and it does that is working now to test this let's do the same thing but let's actually make a challenge that someone wins so we have Rock here so let's make a new one okay can confirm we can open up our backend to verify that this is working we want to see a new challenge created here give this a second to appear okay challenge was created let's now go to our different accounts let's go account six refresh the page okay and we've got two things here reveal move and accept challenge so for reveal move we're going to need to fix that obviously because we don't want to display reveal move yet I think the way we can fix that is if we go go to list challenges and we go to show reveal so wherever I have that so that's inside of challenges sorry scroll scroll scroll let's get rid of the double equal sign which I actually don't think I need and if we fix that now okay perfect gets rid of that so it says opponent hidden waiting okay we had Rock before let's do paper and let's accept the challenge okay let's go ahead and click confirm all right right we can give this a second on our back end okay let's refresh and now we have ended a draw which we did not want to display okay so obviously a few things going wrong here guys sorry handling the draw was not something I thought of before so I'm kind of coding this on the Fly let me do a few fixes just to make sure that I'm not misleading you with all these changes and I'll be right back so a few slight changes here that have now fixed things first of all from list challenges I simply removed the does not equal undefined from challenge done so now challenge done is equal to challenge. winner or challenge. opponent move and challenge. Creator move so as long as those are a truthy value so not zero or not undefined then the challenge is finished which is originally what I wanted to have but uh I kind of coded incorrectly so that's my bad then then from challenge. JS I just got rid of the um showing the draw and showing the waiting just to simplify things so all I did was just remove the code that was showing if there was a draw or showing if there was any waiting just to make sure I didn't kind of over complicate stuff so for now you can see active challenges is correct it's showing our active Challenge and then we have our challenge history so let's now go ahead and try to reveal our move and let's see if this works now when we actually have a winner okay so this guy reveal this move let's go over to our back end and it should show us popping up in a second okay uh removed paper or revealed move of paper okay so now we have our move paper and the button goes away and then if we switch over to account seven and we refresh okay opponent move is paper we can reveal our move let's go ahead and do that okay give this a second to run and we are going to update the challenge and there we go we have our history so we have the first move and then we have this challenge it says the winner was the opponent the opponent was was paper our move was Rock so that's exactly what we are looking for that it shows either us or the opponent and just to show you from the other side if we go here to the opponent and we refresh the page it says the winner was us which is exactly what we are looking for okay so that is it and that is going to wrap up this tutorial now I know there was a lot of mess at the very end there I apologize guys but I'm just keeping it real with you this stuff does happen this is the life of a developer and actually reminds me we need to style this so let's style this and then we can wrap it up uh but this is kind of the core logic which we just finished so let's do some basic styling to do the styling we have a few classes uh we have the challenge class right so we're going to want to space those out a little bit in create challenge we have the challenge form if we go to list challenge we have the center class so let's just go into index.js and we can do a fair bit of our styling inside of there so first we'll say do challenge now what we'll do is we'll say this is a flexbox so display Flex say the flex direction is a column we'll say align items Flex start we'll say padding is 10 pixels we'll say the flex is one and the width is 33% so let's fix that and then we will align items actually in the center so I don't know why I had Flex start we're going to put them in the center okay then we're going to have Dot challenges we'll make sure we added that class after but this is going to be width 100% we then going to have the display Flex we're going to have the flex Direction equal to row we're going to have align items in the center we're going to have justify content in the center and we're going to have margin top equal to 10 pixels okay lastly we're going to have Center we're going to say align item Center display flex and then the flex direction of column and then last few things here dot challenge form we'll just add some padding here of 20 pixels and we'll just text align Center and then we will have a button and for all our buttons we'll just add some margin to the top of 10 pixels now now don't worry about copying all of this out I will have it available from the link in the description so you can just grab it there uh but this is kind of the main styling that we need now let's see what that actually did to the page notice now that all of our challenges are going to be aligned in a 3X3 grid the way I did that was by adding the width of 33% for all of our challenges and kind of aligning them in the center we then have the create challenge form with a bit of padding we have some padding between our headers some padding with our buttons looks quite a bit better okay so now that is going to wrap it up that will be the end of this video in the next videos we'll handle deployment talking more about architecture Etc hope you guys have enjoyed this so far again the code is available from the link in the description and I will see you in the next video
