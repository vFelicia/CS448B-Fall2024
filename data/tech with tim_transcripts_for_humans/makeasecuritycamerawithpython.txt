With timestamps:

00:00 - hello everybody and welcome to the
00:02 - youtube video so in today's video i'm
00:04 - going to show you how to make a security
00:06 - system in python using the opencv module
00:10 - now what we'll be doing is actually
00:12 - detecting a face or a body in our video
00:15 - camera footage so you need to have some
00:16 - type of webcam to be able to follow
00:18 - along with this video or any type of
00:20 - camera that you can kind of like plug
00:21 - into your computer and you can view in
00:23 - live time what we'll do is we'll be
00:25 - accessing that camera using opencv
00:27 - detecting a face or detecting a body and
00:30 - then as soon as we detect that we're
00:31 - going to start recording so we're
00:33 - actually going to record all of the
00:34 - motion or all of the time that this
00:37 - thing is in the frame this person is in
00:38 - the frame we'll then save that video and
00:41 - then from there you guys can extend this
00:43 - you could email it to yourself you could
00:44 - send yourself a notification you could
00:46 - you know snap a photo of the person's
00:48 - face will actually show you how we can
00:49 - get directly the face from the video
00:52 - frame anyways this will be a really good
00:54 - kind of starting point if you are trying
00:56 - to build you know a security camera or
00:58 - security system or something along those
01:00 - lines with that said let's go ahead and
01:02 - dive in and start writing some code
01:07 - [Music]
01:12 - okay so let's go ahead and get started
01:14 - now the first thing i will mention is
01:16 - that i do have an opencv python tutorial
01:19 - series so in this video i will kind of
01:21 - skim through some of the more advanced
01:22 - opencv concepts i'm not going to explain
01:25 - them in depth because they would take a
01:26 - really long time so if you do want to
01:28 - understand how those things work then do
01:30 - go and check out my opencv python
01:32 - tutorial series i'll kind of reference
01:34 - which videos which things are talked
01:36 - about in as we go through here and i'll
01:38 - leave a link to that series in the
01:40 - description so now that i've mentioned
01:42 - that the first thing that we need to do
01:44 - here is install opencv so it doesn't
01:46 - really matter what operating system
01:47 - you're on open your terminal open your
01:49 - command prompt here i'm in vs code so
01:51 - i'm using the vs code terminal and type
01:53 - pip3
01:54 - install opencv hyphen python now if that
01:58 - doesn't work for you try just pip if
02:00 - that doesn't work try python hyphen m
02:04 - like that and if that doesn't work try
02:06 - python 3 hyphen app okay try all of
02:08 - those i already have this installed so
02:10 - i'm not going to run that command once
02:12 - you have it installed though we can
02:13 - continue if for some reason that doesn't
02:15 - work i'll leave two videos in the
02:16 - description that show you how to fix
02:18 - this pip command one for mac and linux
02:21 - the other for windows
02:22 - okay now that we have that i'm in a
02:24 - python file i'm in vs code and the first
02:26 - thing i'll mention is wherever you
02:28 - create this python file is where the
02:30 - video recordings are going to be saved
02:32 - so just you know make this in a folder
02:33 - or something just don't put this like
02:35 - directly on your c drive because there's
02:37 - going to be a ton of video files when
02:39 - you're actually running this
02:40 - okay so now let's import a few things
02:42 - we're going to import
02:44 - cv2 we're going to import time and we're
02:47 - going to import date time
02:51 - okay we'll use some of these later
02:52 - first thing i'm going to show you how to
02:54 - do is access your webcam and just view
02:56 - video here in python so that's step one
02:59 - so to do that we're going to say capture
03:01 - is equal to cv2
03:03 - dot video
03:05 - capture like that and we're going to put
03:07 - the number zero
03:08 - now what you can do if you have multiple
03:10 - video capture devices is index them with
03:12 - zero one two three the first video
03:15 - device will be zero i only have one so i
03:17 - can only put zero but if you had
03:18 - multiple you do one two and so if you're
03:20 - not getting the correct video camera
03:22 - just increment this number go up uh each
03:24 - time and just check and see if you're
03:25 - getting the right device
03:27 - now that we've done that what i need to
03:28 - do is set up a wallop
03:30 - so i'm going to say while true and i'm
03:32 - going to say underscore comma frame is
03:34 - equal to cap dot read so what i'm doing
03:36 - is reading one frame from my video
03:38 - capture device i'm then going to display
03:40 - that on the screen and so we'll display
03:43 - a ton of frames i mean that's really
03:44 - what a video is right a ton of images so
03:46 - we'll do that and we'll be able to see
03:48 - our video now if you're wondering why i
03:50 - did this the underscore is a placeholder
03:52 - variable i could do something like h or
03:54 - x or some variable name the reason i'm
03:56 - doing that is because this returns
03:58 - something else as well we don't really
03:59 - need to know what that is but the only
04:01 - thing we care about is the frame so
04:02 - we're going to say whatever this is we
04:03 - don't care about so we just put an
04:04 - underscore comma frame this is what we
04:06 - want
04:07 - all right so now what we're going to do
04:09 - is say cv2 dot i am show
04:13 - we're going to show
04:15 - as our camera
04:17 - the frame now this is just going to be
04:18 - the title of the window that shows you
04:20 - the actual video frame name this
04:22 - whatever you want doesn't need to be
04:23 - camera and then put frame right here
04:26 - great now that we have that i just need
04:28 - to set up one thing that allows us to
04:30 - actually quit this because right now if
04:32 - you run this you're going to be an
04:33 - infinite loop and without crashing your
04:35 - program you won't be able to actually
04:36 - quit
04:37 - this while loop so to do that we are
04:39 - going to say if
04:41 - and this will be cv2 dot weight key one
04:44 - equals equals the ordinal of q
04:47 - then
04:48 - break now i won't really explain how
04:50 - this works again watch the cv2 tutorial
04:52 - series specifically i believe the first
04:54 - video actually it might be a different
04:56 - video but one of those videos explains
04:58 - how this works but this pretty much just
05:00 - says hey if you hit the q key stop okay
05:02 - break the program end
05:05 - all right now that we have that we need
05:06 - to release the resources from this
05:09 - camera so it's just good practice after
05:11 - you kind of access a camera
05:13 - that you release the resource so what
05:15 - we're doing here is we're saying okay
05:17 - give me access to the video capture
05:18 - device it's going to activate the video
05:20 - camera and then this program has control
05:23 - of it okay so you won't actually be able
05:25 - to run this if another device is using
05:27 - your video camera actively so make sure
05:29 - it's not being used when you run this
05:31 - but what we need to do is make sure that
05:32 - once this program ends something else
05:34 - can now use the video camera so we're
05:36 - going to say
05:37 - dot release like that and that will
05:39 - release the resource kind of clean it up
05:41 - and allow other things to now use this
05:42 - once the program ends then we're going
05:44 - to say
05:45 - cv2.destroy all windows and this will
05:49 - destroy the window that is showing the
05:51 - video capture device
05:53 - perfect now that we have all this we can
05:55 - run our code cross our fingers and pray
05:58 - that this works i will mention this does
06:00 - take usually for me like
06:02 - 15 20 seconds to actually run not sure
06:05 - why it takes so long hopefully for you
06:06 - guys it's faster but it's totally normal
06:08 - if it's kind of hanging here i've had it
06:10 - hang for up to like you know 45 seconds
06:12 - sometimes and so if you see me cutting
06:14 - throughout this video it's probably
06:15 - because i'm just getting past the
06:17 - hanging of the video account anyways i
06:19 - can see my video camera on now so let me
06:21 - get out of vs code notice we have this
06:24 - camera frame here and you can see my
06:26 - beautiful face now in two places on the
06:28 - screen regardless to quit i'm gonna hit
06:30 - q
06:31 - we are now done and we can continue
06:34 - okay so now that we've done that we have
06:36 - access to our video camera i want to
06:38 - detect faces and bodies so to do that
06:41 - i'm going to use something called a
06:43 - harcass skate now a har cascade is kind
06:46 - of the first word that i need to say
06:48 - it's a hard cascade classifier and what
06:50 - the hard cascade classifier is is
06:52 - something that is pre-trained and
06:54 - pre-built by opencv to detect faces or
06:58 - whatever we want really in images so in
07:01 - this case we're going to use a face
07:03 - detection one and a body detection one
07:05 - and really all you need to know about
07:07 - these is that
07:08 - you pass an image to them
07:10 - they've been trained on like hundreds of
07:12 - thousands if not millions of images
07:14 - they're really really good and they can
07:15 - tell you very quickly if faces exist in
07:17 - the image and where those faces are or
07:20 - if whatever you're trying to classify
07:22 - exists in the image
07:24 - so to set these up we're going to say
07:26 - face underscore cascade is equal to cv2
07:30 - dot
07:31 - cascade classifier like this we're then
07:34 - going to pass
07:35 - cv2.data
07:37 - dot har cascades like this
07:40 - plus and then the name of the hard
07:42 - cascade we want to access so in this
07:44 - case i want the har
07:46 - cascade
07:47 - underscore frontal face
07:50 - underscore default dot xml let me make
07:53 - sure this is correct
07:56 - looks good to me except i gotta spell
07:58 - cascade correctly
07:59 - so this is what we want let me just kind
08:01 - of run through this line and explain
08:03 - what i just did so i set up a cascade
08:05 - classifier i need to pass to it a
08:07 - classifier all of the classifiers we
08:09 - have here already exist they're
08:11 - pre-built into opencv you don't need to
08:12 - install them or download them or
08:14 - anything and one of the ones we have is
08:15 - this frontal face default classifier and
08:18 - so i have to pass kind of like the base
08:20 - directory of where all of these
08:21 - classifiers exist which is
08:24 - cv2.data.har cascades make sure you have
08:26 - the plural here so the s and then i add
08:29 - the actual name of the classifier so i
08:30 - just want this classifier that's pretty
08:32 - much it uh if you want a full list of
08:34 - all of the classifiers i'll leave a link
08:35 - to it in the description you can mess
08:37 - around with other ones they pretty much
08:38 - all work the same okay now we have face
08:41 - we want body
08:42 - so i want the body cascade i'm going to
08:44 - say cb2.data.hardcascades
08:46 - and this time rather than the frontal
08:48 - face default i want the full
08:51 - body not fully body the no that was
08:54 - actually right full
08:55 - body like that dot xml let me make sure
08:58 - that's correct yes that looks good okay
09:01 - so we now have the full body one and we
09:03 - have the frontal face one
09:04 - so now that we have them let's actually
09:06 - use them so to use them the first thing
09:08 - i need to do is actually convert my
09:10 - frame here to a grayscale image so all
09:13 - of these classifiers require a grayscale
09:15 - image to do the classification and they
09:17 - will tell us the location and presence
09:19 - of any faces in the grayscale image now
09:21 - it doesn't really matter we can still
09:23 - show like the color image on the screen
09:25 - it's just that to do the classification
09:26 - it needs grayscale so i'm going to say
09:28 - gray is equal to and this will be
09:30 - cv2.cvt
09:32 - color like that we're going to pass our
09:34 - frame we're going to pass cv2 dot color
09:38 - and this is going to be bgr 2 and then
09:41 - gray okay
09:42 - what this will do is give us a new image
09:44 - that is grayscale
09:45 - and yeah that's about it that's all i
09:47 - can really say for that okay now that we
09:49 - have the grayscale image let's use a
09:51 - classifier so i'm going to say faces
09:53 - in lowercase is equal to
09:56 - face cascade
09:58 - not dot fit dot this is going to be
10:01 - detect and then
10:03 - multi-scale like this it's a specific
10:06 - algorithm we're going to use with the
10:08 - hard cascade i need to pass to this my
10:10 - frame so i'm going to pass gray which is
10:12 - my grayscale image i need to pass what's
10:14 - known as a scale factor and what's known
10:16 - as my minimum number of neighbors now
10:18 - let me stop for a second explain what
10:20 - these are so gray clearly is our image
10:22 - okay that's what we want to detect the
10:24 - faces on as i said this is going to
10:25 - return to us a position or sorry list of
10:28 - positions of all of the faces that exist
10:30 - yes this can give you multiple faces if
10:32 - they are all in the image this will
10:34 - actually give you the x y width and
10:36 - height of all faces that exist anyways
10:38 - you pass the frame and then you pass the
10:40 - scale factor now the scale factor is a
10:42 - number that determines the accuracy and
10:44 - speed of this algorithm it does a lot
10:46 - more than that but i'm not going to
10:48 - explain exactly how it works pretty much
10:50 - you should keep this number between 1.1
10:52 - and 1.5 i find 1.3 is the best kind of
10:55 - middle ground for speed and accuracy but
10:58 - the lower this number goes the more
11:00 - accurate it gets but the slower it is so
11:02 - if i do something like 1.01 by the way
11:05 - the minimum for this number is one you
11:06 - have to have something larger than one
11:09 - you're going to get a very very accurate
11:11 - algorithm but it's going to take a very
11:13 - long time to run so if you're noticing
11:15 - that at 1.3 your faces aren't quite
11:18 - accurate or it's too slow or actually
11:21 - other way around if they're not too
11:22 - accurate
11:22 - make this number lower make it like 1.2
11:24 - 1.1 and if you notice here that it's
11:27 - still too slow then make it something
11:28 - like 1.5 1.6 but again 1.3 will most
11:32 - likely be fine for you these things
11:34 - still work extremely quickly even if you
11:36 - make them like 1.2 or 1.1 but let's go
11:38 - with 1.3
11:40 - okay now what is minimum number of
11:41 - neighbors uh this one is a little bit
11:43 - complicated but pretty much the way that
11:45 - this har cascade's gonna work is it's
11:47 - gonna detect like hundreds of faces and
11:50 - all of them are gonna be the same face
11:51 - so it's gonna look at my face and it's
11:53 - gonna draw like you know 20 boxes around
11:55 - my face and say we have 20 faces when
11:57 - really it's just my face 20 times and so
11:59 - what you do with this minimum number of
12:01 - neighbors is you say okay
12:02 - how many faces do i need to detect in a
12:05 - specific vicinity for me to call this
12:08 - thing a face and in this case i'm
12:10 - putting five so i have to have five kind
12:12 - of boxes overlapping each other in one
12:14 - area for me to say hey this here this is
12:17 - a face that's what it means so for this
12:19 - number you don't really have to worry
12:20 - about it too much make it something
12:22 - between three and six the higher the
12:24 - number goes the uh less number of faces
12:26 - you're going to get detected the lower
12:28 - the number the more faces so if you're
12:30 - finding it's not picking up faces make
12:32 - it lower maybe make it three or four if
12:33 - you're finding it's picking up too many
12:35 - faces things that aren't faces make it
12:37 - like six okay
12:38 - but five is a really good middle ground
12:40 - anyways now that we have this i'm going
12:42 - to show you how we can actually use this
12:44 - to draw where the faces are on our image
12:47 - so to do this we're going to say
12:50 - 4
12:51 - x
12:52 - y width and height in faces we're going
12:55 - to say
12:56 - cv2.rectangle this is going to draw a
12:58 - rectangle on the screen we're going to
13:00 - draw this on our frame notice i'm
13:02 - drawing this on my color image not on my
13:04 - grayscale image that's because the
13:06 - grayscale image and the color image in
13:07 - terms of
13:08 - i guess locations so like x y width
13:11 - height where faces are is the exact same
13:13 - so i'm going to say frame
13:14 - i'm going to say x y
13:16 - i'm going to say
13:19 - x plus width
13:21 - and y plus height i'm going to say 255 0
13:26 - 0
13:27 - and i'm going to say 3.
13:28 - now what the heck did i just do let me
13:30 - explain so frame this is the image you
13:32 - want to draw it on i want to draw an
13:34 - image on this frame okay i wonder a
13:36 - rectangle story on this image then we
13:38 - have point one and point two this is the
13:40 - top left and bottom right hand corner of
13:42 - our rectangle so x y this my top left x
13:45 - plus width and y plus height that is my
13:48 - bottom right so it's telling me the two
13:50 - corners of the rectangle and then i can
13:51 - draw the rectangle according to that
13:53 - that's all i need okay then this is the
13:54 - color of the rectangle don't get
13:56 - confused here this is actually bgr not
13:59 - rgb
14:00 - so
14:01 - 0 0 is going to give me a blue rectangle
14:03 - because blue green red kind of weird how
14:05 - they do it but that's how it is
14:07 - and then this is the line thickness so i
14:09 - want this to be three pixels thick
14:11 - across the rectangle sweet now this will
14:13 - draw all of our faces too because we're
14:15 - doing this in a for loop and if we have
14:16 - no faces well it will draw no faces
14:19 - okay now that we have that i'm going to
14:21 - skip the body for right now we'll just
14:23 - do the face
14:24 - let's run this and let's see if it works
14:26 - and there we go we have our window and
14:28 - notice the blue rectangles kind of
14:30 - follow me around now if i go and like i
14:32 - hide behind my microphone notice it
14:34 - disappears so obviously it's not perfect
14:36 - but considering how quick it is it does
14:38 - a pretty good job so there you go that
14:40 - is the face detection okay i'm going to
14:42 - quit that so now that i have quit that
14:46 - what i'm actually going to do is remove
14:47 - this because i don't actually care about
14:49 - the location of my faces or of my bodies
14:52 - and by the way if you want to do this
14:54 - with the body cascade you do the exact
14:55 - same thing so in fact let's just do this
14:57 - let's say bodies is equal to face
14:59 - cascade dot detect multi-scale 1.3 and
15:01 - 5. so same parameters are okay if you
15:03 - wanted to draw the bodies then what you
15:05 - would just repeat this but you do in
15:06 - bodies instead of faces okay
15:08 - we're not going to do that for right now
15:10 - the point is i don't really care where
15:12 - my faces are where my bodies are because
15:14 - i'm not going to draw rectangles and
15:16 - stuff around them i just want to know if
15:18 - they're there so if they are there then
15:20 - i will start recording that's kind of my
15:22 - logic here if i see a body or face start
15:24 - recording i don't really care where in
15:26 - the frame it is so how can i check if a
15:28 - body or if a face is here well i can
15:31 - look at the length of my faces and the
15:33 - length of my bodies because if i have
15:35 - one face this will be length one if i
15:37 - have one body this will be length one
15:38 - it's a list of locations so i'm going to
15:40 - say if the len of faces plus the lan
15:46 - of bodies is greater than zero
15:50 - then recording
15:52 - equals true and this should be recording
15:54 - not just record okay so we're gonna get
15:56 - the line of the faces add it to the line
15:58 - of bodies if we have at least one body
15:59 - or one face then we will start recording
16:01 - so let's make a variable up here
16:04 - let's call this recording and let's make
16:06 - this equal to true now before i go any
16:08 - further let me show you how to record
16:09 - video and then we'll implement all of
16:11 - the logic for actually doing like
16:13 - recording at a specific time essentially
16:15 - okay so to record video you need a few
16:17 - things the first thing you need is the
16:19 - frame size of the video you want to
16:21 - record so since we're going to be
16:22 - recording our video capture device the
16:25 - frame size of our video recording needs
16:27 - to be the exact same as our video
16:29 - capture device so i'm going to say my
16:31 - frame underscore size is equal to
16:34 - this is going to be a tuple this is
16:36 - going to be the end of cap.get3
16:40 - cap.get3 gives you the width as a
16:42 - floating point value so we have to round
16:44 - it using int
16:45 - and then we're going to say int and cap
16:48 - dot get
16:50 - four okay so inside of here we put a
16:53 - four so this gives us the height i have
16:55 - one extra bracket there sweet now we
16:57 - have the frame size next thing we need
16:59 - to set up is what's known as our four
17:00 - character code which is the unique
17:03 - identifier for the specific format our
17:05 - video is going to be saved as now i want
17:07 - to save my videos using mp4 format so
17:10 - what i'm going to do is say that my 4cc
17:13 - four character code is equal to cv2
17:17 - dot video
17:18 - writer underscore 4cc and then inside of
17:22 - here i'm going to pass a mp4v
17:27 - and then an asterisk now let me explain
17:29 - this and let me just look at my notes
17:30 - and make sure i did this right okay
17:33 - looks right right now though we might
17:35 - have to change this later so what this
17:37 - does is actually pass this string here
17:40 - as four parameters to this function so
17:43 - the asterisk kind of like decomposes
17:45 - this and into four separate arguments
17:48 - because this actually accepts
17:50 - four characters right mp
17:53 - v or mp4
17:57 - and then v so what we need to do is pass
18:00 - well this and an easier way for me to do
18:02 - this is mp
18:04 - 4v
18:05 - with an asterisk hopefully that kind of
18:07 - makes sense but that's what that does
18:09 - okay so now that we have that we need to
18:10 - make an output stream now the output
18:12 - stream is where we're going to write all
18:14 - of our content to and then we will kind
18:16 - of close the output stream once we want
18:17 - to save the video so we're going to say
18:19 - out is equal to
18:23 - cv2.videowriter and we're going to pass
18:25 - the file name so i'll just go with video
18:28 - for right now.mp4
18:30 - then i need to pass
18:31 - my four character code so i'm going to
18:33 - pass 4cc
18:34 - i need to pass my frame rate so i'm
18:37 - going to go with 20 and lastly i need to
18:39 - pass my frame size okay now you can just
18:42 - do 20 like that as well so you need
18:44 - video name the uh four character code
18:46 - which you got to set up like this and
18:48 - then you need your frame rate make this
18:50 - whatever you want to make it 20 and then
18:52 - frame size i am just going to go with
18:54 - the frame size of my video capture
18:56 - device now that we have out it's
18:57 - actually very very easy to make or save
18:59 - a video what you do is you say out dot
19:02 - write notice i'm doing this in the while
19:04 - loop i'm going to write my frame
19:06 - and now all i need to do is once i quit
19:09 - this while loop here so once i quit the
19:10 - program i have to say
19:13 - out dot release and this will save the
19:15 - video so i'm going to write all of the
19:16 - frames to this output stream and then as
19:18 - soon as i release the stream it saves
19:20 - the video
19:21 - so let's go ahead and save this
19:23 - and run it and let's see if we generate
19:25 - a video now the video will be in the
19:27 - same directory as where your python file
19:30 - is so keep that in mind if you're kind
19:31 - of searching for where the video is
19:33 - alright so here we go i have my video
19:35 - capture stream in front of me notice i'm
19:37 - not drawing the faces anymore that's
19:39 - intentional now when i hit q it stops
19:42 - let me open up my windows explorer and
19:43 - show you video so we will continue in
19:45 - one second but i need to quickly thank
19:47 - the sponsor of this video and this
19:48 - series which is algo expert algo expert
19:51 - is the best platform to use from
19:53 - preparing for your software engineering
19:54 - coding interviews they have over 160
19:56 - coding interview practice questions
19:58 - taught by the best instructors one of
20:00 - which is me check out algo expert from
20:03 - the link in the description and use the
20:04 - code tech with tim for a discount on the
20:06 - platform all right so here we go we can
20:09 - see the saved video i'm not going to
20:10 - play it i mean like you guys know the
20:12 - video here you go it works it was just
20:14 - what you saw before
20:15 - and now we can continue so now that we
20:17 - know how to save video we know how to
20:19 - access the faces we know how to do all
20:21 - kinds of other stuff what we're going to
20:23 - do is implement the logic for saving
20:25 - videos at a specific time only when a
20:27 - person is in the frame of our video
20:30 - camera so to do this we need a little
20:32 - bit of logic we need this first variable
20:33 - which is recording this next variable we
20:36 - need is i got to look at my notes here
20:38 - we're going to call this detection
20:40 - underscore stopped
20:42 - underscore time we're going to make this
20:44 - equal to none explain why we need this
20:46 - in a second and i'm going to say timer
20:48 - underscore started
20:49 - is equal to false i'm actually going to
20:51 - change recording to be equal to
20:53 - detection to say hey we did detect
20:55 - something we have detected i think that
20:57 - makes more sense
20:59 - okay so let's go with detection if i
21:01 - could spell like that is equal to true
21:03 - okay so the reason i want these two
21:05 - variables detection stop time and time
21:07 - are started is because as soon as
21:08 - someone leaves the frame i still want to
21:11 - record for a certain period of time so
21:13 - you know most traditional video cameras
21:15 - someone comes in the frame or some
21:17 - motion's detected and then it will
21:18 - record like a certain duration of time
21:20 - after they leave the frame that's what i
21:22 - want to do now there's two good reasons
21:24 - for that one that just seems like a good
21:26 - thing to do
21:27 - two what will happen in my algorithm if
21:29 - i don't do this is that as soon as the
21:31 - face is not detected which can happen
21:33 - sometimes like the class the classifier
21:36 - can mess up it will instantly stop
21:38 - recording the video and then it will
21:39 - restart the video immediately and so
21:40 - what you'll get is like you know 100
21:42 - like millisecond long videos we're just
21:44 - like start stop start stop start stop we
21:46 - don't want that instead we want one
21:48 - longish video and then if i'm out of the
21:50 - frame for a certain period of time then
21:53 - we'll stop and then we'll restart the
21:55 - video as soon as i come back in
21:56 - hopefully that kind of makes sense but
21:58 - that's the idea and if you want to see
22:00 - what happens if you don't do this well
22:01 - then just run it without the logic that
22:02 - i'm going to implement
22:04 - next i need this variable i'm going to
22:05 - say seconds to
22:08 - record
22:09 - after
22:10 - detection kind of a ridiculous variable
22:13 - name but i'm going to go with 5 just so
22:15 - we can very easily change this later on
22:18 - great now that we have this let's go
22:20 - down here so we have our if statement
22:21 - and we say if the atlanta faces plus the
22:23 - line of bodies greater than 0 detection
22:25 - equals true however i want to first say
22:29 - if detection
22:31 - so if detection like this
22:33 - then
22:34 - timer underscore started
22:38 - equals false so you'll see why we need
22:40 - this in a second i'm just going to have
22:41 - to code out a bunch of stuff and then
22:42 - i'll walk you through all the code
22:43 - because it's hard to break this into
22:45 - like different sections
22:47 - otherwise i'm going to say else
22:49 - detection
22:51 - is equal to true so starting off here
22:53 - we're saying okay
22:54 - if we detected a face of our body but
22:56 - we've already detected a face or a body
22:59 - like we're already detecting it just say
23:01 - the timer started as equal to false
23:03 - which means if we were going to stop
23:05 - recording don't stop recording we just
23:07 - detected a body and a face again seems
23:09 - kind of confusing because we haven't
23:10 - implemented the timer started yet but
23:12 - just keep that in mind now here we're
23:14 - saying okay well if we weren't already
23:16 - detecting something so if we hadn't
23:18 - detected something already let's set
23:20 - detection equal to true and now let's
23:22 - start a new video because i want to
23:24 - start a new video or start a new
23:26 - recording whenever i first detect a new
23:28 - body or face after we hadn't been
23:30 - detecting something previously if we
23:32 - were detecting something previously just
23:34 - keep writing to the video output stream
23:37 - we don't need to start a new video
23:38 - otherwise we would have a new video for
23:40 - every frame right so what i'm going to
23:41 - do is take this out variable
23:44 - delete it from there i'm going to put it
23:46 - in here and say out is equal to this
23:48 - however
23:49 - first i want to change this output file
23:51 - name
23:52 - and the name should actually be equal to
23:54 - whatever the current date and time is
23:57 - that's usually what you have for like
23:58 - your video file names when you have some
24:00 - type of security system
24:02 - so we have import date time here make
24:04 - sure you have that
24:06 - we're going to say
24:07 - current time is equal to
24:11 - datetime.datetime
24:13 - like this dot now dot strf time
24:18 - and then i'm just going to copy
24:19 - something in here and i'll explain what
24:21 - this is in a second but it's easier to
24:23 - copy okay so what this is going to do is
24:25 - format our time uh why is this
24:29 - okay i think this is all right i'm just
24:31 - trying to make sure i haven't messed
24:32 - something up here okay it looks good to
24:33 - me so we're saying okay let's get the
24:35 - current time all right and then we're
24:36 - going to format the time so we get it in
24:38 - day month year hour uh month and second
24:42 - or
24:42 - yeah does that make sense hour sorry
24:44 - hour minute second okay day month year
24:47 - hour minute second that's what this is
24:48 - going to give me in this order if you
24:50 - only want say like just the hour minute
24:53 - second then just remove these right you
24:55 - can mess with it as you want but make
24:56 - sure you don't have any colons in here
24:58 - or anything that's an invalid character
25:00 - in saving a file name because if you
25:02 - have that then this just isn't going to
25:04 - work i found that out the hard way when
25:05 - before making this video for like an
25:07 - hour i was debugging and i had a damn
25:09 - colon in this name and that was the
25:11 - issue so just keep it like this that's
25:13 - going to give us our current time so
25:15 - what i'm going to do now is i'm just
25:16 - going to use the current time so i'm
25:17 - going to use an f string and say f
25:20 - and then current time like that dot mb4
25:22 - so this will actually be my file name
25:25 - let me see if there's anything else i
25:26 - need to do here that actually looks good
25:28 - to me after i do this though i'm just
25:30 - gonna print
25:31 - started
25:33 - recording just so we know that okay we
25:35 - just started recording start a new
25:36 - output stream now we can start writing
25:38 - to that string
25:40 - great so now that we have this part of
25:42 - the logic i'm going to implement else
25:44 - here so i'm going to say okay else if
25:47 - detection
25:48 - so actually this isn't else if this is
25:50 - just life been writing in too many
25:52 - different programming languages recently
25:53 - so i'm going to say all right
25:55 - if we did not detect a body or face but
25:58 - we had detected something previously the
26:00 - detection variable is equal to true then
26:02 - what we're going to do is say
26:05 - start our timer so start our timer for
26:07 - when we should
26:08 - end the video stream or end the video
26:11 - record hopefully this makes sense but if
26:14 - we just stopped detecting something so
26:16 - if we no longer see a face or a body but
26:18 - we just we're seeing a face our body
26:20 - we're gonna wait whatever this variable
26:22 - is so five seconds before we stop our
26:25 - video recording that's what this like
26:27 - part of logic that i'm gonna write is
26:28 - gonna do
26:29 - so i'm going to say
26:31 - timer underscore started is equal to
26:34 - true and then i'm gonna say the
26:36 - detection
26:38 - uh stop time is equal to time dot now
26:42 - okay uh sorry not time.now this is
26:44 - time.time
26:45 - and this will give you the current time
26:47 - now we also could use daytime.now but
26:49 - time.time is just a little bit better
26:51 - for this purpose
26:52 - anyways go with this okay detection time
26:54 - equals time dot time
26:56 - however
26:58 - we need a way to actually stop the video
27:00 - so what i'm going to do is say if the
27:02 - timer has started so if the timer was
27:04 - already started if we already did this
27:06 - then what i want to do is check if the
27:09 - timer is past its five seconds so i'm
27:11 - going to say if
27:12 - time dot time minus the detection stop
27:16 - time is greater than seconds to record
27:20 - after detection so greater than or equal
27:22 - to
27:23 - then what i will do is stop the video
27:24 - i'm going to say detection
27:26 - is equal to false
27:28 - i'm going to say the timer started is
27:31 - equal to false and i'm going to say out
27:34 - dot release this will save the video
27:36 - then i'm going to print
27:39 - stop
27:40 - recording okay and let's just go with
27:42 - capital here for consistency
27:45 - okay then
27:46 - i'm going to put else and i'm going to
27:48 - put this
27:50 - all right so i'm sure everyone's
27:51 - confused so let's run through this and
27:53 - just see what happens all right so let's
27:55 - pick our first scenario for running
27:57 - through this in that we just started the
27:58 - program we've not detected anyone yet
28:01 - this detection variable is false okay
28:02 - that that's the first thing we'll say
28:04 - this
28:05 - for right now is equal to false
28:08 - okay so when this is false we just
28:09 - detect a body or face we did my face
28:11 - just comes in frame and we say okay
28:13 - we've detected a body or face so we get
28:14 - inside this if statement were we just
28:16 - detecting a body of your face no we
28:18 - weren't so we go into the cells so we
28:20 - say okay detection is equal to true we
28:21 - have detected something what's the
28:23 - current time get the current time create
28:25 - our video output stream we're going to
28:26 - make a new video we're going to start
28:27 - recording right now because we just
28:29 - detected a new body or new face okay
28:31 - boom goes on
28:33 - face is in the frame all of a sudden
28:35 - stops face is no longer in the frame so
28:37 - this is false so we go to this lf and we
28:39 - say okay were we just detecting
28:41 - something before we were we were
28:42 - recording before detection was equal to
28:44 - true so what we're going to do is check
28:46 - if the timer was started well the timer
28:48 - was not started because we just stopped
28:49 - detecting something so start the timer
28:52 - all right so we say detection stop time
28:53 - is equal to time dot time this is
28:55 - telling us okay at this point in time we
28:57 - stopped seeing something on the video
28:58 - frame or in the video camera we didn't
29:00 - see a person anymore okay continue all
29:03 - of a sudden we no longer see any more
29:05 - people all right so we no longer see any
29:07 - more people we come back here we say
29:08 - okay were we detecting people before yes
29:10 - we were has the timer started the timer
29:13 - has started so now we run this we say
29:14 - okay well is the current timer or is the
29:18 - current time sorry five seconds past
29:20 - when we started this time that's what
29:22 - it's doing saying has five seconds
29:24 - elapsed if it hasn't we just continue
29:26 - keep running the program
29:28 - if it has though if five seconds or more
29:30 - has elapsed we say detection equals
29:31 - false timer start equals false stop the
29:34 - current recording print stop recording
29:36 - and now everything resets right
29:39 - hopefully that's kind of makes sense
29:41 - okay so now let's imagine that this is
29:43 - not the case all right so maybe it's
29:44 - only been one second or two seconds
29:46 - since someone's left the frame
29:48 - now all of a sudden boom i'm back in the
29:50 - frame we see a face so what happens is
29:52 - this is true we did detect a face or we
29:54 - detect the body the timer has started
29:56 - and we were detecting something before
29:58 - so if detection yes we were detecting
30:01 - something before
30:02 - timer started equals false now the
30:04 - reason for this is i need to kind of
30:06 - reset this time because all of a sudden
30:08 - we just saw another person so we're
30:10 - going to say timer start equals false
30:12 - keep recording and now if the person
30:14 - leaves we're going to have five seconds
30:16 - after they just left to keep record
30:19 - hopefully this is kind of making sense
30:20 - but this is to mitigate the fact if i
30:22 - leave and come in the frame a bunch of
30:23 - times very quickly i don't get like 20
30:25 - videos i just have one video that
30:28 - maintains or records the entire time of
30:30 - me leaving coming back leaving coming
30:31 - back
30:32 - i'm hoping this is kind of making sense
30:34 - but that's what the logic is doing it's
30:35 - just saying we're not going to stop the
30:37 - recording unless it's been five seconds
30:39 - that someone entered the frame that's
30:41 - what all of this does and at this point
30:42 - i can't really explain it much more you
30:44 - can kind of run through the scenarios
30:45 - yourself and see how this works but i
30:47 - promise you it does work okay now that
30:49 - we have this we actually need to write
30:51 - to the output but we only want to write
30:53 - to the output stream first off the
30:55 - output stream exists and if we are
30:57 - recording
30:58 - so we're going to say if detection
31:01 - then out.right and that's actually all
31:03 - we need for this saying okay well if we
31:05 - are detecting something then we're going
31:07 - to be writing so as soon as this
31:08 - variable becomes false we stop writing
31:10 - to the output stream and while we would
31:12 - have stopped recording
31:13 - and then we would have started a new
31:14 - recording as soon as we detected a new
31:16 - thing hopefully making sense but that's
31:20 - actually all that i need i'm looking at
31:22 - my other screen here to make sure i
31:22 - didn't forget anything and i think this
31:24 - is all the code we need for our security
31:26 - system so let's run this let's test it
31:29 - out and i'll do one more recap and go
31:30 - through everything that we've done
31:32 - okay so let's run
31:34 - give it a second and see what we get for
31:36 - our videos alright so we already got an
31:38 - error my apologies it's because i set
31:40 - detection equal to true to start
31:43 - we need to set this equal to false to
31:45 - start because otherwise we get this out
31:46 - is not defined error because i tried to
31:48 - write to the output stream before i
31:49 - created it so just make detection equal
31:51 - false and let's try it again all right
31:54 - so we just ran it it says started
31:55 - recording because it detected my face
31:57 - what i'm going to do now is leave the
31:59 - frame you'll see that after about five
32:00 - seconds it stops recording then i'll
32:02 - come back in and we'll just we'll do a
32:03 - few examples so i'll be right back
32:17 - all right hopefully you guys enjoyed
32:19 - that me running around here trying to
32:20 - get this to work um let me get my face
32:23 - out of the frame for a second though
32:24 - just so we stopped this last recording
32:26 - all right great so we stopped last
32:27 - recording okay let's start again anyways
32:29 - let's just quit and let me go here and
32:32 - see that we have four recordings now and
32:34 - notice that as i kind of left the frame
32:36 - and come back in the frame or came back
32:37 - in the frame if i didn't wait five
32:39 - seconds the recording didn't stop so it
32:40 - just continued and i left came back in
32:42 - left came back in whatever so hopefully
32:44 - that kind of gave me an example of how
32:46 - this works but obviously you can tweak
32:47 - some of the settings to make it work
32:49 - differently
32:50 - anyways
32:51 - that's it that's literally all we need
32:52 - for this security system so let me make
32:54 - this a bit smaller here and i will kind
32:57 - of go through the code one last time
32:58 - just to make sure everyone is clear and
33:00 - then explain to you how you can maybe
33:01 - make this even better in the future if
33:03 - you wanted to
33:04 - so we create our hard cascades our video
33:06 - capture device you do our imports
33:08 - declare all our variables i don't need
33:10 - to talk about all this
33:11 - here we can quickly cover this we're
33:13 - getting the frame size and we're getting
33:14 - our four character code which is the
33:17 - kind of video format right so i'm going
33:19 - with mpv4 because i'm doing an mp4 video
33:22 - if you wanted a different format you'd
33:23 - have to pick something else
33:25 - again link in the description to find
33:26 - out what those formats are
33:28 - continuing we start our while loop we
33:30 - capture our frame we can convert our
33:32 - frame to grayscale we detect the faces
33:35 - and the bodies in our frame in the
33:36 - grayscale frame
33:37 - we then say have we detected or have we
33:39 - seen any uh faces or bodies if we have
33:43 - we go inside of here and we say okay
33:44 - were we detecting stuff before are we
33:46 - currently recording essentially yes we
33:48 - were so timer start equals false just to
33:51 - make sure that if we were um
33:54 - about to end the video if we'd start
33:56 - that timer we now make that false so
33:58 - we're going to keep recording we kind of
33:59 - like reset the timer if that makes sense
34:01 - that's what this is doing
34:02 - then we go into this else so if we were
34:04 - not recording before then we need to
34:06 - start recording because we just detected
34:07 - a phase of our body so we say the text
34:09 - equals true we get the current time use
34:11 - that as our file name start the video
34:13 - output stream create a new recording
34:14 - okay
34:16 - continuing we go to this life so l if
34:18 - we're recording so if we have not
34:19 - detected any faces or bodies and we're
34:21 - recording then it's time to start the
34:23 - timer and see if any faces or bodies
34:25 - come back in the frame within that time
34:27 - or duration so if the timer started we
34:29 - check if the timer has expired and if it
34:31 - has we stopped the recording if it
34:33 - hasn't we just continue if the timer is
34:35 - not started we start the timer and keep
34:36 - track of when we started the time okay
34:39 - that's it that's how this logic works
34:41 - then we come here we say okay are we
34:43 - detecting something if we are right
34:45 - right pretty much this is saying are we
34:47 - recording if we're recording yes let's
34:48 - write out to the frame then we show the
34:50 - current frame and you press q if you
34:53 - want to quit now it's worth mentioning
34:55 - you don't have to show the frame
34:57 - right like i can do this and this will
34:58 - work perfectly fine without me actually
35:00 - displaying the frame on on the screen
35:02 - obviously the point of that is it makes
35:03 - a better video but you don't need to
35:05 - show this especially if you're just
35:06 - running this on like a raspberry pi and
35:08 - in fact it'll be a lot faster if you
35:10 - don't show this frame on the screen
35:12 - finally we just release all of our
35:14 - resources so i release out just to make
35:16 - sure that in case
35:17 - we were
35:19 - recording and we didn't stop the
35:20 - recording when we got out of this while
35:22 - that we stop it just in case and then we
35:24 - release our video capture device and we
35:26 - destroy all our open cv windows perfect
35:30 - all right so with that said i am going
35:32 - to wrap up the video here all of this
35:34 - code will be available at the link in
35:36 - the description and so will that opencv
35:38 - python tutorial series that would
35:40 - explain all of this more in depth i hope
35:43 - you guys found this useful and you
35:44 - enjoyed the video if you did make sure
35:45 - to leave a like subscribe to the channel
35:47 - i will see you in another one
35:51 - [Music]

Cleaned transcript:

hello everybody and welcome to the youtube video so in today's video i'm going to show you how to make a security system in python using the opencv module now what we'll be doing is actually detecting a face or a body in our video camera footage so you need to have some type of webcam to be able to follow along with this video or any type of camera that you can kind of like plug into your computer and you can view in live time what we'll do is we'll be accessing that camera using opencv detecting a face or detecting a body and then as soon as we detect that we're going to start recording so we're actually going to record all of the motion or all of the time that this thing is in the frame this person is in the frame we'll then save that video and then from there you guys can extend this you could email it to yourself you could send yourself a notification you could you know snap a photo of the person's face will actually show you how we can get directly the face from the video frame anyways this will be a really good kind of starting point if you are trying to build you know a security camera or security system or something along those lines with that said let's go ahead and dive in and start writing some code okay so let's go ahead and get started now the first thing i will mention is that i do have an opencv python tutorial series so in this video i will kind of skim through some of the more advanced opencv concepts i'm not going to explain them in depth because they would take a really long time so if you do want to understand how those things work then do go and check out my opencv python tutorial series i'll kind of reference which videos which things are talked about in as we go through here and i'll leave a link to that series in the description so now that i've mentioned that the first thing that we need to do here is install opencv so it doesn't really matter what operating system you're on open your terminal open your command prompt here i'm in vs code so i'm using the vs code terminal and type pip3 install opencv hyphen python now if that doesn't work for you try just pip if that doesn't work try python hyphen m like that and if that doesn't work try python 3 hyphen app okay try all of those i already have this installed so i'm not going to run that command once you have it installed though we can continue if for some reason that doesn't work i'll leave two videos in the description that show you how to fix this pip command one for mac and linux the other for windows okay now that we have that i'm in a python file i'm in vs code and the first thing i'll mention is wherever you create this python file is where the video recordings are going to be saved so just you know make this in a folder or something just don't put this like directly on your c drive because there's going to be a ton of video files when you're actually running this okay so now let's import a few things we're going to import cv2 we're going to import time and we're going to import date time okay we'll use some of these later first thing i'm going to show you how to do is access your webcam and just view video here in python so that's step one so to do that we're going to say capture is equal to cv2 dot video capture like that and we're going to put the number zero now what you can do if you have multiple video capture devices is index them with zero one two three the first video device will be zero i only have one so i can only put zero but if you had multiple you do one two and so if you're not getting the correct video camera just increment this number go up uh each time and just check and see if you're getting the right device now that we've done that what i need to do is set up a wallop so i'm going to say while true and i'm going to say underscore comma frame is equal to cap dot read so what i'm doing is reading one frame from my video capture device i'm then going to display that on the screen and so we'll display a ton of frames i mean that's really what a video is right a ton of images so we'll do that and we'll be able to see our video now if you're wondering why i did this the underscore is a placeholder variable i could do something like h or x or some variable name the reason i'm doing that is because this returns something else as well we don't really need to know what that is but the only thing we care about is the frame so we're going to say whatever this is we don't care about so we just put an underscore comma frame this is what we want all right so now what we're going to do is say cv2 dot i am show we're going to show as our camera the frame now this is just going to be the title of the window that shows you the actual video frame name this whatever you want doesn't need to be camera and then put frame right here great now that we have that i just need to set up one thing that allows us to actually quit this because right now if you run this you're going to be an infinite loop and without crashing your program you won't be able to actually quit this while loop so to do that we are going to say if and this will be cv2 dot weight key one equals equals the ordinal of q then break now i won't really explain how this works again watch the cv2 tutorial series specifically i believe the first video actually it might be a different video but one of those videos explains how this works but this pretty much just says hey if you hit the q key stop okay break the program end all right now that we have that we need to release the resources from this camera so it's just good practice after you kind of access a camera that you release the resource so what we're doing here is we're saying okay give me access to the video capture device it's going to activate the video camera and then this program has control of it okay so you won't actually be able to run this if another device is using your video camera actively so make sure it's not being used when you run this but what we need to do is make sure that once this program ends something else can now use the video camera so we're going to say dot release like that and that will release the resource kind of clean it up and allow other things to now use this once the program ends then we're going to say cv2.destroy all windows and this will destroy the window that is showing the video capture device perfect now that we have all this we can run our code cross our fingers and pray that this works i will mention this does take usually for me like 15 20 seconds to actually run not sure why it takes so long hopefully for you guys it's faster but it's totally normal if it's kind of hanging here i've had it hang for up to like you know 45 seconds sometimes and so if you see me cutting throughout this video it's probably because i'm just getting past the hanging of the video account anyways i can see my video camera on now so let me get out of vs code notice we have this camera frame here and you can see my beautiful face now in two places on the screen regardless to quit i'm gonna hit q we are now done and we can continue okay so now that we've done that we have access to our video camera i want to detect faces and bodies so to do that i'm going to use something called a harcass skate now a har cascade is kind of the first word that i need to say it's a hard cascade classifier and what the hard cascade classifier is is something that is pretrained and prebuilt by opencv to detect faces or whatever we want really in images so in this case we're going to use a face detection one and a body detection one and really all you need to know about these is that you pass an image to them they've been trained on like hundreds of thousands if not millions of images they're really really good and they can tell you very quickly if faces exist in the image and where those faces are or if whatever you're trying to classify exists in the image so to set these up we're going to say face underscore cascade is equal to cv2 dot cascade classifier like this we're then going to pass cv2.data dot har cascades like this plus and then the name of the hard cascade we want to access so in this case i want the har cascade underscore frontal face underscore default dot xml let me make sure this is correct looks good to me except i gotta spell cascade correctly so this is what we want let me just kind of run through this line and explain what i just did so i set up a cascade classifier i need to pass to it a classifier all of the classifiers we have here already exist they're prebuilt into opencv you don't need to install them or download them or anything and one of the ones we have is this frontal face default classifier and so i have to pass kind of like the base directory of where all of these classifiers exist which is cv2.data.har cascades make sure you have the plural here so the s and then i add the actual name of the classifier so i just want this classifier that's pretty much it uh if you want a full list of all of the classifiers i'll leave a link to it in the description you can mess around with other ones they pretty much all work the same okay now we have face we want body so i want the body cascade i'm going to say cb2.data.hardcascades and this time rather than the frontal face default i want the full body not fully body the no that was actually right full body like that dot xml let me make sure that's correct yes that looks good okay so we now have the full body one and we have the frontal face one so now that we have them let's actually use them so to use them the first thing i need to do is actually convert my frame here to a grayscale image so all of these classifiers require a grayscale image to do the classification and they will tell us the location and presence of any faces in the grayscale image now it doesn't really matter we can still show like the color image on the screen it's just that to do the classification it needs grayscale so i'm going to say gray is equal to and this will be cv2.cvt color like that we're going to pass our frame we're going to pass cv2 dot color and this is going to be bgr 2 and then gray okay what this will do is give us a new image that is grayscale and yeah that's about it that's all i can really say for that okay now that we have the grayscale image let's use a classifier so i'm going to say faces in lowercase is equal to face cascade not dot fit dot this is going to be detect and then multiscale like this it's a specific algorithm we're going to use with the hard cascade i need to pass to this my frame so i'm going to pass gray which is my grayscale image i need to pass what's known as a scale factor and what's known as my minimum number of neighbors now let me stop for a second explain what these are so gray clearly is our image okay that's what we want to detect the faces on as i said this is going to return to us a position or sorry list of positions of all of the faces that exist yes this can give you multiple faces if they are all in the image this will actually give you the x y width and height of all faces that exist anyways you pass the frame and then you pass the scale factor now the scale factor is a number that determines the accuracy and speed of this algorithm it does a lot more than that but i'm not going to explain exactly how it works pretty much you should keep this number between 1.1 and 1.5 i find 1.3 is the best kind of middle ground for speed and accuracy but the lower this number goes the more accurate it gets but the slower it is so if i do something like 1.01 by the way the minimum for this number is one you have to have something larger than one you're going to get a very very accurate algorithm but it's going to take a very long time to run so if you're noticing that at 1.3 your faces aren't quite accurate or it's too slow or actually other way around if they're not too accurate make this number lower make it like 1.2 1.1 and if you notice here that it's still too slow then make it something like 1.5 1.6 but again 1.3 will most likely be fine for you these things still work extremely quickly even if you make them like 1.2 or 1.1 but let's go with 1.3 okay now what is minimum number of neighbors uh this one is a little bit complicated but pretty much the way that this har cascade's gonna work is it's gonna detect like hundreds of faces and all of them are gonna be the same face so it's gonna look at my face and it's gonna draw like you know 20 boxes around my face and say we have 20 faces when really it's just my face 20 times and so what you do with this minimum number of neighbors is you say okay how many faces do i need to detect in a specific vicinity for me to call this thing a face and in this case i'm putting five so i have to have five kind of boxes overlapping each other in one area for me to say hey this here this is a face that's what it means so for this number you don't really have to worry about it too much make it something between three and six the higher the number goes the uh less number of faces you're going to get detected the lower the number the more faces so if you're finding it's not picking up faces make it lower maybe make it three or four if you're finding it's picking up too many faces things that aren't faces make it like six okay but five is a really good middle ground anyways now that we have this i'm going to show you how we can actually use this to draw where the faces are on our image so to do this we're going to say 4 x y width and height in faces we're going to say cv2.rectangle this is going to draw a rectangle on the screen we're going to draw this on our frame notice i'm drawing this on my color image not on my grayscale image that's because the grayscale image and the color image in terms of i guess locations so like x y width height where faces are is the exact same so i'm going to say frame i'm going to say x y i'm going to say x plus width and y plus height i'm going to say 255 0 0 and i'm going to say 3. now what the heck did i just do let me explain so frame this is the image you want to draw it on i want to draw an image on this frame okay i wonder a rectangle story on this image then we have point one and point two this is the top left and bottom right hand corner of our rectangle so x y this my top left x plus width and y plus height that is my bottom right so it's telling me the two corners of the rectangle and then i can draw the rectangle according to that that's all i need okay then this is the color of the rectangle don't get confused here this is actually bgr not rgb so 0 0 is going to give me a blue rectangle because blue green red kind of weird how they do it but that's how it is and then this is the line thickness so i want this to be three pixels thick across the rectangle sweet now this will draw all of our faces too because we're doing this in a for loop and if we have no faces well it will draw no faces okay now that we have that i'm going to skip the body for right now we'll just do the face let's run this and let's see if it works and there we go we have our window and notice the blue rectangles kind of follow me around now if i go and like i hide behind my microphone notice it disappears so obviously it's not perfect but considering how quick it is it does a pretty good job so there you go that is the face detection okay i'm going to quit that so now that i have quit that what i'm actually going to do is remove this because i don't actually care about the location of my faces or of my bodies and by the way if you want to do this with the body cascade you do the exact same thing so in fact let's just do this let's say bodies is equal to face cascade dot detect multiscale 1.3 and 5. so same parameters are okay if you wanted to draw the bodies then what you would just repeat this but you do in bodies instead of faces okay we're not going to do that for right now the point is i don't really care where my faces are where my bodies are because i'm not going to draw rectangles and stuff around them i just want to know if they're there so if they are there then i will start recording that's kind of my logic here if i see a body or face start recording i don't really care where in the frame it is so how can i check if a body or if a face is here well i can look at the length of my faces and the length of my bodies because if i have one face this will be length one if i have one body this will be length one it's a list of locations so i'm going to say if the len of faces plus the lan of bodies is greater than zero then recording equals true and this should be recording not just record okay so we're gonna get the line of the faces add it to the line of bodies if we have at least one body or one face then we will start recording so let's make a variable up here let's call this recording and let's make this equal to true now before i go any further let me show you how to record video and then we'll implement all of the logic for actually doing like recording at a specific time essentially okay so to record video you need a few things the first thing you need is the frame size of the video you want to record so since we're going to be recording our video capture device the frame size of our video recording needs to be the exact same as our video capture device so i'm going to say my frame underscore size is equal to this is going to be a tuple this is going to be the end of cap.get3 cap.get3 gives you the width as a floating point value so we have to round it using int and then we're going to say int and cap dot get four okay so inside of here we put a four so this gives us the height i have one extra bracket there sweet now we have the frame size next thing we need to set up is what's known as our four character code which is the unique identifier for the specific format our video is going to be saved as now i want to save my videos using mp4 format so what i'm going to do is say that my 4cc four character code is equal to cv2 dot video writer underscore 4cc and then inside of here i'm going to pass a mp4v and then an asterisk now let me explain this and let me just look at my notes and make sure i did this right okay looks right right now though we might have to change this later so what this does is actually pass this string here as four parameters to this function so the asterisk kind of like decomposes this and into four separate arguments because this actually accepts four characters right mp v or mp4 and then v so what we need to do is pass well this and an easier way for me to do this is mp 4v with an asterisk hopefully that kind of makes sense but that's what that does okay so now that we have that we need to make an output stream now the output stream is where we're going to write all of our content to and then we will kind of close the output stream once we want to save the video so we're going to say out is equal to cv2.videowriter and we're going to pass the file name so i'll just go with video for right now.mp4 then i need to pass my four character code so i'm going to pass 4cc i need to pass my frame rate so i'm going to go with 20 and lastly i need to pass my frame size okay now you can just do 20 like that as well so you need video name the uh four character code which you got to set up like this and then you need your frame rate make this whatever you want to make it 20 and then frame size i am just going to go with the frame size of my video capture device now that we have out it's actually very very easy to make or save a video what you do is you say out dot write notice i'm doing this in the while loop i'm going to write my frame and now all i need to do is once i quit this while loop here so once i quit the program i have to say out dot release and this will save the video so i'm going to write all of the frames to this output stream and then as soon as i release the stream it saves the video so let's go ahead and save this and run it and let's see if we generate a video now the video will be in the same directory as where your python file is so keep that in mind if you're kind of searching for where the video is alright so here we go i have my video capture stream in front of me notice i'm not drawing the faces anymore that's intentional now when i hit q it stops let me open up my windows explorer and show you video so we will continue in one second but i need to quickly thank the sponsor of this video and this series which is algo expert algo expert is the best platform to use from preparing for your software engineering coding interviews they have over 160 coding interview practice questions taught by the best instructors one of which is me check out algo expert from the link in the description and use the code tech with tim for a discount on the platform all right so here we go we can see the saved video i'm not going to play it i mean like you guys know the video here you go it works it was just what you saw before and now we can continue so now that we know how to save video we know how to access the faces we know how to do all kinds of other stuff what we're going to do is implement the logic for saving videos at a specific time only when a person is in the frame of our video camera so to do this we need a little bit of logic we need this first variable which is recording this next variable we need is i got to look at my notes here we're going to call this detection underscore stopped underscore time we're going to make this equal to none explain why we need this in a second and i'm going to say timer underscore started is equal to false i'm actually going to change recording to be equal to detection to say hey we did detect something we have detected i think that makes more sense okay so let's go with detection if i could spell like that is equal to true okay so the reason i want these two variables detection stop time and time are started is because as soon as someone leaves the frame i still want to record for a certain period of time so you know most traditional video cameras someone comes in the frame or some motion's detected and then it will record like a certain duration of time after they leave the frame that's what i want to do now there's two good reasons for that one that just seems like a good thing to do two what will happen in my algorithm if i don't do this is that as soon as the face is not detected which can happen sometimes like the class the classifier can mess up it will instantly stop recording the video and then it will restart the video immediately and so what you'll get is like you know 100 like millisecond long videos we're just like start stop start stop start stop we don't want that instead we want one longish video and then if i'm out of the frame for a certain period of time then we'll stop and then we'll restart the video as soon as i come back in hopefully that kind of makes sense but that's the idea and if you want to see what happens if you don't do this well then just run it without the logic that i'm going to implement next i need this variable i'm going to say seconds to record after detection kind of a ridiculous variable name but i'm going to go with 5 just so we can very easily change this later on great now that we have this let's go down here so we have our if statement and we say if the atlanta faces plus the line of bodies greater than 0 detection equals true however i want to first say if detection so if detection like this then timer underscore started equals false so you'll see why we need this in a second i'm just going to have to code out a bunch of stuff and then i'll walk you through all the code because it's hard to break this into like different sections otherwise i'm going to say else detection is equal to true so starting off here we're saying okay if we detected a face of our body but we've already detected a face or a body like we're already detecting it just say the timer started as equal to false which means if we were going to stop recording don't stop recording we just detected a body and a face again seems kind of confusing because we haven't implemented the timer started yet but just keep that in mind now here we're saying okay well if we weren't already detecting something so if we hadn't detected something already let's set detection equal to true and now let's start a new video because i want to start a new video or start a new recording whenever i first detect a new body or face after we hadn't been detecting something previously if we were detecting something previously just keep writing to the video output stream we don't need to start a new video otherwise we would have a new video for every frame right so what i'm going to do is take this out variable delete it from there i'm going to put it in here and say out is equal to this however first i want to change this output file name and the name should actually be equal to whatever the current date and time is that's usually what you have for like your video file names when you have some type of security system so we have import date time here make sure you have that we're going to say current time is equal to datetime.datetime like this dot now dot strf time and then i'm just going to copy something in here and i'll explain what this is in a second but it's easier to copy okay so what this is going to do is format our time uh why is this okay i think this is all right i'm just trying to make sure i haven't messed something up here okay it looks good to me so we're saying okay let's get the current time all right and then we're going to format the time so we get it in day month year hour uh month and second or yeah does that make sense hour sorry hour minute second okay day month year hour minute second that's what this is going to give me in this order if you only want say like just the hour minute second then just remove these right you can mess with it as you want but make sure you don't have any colons in here or anything that's an invalid character in saving a file name because if you have that then this just isn't going to work i found that out the hard way when before making this video for like an hour i was debugging and i had a damn colon in this name and that was the issue so just keep it like this that's going to give us our current time so what i'm going to do now is i'm just going to use the current time so i'm going to use an f string and say f and then current time like that dot mb4 so this will actually be my file name let me see if there's anything else i need to do here that actually looks good to me after i do this though i'm just gonna print started recording just so we know that okay we just started recording start a new output stream now we can start writing to that string great so now that we have this part of the logic i'm going to implement else here so i'm going to say okay else if detection so actually this isn't else if this is just life been writing in too many different programming languages recently so i'm going to say all right if we did not detect a body or face but we had detected something previously the detection variable is equal to true then what we're going to do is say start our timer so start our timer for when we should end the video stream or end the video record hopefully this makes sense but if we just stopped detecting something so if we no longer see a face or a body but we just we're seeing a face our body we're gonna wait whatever this variable is so five seconds before we stop our video recording that's what this like part of logic that i'm gonna write is gonna do so i'm going to say timer underscore started is equal to true and then i'm gonna say the detection uh stop time is equal to time dot now okay uh sorry not time.now this is time.time and this will give you the current time now we also could use daytime.now but time.time is just a little bit better for this purpose anyways go with this okay detection time equals time dot time however we need a way to actually stop the video so what i'm going to do is say if the timer has started so if the timer was already started if we already did this then what i want to do is check if the timer is past its five seconds so i'm going to say if time dot time minus the detection stop time is greater than seconds to record after detection so greater than or equal to then what i will do is stop the video i'm going to say detection is equal to false i'm going to say the timer started is equal to false and i'm going to say out dot release this will save the video then i'm going to print stop recording okay and let's just go with capital here for consistency okay then i'm going to put else and i'm going to put this all right so i'm sure everyone's confused so let's run through this and just see what happens all right so let's pick our first scenario for running through this in that we just started the program we've not detected anyone yet this detection variable is false okay that that's the first thing we'll say this for right now is equal to false okay so when this is false we just detect a body or face we did my face just comes in frame and we say okay we've detected a body or face so we get inside this if statement were we just detecting a body of your face no we weren't so we go into the cells so we say okay detection is equal to true we have detected something what's the current time get the current time create our video output stream we're going to make a new video we're going to start recording right now because we just detected a new body or new face okay boom goes on face is in the frame all of a sudden stops face is no longer in the frame so this is false so we go to this lf and we say okay were we just detecting something before we were we were recording before detection was equal to true so what we're going to do is check if the timer was started well the timer was not started because we just stopped detecting something so start the timer all right so we say detection stop time is equal to time dot time this is telling us okay at this point in time we stopped seeing something on the video frame or in the video camera we didn't see a person anymore okay continue all of a sudden we no longer see any more people all right so we no longer see any more people we come back here we say okay were we detecting people before yes we were has the timer started the timer has started so now we run this we say okay well is the current timer or is the current time sorry five seconds past when we started this time that's what it's doing saying has five seconds elapsed if it hasn't we just continue keep running the program if it has though if five seconds or more has elapsed we say detection equals false timer start equals false stop the current recording print stop recording and now everything resets right hopefully that's kind of makes sense okay so now let's imagine that this is not the case all right so maybe it's only been one second or two seconds since someone's left the frame now all of a sudden boom i'm back in the frame we see a face so what happens is this is true we did detect a face or we detect the body the timer has started and we were detecting something before so if detection yes we were detecting something before timer started equals false now the reason for this is i need to kind of reset this time because all of a sudden we just saw another person so we're going to say timer start equals false keep recording and now if the person leaves we're going to have five seconds after they just left to keep record hopefully this is kind of making sense but this is to mitigate the fact if i leave and come in the frame a bunch of times very quickly i don't get like 20 videos i just have one video that maintains or records the entire time of me leaving coming back leaving coming back i'm hoping this is kind of making sense but that's what the logic is doing it's just saying we're not going to stop the recording unless it's been five seconds that someone entered the frame that's what all of this does and at this point i can't really explain it much more you can kind of run through the scenarios yourself and see how this works but i promise you it does work okay now that we have this we actually need to write to the output but we only want to write to the output stream first off the output stream exists and if we are recording so we're going to say if detection then out.right and that's actually all we need for this saying okay well if we are detecting something then we're going to be writing so as soon as this variable becomes false we stop writing to the output stream and while we would have stopped recording and then we would have started a new recording as soon as we detected a new thing hopefully making sense but that's actually all that i need i'm looking at my other screen here to make sure i didn't forget anything and i think this is all the code we need for our security system so let's run this let's test it out and i'll do one more recap and go through everything that we've done okay so let's run give it a second and see what we get for our videos alright so we already got an error my apologies it's because i set detection equal to true to start we need to set this equal to false to start because otherwise we get this out is not defined error because i tried to write to the output stream before i created it so just make detection equal false and let's try it again all right so we just ran it it says started recording because it detected my face what i'm going to do now is leave the frame you'll see that after about five seconds it stops recording then i'll come back in and we'll just we'll do a few examples so i'll be right back all right hopefully you guys enjoyed that me running around here trying to get this to work um let me get my face out of the frame for a second though just so we stopped this last recording all right great so we stopped last recording okay let's start again anyways let's just quit and let me go here and see that we have four recordings now and notice that as i kind of left the frame and come back in the frame or came back in the frame if i didn't wait five seconds the recording didn't stop so it just continued and i left came back in left came back in whatever so hopefully that kind of gave me an example of how this works but obviously you can tweak some of the settings to make it work differently anyways that's it that's literally all we need for this security system so let me make this a bit smaller here and i will kind of go through the code one last time just to make sure everyone is clear and then explain to you how you can maybe make this even better in the future if you wanted to so we create our hard cascades our video capture device you do our imports declare all our variables i don't need to talk about all this here we can quickly cover this we're getting the frame size and we're getting our four character code which is the kind of video format right so i'm going with mpv4 because i'm doing an mp4 video if you wanted a different format you'd have to pick something else again link in the description to find out what those formats are continuing we start our while loop we capture our frame we can convert our frame to grayscale we detect the faces and the bodies in our frame in the grayscale frame we then say have we detected or have we seen any uh faces or bodies if we have we go inside of here and we say okay were we detecting stuff before are we currently recording essentially yes we were so timer start equals false just to make sure that if we were um about to end the video if we'd start that timer we now make that false so we're going to keep recording we kind of like reset the timer if that makes sense that's what this is doing then we go into this else so if we were not recording before then we need to start recording because we just detected a phase of our body so we say the text equals true we get the current time use that as our file name start the video output stream create a new recording okay continuing we go to this life so l if we're recording so if we have not detected any faces or bodies and we're recording then it's time to start the timer and see if any faces or bodies come back in the frame within that time or duration so if the timer started we check if the timer has expired and if it has we stopped the recording if it hasn't we just continue if the timer is not started we start the timer and keep track of when we started the time okay that's it that's how this logic works then we come here we say okay are we detecting something if we are right right pretty much this is saying are we recording if we're recording yes let's write out to the frame then we show the current frame and you press q if you want to quit now it's worth mentioning you don't have to show the frame right like i can do this and this will work perfectly fine without me actually displaying the frame on on the screen obviously the point of that is it makes a better video but you don't need to show this especially if you're just running this on like a raspberry pi and in fact it'll be a lot faster if you don't show this frame on the screen finally we just release all of our resources so i release out just to make sure that in case we were recording and we didn't stop the recording when we got out of this while that we stop it just in case and then we release our video capture device and we destroy all our open cv windows perfect all right so with that said i am going to wrap up the video here all of this code will be available at the link in the description and so will that opencv python tutorial series that would explain all of this more in depth i hope you guys found this useful and you enjoyed the video if you did make sure to leave a like subscribe to the channel i will see you in another one
