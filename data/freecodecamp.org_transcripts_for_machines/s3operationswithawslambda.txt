hello world in today's video we are continuing with s free and we are going to perform some basic operations on a file like getting the file from the s free bucket and saving the file back to this free bucket this video we are continuing with s 3 but this time we are going to perform basic operations on this free bucket from the lambda so we are going to create a bucket from the server list channel then we are going to give permissions to our lambda to perform operations in that bucket then we are going to create a new file if there is known or and get it we are going to perform some operations on the file and then we are going to save it back and by the end you will get back a sign or L and this is the public or L sign with I am permissions so you can share private files in the open Internet securely so I will show you how to do everything stepbystep and we will be using the AWS SDK for node as we are we're using for dynamo for other things as well so let's go to the code so let's get start as always by creating a new directory where we are going to put our project I will call it several s as free operations you can put any name you want and I will get into that directory I will create a node project and p.m. in it yes and we then will create a server less project using the template from AWS and node after everything is done when we get into our project that we just created with the free files with package.json 100 Jas and several s you know as always the first thing we need to do is to go to the several SML and change the name of the solace project now I will set the region to Ireland you can put any reason you like but I like airline is closed and then I will pick my profile we got her many and I will just put default remove some of the comments the next thing I want to do is I want to modify them default lambda and change the name to a pen text and then add an HTTP event there will be a put to a path called a paint pen text so whenever we call this endpoint and we passed some text then these text will get appended to file and we can get the file or a public URL back so now I will create a bucket and to create a bucket you just need to use the cloud formation template to put something like these in the server Lezama in the resources property you just put as free operations bucket that's the name of the resource in the in the llam√≥ and then you put the bucket name and I will put several SS free operations bucket you can put any name you want if you pick this name this will be taken by me because name of the buckets are global in all AWS this will create a private bucket for your account with all the default properties if you want to have more detail in your properties you can add whatever you want in this template and it will create a bucket for you the next thing we want to do is we want to give permissions so lambda to write in this bucket and to get the items in this bucket and to do that I will just add permissions in the I am roll off the server less yeah Mel I will add these free actions that this lambda can perform to list the bucket to get the object to put the object and into the resource packet that we just created if I was doing this in production I will have this name as an environmental variable but I think for now I don't want to add that complexity to this code but if you are interested on learning a little bit more about environmental variables just let me know in the comments and I can make a whole video out of them now we are going to our handle Cheers our several HTML is ready and I'm going to change the name of the lambda to from hello to append text and there we are going to create a new file that is the one that will be performing all the operations in the industry I just put manage file you can put any name something better I sure they're better words for this it's just very bad at naming stuff takes me hours so I just pick any name and I will put this manage file and I will create it and in there we will put all the operations that we want to do into our s free to get started we need to require in our file AWS and s free module and then I will create two two constants that will be the bucket name and the object the file name this see Sara will be using if I will be doing it production I will be using environmental variables for now I just have it here and then we will have one main method that it will be called append text and in that method we can we want to do these things first we want to get the file and then we want to append some text to it file so it will be a basic txt file plain text when the pen time textured file in the new line for example and I want to say the file again into the the bucket and then we want to get oral the public URL for this this file so we will do this a chain of promises so we will have four promises chained together that will be performing different things the first thing we want to do is to get an object to do that we will be using this function called get s3 object and the only thing that this is doing is calling the AWS SDK get object with the bucket there is a constant and Hakeem and I just put the response condom type it's a plain text but that's not really needed and I'm making a promise of this so this is returning a promise the next thing we want to do is we want to you want to append some text to that to that file so this get as free object will be returning buffer and this buffer we can then pass to this function append text and we will first have no no information in there so that this buffer will be undefined it will be not found and then we just return the text that we want to append and then if there is something in the buffer we just convert it to string and if it's encoded with ASCII this will be we just append in a new line but text so this is the way to confer to transform a buffer to a string this will just do what we need to do if you want to do more complex operations for example if you are working with images you can do exactly the same get object and maybe the different content type and then here you can do it like resizing an image or whatever or if you are doing something more complex with text or it will be a shayzon this is the function that can be creative as this is a demo I'm just doing something super simple the next thing we want to do is we want to save that file into the bucket again so that will save using the s3 put object function will say the body into the bucket with the content I'm plain text the key will be the exactly same and the body is the one that we got from the append text and the last thing we want to do is to get the sign Aurel this is the public URL for that file sign with your with proper keys so this will expire in time so you get earn well that you can share with other people now you go back to our s3 object so so in the beginning we'll have an empty fold an empty bucket and there will be no file so basically if we try to get this this file we will see that there will be an error so what if there is the file is not there so then we need to handle this error will be only happening once but as we are creating everything from from the code we need to handle that case so here if there is an error like the file not found for example we just can't create the fire layer with nothing on it so then when the next step comes we can append text to it and everything is nice so now we construct the chain of promises that we need this is exactly the same where I was in the comment first we get the object then we append the text then we save the object back and then we get the sign over and that's what we will be returning to the handler Jia's one thing you might be interested in knowing what is inside the AWS SDK in that's free so just go to the documentation and take a look at it it's very complete you can find everything on it and just showing you a bit here but you'll find all these operations and there's a lot of different things you can do so I encourage you to take a look at it and learn how it works because it's very very convenient and leave you the link in the description box so you can find it also the code will be in the description box as always so you can go and check it from github so now we have our manage file done if and save and we go back to our handler tears then I can call that before returning the response so we only send a response when there append text is completed and we can remove a little bit what is in the body to just return the result that is the sign Errol and now we format it a bit we have the missing brackets the last thing is to grab the text that we want to append that I will put it in the query parameters you can put it anywhere else but I like it from there so I will just deploy and we can try it on the postman and see how it works I will speed this up for you because the deployment takes a little while and I don't want you to wait so now this is deployed we just grab the URL that we get from the endpoint and we put copy paste it in postman and we can add the text at the end of a query string parameters I will put Ola and then I get oral bug I just click there and I can request that file and we can say hola and then if I go on food marzia get the same moral back and then I can see what is inside although Mars here and I gave food full bar and if you can put as many things as you and it will just return always them they were up so that's very simple if you go to your AWS account you will see also the bucket is created the file is created you can check it out from there as well this was the video for today I hope you enjoyed it if you did give a big thumbs up