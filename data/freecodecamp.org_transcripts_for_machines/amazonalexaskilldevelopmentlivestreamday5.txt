hey this is steve with dabble lab welcome to uh day five of our alexa development series for those of you that find the video development i always forget to do that to turn that off um for those of you that were uh here previously welcome back and for anybody who's new uh welcome today we are going to be turn that up uh turn that off um yeah today we're gonna be talking about uh well first of all actually if um if anybody is planning on going to the voice summit if you don't know about it it is the largest tech event of the year for voice development stuff if anybody is planning to go there uh uh it's the end of this month let me let me know i'd love to uh to connect and say hello also if you are planning to go or thinking of going and you haven't gotten tickets we you can go if you go to voicesummit.ai and uh register and use the um there's a discount code dabble dabble that will give you a 20 uh discount if you are planning on going to that but let me know if you're planning on going i'd love to uh connect and say hello in person okay uh today we're going to be talking about multiturn dialogues and also data persistence in dynamo db and the certification process i'm gonna i'm not going to try to fit this into the free code camp skill that we've been working on just because i don't have a good example for that and i really want to try to make these two topics clear so i'm going to use just i'm going to go we're going to create two new skills to go through each one of these topics so that it doesn't get confusing hopefully or that's what i'm trying to uh to do with it and uh and then we'll also talk about the skill certification process we're not quite ready to fully um submit the free code camp skill yet so i was hoping we might get a a chance to submit it for live review but we're not gonna we're not gonna be able to do that i don't think uh so um but we will talk about this uh skills certification process so these are our goals for today recap yesterday we looked at using slots and we talked about custom slots and entity resolution yesterday and i think yesterday was a lot got some feedback it went went kind of uh quick for the timeline we had and although we got it all worked into the uh the skill project um part of the reason i want to try to break these two topics that we're going to be talking about today out is so that it's uh it's not as confusing but we've got the um we have the repo now out there it's been out there for two days but if you're just coming back i will post the link to the there you go that is the the github repo so um if you uh you want to grab the code it has been updated except for this link here i don't think is the most current link i'll change that though um and uh we are ready ready to go so we're gonna we're gonna start like i said with multiturn dialogs and um we're gonna do that using the management console so i'm gonna i'm gonna go over to developer.amazon.com and there's there's kind of two ways that you can do multiturn dialogues we talked uh yesterday or the day before about what they were multiterm dialogues are dialogues where you're going to go back and forth with alexa so you might ask alexa for something but before the intent can be fulfilled alexa's got to get more information from you or the skill does and so there's sort of a back and forth so for example like um ordering a pizza i think is the example that i used when we were talking about this before if you if you had an intent that was a order pizza intent to fulfill that intent you might need the pizza size toppings all of that kind of good stuff and to get that you would go and go back and forth with a multiturn dialogue to get the information that you needed to fulfill the intent so that's what we're going to walk through i did a tutorial on this a while back and i'm going to use the uh the the same example but the example that we're going to use is an example for a um like a sales coaching skill so uh and uh i think that will work so we're we're talking about the dialog interface i said there's two ways to do this you can do it through the dialogue interface which the the back and forth is managed by the alexa service you can also uh look at within your skill code you can look at the request and find out if the um slots have been filled or not and if not then you can prompt the user with a different response and that's going to be the second example that we're going to show uh or talk about today and then with that one i'm also going to get into the persistence part so let's um let's get started uh welcome back okay um what's the question free code can't by any chance uh livestream uh voice 18 summit we will be there uh i'm live stream of voice 18. i'm not sure what that is can you can you post um info on that so i'm not sure i'm understanding that question but um i'll i'll get back and look at the questions again in just a second here so i'm gonna start a new skill and i'm going to call this sales coach and custom skill for the skill service for the lambda function for the back end i am going to use the uh vui tester which i'll show you in just a second which is a great way to to just kind of get a really quick back end set up for development stuff so um let me uh let me go do that right now actually so uh if you to get the the if you go to the github the alexa github.com alexa there's a repo in there called cookbook and it's got a lot of cool examples and stuff in it so i would encourage you to go check it out and i from time to time just poke through there and see what's in there and one of those times i came across uh in the tools folder this folder here this um this here this vui testing tool uh and there's a stepbystep walkthrough but um it i'm gonna just i'm gonna cheat a little bit here for the walk through they they zip up the project but there's a shortcut way to do this that i'll show you so um i'm going to go into the source code and grab the the code for this uh lambda function here and what this does is is just echoes back requests that are coming from alexa so this is a um a skill service for really just for testing and so oops so that's what we're going to be using it for so let me go back over here to aws now and to lambda and the trick so you don't have to zip it up and deploy it i'll show you what you can do when you create your lambda function for it if you use one of the alexa blueprints remember i mentioned this i guess day one now the alexa blueprints have the skills kit sdk in them so i'm gonna just grab this one i'm gonna be overwriting all the code but i'm doing this just so i don't have to zip and upload and i'm going to call this sales coach like that and basic execution role is good and then um i'm gonna create the function and like i said i'm gonna get rid of all of the boilerplate code there i'm i'm just using this for the um the sdk that is included with it so um i need to set up my trigger there and let me get rid of the code here well while that's loading i'll set up the trigger endpoint and i'm not talking through all this because we had covered this earlier but if you've got any questions as i'm going through this uh leave those in the um in the chat and we'll cover those uh actually i could just disable this too but add that know why this is not pulling up the code here i don't know what it's doing there we go all right um and so then i'm just copying oops i need i'm going to just paste in this here so copying it and then just pasting this in like this so again this uh the the code that i'm copying and pasting in here is just gonna echo back anything that it gets from the alexa service so it's just for testing and i'm gonna save that and i think we're good uh we need to grab the arn remember from earlier and then we're going to take the the amazon resource name and add it to our skill endpoint over here and we'll save that save the endpoint for some reason the trigger didn't save let's see if that fixed it copy this to the clipboard okay that time it's saved so i think we're good um yeah we'll just leave it like that for now okay so we're so we're good there now um now let's get into the the interaction model and this is uh this is where we're gonna spend the uh the next few minutes talking about the multiturn i'm gonna just set the invocation name first to sales coach that save the model and now um i'm gonna uh i'm gonna create a an intent a custom intent where uh that we're gonna use as our multiturn example so i'm going to add an intent called set goals intent and the the reason i'm i'm doing this with the the ui you could do all this with the json editor but i'll show you the json in a minute it can get um it can get uh hard to follow quick so if you're going to use the dialog interface you probably want to uh start at least doing it through the um the the graphical uh skill builder which is actually really nice especially for for doing this you can of course do all this uh in code and json and and deploy it with the uh the cli like we have been doing up to this point but um for this it'll be a lot easier to show i think going through the the graphical user interface here so um first we need a sample utterance uh and we'll just say set my goals and um now this is where we're going to get in the multiturn so let's say that we want to we're trying to figure out what the user is going to need to do for their sales activity and so to do that we might want to know like what's their sales goal for the month um what do they what's their goal for the average value of a customer and um what's their goal for uh total prospects that they're going to contact and then we could use that to to give them maybe feedback that says this is what your closing rate's going to need to be to hit your goal if your total revenue goal is x and the average customer value is why we're not going to do that part because that's sort of outside the multiturn part but that that's the idea behind this so what we need is we need their their total sales goal we need their average customer value and we need their total prospects contacted so um so we need three values so we're going to collect three values and for this example all of the values are numbers so we can use a builtin slot type there's a a number slot type and we'll use that for all of them so the total sales is a number the average customer value is a number and then the total prospect that's the number i'm going to change this to total prospects contacted um okay let me go back over here now what i need to do so now i've got my my intent and i've got my slots that i want to get information on now i need to configure each one of these slots so that um i've got some options here so uh by default i can go down here like this the uh the slots aren't required by default but for this example i'm gonna say to to fulfill this intent to give them back uh some information about how what their sales closing rate needs to be uh i need all of those values so i'll say that this slot total sales goal is required and i'm gonna prompt them so if if the slot value doesn't come over with the request or is not filled then i'm going to say what is your total sales goal for the month and we'll just do one for right now you might want to say that in different ways just to make it less redundant and repetitive and then the user might respond and this is where i'm going to take the value that they provided or this is the slot and then dollars something like that or my my goal is and then i would just like we we have been doing use some additional samples and then down here what i can do to make sure that i've got the right response from them i can confirm each slot and i'm going to do that for just for for this example uh okay and i'm gonna say uh let's see so your goal for the month is dollars did i hear that did i get that right and this is where i'm looking for a yes or no to confirm this okay so now i i basically need to do the same thing for each of these other slots so the next one same thing i'm going to require this and i'm asking for the customer value so what is the average value of a new sale and maybe how much will the average customer spend maybe something like that this is an example and then the user is going to say something like dollars or the average customer will spend okay and we'll just go with those two for right now and then we want to uh require um a confirmation so we'll say uh i heard you say the customer will spend deal all the errors right okay and then we've got to do this one more time and then we're gonna be good so uh same thing here and what do we got um so total prospects how many prospects will you need to contact to get a single sale and then the user might just say a number in this case or maybe they'll say that with prospects okay and then we're gonna confirm this too so you'll contact is that right and then there we go okay so now um now we we have our dialog uh pretty much set up here let me show you the uh the json editor show you what's going on at this point so you can see here um that we've got our our slots with the samples and then we we've also got our dialogue down here and this is why i said this gets a little bit more uh confusing because there's a an id that goes with uh with each one of these which you can manually create but um i'm not going to do that which is why i'm using it from here and then you tie that id to the prompt that's going to come back for the confirmation so if you're using the dialog management you probably want to do that like i said through through here so we're just about done with this example except for um i'm gonna go back to my intent to the uh the sales goal intent here and um i'm going to what am i going to do let's con we're going to confirm that the intent itself so we just went through and we confirmed that we had the right value for each one of the slots now that we do we can confirm everything if we want to do that and i might say so your monthly goal is your average customer will spend and you'll contact total prospects we good all right so uh so now once we've gone through the entire dialogue at the end uh we're gonna confirm the intent with this here and so now i think we're probably done let's save that and build it and then we'll test it out so this is going to take a second here i'll read the questions as i'm going through here yeah i am that that's part of why i'm gonna split this out um bencat um i'm gonna do separate uh separate skills today rather than putting it all in the free code camp skill because yeah i saw that i saw that comment from you yesterday and i think that's uh probably a good comment it might be getting a little there might be a little bit too much going on in there so i will um i'll separate it out today especially for the next one persisting because um that will have some code this really doesn't have uh much code so not a big deal but i think we are ready to test let's give it a try um just need to enable testing first okay so i've got testing enabled now i'm going to just uh check i can't remember what i used for my invocation i think it was set my goals but let me just confirm that um i'll just try it alexa ask sales coach to set my goals what is your total sales goal for the month five thousand dollars i'm not sure what went wrong alexa ask sales coach to set my goals what is your total sales goal for the month five thousand dollars sorry something went wrong let's see what went wrong oh this is what went wrong i used the wrong this isn't set yet so let me change that not sure how i ended up doing that i thought i set that right but that is what's wrong let me just make sure i didn't do it on the other ones and then we'll rebuild this average customer that looks good total prospects that looks good so i have to build this again so it's going to take a second hey startup santana how are you doing today welcome back and loca hey all right almost done here building okay let's give it a try again alexa ask sales coach to set my goals what is your total sales goal for the month five thousand dollars so your goal for the month is five thousand dollars did i get that right yes how much will the average customer spend twenty dollars i heard you say the average customer will spend twenty dollars right right how many prospects will you need to contact to get a single sale 500. so you contact 500 prospects is that right that's right so your monthly goal is 5 000 your average customer will spend 20 and you'll contact 500 prospects we good we're good your endpoint received a request here's a breakdown the request type is intent request alexa stop so that response that i'm getting uh at the end there that is the response that's coming from that vui test tool so the the back end skill it's just like i said echoing back everything that it um that it heard or that it got from the request so you could see from this example that uh is a multiturn dialogue using the dialog management so i didn't have to do anything to uh to in the code to do that so that's um that's one way of doing it the the other way of doing it is to actually look at the requests that are coming over and that is in the code and that is what we're gonna do next and i'm going to i just um i pushed out a template on skill templates i haven't published a tutorial or anything on it but i literally just pushed it out today for this example because i i hadn't done this example with the um ask 2.0 sdk yet so it's actually fumbling around with it for a little bit but i think i've got it all figured out now and so it's the um attributes starter template is the one that we're gonna we're gonna use so i'm going to um come over here and this one we're gonna do from code but i'm going to start with the the skill template and show you what's going on in there so let's let's go like this so we'll go um okay so it's this um this template right here the attributes starter and um a couple of a couple of things in here that i'll i'll go over so um for first of all the um the basic starter and if you just go um ask new it just uses the um the core sdk so uh there's uh the ask sdk dash core and for this to work you need to have the uh the full sdk so that's one thing that's different in the template this here so it's uh uh ask sdk and then what's gonna um what's gonna happen here and this is a variation of the basic starter template so uh the it's the same kind of flow where it is gonna ask you for your name and then um down here in when you respond uh when the user responds now here the uh the difference now is it's gonna use the um attributes manager to pull the attributes back so get the persisted attributes and also to save the attributes so what's happening here is the very first time somebody responds we get the name from the slot and in the model again it's the same model and everything as the uh the basic starter template but here's the um for the my name intent here's the sample so they can just respond with their name or steve is my name or my name is steve or i am so those are the examples so when that slot the value for that slot comes over the first time it's being set or being used as part of the speech text but if if it's not in the database so this is going to be persisted to dynamodb if it's not in dynamodb then we set the value of the an attribute called name value here and then we persist it back to the database and what wires that up to happen is this down here so this has changed also from the the the basic starter uses or if you just use like ask new as the starting point um i think that's called the greeter template it uses um custom here and uh so this is changed to standard and then you can add this with table name and this is going to be the name of the table that's created in dynamodb and you can change that to whatever and then with auto create is basically basically saying you know go out and create the dynamodb table the thing with that is you need to have permission to create the two actually let me show you the error and then i can uh talk through what's going on there so um uh so let's uh let's deploy this what is this so i'm pushing this out yeah venkat i can share this code too if you want i don't have this in a repo but actually i mean this exact one but i'm not changing anything from the skill template so you can grab it from there but setting up the permissions in lambda is um it's got to be done and i don't think i put that in the uh the readme on the skill templates template i need to do that i'm not sure if there will be a live stream of voice summit i hope there is um i'll i'll be there like i said so i'll try to live stream some if i can i hope i hope they're covering it i would i would guess that they are but i don't know that for sure uh okay so um now if uh let's go let's go back over here alexa attribute starter there was a problem with the requested skills response okay so um i've got attribute starter here but you can hear the the error that i'm getting and um i'll go through remember how we did testing a couple of days ago i'll go through that process again just so you can see how you would uh debug it i know what the error is because i run into it but i'll just step through the the process again here so if you go to test and and this is this is kind of the um the easiest way to to debug if you're just getting going but there's a lot lot better debugging processes and if anybody is uh interested in that the um check out be spoken tools they've got a really good set of tools for for testing and debugging but let me let me do this uh so open and you can see no output so we got an error there but i'm going to just copy the request and go over here to my my lambda functions and then here's the function that was created for the attributes starter hey khalid all right uh let's see so now um so i'm gonna set up a test event here and just paste in that request that i copied from the uh the developer portal and i'll just call this launch request and save it and then when i run the test here i get more information you can also look at the cloud watch logs like we did earlier but i like doing it this way it uh seems quicker than digging through the logs um and so in here if i look at the the error um i can see it's the dynamodb persistence adapters thrown in error and it could not create the table uh alexa data and this is um because the role doesn't have permission to do that so that's basically what's going on here so when the when the ask cli pushes out the lambda function it also creates a role for the function to run with and it uses i think by default the basic execution role as a template so in this case my basic execution role does not have permission to uh to create tables and dynamodb or any any of that stuff so what i'm going to do is i'm going to go to the role that was created for the attribute starter which is this here and you can tell because it names it the same thing and i'm just going to add permissions to uh allow it to create the the dynamodb table and i can do that by just going attach policies and this is loading here but i'm going to find the the dynamodb if you just searched and i think for this i need the full access so i'm going to add full access i could prob i could probably like modify this this is probably more permission than it needs it but um for this i'm gonna go ahead with it okay so now that i've uh now that i've provided permission i should be able to uh to try this again so alexa open attribute starter i'm not sure alexa open attribute starter hello there what is your name steve sorry i can't understand the command please say again steve oh you know what hello what it's nice to meet you okay um alexa open attribute starter hello there what is your name steve i remember you you told me your name was what so you can see what the code's doing here is it's um it's saving the what the user says the first time uh back to the uh the dynamodb uh source that was created and let me show you that actually too how we do it oh yeah we're good on time um so if i go to dynamodb here and go to tables and so there there's the table that was created there and if you go to items you can see there's just this one record that was created here and somebody was asking me on the um i think on the alexa slack channel yesterday or recently uh how the how the records are associated with the users and the answer is this there's a unique user id value that is uh the associated with the the amazon account that's set up for the device i believe i don't think it's unique to the user if there's multiple users but i'm not 100 sure on that but uh anyway it's that id that allows us to tie the information back so if the next person comes in that's using a different device or a different account and does the same thing then they would of course get you know whatever value they set and you can see the value here the property um that was set what if i change that here to steve try it again alexa open attribute starter hello there what is your name steve i remember you you told me your name was steve yeah so it so it's pulling it here like like you can see from the uh the um dynamo back end and it's pretty easy to uh to wire up uh it's the ask sdk 10 was a little bit easier or it was literally like one line so i had to fumble around a little bit to uh to get it working with the 2.0 but i'll um just walk through that again now all the code is in now in the attribute starter and the um skill templates but you need the the full sdk first of all um and then the second main thing and this is what stumped me the longest is um this by in the other examples like if we look in to probably even this one but any of the other templates that i've looked at this is custom here and so to to use that that needed to be changed to uh standard and then um this with table name and then with auto create table and with that all wired up then you can use the uh like i said earlier the um uh persistence manager attributes manager it to uh to manage the um the the values to pull them back out of the back end and to uh to save and there's now there's now an adapter that you can use so you can persist data or not an adapter but with the persistence manager you you can persist data to um sources other than dynamodb also which i haven't done yet myself i plan to play around with that so maybe you want to save it to like my sequel or couchdb or or or something like that and that is an option now using this but i haven't tested that out but um i think that is pretty close to what i wanted to cover for this for attri for saving attributes so we've talked about let's see where we are we talked about the multiturn dialogues check um data persistence uh we did that demo and then the skill certification process um like i said we're not going to submit the uh the free code camp skill today but let's go take a look at that just got a couple more minutes here so what we would do in the in the process um so if not if i'm hoping when uh we submit this free code camp skill um once we've gone through it and we've tested it and retested it ourselves and gotten some beta testers and gotten feedback and everybody says this is great let's publish it out for the world to enjoy then you would go over here to the distribution and and make sure that you've got everything filled out here and we looked at this is all in the skill manifest the skill manifest so skill.json which is here it's all this information but you want to make sure that this is uh this is all filled out um the example phrases your icons are set your category is set you probably want some uh some keywords here i don't know if they're required or not uh but uh you probably want to have those definitely the privacy urls and the terms url i know i'm almost positive the privacy url is required i'm pretty sure terms are also and then you'll need to answer these privacy and compliance questions here so does the skill allow users to make purchases or spend real money and in our case no does it collect personal information no is the skill uh directed or targeting children no in our case um although there's some smart kids out there that are coding so maybe they would want to check out free code camp um does the skill contain advertising and no and then there's the export compliance here and then for the testing instructions unless there's something specific in there you need to do i usually just say no special instructions and then save and continue and then here who should have access to this skill public is the world you can also publish skills for an organization through alexa for business and then you select where you want the skill to be available so the you wanted to select specific countries you would just select the countries or regions that you wanted available and alexa is not available in all these regions yet but i'm sure it's not far off so you want to go ahead and select the uh the regions that you want and then save and continue and then um the the process it really um depends on a few things but um you know how complex the skill is and some other things but the process has been pretty quick in my experience um a few days maybe and uh if you do get um rejected for or don't pass certification for any reason the the the information that you get back is pretty clear so it's really pretty quick to uh to resolve the problem if there is a problem and the last thing that i'll show you and we are running up on our time is the analytics and because we um i had sent this out uh to uh for beta testing we've got some um we've got some analytics in here so over the last seven days there's been 53 sessions and 162 utterances probably a lot of those are mine during testing but i can see um you know a breakdown of which intents are or called and um yeah get uh you get some some good metrics back on you know what's being used and and what uh what the users are most interested in and or using most in terms of the uh the intents and i think that is gonna cover it that is our uh that is it for today any questions let me look down here how many alexa related slack channels are there um there's really just one that uh that i am familiar with or i go to and it's alexisslack.com and it's pretty active let me see let me just pull it up here yeah this is it actually here it's um it's pretty active uh and uh so this is the one that i uh i monitor and um i am steve t here so if you uh if you have any questions and or thoughts and you want to direct them to me this is this is the one that i'm looking at let's see any other questions before we wrap it up and get ready for the weekend let's see okay it looks like it looks like that's it well hey thanks so much everybody i i hope this was um useful and valuable to you if uh if you have any other um questions after the the live cast is done you can leave those on the youtube channel um we also have uh if you're not subscribed to the data lab youtube channel we've got um i try to do like a new video once a week it's not always once a week but um uh at least a few times a month so if you go to youtube i'll pull it up real quick uh slash dabble lab and the tutorials that i'm working on right now are mostly updating the ones that were already out there for the 2.0 sdk and i've got i've got three or four of them that i'm just about done with that i'm going to start publishing pretty quickly here and if you're just getting going with this stuff there's um beginning node.js for alexa development kind of gets into the node in javascript topics uh which is sort of in the context of developing alexa skills but again i'm pushing stuff out here trying to uh to do that like once a week and uh and yeah in the last thing is uh skilltemplates.com if you go over here this is um this these are really mostly like starter templates and what i what i'm trying to do with skilltemplates.com is put examples out that are not not super complicated that are really kind of focused on you know one learning ideas so some of the um the i really the templates that are the examples uh that amazon provides are really good and thorough but sometimes they can get pretty complex especially if you're just getting started so my my goal with these templates is to make them as simple as possible and you can subscribe here to to get updates when there's new templates published and i'm trying to do a video with each one of the templates i haven't i haven't done that yet and uh and yeah last thing if you're going to uh to the voice summit or you want to go to the voice summit go to voicesummit.ai and um hit me up on slack or um youtube or twitter and let me know that you're going i'd love to connect and say hello in person thanks so much again i hope you enjoyed and have a great weekend you