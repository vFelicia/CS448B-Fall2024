hi in this video we are going to add new security rules and authenticate the user so for now the password field is filled with the plain text so they are going to change it into the random set of values for doing this we are going to use a new library that is called NPM that is called big crib chairs so I have already installed it using NPM I big crypt Jas big crib chairs and here I have also used pip crypt is equal to require big trip chairs so in here we are going to use a schema method that it provide non whisper behind that is user schema dot free it means that and whenever a new method is to be called it will be called p4h that is whenever we use the save matter it will be called before it and it's a synchronous process so we are going to use a sink process and it uses es before es6 function syntax so we are going to use async function and in here we are going to use the parameter next which is called whenever the upper whenever the upward functionality will be done so in here we are going to use the cost user is equal to this it dis provides the document that is going to be saved in here so in here a user has a password so whenever a user pothole is being changed then we are going to run this if statement so in here if user dot is modified in the in here we are going to just say the field that is password any here we are going to use the bcrypt so what's pink change that is the password being changed so user dot password is equal to it's a synchronous process so we willingly acquaint you with await and in here we are going to use big crypt method that is has a name here the string that is the request or password that we are going to change and how many times we are going to run this algorithm that is like it's a stable that is very aware if you are going to use eight times so now that's it by doing this we can see if the password is being saved as a random set of values so for looking for saying this we are going to use the postman in here and we are going to create a new new fire profile that is Jesse Capen and now if we run this file we can see in here that the password is being stored as a random set of values now that's being done now we have to login with the credentials that is being given like email and password and now we are going to log in with this email and password but the password is being as a random set of values that has been provided by the bakery chairs so for doing this we are going to create a new endpoint in here in app tortious so in here we are going to create a new endpoint and here AB dot post because we are sending the user's body in here users and login and it's going to be a synchronous process and we are going to use request response and now in here we are going to create out on it if an undefined userdefined method in here so for this we are going to use Const user first we're going to use its a synchronous plus also await we are going to perform on the user matter and also the matter that we are going to call it's a predefined method and we insert a userdefined mention we are going to define it let's say find my credentials and in here we are going to use two thing that is a Chris start body dot email and also the request dot Fadi the password so what it will return it will return a user so we are going to use the same thing corns future and in here and that's it and then we are going to create a catch block and provide response let's say response status for hundred percent so now we have to define this new function or a method so in here we are in the dividual chairs we are going to defining so in here user schema as we are defining it into a model or an kima so we have to use the statics and the method name that is find by creating seals and in here it's an a synchronous process oh thank you sink and in here we are going to provide email and password and now we are going to give form so in here we are going to find a user by the find one method so we are going to use try and catch block so in here when you use Const user a bit user dot find one and the object it is email in the condition so now if there is a user if no if there is no user then we are going to throw and add it so and edit or new error and if there is and like if there is an user we're simply going to check or compare the password that is given by the user with possibilities being stored in the read time in the Normandy B so in here we are going to use following it's in a synchronous function that is a wait big crypt taught to verify no dot compared and in here we are going to provide the request sorry password and the user dot password for wanting more that yeah that's it user dot password and in here it's provide its return true and false for it's a boolean so is match so if it is not match if not is match then we are again going to try an error and if it is it is make it is being matched and we are going to return the user so in here in the catch block we are going to simply write at worst an error it is return unable to login in this file we are going to symbol like response back responds back with the status 200 and the user that is the user and yeah that's it now we are going to check our function so let's move on to the postman and we are going to create a new request in here we can create a new request at request in here log in usage and it's going to be saving and it's it is going to be a post request so we are going to arrive first and it's the localhost 3000 users log in and then we are going to simply copy it from here I'm sorry you copy it from here email and classroom and just paste into our foot 40 we're going to select it raw and also the Chasen and in here we are going to provide email and password now let's look at we are going to get the music back or not yeah we can see that we are got the user back now if we like if we rung out our encrypt our passwords now if we same that we can see unable to log in so it's very easy to do but there is a caveat in this that is in here in the postman if we like create the user with the same email we can see that it will it is going to create the same user but it will also give the message Oh once again maybe yeah maybe do Cheers and a mail yeah it will handle the if we save the user with the same email and it will be handled by the MongoDB that it will give the Arabs so it's like three it's very helpful or a handful so now we are going to see one is one thing that is called JWT data JSON web token so now in here for getting the profile or it will be changed with getting a profile so whenever the user is going going to like create a user or log in with the user then they can see the dear profile not like whenever we click on when we will be like click on this endpoint hit on this endpoint and they can say it or yeah this functionality is going to be changed in here so for using this or for understanding a whole point of this video we are going to install NPM install chase and wave token so what it will do like whenever we like whenever we create a user it is going to be like save a token it will be saved a token in the MongoDB and it will be sent back to the client and whenever the client is going to use any functionality then they are going to use the same token that is being here in the client side and get authenticated to perform any functionality so for understanding this whole thing we are going to like see how it can be done so now as the tokens is going to be save into our module so we are going to create a new property that is tokens and going to be a aerator because a user can get more than one token at the different point of time or whenever they uses different devices so it's an token of tokens of an array and it's going to be in token and in here it's going to be like type of string and it is required so now in here whenever we save it like now we are going to use and like for this user only a new method or a user different method we are going to create it is like any any name that you can do it like it generate a token in here in this function we're going to generate and you token for this particular user so I am going to copy this name from here and we are going to define it into our Thibodeau chairs so in here let's say here I am going to create it like user schema but we are not going to use the schema method or aesthetics we are going to use for Ted particular user so in here we are we have given the user schema dot methods and the name our token and it's going to be in a synchronous process and now we can define it here so in here we are going to take the user that is cost usually is equal to this it provides a document that we are going to perform the functionality and now if we are going to use the big guy in the JSON web token so in here we are going to create a new cause let's say JWT and we are going to require it from JSON web token and now we are going to define how we are going to use a method of JSON web token so await it's a synchronous puzzles so have a JWT and we are going to sign because this method will provide a token so JWT dot sign and it still need to or like arguments parameters first parameter is the payload so the payload will be the ID so the ID of the user so we can get from the user dot ID but the user that ID is an object ID so we are going to change it and convert it into the to string method now the second parameter will be the one second the second parameter will be the secret or private key can be anything but I'm going to use this is it is going to be like it is going to be a private 14 here I'm going to simply write it this is my new course so the next argument can be the expires in yeah that's it so now it's going to return a token so let's write int with this from it like it's going to return a token now in here we are going to save it or the concatenate in the user dot tokens so user dot tokens user tokens tot contact the token and now just we are going to user in here so the await user dot save and return the token because it is going to be like response back to the plain sight so that's it yeah this function is completely it is right but we are going to look into it so in here it's going to like return our token through cons token of eight and in here we are going to perform all the response back with two teens the user and token yeah now let's see that in action so in here we are going to see login create user and all if we use Jessica and we are going to change the email to Jessica to Alex and name Alex no if we save it yeah it's giving an error because now we have changed mortally in here so in here first we have like till eight our user in here from here then we can see that it is required result you can see now that user is being saved with like tokens and we are going to give back to the token token also now same thing we are going to provide to the login also because in here also the token will be generated and send back to the client so in here we are going to use cost token is equal to the weight and we are going to use in the user user dot generate auth token and we are sending that fit user and talk now if we login with this email and password so we can see in the X in X M so in here we are going to provide email password now if we send it back we are going to see that two tokens is ancient rated in here and and the latest token that is this one is going to send back to the client side now one thing is here that we are giving the plying so much information e we are going to provide like password and tokens of all the tokens that are being there in tauranga TV so we are going to let sort in the like hide the values or hide the information from the user because it's for the security purpose so for doing this we are going to use another method but it is a predefined we can say because in here we are going to use the user schema dot methods because we are going to use the method into a particular user and that's how the writing that I'm going to do is the same thing you have to use to it to Jason because this means that whenever we response back to the client in here it is being converted into Jason dot stringify so in here we are just going to like performed an additional functionality in here because it is same as a json stringify but we are adding some more functionality into this so for using this we are going to just use the following it is you user means function shift user function and now in here we are going to the say cast user is equal to this dot we are going to change into an object so for doing this this dot to object and in here we are going to delete delete user dot faso that because that that don't really need it and also delete the tokens and and just return the user yeah now if we go into our postman and run it again this endpoint we can see that it's going to like just like give the user's name as an email and let its token that is being generated now we are going to use the tokens that are being saved in the mu mu DV and use into the another endpoints like in here users start users info but the user don't want to see another user profile so it's going to be a user profile matter so we are going to change the endpoint user slash me and now for looking into a user's profile we are going to use that token specifically so we are going to use a term that is called a middleware so that means it let's say the new function or method that we named art is going to run before this functionality so for doing this we are going to create a new like for you got again we are going to create a new folder let's say mitigation and in here we are going to create a new file let's say art torches so in here what can we do so let's say we are going to create a Const art and it's going to be nothingness processed and also we are going to export fact with a file so we are going to use module dot exports the odd function and we are going to use in this file so we're going to use Const art sequel to require it from chart chart slash dot slash middleware and art yeah so what's to be done in this method so now in here it's a middleware but it's used same functionality as the request/response and also the next because the next is used for like for going to another elephant yeah now in here first we are going to get token from here so for getting the token we are going to use cons token and it's going to be in the request dot header and we are going to talk about this later authorization and also one thing called replace because thought radiation is being used as a stream so we are going to replace a barrier barrier space string with nothing yeah that's it the token is fin generated here no we are going to verify this token verify this token and generate the ID so Const decode and in here we are going to use the JWT method so we are going to require it from JWT require it from JSON web token so when you hear the JWT verify verify and token touches of token and also the segreto public key that is this is my new course now in this decode there is the ID of the user so from here we can see if there is a user not so for looking into the user we are going to simply say like we are going to use a weight matter and also we are going to use your model so for this again we are going to use a user model or import it from the TV file so require it from require it from dot slash dot dot slash utils DB yeah now we get the usage and after getting user we can use find one method in here we are going to provide ID that is ID is the token decode dot ID and also we are going to verify with the tokens that is paying here in the mumbles normal TV so for that we are going to use tokens dot token and token yeah that's it now if there is a user then it will perform the operations or return back with the user now if there is no user then we are say safely to say like it is going to be a try an adder and thrown you added so requests throughout user is equal to users now there will be a catch block and here we are going to response back response that with status fluorophore and send back wait error 14 erin added in authentication it's going to be in string so we are going to say with like this now if it is run then we are going to use the next method so it will go to the end point after there so now in here in Epcot chairs in here all in this one we are getting the user if is right so there is no need of this if we are going to simply like right request dot users yeah that's it now if we go to our postman we are going to use the end point of this gate users but also we are going to use a chooses the profile it will want to so let's say we are going to use clips so any headers is one thing called uh try this and at the same thing that we have written in the port but in this key it is a value so the value will be the new one that we have used latest like request this token is going to be used in here and it's going to be written for the bearer and like this that's why we have used that to replace the fader with nothing at all so now if we run days we are going to get back the users or a profile so finger plus yeah we get the profile back yeah that's it that's how we can do the getting the profile of any user so now one more thing remaining that is how can we log out from a system so for logging what we are going to create a new a new what new endpoint that is users and lava so in here we are going to use the quest and response and also we are going to use the odds middleware because after authenticating then we are going to remove it from the from the they can be lowered from the devices so in here we are going to see how it can be done so for this it's going to return a token so that they can be logout from the system so for this we are also going to request dot token is equal to token so now in here we are going to see how it can be done so in here we are going to simply say like request no first thing we are going to also use a try and catch block and in here if it is right and it is like response dot status of 500 and send back so in here we are going to use request dot users our user dot tokens and now we are going to use request towards user to our tokens dot filter because it's an error and it's going to read take token it's really wise and if we're going to see a token talk talking is not equal to 30 quiz token then it's going to return all the tokens that is not in the request or token now we are going to save it again request await request sorry await big waste dot user dot save and response tech with the status of 200 and send back with request dot user yeah that's it I have already created a new logout user get endpoint and you can see that I have provided the authorization and also we can see that we can get the alex at gmail.com like the user that we are going to get and we can see in here in our mongoose plus we have to replace it and now you can see to only few objects are there now if we run again this file and we have to also change this token so let's say i'm going to take this token from here and just take yeah now if I copied from here and paste it in here and again send it back we get the user and if we refresh it here again you can see that we will get only one object yeah it's how we can logout from any devices we can also use the like Netflix users like if we want to logout from different devices we can simply write in here same thing but we can change here like request dot user dot tokens is equal to an array so it will for the same thing but it will logout from all the devices yeah so that's it in this video in this video we have seen how can we add the security and also authenticate the user and how can we see that any other functionality can be generally to the authentication yeah that's it thank you