so in the last video in our Tycoon we set up the Tycoon builds the leader stats we created the buttons and we also assigned a tycoon when you joined the game what we've now got to do is work on coding the buttons so they actually unlock the items we'll set up their Billboards we'll also set up the positioning of items and cloning them out of the replicated storage to put them down and then we'll finish off by saving our Tycoon so now that we've assigned a tycoon to a player we can code the buttons so let's go into our main script in the Explorer window and select it and then back in the code editor I'm just going to hide this yellow Banner let's just zoom out we've only got one function at the moment which is to assign our Tycoon we're going to create a few more functions in this video let's start off by creating a function which will take a player and return their Tycoon so local function get Tycoon just increase the size here for you so get Tycoon we're going to take the player as an argument and then what we'll do is we'll Loop through all of the tycoons in the workspace so for underscore comma tycoon in game dot workspace dot tycoons because don't forget in the Explorer window under the workspace we have our tycoons folder so we'll say game.workspace.tycoons colon get children do and then inside of here we want to say if Tycoon colon get attribute and we want user ID so if the user ID attribute is equal to the player's user ID then we will return the Tycoon now if the Tycoon does not exist then this function isn't going to return anything and we'll be able to take what is returned from this function so it will be the Tycoon the player owns and then we'll be able to change it and reference it this is just a really quick way of being able to get a specific player's Tycoon and we'll be using it later on right now let's set up our buttons so if we just head out of this script and head to one of our tycoons here let's just go into the buttons folder and select a button and if we have a look in the properties window we're going to need to add an attribute for this button because we need to know whether it's unlocked now a button will either have a true or false attribute called unlocked and when you step on the button we'll set it to be true and then we'll make the button disappear so let's set up a Boolean attribute and we'll just call it unlocked and click on Save and now what I'm going to do is because we've already gotten a few more tycoons over here I'm just going to destroy them for now so we've only got this one Tycoon to work with because we're going to be making a few changes to our Tycoon model here and as this is going to be the default Tycoon we'll clone them out later on so we'll just have one Tycoon for now and like I said we've set up that attribute for our button here called unlocked we'll just leave it unchecked what we're also going to do is we're going to give this button a tag and we're going to use something called The Collection Service a collection service is a way of giving a tag to a load of objects and then you can write code which will apply to all of them so you don't have to rewrite the same code out over and over again now you're going to need a plugin for this called the tag editor Roblox have added their own tag editor but I find using the tag editor plugin way more useful so in the toolbox over here let me just zoom in here we are if we go to models and select plugins you'll be able to search for tag editor and then you want to take this one by at sweet heartachoke I'll leave a link in the description just make sure that you've installed it once you have go to the plugins window up here and you will see the tag window underneath instance tagging so open up the window and that should open up over here by the Explorer our tag editor so what you want to do is you want to select your button make sure it's selected and we're going to add a new tag type in button and press enter Then you want to click on the check box and make sure it's checked now if you have any other tycoons or buttons make sure you've selected them as well and you've given them this tag this now means that our button here has got the button tag and any code that we write for the button tag will be applied to our button here so if we just head back you can close the tag editor now that's all been done and we head back to our script we can now write some code which will Loop through every single button that's in existence in the game so we can say for underscore comma button in collection service colon get tagged and then in these brackets we're going to put button do so this is going to return a table of all of the buttons in every tycoon in the game now we just need to define the collection service so at the top of our script we'll say local collection service equals game colon get service collection service that now means we can use the get tagged function which will get all of our buttons for us then for every single button we want to detect when it's been stepped on so we can say button got touched colon connect function and then we're going to have an argument or hit hit is going to be the object that touches our button it could be a body part of a player it could be any other part so we'll need to actually check to make sure that a player has touched this part and we can do that by creating a variable and calling it player and we'll just return the result of game dot players colon get player from character and then in these brackets we're going to say hit dot parent now if a player has touched this brick then this player variable will be equal to something but if it isn't it will just be nil so we can we can detect this by saying if not player then return end and that is going to end this function here it's not going to go any further however if it is a player then we want to get their Tycoon and we've just created a function to do this so we can get the Tycoon as a variable by saying a local Tycoon equals get Tycoon and we can pass our player from this variable here and this should return the model of the Tycoon to this variable here so now that we've got the players Tycoon we want to make sure that this button actually exists in their Tycoon because we don't want them to be to be stepping on a button for someone else so we can say if not button colon is descendant of Tycoon then return end all that this if statement's doing is it's checking to see if the button that the player stepped on is inside of player's Tycoon object so if it's inside of the player's Tycoon object that's fine but if it isn't then we don't want to go any further because we don't want other players to be stepping on our buttons the other thing we want to do is we want to make sure that the player does not step on a button that they've already unlocked so when a player steps on a button what we're going to do is we're going to make it invisible we're not going to delete it we're just going to make it invisible so we're going to say button.transparency equals one button dot billboard GUI because don't forget there's a billboard GUI stored within our button so and that's going to have the text of the item so button dot billboard GUI dot enabled equals false and then what we're going to do is we're going to set the unlocked attribute which we just created which is all the way down here it's unlocked property or attribute sorry we're going to set that to be true because the player will have unlocked the item so we'll say button colon set attribute unlocked comma true and then what we can do at the very top of our function here is we just want to check to see if the button has already been unlocked because if it's going to be transparent it can in theory still be touched so we don't want to unlock the same item twice if it's already been unlocked so we can say if button prolonged get attribute unlocked then return end that's just going to prevent the function from going any further and we don't need to say equals equals true because button and colon get attribute unlocked will be true okay if by default we don't need to check its value so that will just check to see if the button has already been unlocked and then the last thing we need to do in this function is we actually need to unlock the item right we need to give the player what they've bought because at the moment all we're doing is making the button disappear so that's what we're going to do now so let's create another function up here and we're going to call it local function unlock item and we're going to need to take a few arguments here we're going to need the player and we're also going to need the ID of the item so we'll create two arguments called player and Item ID now firstly let's get the Tycoon of the player so local Tycoon equals get Tycoon fire and just a quick check to make sure it exists if not Tycoon then return end we can also put the same thing down here if not Tycoon then return end just as a safety mechanism to make sure our script doesn't throw an error so now we've got the Tycoon we want to create a clone of the item so we need to firstly get the item from its ID because like we said in the last video we are we are controlling our items through an ID based system rather than objects we're storing them as IDs so we need to actually find the corresponding object to that ID so we need to create a variable for our item and we actually need to create another function to get an item from an ID so let's do that now let's create another function and we're going to call it get item so local uh in fact let's just let's put it all the way up here let's let's put it above our assigned Tycoon doesn't really matter but just for organization local get local function get item it's going to take the item id that's what we're going to pass to this function so let's firstly create a variable for our items folder because we've got an items folder in the replicated storage which we're going to Loop through so we're going to say at the top here just by our tycoons um variable local items equals let's create a variable as well for replicated storage local replicated storage equals game called get service replicated storage and items equals replicated storage prolonged weight for child items and just for consistency I'm going to change the tycoons from speech marks to these these apostrophes here so now we've got our items and tycoons variables back in our get item function we're going to create a for Loop which Loops through every single item in our items folder in the replicated storage and we're going to check to see if that item's ID attribute is equal to the one that we are looking for and if it is we'll return it from our function so local function get item takes the item id we're going to say or underscore comma item in items colon get children which is just going to return a list of all the items you do we say if item colon get attribute ID equals equals item id then return item and that's just going to return the correct item for us also in our assigned Tycoon here we don't necessarily need this return nil as it will return nil anyway so you can remove it if you'd like so now we have a way of getting our item we can then in our unlock item function we can say get item and we can pass the item ID and then we can call colon clone on it to create a duplicate of that item from the replicated storage we also want to get the cost of the item so let's just create a variable for the cost and because we know that we've stored the cost of every single item as an attribute which is what we did in the last video we can just say item colon get attribute cost now we need to check to see if the player can afford this item so we're going to say if player got leader stats dot cache dot value is less than the cost then return false that is going to stop the script right there and end it and just uh it's going to return I'm not going to go any further because obviously the player can't afford the item however if they can afford the item let's deduct the cost from their current balance by saying player dot leader stats dot cash dot value minus equals cost that is going to subtract it from their current balance and finally what we need to do is we need to take our cloned item and we need to position it in the right place because at the moment in our Tycoon we've got everything laid out in the correct location but we're going to have lots of different tycoons some tycoons may be rotated differently positioned differently so what we're going to need to do is we're going to need to basically get the relative position of each item relative to the Tycoon and then position it relative to where our Tycoon is placed because like I've said some tycoons might be opposite each other rotated so we're going to need to position the item relative to where it currently is so that's what I'm going to talk you through now firstly however let's just take our item and parent it to the players Tycoon so we'll say item.parent equals Tycoon dot items that's going to put it into the folder that we created in the last video called items and now we're going to want to do is we want to get the C frame we want to set the item C frame so we'll say item pull on pivot 2. and we need to put a C frame in here so a C frame is a combination of a position and an orientation so it's an area in the map it's it's we can tell the script where we want to position this item so we need to give it a C frame so firstly we're going to need to have a relative C frame now a relative C frame is a position and orientation relative to another part and in this case we want to get the conveyors or the item whichever item it is we want to get its position relative to our Tycoon so how are we going to do that well let's create a function which will get a relative C frame so we're just going to create a local function get relative C frame and we're going to take the item ID now do you remember earlier in the last video I said we're going to position everything where it's going to be in our Tycoon and then when we start the game up we're going to strip out all of the items right because the player won't have unlocked them yet but we have a copy of them in replicated storage right well because we have got a copy in replicated storage with the position and the orientation saved we have the position that we want our items to be in all we now need to do is make them a relative to our Tycoon plot so that if the Tycoon plot is in a different location to where the items are currently placed they will move with that Tycoon so what we'll do is we'll firstly we'll find the item that we're looking for with this ID in the player's Tycoon plot so let's create a variable for the item and let's create another function which is going to get the item in the Tycoon by its ID so up here again in the top of the script we're going to create another function and call it get item in Tycoon by ID we're going to provide the item ID and we're also going to provide an object for our Tycoon which will pass into this function so we want to Loop through all of the items currently in this um Tycoon actually what we'll do instead is we'll take our Tycoon here and we're going to right click and copy it we'll make it we'll make a copy of this Tycoon and we're just going to put it into replicated storage Okay so we've created the copy of the Tycoon this will be our placeholder Tycoon let's create a variable for this as well so local placeholder Tycoon equals replicator storage wait for child Tycoon okay so if you ever make any changes to your Tycoon and you add any new items all you're going to do is right click on it copy it and replace it in the replicated storage here so we have a default Tycoon that would be our placeholder one okay now what we can do is instead of saying Tycoon here we'll just Loop through our placeholder Tycoon until we find the item that we're looking for so for underscore comma item in placeholder Tycoon dot items current getchildren do we want to make sure it's the correct item so if item colon get attribute ID equals equals item id then return item so what we're doing here in this function is we're getting a uh we're getting a place we're getting an item by an ID from the placeholder Tycoon because in the placeholder Tycoon it's going to be in the correct location where we've set it up to be okay so we're just getting this item and then what we're going to do is we're going to get the C frame of that item relative to the placeholder Tycoon so back down here in our get relative C frame script we now have a path to get our item so we can say get item in Tycoon by ID Item ID and now we can get our relative C frame so local relative CF which is just a C frame relative to another location so by default in Roblox any C frame or position is relative to the origin which is a point in the world marked by zero comma zero comma zero so if you had a part in your game and you have a look at its position down here in the properties you can see its position is 88 comma 0.5 comma 55 that's also at C frame and that just means it's 88 studs on the xaxis away from zero 0 0.5 stoods away from zero on the yaxis and 55 stoods away from zero on the zaxis and if I was to move this closer and closer and closer in each direction to the origin we would eventually get to zero zero zero which if you want I can set two right now and if we press F it's now positioned in the center of the world so all that we're doing is we are setting the origin of the world to be our Tycoon so then we know how far away each individual object is going to be we've got a C frame or position relative to the center of our Tycoon so that when we create if the player is in a different Tycoon which is positioned away from here or rotated away from here because we've got a relative C frame it doesn't matter how it's rotated how it's positioned these items and buttons are always going to be positioned relative to where the Tycoon is now don't worry if you can't get your head around this just yet it is quite complicated but obviously you're going to need it for our Tycoon so to get our relative C frame all we're going to say is placeholder Tycoon dot primary part dot C frame colon to object space with a lowercase T and an uppercase o and S for object in space we're just going to say item colon get pivot that's going to get the C frame of the item and then this function is going to generate a C frame which is relative to the primary part of the placeholder Tycoon so we can now return this relative C frame and then back to where we call this function well get relative C frame we're going to call it um in our unlock item down here where we've got our item colon pivot two we're going to firstly get our relative C frame so we'll create a variable for that relative CF equals get relative C frame Item ID so just to recap this is going to get the relative C frame between well so it's going to get the C frame of the item relative to the Tycoon okay so it could be something so that's just telling us how far away from the origin of our Tycoon or we can just say how far away from the Tycoon is the item okay and that's going to be in object space so it's going to be very simple like ten by one ten by Zero by two which would mean it's tends to delay on the xaxis and two studs away on the zaxis okay and then what we're going to do is using that we want to now convert this back to World space because we need to put our item somewhere in the world and we can convert this relative C frame back to World space because we always have to set our C frames in World space so World space is the opposite of relative space right because it's now relative to the origin of the world zero zero zero so you have to convert it back so we can say Tycoon well local World CF equals Tycoon dot primary part dot C frame colon to World space and we're going to put our relative C frame in there which is now and this should be um this should be the player's Tycoon uh which is lowercase my bad so we're getting their Tycoon and we're we're getting the C frame in the world for this specific position and we can then pivot the item to that world space put it into the Tycoon items folder and then return true to say that the item was successfully unlocked and then what we'll do is down here in our button touched function we can just say local success equals unlock item we're gonna pass the player and we're also going to pass the item id of the button so we can say button colon get attributes item id because don't forget we need the item id as well in our unlock item function so this success is either going to be true or false right depending on on how the function what happens in the function whether we've got enough money or not so we can say if not success then return end because we don't want to hide the button if it wasn't a success so we now should have a working button system let's go and check it out and again don't forget every time we make a change to your Tycoon make sure that you right click copy and replace the Tycoon that's in the replicated storage in fact before we do that let's just remove all of the items from the Tycoon when the game begins so that we can actually see the items appearing when you press the button we're going to need to clear out all of the items in the Tycoon first because obviously when you start the Tycoon you're supposed to have no items so let's create a comment say we're going to clear out all items from tycoons and we'll say for underscore comma tycoon in collection service now I know we haven't done this yet but we're about to do it Colin get tagged Tycoon we're going to tag every single Tycoon like we did with the buttons so that we can just easily get them all and then if Tycoon colon is descendant of replicated storage then continue end because obviously we don't want to destroy the Tycoon that's in replicated storage because that's our placeholder Tycoon uh so continue we'll just move on to the next one without doing anything but if it is a tycoon in the workspace that we do want to clear up we will say Tycoon dot items we're getting this folder which is within our Tycoon here Tycoon the items we're going to just clear out everything in here by saying colon clear all children and that will just wipe it clean so that when the game starts up this code's going to run and every Tycoon that's in the workspace that isn't the one in the replicated storage is going to have its items folder cleaned out so if we click on run for a sec you'll see that when the game begins well actually we need to tag it don't we so let's select our tycoon in the workspace head to the plugins tab again open up our tag window and if we just head over here to the right let's add a new tag Tycoon let's make sure it's selected and checked and make sure you do that for every other Tycoon if you've got one in your folder up here but again don't tag the one in the replicated storage the one in the replicated storage should be untagged so let's head back let's click on home and let's go to the Run button and let's see what happens here so I've clicked on run and you can see the conveyor has disappeared because we just wrote some code to strip out all of the items let's rejoin the game here and let's see what happens when I step on the button okay nothing seems to be happening let's go to the output window it says we've got an error that's all good so the error is on line 59 of the script line 59 which is where we get the item attempt to index nil with clone so it's saying that this part whatever's returned from this function is currently nil now let's just have a look at our get item function that looks all good I think what the problem is here is that nothing is being returned from here so I'm going to take you through how I would usually debug a problem like this so if we just go back here to where we're saying unlock item obviously this item ID is it must be nil Okay so we've passed it to this function called unlock item so if we head down here to where we say button get attribute Item ID so I think the problem is that we haven't supplied an attribute for Item ID to the button that's my bad so what we need to do is we need to for every single button we need to have an ID an item id attribute so let's create an attribute and we'll call it Item ID item id let me just zoom in for you here there you go item ID and let's set this to whatever the ID of the conveyor is so the conveyor corresponds to this button and it has an ID of one so we're going to go and select our button for this conveyor and set the ID to the ID of the conveyor which is one and now that should work so for every button you need to set its item id attribute to be the ID of the item that you want to unlock okay otherwise you're going to get errors like that but if you do get an error don't worry it's just something that every coder has to go through it's just a matter of problem solving when you're problem solving skills will get better the more you do this it's all about understanding what's going on so let's try this again okay we've got another error this time on a different line so script 43 let's head back on to line 43 attempt to index nil with C frame so this looks like uh it is going to be here because in the placeholder Tycoon I don't think we set a primary part which again is my bad so let's just go into the Explorer here and just right click and delete this Tycoon from the replicated storage because we're going to make some changes to the one in the workspace all we're going to do is we're going to click on our Tycoon here and in the properties we're going to select primary part now this is very important you don't want to click anywhere else for now you want to make sure you've got this cursor which has the part with the red and black arrow on it and then we're going to set a primary part which is going to be like a point of reference for our Tycoon so I'm going to go and set it in the in the decorations folder I'm going to set it as this base part down here okay so what I'm just going to do is I'm just going to use the select tool I'm going to hold down Alt and I'm going to select the base down here the base part of our Tycoon can you see it there so it's the floor it's going to set the name of this down here in the properties window to be base and then in the Explorer I'm going to go back to my Tycoon I'm going to then go back to the properties and set the primary part B the base okay so I've now set the primary part this is just a point of reference so that we can um when we set our relative C frames it's going to be relative to our base because the base is the primary part so let's go back in again I do apologize for a few of these mistakes obviously I'm working from a place that I've already created on and I'm just rewriting the code out so I may skip one or two steps but um okay looks like we have another problem oh yeah I forgot to um I forgot to copy the Tycoon didn't I so take your Tycoon now right click copy and then we're going to put it back into the replicated storage okay otherwise you'll get one of these infinite yield possible errors so I'm keeping these errors and you know warnings in I'm not skipping them over in the tutorial because you're obviously going to have some as well and it can be helpful to watch me debug them rather than me hiding them but there we go I step on the button and it's generated my conveyor for me so there we go I think the last thing we're going to do here is just take our button and in this for loop we're going to say button dot billboard GUI and we're going to say dot text label dot text equals and then we're going to say the name of the item that we're going to unlock and we need to get that somehow so let's have a look and at our functions here we can use the get item function so get item go button colon get attribute item ID we can say dot name and then we can put a we can concatenate this with two dots and a string with a hyphen and then another two dots and we can say button colon get attribute actually we'll say uh uh let's just let me think for a second here we're going to say uh in fact let's create a variable for the item local item equals uh in fact we'll create we'll create an item id variable we'll then create an item variable for get item Item ID and then we can change the text to be item.name and we can say item get attribute cost like this okay so this is going to format the buttons text to say item's name hyphen and then the cost as well and we just use these two dots to separate the strings and the uh and these other strings here so if we now click on play we should see that it says conveyor 50. okay and you can add a dollar sign as well to the string if you want that's no that's no problem but and you can also see up here in the top right that our money has gone down from 500 to 450. now other thing that we need to do finally is we need to clear up the Tycoon when you leave the game because we want to let another player take your Tycoon so we can do this very simply by saying a Game Stop players dot player removing curl on connect function layer and inside of here we want to get the player's Tycoon so local Tycoon equals get Tycoon player and we can clear out their items folder by saying Tycoon got items colon clear all children that will just reset the Tycoon and we also want to make the buttons visible again so for underscore comma button in Tycoon dot buttons colon get children do button dot transparency is zero which will make it visible again and button dot billboard GUI dot enabled equals true that will just set the uh the text above the button to be visible again and and that should be everything now we haven't done saving cash or items in the Tycoon however a lot of tycoons are like this they don't save anyway however I'll probably make another video soon on how to make your Tycoon save this has been a basic tutorial on how to make a tycoon I'll also be making a full course on how to make a full tycoon in the future and let me just show you how to add more items if you're a little bit confused so let's go and add another model here from free models so let's just do uh let's just insert something like a let's see like a sign okay let's insert a sign so I've inserted my sign and the first thing I need to do is I need to add two attributes one for the cost and one for the ID so we'll do cost down here edit to a number and we also need just like in the conveyor we need an ID as well so cost and id id there we go so this is going to be number two because it's the second one comes after the conveyor if you were to add another item it'd be ID3 or id4 id5 just make sure that they're all unique and set the cost as well so this could be a hundred now that I've got my sign attribute setup I'm going to just in the um in the Explorer I'm going to drag it under the items folder and then I'm going to right click duplicate and put the duplicate into the items folder in replicated storage and lastly I'm going to take the button over here I'm going to right click and duplicate that as well I'm going to use the move tool just to drag it over here and then with my button selected I'm going to head to the properties window I'm going to change the item ID from 1 to 2 because the sign is id2 id1 is for the conveyor we want this button to be for the sign and then that should be good to go so let's just close the toolbox and let's go into the game and you can see it now says sign for 100 and conveyor for 50. so I'm going to buy my conveyor now watch my money over here as I step on it let me just see if I can position the camera I don't think I can unfortunately okay I'm going to step on it anyway and you can see it's gone down to 450 and I've now got my conveyor and aha we have another problem I've stepped on my sign and it's saying attempt to index nil with get pivot that's because that's because in line 43 it's this item variable is nil which means that this function get item in Tycoon by ID has returned nil so this means that the item must not be in the placeholder Tycoon so also what you need to do is every time we make a change to your Tycoon you need to take the entire Tycoon right click copy and then replace the one in replicated storage with this new one and if you have any other tycoons in the map you'll also need to do the same thing so you need to make sure they're all the same version but now we can have all sorts of different tycoons rotated in all sorts of different ways and they will all work it will just be assigned one when you join the game we'll just have to work out which one we've been assigned and we'll be able to figure out because okay it's this one but you can see I can purchase my sign purchase my conveyor and hopefully I can't yeah we go I can't purchase anyone else's uh stuff because this isn't our Tycoon uh so there you go that's how to create a tycoon in Roblox if you enjoyed this video please leave a like don't forget to subscribe and again check out the full courses which will be coming soon link to that will be in the description down below so I'll see you in the next one