hello everyone and welcome back to episode 5 in my how to make a piggy game in roblox series now we're getting closer and closer to finishing this series but today what we need to do we need to make Lea we need to add the logic in the for loop in our start round to detect when the players escape because currently if you escape it won't end the round so that's what we'll do today we're also going to be working on crouching and traps as well so very important parts of the game which are you know crucial to to how piggy works because we're balancing it out we're giving the piggy a little bit of power in that they can place traps but we're also allowing the players to Crouch so if they get in a sticky situation and they're trapped somewhere then they can crouch down and and get out one of those holes in the floor so that they can escape from the piggy so I've been getting a lot of questions from people saying that their game looks quite dark and if there's any way to turn up the brightness and there is if you go into lighting click on the lighting service and in the properties window you'll see this ambient property now if you turn this up it makes the game a lighter I wouldn't turn it up to the max amount so you just drag the slider and but drag it and see what's best for your game you can also edit the light bricks you can add your own bricks and put spotlights in them or surface lights like I've done in the in the lobby and also in the main map you'll see that if we have a look okay now it's in the intro tunnel actually I've put a light part with a surface light and that can make parts of the game brighter or darker so let's get straight into the code to end around if people escape so in the round module scripts we are going to go down here and in the last video we inserted the escaped value into the player when they exited the final door if we have a look for that you will see in the door module it's already there but it inserts this value called escaped when you touch the exit door which is unlocked with the white key so when you do touch it if you're a contestant and you've not already escaped you've not already got one of these values in your player we're going to insert that escaped value it's a ball value so it's going to be true or false but that doesn't matter it's just like one of those tags which we insert so that we can detect if you've got it and if you've got the escaped tag in your player we'll know that you've escaped and then that way in the round module all we need to do is every second just loop through all of the players and then if they have a escaped value then we can just have a variable and increase that for every single player that has it and that will tell us the amount of players that have escaped so let's create a variable and call it escapees I'm going to set this to zero it's going to be zero every single time it it loops around at the starts but then when we loop through every player in the game we're going to have another if statement here and we'll just say if player and by the way we are not never mind yes so we'll say if player kernel find first child escapes so if they've got that escaped value inside of them then we know that they've obviously hit the the door the final door and it's given them that value then we're going to increase that escapees variable by one so escapees equals escapees plus one so if there's five people in the game with this tag then it's going to start zero it's gonna loop through every player in the game and it's going to update this escapees variable by adding one to it and it's going to do that five times so at the end of the for loop we will know that there are five escapees because the escapees variable will be set to five so now we need to do a if statement outside of it just like we've done with the others before if the piggy is alive or not if they've if they've left if the piggy killed everyone and if the times up so we'll say if escapees is greater than zero if more than one person's escapes what sorry if one person or more has escaped if that escapees value is greater than zero then we're going to set the outcome variable to be escapes and so we can check in a minute to see if the outcome is escaped and if it is we can set the status value but then we want to break break out of the the for loop here the outer for loop which is counting down from ten minutes because everyone's escaped so we need to end the round then down here we can just add another else if we can say else if status value equals escapes oh do a leak cause needed there because it's an if statement then status dot value equals contestants have escaped piggy the losses okay so when the first person escapes and gets out we will just end the round okay now you could change this to end the round only when all the contestants are out but if you've got someone who's afk for example then they're probably not going to escape and the Piggy's going to have to catch them so it just ends the round when the first person's escapes because everyone's going to be working in the team and when the first person escapes everyone else is probably going to be around them escaping at the same time so I'm just ending the round when the first person or you know it could be everybody escapes at once but as soon as that first person has been registered and there's one escapee is going to end the round so of course there'll be a fivesecond wait as well so everybody else who still hasn't escaped has five seconds to head to the exit and get out before the round ends so now if we go in to the game and try out we should be able to escape and end the round so you're gonna start with the game and I'm gonna cut this part out so I'm gonna skip to when I'm about to escape in fact what I'm gonna do and I'm going to show you this as well if you want to save time and allow your player to escape really quickly if you're just testing you can go into the server window if you're in the test mode open up the server window and then head over to the map I'm going to use the Select tool I'm gonna press alt this selects each individual wooden block I'm just going to delete it because that's what the hammer would do then I'm gonna alt click on the generator and I'm going to set the on value to be true I'll change the color of this the display as well because that's usually what happen and then I need to get the white key so I'm going to basically alt click on this purple door which is the door to the downstairs area which is where the white key is I'm gonna move it away I'm going to drag it somewhere else I don't know where it's gone I'll just drag it out of the way so now and you have to do that on the server by the way so that everybody in the game can see it both the Piggy and me when we go down here this was that I was just a shortcut to save us from having to complete the game basically to get the final key so I'm gonna pick up the final key and we're gonna head over I know it's very dark down here and you can't really see and that's why you need to increase the ambience or maybe add a a surface light I'll probably do that later on and I'm gonna go back up here and now if we open up the server again and we go into the players service and it's player 1 you can see we don't currently have an escaped value but if you just move out over there there we go watch carefully as I unlock the door okay it's this that is added the escaped value and go it's ended the round okay I'll show you again I've opened up the server I'm gonna pick up the white key I'm gonna head out and it says you escaped and then it ends the round oh and just realized I made a mistake I said status top value instead of outcome I should have said house if outcome equals equals escapes then it will print out it will set status to say contestants have escaped that's why it didn't write that when we escaped so let's try once more and I've also just taken the status not value equal to MS I and I've put it above thee above any of these if statements here because it will update the status to the current time before it breaks the for loop because if it had broken it wouldn't have updated the status timer to the latest time so I've moved it from the bottom down here just up here but I've not I've not moved the weight so keep the weight down here but I've put the status just after the for loop and before the assignments but it doesn't really matter but what it doesn't matter is that you've changed the you made sure that you said outcome equals equals escapes just as you have with the others so let's go test that out again so if you go over here and we pick up the key which I've just brought up from downstairs in the server and I'm going to unlock the door and it says contestants have escaped piggy loses and then the next round is going to start brilliant yeah so what we now need to do because if we just pause the game here we open up the Explorer and we go in here you'll still see I've got the escaped value so we need to delete that in our in our cleanup function where we you know clean up the round ready for the next one so if we go into the remove tags area what we can do is we can just do a very very simple in the else if V is a contestant we don't want to do this for the piggy goes to sewing two contestants that can escape so we're going to say what you can do it outside if you want I guess it doesn't really matter so you can say if the color find first child because if the piggy doesn't have it then it won't matter escapes then V dot escape to coat on destroy so if the player has the escaped value then we're going to delete it and then that way they'll have to escape again in the next round for them to get it because if we kept it in it will start being counted from the start of the next round when you haven't escaped so that's very important there and if you do try it again you'll see that the escape value gets deleted so you can see if we pick up the key unlock the door you'll see that player 2 has the escape value but then as the round ends and the remove tags function fires it gets destroyed as does any contestants value all right next we're going to work on the crouching a lot of people have been wanting to know how to do this I'm going to show you and just as with the piggy bats I can't share my animations with you because roblox just prevents you from sharing animations of the minute so I'm going to teach you how you can make your own piggy and Crouch animation it's very very simple but the majority of the work has already been done the crouching script was in the piggy kit so if you're going to start the GUI click on main GUI and it's inside this anims local script which is where if you often it won't work as a minute but if you have an animation in here which you own it would work straight away so I'm going to walk you through the code so firstly we've got this function which we're going to call and it firstly checks to see if you're a contestant because we only want the contestants to be able to crouch and if you are a contestant then we've got this variable called and in playing which tells us whether the animation is currently playing or not because if it is currently playing which is handled in this else statement then we want to stop the animation but if it's not currently playing we want to start it so to start the animation we create an animation objects we load in the animation ID which we've put in this variable up here and so if you want to put your own animation in you just change the ID here but keep the RBX assets I D but and then you play the animation because you load it into the characters humanoid and then you play it and then I'm slowing the player down so I'm setting the player's character the humanoid in the in the humanoid setting their walk speed property walk speed has capital s to ten so it slows them down I update the variable so it then when we call the Crouch function again the an implying will be true so it will do the opposite of what it currently is doing sort of like the stop will play it and then I'm setting the as a GUI which will appear called Crouch inside the main GUI here I just make it visible you can see and when you press the Crouch button or you start crouching it will change the color to be blue roughly text and the image button and it will just print out that it's plain when you want to stop the animation it will print it's going to stop then it's going to loop through all of the while it's going to call a function on your humanoid called get playing animation tracks this is built into roblox and it will return back a table of all of the animations that are currently playing and so we can loop through them in this for loop and stop every animation it's currently playing so it basically stops your Crouch then and if you don't want to if you have other the other animations that you don't want to stop you could have an if statement here to check the name of the animation and only stop a certain one but this will stop all animations we don't have any other animations in the game currently for the contestants except for the Piggy bat but that's for the piggy so doesn't matter we're then assessing the walk speed back to the default of 16 so if you increase your walk speed your default walk speed and make sure that you change it here as well because 16 is the current defaults then we set the an implying variable to false so that when we press Crouch again it will do the opposite and we're just reverting the image button and the text labels color back to white so it looks on the GUI that it's not enabled then down here we're using the user input service which is detecting user input so like when you press a key so when you have started an input so it could be a mouse click or something we are detecting if you press the left control button if you to change the button that starts your crouch you could do enum key code and then if you wanted it to be the a key you just write a he wanted it to be shift you'd say left shift I think yeah left shift so I'm going to leave it at left control and enum is like a list of options that we can choose because enum dot key code will only take a certain number of inputs it could be any key on your keyboard so we just look them up using an enum and then when you have pressed the correct inputs with calling the crouched function which is up here so it will either start or stop your crouching and then if you're on mobile to make it work we're also hooking it up to a mouse button one click event on the Crouch button so that you can click the button I just show you to enable or disable your crouching and then down here we have some code for a remote events which we're going to add in to replicate the storage so go into replicated storage add another remote events and make sure that you call it toggle crouch now what this is going to do is in the server at certain time so for example at the end of the round we want to disable the crouching if you're in the lobby so also if you're the piggy we want to turn off your ability to crouch or to show the GUI so we can fire the toggle crouch event from the server and we can have an argument which will be whether it's going to be turned visible or invisible so true or false and then when that is fired from the server we can set the visibility of the Crouch button to either be true or false we will stop playing the animations and we will set everybody's walk speed back to 16 so this remote events events is going to be used to turn off the crouching for people at certain times so when the round ends so we fire it from the server and then all clients are going to pick it up with this event and it's going to remove that it's going to make the Crouch GUI invisible it's going to stop the current animation it's going to reset and in playing to false so you're not crouching anymore and we will set that in a server script so let's just go into the server scripts where we want to disable the crouching and we can fire this toggle Crouch events so if you think about it if somebody has just played around we want to hide the crouching GUI when you hit the lobby again when the round is over so what we can do is in the remove tags function which will just clean up after arounds finished in this for loop looping through all the players in the game we can say game got replicated storage toggle crouch and in fact that's what we'll do is we'll put this outside of the for loop here because we only need it to run once because we're going to fire it for all clients like this so for every player in the game we're going to fire this or a motive end and that way when we use fire or clients we don't need to specify the player who we're going to fire this event for because it's going to fire for every player in the game and we want to toggle it to be false we want so we're sending the false argument so that when we pick it up in this script we've got the visibility so we can set the Crouch crouch GUI visibility to be false even though this is disabling the animations anyway I guess we could just say false here and that would do it anyway but so I'm going to remove that so a visibility argument because this is just disabling the Crouch anyway so it's not like we're going to use it to turn it on in fact that's not true because we're gonna want to actually enable the GUI again so I'm going to keep this visibility I'm gonna keep that because we might want to turn it on or off so it might be true or might be false at times because we will want to when the round starts we're going to want to enable it again for all the players that aren't the piggy so if we go back to the round module so we've done that and that will disable it for everyone but then if we go into our game logic script and goes let's think about this so when the piggy has been chosen and we're removing the piggy from the table if they are the chosen piggy let's do an else so if the ALF statement runs we know that the contestant that we're currently looping through is not going to be the piggy so we want to toggle the Crouch GUI to show up so we can say game got replicated storage darts toggle crouch curl on fire clients and then we want to we're not doing fire all clients because that would fire it for the piggy as well so we're firing for each individual contestant but we're looping through them at the same time so it's going to happen for all contestants we're then going to pass the argument true so that when we go down into the Animas crypt and it's gets and picked up you're going to enable the Crouch GUI it's going to disable your animations that are currently playing though and set the an implying to false so that it's just appeared and from then on you can start playing pressing crouching and clicking the button and stop playing your animation so it's just enabled the Crouch GUI then we need to enable the GUI one more time for those that join halfway through the round so if we go into the event handling script and we go down into this menu play event this is going to be when people join halfway through when they've pressed play on the menu so what we can do is we can say game dot replicated storage dot toggle crouch her on fire clients again not fire all clients we're sending the specific player that we want to enable the GUI for which can be player because it's the player that clicked the button and get passed to this on server events and then we're going to say true because we want it to appear so now when the game starts we should be seeing that crouched GUI appear that's wait and see there we go it's appearing for the player on the right because they are a contestant but the player on the left is the Piggy's office it's not going to turn it's not going to appear now next we need to make this crouching animation now because I've already made one but I can't share it with you this is what its gonna look like okay so we're gonna make this I'm going to teach you how to make it so you can make it for yourself in the animation editor is very simple and I know my Crouch animation doesn't look the best that's because I spent about five minutes on it because I know that I knew that I wasn't gonna be able to share it with you so I'm not going to make a very detailed one because it's you that's going to be making the animation in the end so let's go ahead and do that now so we're going to open up the animation editor but before we do that we're going to insert a rig so click on build rig then click on our 15block rig now I'm not going to do a r6 animation because I'm going to set this game to be r15 only if you wanted to do an r6 one you could but arms are going to set the game to our fifty and it makes it look a lot simpler so then go into animation editor click on your dummy then you can name the animation I'm gonna call it crouch and click on create' and what we need to do is don't move the blue line okay don't move the scrubber first thing we're going to do click on the three dots very important then click on set animation priority and click action if your Crouch animation isn't working for you it's most likely because you've forgotten to set the animation priority and it's not being played because the roblox movements grips when you walk and your idle are being played and being prioritized and played over it so it's not playing at all so set the animation priority to action then again don't move the scrubber but we're going to position this rig into a crouching position so to do this well imagine that this grid is the floor so we're going to firstly click on their lower torso so this small torso here okay you have to click on this one if you click on the upper torso and try and move the player all their body parts are going to get skewed off and I'm not going to work so click on the lower torso here okay then go to home select the move tool and drag him down get it to about here so that his torso in fact I'm just gonna do it around here so that say quarter of his leg is above the ground then I'm going to take his right leg I'm going to use the rotate tool and I'm going to rotate it vertically okay so it looks like he's bending his arm his leg sorry then I'm gonna take the next part of his leg and bend it up a bit okay right then I'm gonna take the next leg gonna click on the upper part of it I'm gonna drag it rotate it forward like this I'm gonna take the second part of his leg and drag it down a bit okay so not the best Crouch animation but guess what it works um if you want to animate the arms you can do so as well so you could maybe drag them into the middle like this I know in the actual piggy game the animation animates their arms so I'm just going to show you how to do that as well and again my animation skills aren't very good I'm mainly a scripter so you know bear with me a bit here so when you've finished your animation again not moving the we're not moving the scrubber along because we want it to be playing this infinitely this same pose let's check this one out what I'm gonna do is I'm going to move the lower torso off the ground a little bit more like this just so that we can get the players legs in like this and I'm gonna rotate the leg up a little bit more if you don't want it to snap when you rotate click on model and uncheck the rotate in the snap to grid section that way you'll just have free control over your Lex I'm gonna bend this one a little bit more like this okay now if we play the animation first I'm going to click on this button here so that it loops and if you just play it it's going to off see it's going to constantly loop we only got one pose so the players always going to look like this so now what we can do is we can export this animation so click on the three dots click on exports and then click create new give it a name I'm gonna call it crouch come finish and the same as we did with the piggy bat select just the ID right click copy if you don't see this box just go to the roblox page website go to create and then in the size section you should see animations and you can find a link to your animation right then close down the animation editor head back to your animus grips and take the animation ID variable and replace the numbers here with your animation ID keep this RBX asset ID part because that tells the script to look up on the roblox site for this animation ID right now we're good to test it out so we're gonna go into a server again and see what happens now it might be that it's probably likely that we're gonna have to change this animation because it might not look right but that's fine I'll show you how we can change it alright so here we go around about the starts okay the GUI hasn't shown up we'll investigate that in a minute but if we press ctrl the scripts still be working so there we go we are crouching and you can see that we're now it's working pretty good I'm liking this animation and now we can slip through these little holes where as we couldn't before so if the P key was chasing you and you wanted to make a quick escape you could just a crouch down and boom you're out so really really nice I like that so I'm going record myself debugging this animation GUI to see what's happening okay it's appeared now for some reason okay so that's very weird because I've been testing it a lot of times and it's been showing up the crouch UI and so that one time where it didn't show up was quite interesting because it obviously works but then for some reason that time when we first tested the animation it didn't which is very interesting but I'll just reset and you'll see that the Crouch UI is still there but nevermind it's gone now because we fired that toggle crouch because obviously we died and then we respawned and then it loaded everybody again when the round had ended and I'd let's to see yeah it seems to be working for me so I don't think there's any issues that might have just been a oneoff but the good thing is that we have our animation in there now and it is working really well so we don't need to go back in and edit it but if you do want to change your animation a bit it's very simple head back into the animation editor like this and it might have loaded itself but if it hasn't then click on the three dots import from roblox and then select the Crouch animation that you're saved and then to save yourself from having to put the animation ID and again when you are want wanting to export it again just overwrite the one you just made but really important is that you click the three dots set animation priority and click action else it's not going to work I can't dress that enough okay so that is the crouching done so if you're still having problems make sure that you've added the remote event and that you've been following along carefully and also that you've done your animation yourself because it's not going to work unless you've made your own animation and put it into the Animas scripts okay so next we're going to do is we're going to do the traps so we've done the crouching we now need to make the traps for the piggy now I'm just going to say delete this dummy when you finished with it we no longer need it that was only used for the animation so I'm going to show you now how you can make your traps work so alongside the main GUI in the piggy kit I also gave you a GUI called trap GUI now if you make this GUI enabled click on it and set the enabled property to be true you'll see that it appears and it shows a bear trap with the amount of traps you have left and also a instruction so that you press the control button or you tap on the button click it to place a trap so inside of here there's a local script and it's very similar actually to the animations in it there's a function called trap and when called it detects to see if you're the piggy if you've got that value inside that tells you the piggy we've also got a D bounce and the debounce allows you to have a cooldown so you can only use the trap once every 5 seconds and the way that works that we have a variable and we set it to false to begin with and we'll only let you place a trap if that variable is false and so not debounce is the same saying if the bounce is false so if it is false we're gonna set it to true so that if you keep putting trap because the debounce variable is now set to true this is not going to pass so it's not going to let you place any more traps until the debounce becomes false so after 5 seconds we're going to set D bounce to be false and then once the debounce has first been set the text label inside the trap button which looks like this this control / tap will change its text to say wait and then we will fire a remote event to the server which is going to place that trap and we're also going to script a value into the player called trap counts we haven't made that yet but we will do it very soon and that is going to track how many traps the piggy has left to use and every time they place a trap will update the red eye so have a look at the red text which says 5 to be the amount of traps you have left the value of that truck out and then after five seconds we set the debounce to false and we set the text label of the trap that says control back to its original value which was saying weight before and then we using the user input surface again to see if you've pressed the left control and if you have then we'll call up the trap function and if you've clicked it maybe you might be on a mobile you've tapped it or clicked it it will also call the trap function and also we have another remote event called toggle trap this is very similar to toggle crouch in that it will make the trap GUI show up or go off screen it will make it visible or invisible but instead it sets its enabled property instead of the visible property of the trap person which you could set but I've just chosen to use enabled so we're gonna need two more remote events to begin with and it's we're gonna have one for the toggle trap so insert our most events and set it to toggle trap like that and one more which is going to be called place trap so we're going to fire the place trap when we want to lay down a trap in the Piggy's current location and then we're going to have another one which will make the trap GUI appear on the screen or make it go off the screen when the ground is finished or when the piggy has been selected so firstly let's make this trap GUI show up so very simple so let's go into the round module and we're gonna go to the function where we teleport the piggy teleport piggy here we go teleport piggy so inside of here well firstly going to create that a value inside of the piggy called trap count okay very simple and this is what's going to look like just to speed up the video by now you should know how to insert values so recruiting a variable called trap count where instancing in a in value changing its name to be trap counts then by setting its value to be five that's the amount of traps the piggy can place of course you can change this to a bigger number such as ten I recommend you keep it at five because it keeps the game balanced and then we're gonna say trap counselor parent equals player so it puts it in the piggy in there player so only the piggy is going to have this value that's why we've put it in to teleport piggy and then we're going to want to make that GUI appear so we're gonna say game dot replicate this storage got toggle trap I'm sorry toggle trap Carol on fire clients not fire all clients we're gonna use fire clients we only want to fire it for the piggy so we're going to put the player in the player argument that's going to fire four which is going to be the piggy which we passed to this function and then we're going to set the second argument to be true because we want to make that DUI appear and later on when we want to make it invisible or disabled we will just call at this remote event again specifying the piggy and also having the second argument to be false so that the script knows to set the enabled property of the trap GUI to be false so next we need to do just that so we're going to scroll down a bit to the remove tags function and inside of here inside of the if the find first child picky when we're looping through all the players in the game when we found the piggy what we're going to do is we're going to firstly just underneath the part where it deletes your tools and the piggy back we're going to see if you have that trap count value so if the code on find first child trap counts then V dot trap counts destroy okay it's going to delete that trap count value out of your player because we no longer need it and if you've just been the piggy and the next round you're gonna be a contestant even if you are the piggy next runned again it's going to insert another trap count into your player so we need to delete it at the end of the round especially though if you're going to be a contestant next round we don't want you to have a trap count value in your player so after that we're then going to fire that our remote event again to disable the trap GUI on the picking screen because if they're no longer the piggy we don't want them to be able to see that's trapped GUI because if they're a contestant next round they're gonna get the toggle crouch they're gonna get the crouch GUI which is gonna be in the same position so we're gonna say game don't replicate the storage once again topping trap curl on fire clients we need to pass the piggy the current player that we're looping through whose GUI we're going to disable that's going to be V because V represents the current player that we're looping through in this table and that table is game dot players come get players up here so the current player that we're looping through it's going to be V we know that there's a piggy because we've doing this if statement to check if they are then we're gonna say comma and we're gonna say folks because we want to disable the trap GUI now in theory if you are chosen to be the piggy then after you die then the GUI should hide itself because it's got a reset on spawn property set to true so we'll reset how it first looked when the GUI was inserted into your player and the trap button is going to be invisible at that point because the GUI is disabled but just as a good practice to make sure that actually did happen we can use this toggle trap remote event to make sure that it is disabled and set to a false which is useful if you don't kill the piggy for example if you just teleport them back after the end of the round so now if we test the game out you'll see that when the round begins the piggy should see they're trapped GUI and there we go they do see it and for some reason the toggle Crouch still is not working so we will investigate that a bit more but before we do that we are going to make it so that the piggy is able to place their traps because currently they will be able to press control and it will say wait but they won't be able to actually place them and that's because we've got to do the coding on the server we got to pick up that's remote events called place trap when it gets fired and we're going to place a trap in the Piggy's current location we're going to do that on the server though so let's go into the event handling script and let's just create a another event called game replicate this storage dot place trap dot on server event so when it's fired to the server colon connect function player just like that and then we need to firstly make sure that the person that's calling this remote event is the piggy because it could be somebody that you know tries to exploit and is actually a contestant so we can say if player cut on find first child piggy so if they've got that piggy value then we'll make sure that they've got a trap count value if player curl on find first trialed trap count then we need to have a debounce don't we we need to have a diva like we had a V bounce for the what do we have the D that's the debounce was for is the it was in so we had D bounce for these stun scripts and the bat script as well but yeah the debounce will stop the piggy from being able to lay down five traps at once by spamming on the Crimewatch button so local trap debounce equals false this is only going to be used in this place trap event so we need to say if not trap debounce then so if d bat is the trap debounce is false which means that they can place a trap we need to set it to be true so they can no longer place a trap after that for us for a five seconds so we'll wait five seconds and then we'll set trap D bounce back to false so that for five seconds you won't be able to place any more traps before it then unlocks again to the five seconds will unlock the debounce by setting the variable back to false because we allow the for loop to pass if the condition is that lead trapped debounce is false so when it's true it's not going to run so in here we need to then check to see if the player has enough traps left because they could have used the fall of their traps so if player dot trap count dot value is greater than zero then if it have got enough traps a number greater than zero so five four three two or one if they have zero traps well it's not going to pass because zero is we our condition is that the amount of traps that you have has to be greater than zero and so then we need to put the bear trap in the map but we firstly have to check see if the map is there so we say if game dot workspace curl on find first child map this is just some extra security and safety so that the script won't error if the map isn't there for some reason no reason why it shouldn't be but you know then we're gonna say player the dart truck and we're gonna subtract one from their current trap camps when they've placed a trap we need to remove one from their trap count value so player thought trap count thought value equals and then we'll just say play a lot truck a lot value because that's their current value minus one so it takes one away from the current value so if they have 5 it would be 5 minus one so would then turn into four right now we need to actually place the bear trap so in the piggy kit I gave you a mesh of a bear trap I'm just going to drag it into workspace to show you here we are nice bear trap very nice you can resize it if you want doesn't really matter so I'm going to take this bear trap in fact it kind of does matter if you resize it on the yaxis you make it bigger like this then it's going to interfere in a minute with the placement and I'll explain more so put it back into server storage that was just to show you go back into event handling we're going to clone this bear trap so local trap equals game doctor server storage dot bear underscore trap colon clone because it's got an underscore in the name then we're going to set the C frame off of the trap so C frame again is like the position but with rotation as well so C frame is just a better way in my opinion of placing these type of things so we're gonna set the traps C frame to be the C frame of the player's humanoid root partner the humanoid root part is a invisible part in the middle of the player's character so positioning it there we'll be able to put it where the player standing right in terms of x and y because it will be in the middle of the player's character sorry x and z the y value it will be off the ground in the middle of the player's character so we'll need to offset it a bit to put it down on the ground so we're gonna say player dot character dot humanoid root part dot C frame and this is how we offset it so it's currently going to be in the middle of the piggies body so like about level with their bats or their arm so we need to subtract a number of studs from this C frame value to put it down on the ground and so if you've increased the size of your trap you're going to need to change this number the amount of studs this that it's going to be offset by so that it is it looks like it's on the floor so we're going to say vector 3 dot new so vector3 value is just made up of three values and x y&z value and they are the amount of studs that is going to move on each axis so we can leave the x and y values 0 sorry the x and z value 0 but we're going to set the Y value to be 3.5 so it's going to subtract 3 point five studs vertically from the C frame of the trap so it's going to move it down by three point five studs if you wanted to move it up you would change this to a plus but it's a minus because we want to subtract to move it down so now that we've placed the trap and again change this if you want if you don't change your piggy character as well this should work fine but if you use a different piggy character which might be a different size you'll probably need to change this value three point five so play around with it although currently works well for me right next we need to parent this trap so I'm gonna put it in the map so trap dot parents equals game dot workspace find first child map and so that will put it in the map and that should be good now we then you might be wondering how do we kill the player when they step on it I've put a script in there it's called full damage I don't know why I think it's because I copy the script and forgot to rename it so I'm going to rename it to be death script although it doesn't really matter but in this bear trap again in the picky kit it came with it there's a touch deven so when something touches the bear trap he's going to get their player from their character the character is going to be the parent of the hit the hit is the argument that the part that touched the bear trap or the thing the body part so if it is a player and they're not the piggy is going to set their walk speed to be zero for five seconds and then it's going to set their walk speed back to 16 so you're going to be stuck for five seconds and after the five seconds it's going to destroy the trap so multiple people could get stuck in this trap but I I don't think that's a good idea for a few reasons because let's think about it if somebody first steps on the bear trap and then two seconds later someone else steps on it well after the bear trap gets destroyed after the first five seconds for the first person the traps going to get removed so it's going to stop this script so there won't be the second player that steps on it because the script gets destroyed he will be stuck forever so we're gonna have a debounce so I'm going to make another D bound so local debounce it was false and I'm going to say if player then if not D bounce then the bounce equals true gonna do this put this inside of here and then take this code ice might look a bit confusing but bear with me just thought about this whilst I was recording so cool so I've added the D bounce in here and there's no point in setting the D bounce value to become false again because we're gonna delete the bear trap and it will stop the scripts but what it will do is it will only allow one player to get stuck so when one player wants or when you activate the trap nobody else can get stuck in it because it will get destroyed after five seconds anyway and this will prevent players from getting stuck forever if they step on a trap that somebody else has stepped in so because after five seconds it's going to destroy the script if somebody else is stepped on it halfway through that five seconds the scripts going to be destroyed before they're five seconds are up so they're going to get infinitely stuck so you only want the first player that touches the bear trap to get stuck and this should do it okay go give it a try okay we've still got that toggle crouch GUI issue to work out as well but if we wait for the game to load you can see the piggy has their bear trap has loaded up and if they wanted to they could press control and it's gonna place a trap I'm gonna wait until he gets spawned in so we can get the player on the Left caught in the trap which would be in two seconds here we go so I'm gonna place a trap over here and I'm gonna place another one do you see how the number here went down as I placed one here we go and would place another one up here and if I go and stand in one of these Oh interesting the trap hasn't showed up oh hold on let's just have a look at this interesting okay we're going to have a bit of a debug now we're gonna try and debug this so let's just give the piggy some more traps it's not going to update on their GUI but if they place a trap then it destroys itself after five seconds uh I think I know what we've done here so what I think I've done is let's let's look at this so yeah my mistake so even if the piggy touches it we're already starting with debounce so because this if statement comes after the debounce if statement if the piggy steps on the trap it's going to start the debounce and it's going to wait five seconds even if they are the piggy it doesn't matter because this wait five seconds isn't in the if statement when it's when it should be and this should be in it as well so it's going to just destroy it after anybody touches it so when the piggy touches it which we don't want so let's take the ste bounce and put it inside of this if statement and then we'll take this code here and we'll put it in here as well so it's kind of hard to get your head around the bounce so don't worry if you finding it a little bit hard to understand let us just sort this out okay we've got an indent of one extra indent which we didn't need okay this should work now so the debounce will only trigger if the player is not the piggy so when somebody who is not the piggy steps on the bear trap then we're going to see if the debounce is false and if it is we're gonna set it to true so nobody else can step on the bear trap then we're gonna make the character stand still five seconds and then it's going to wait five seconds and then it's going to delete the script we don't need to set the debounce to false because the scripts gonna get deleted anyway because only one player is going to be using this trap let's try it once more so they go little example of me debugging my own code there so you need to learn how to debug as well so that when you face the type of problem you can fix them yourself and as you do more coding as you look into more problems your problemsolving skills they will get better trust me so here we go again wait five seconds to start the round and we will place one of the traps when the piggy spawns interestingly though the Crouch has appeared again so interesting we'll have to look into that a bit more I'm still a little bit puzzled as to why that's not working but if we wait for the piggy spawn which should be very soon I'm gonna head down to the lobby section down here I'm gonna let the piggy place trap and now if I step in one of these traps I get stuck and you can see I've kind of walked into the trap here and it's so if I jump into it I'd get stuck in it and that's because the trap is a and if I just walk on the edge of it it doesn't look like I'm touching it it still kills me all right it still freezes me that's because the trap is quite big I think if you make the trap smaller and you set the can collide in fact you don't need to make it smaller you can just set the can collide oh never mind actually that's that's a good point let's think about this so you could add a small weight here of maybe not 0.25 seconds just to allow the player to walk into the trap a little bit more and that way they would it would look as if they get stuck in the middle of it they're still touching it they're just touching an invisible part of the block which we can't see because it's a mesh whereas there's a hitbox around it so if we go in at one of the edges we'll still be able to touch it so we'll try this again okay let's try this there we go that looks much better so just a little delay to allow me to keep walking into the trap before it deletes awesome and if we look at this again the piggy cannot get stuck because he's got that value inside of him which tells the script in the bear trap that he is the piggy so it's not going to trap him whereas because I'm a contestant I've not got a piggy value he's going to make me get stuck and the piggy he wants can use up all of his traps in one go we'll just let him use them here and when he gets down to zero he'd have none left so the piggy needs to use these traps really wisely and see he's down to zero he can't place any more but he can kill me okay brilliant so all it is left to do is fix that bug with the Crouch GUI and that we should be good for this episode in fact there's actually a hidden bug which I haven't told you about yet which we will also have a look at fixing in this episode and that is even though our Crouch DUI doesn't appear of course we can still Crouch but if you step in one of the piggies traps right now there's a bug that when you get stuck a quick way to get out of the trap is to crouch down so I'll show you again move the piggy out the way you get stuck in the trap if you crouch you can get out of it because the Crouch is adjusting your walk speed remember to slow you down and speed you back up when you press control so we're gonna have a look in that book as well so two books regarding the crouching to fix so I'm going to record myself investigating this book so that it helps teach you some debugging skills so I don't know at first whether this event is actually being picked up when it gets fired so let's print toggle cracks fired with visibility and then I'll pass through the visibility the visibility Oh already found the book that's about visibility wrong if you have a look it says visibility so visibility and Oh actually mm now that can't be right that can't be right because even I spelt it wrong I still have dated the crouch value so that's not the that's not the problem fixed so let's print out again toggle crouch picked up with visibility dot visibility I'll set it to be visibility anyway but we still need to work out why it isn't working so into test mode and trust me we'll get this book fixed there's no such thing as an unsolvable bug in my book because we'll be able to fix it trust me just got adopt the mentality that you can fix a book because I fix lots of books in my roblox development career so it's just about the learning so let's open it up crouched I see if it what we need to firstly work out here's the piggy ah attempt couldn't oh whoops I forgot to I forgot to hum fix the book what I've forgotten to set it to a string because you can't concatenate a ball value with a string but it appears that visibility is being fired sorry the event is being fired and it's passing a boolean value to it which is going to be either true or false so if we just test this again I'm going to skip to when it loads okay let's open up the outputs okay it's a for some reason while off see it should have here but it's very weird that sometimes it doesn't appear whereas sometimes it does okay interesting so I've just launched the game again and it hasn't fired the event we can see because asn't printed out there's been picked up so we know that the problem we know that the problem is to do with when we are firing it the event so let's have a look at that so it's going to be toggle crouch let's go to where we fire it so when we're looping through all of the contestants we are toggle crouch fire clients V true so it would appear that it's not getting to this else statement so let's print out firing toggle crouch for player V dot name and then let's print out V dot name outside of this if statement so we can see all of the players that is looping through interesting okay let's try again okay so it's worked again so let's go into the server and see what it says so it says player one now player 1 is the piggy so it's only printed out player one for some reason so let's have a look at this so let's go back to our game logic no game logic ran module no game logic my apologies so let's have a look so it's printed out player 1 which suggests that player 2 is not in this table for some reason let's have a look so it would suggest that's it would suggest that the second player is getting removed so I'm going to see I'm going to Prince added player v oom2 contestants I'm going to add them to this contestants table up here well I'm going to print when each player's added I've got a slight theory which I won't share with you yet I will share it with me though if this works ok I think my theory is correct so what's happening is the players at the start of the game are being added to this contestants table ok but when we get to the you see only prints out player 1 it's not printing out player 2 who is the actual contestant so this to me is suggesting that when we are removing table we using table don't remove to remove the key out of the table it is this will sound very it might this might be hard to me to explain to you but if we imagine that in our table in our table here we have Alvin and we have na yeah if let me think about this for a second so if this piggy is the is me is a B what's going to happen is the for loop is starting out looping through all the contestants so it's going to loop through the first person and so I is going to be one and it's going to work out that a Billy is the piggy so it's going to remove a B from the table so what it looks like now is this Nyko 88 who is the contestant it's the only one left in the table and because a B has been removed his index is now one so when it then loops around and you would expect it to move on to nacho 88 it doesn't it just ends out of the for loop because it thinks that NACO 88 is at index 1 because in the because these are index 1 now well I would increase by 1 so I think what we need to do to fix this is to remove this part where we fire the toggle crouch but instead copy and paste this for loop and instead of this this fee equals equals chosen piggy we'll change it to not equal to chosen pigley and so if for everyone in the contestants if they are not the piggy then we're going to fire the toggle crouch for them because they they should still be in the contestant in the contestant table it's just that because the way it works when you remove someone from the table it shifts along but the I value will stay the same so you might miss someone out which is why the toggle Crouch is not firing but this way we have a separate for loop is going from the start again and will no longer be a piggy in there so it will it won't remove anyone from the table it will just start from the beginning again and it will set the toggle Crouch to enable to everybody so that should do it and you see I had to debug that there was no error I had to think logically about how it was working and I got to the end now if you're a beginner scriptor it's unlikely that you would have found the solution to that problem it might have took you a couple of hours but because I'm an experienced coder I managed to find that book really quickly and rectify it so the more coding you do and the more problems and books you get the better you get solving them so a couple years ago I wouldn't be able to solve that problem as quick as I have done right now but just keep going so to recap we're adding another for loop with this if statement here okay so if V the player is not equal to chosen pigley then we're gonna fire the toggle crotch rent now I hope this works because um I haven't actually tested it yet so let's see and the thing that led me to believe this was because it was only what it was only breaking and not showing the toggle Crouch when player two was not the piggy so when player one was the piggy they'd be the first one in the table I think and it would be removing them first which would leave player two still in the table but because the for loop had then moved on and changed I and realized there wasn't a second element in the table anymore it just broke out so let's see here so player 1 is the piggy so this wouldn't of sorry player 2 is the piggy but player 1 would come first anyway so this wouldn't affect it but let's keep trying it and here we go player 2 is the non piggy player 1 is the piggy and it's working perfectly so he press control it goes blue and when we release it it goes white and you can also click so really awesome we've got the crouching in here and if we go back to the server you'll see I did play a one two contestants added player two two contestants and then it fired the toggle crouch for player two so we've just fixed that book together and we've now got a working trap system we've got a working crouch system and we've got the animations done for them as well we've also been able to make the players escape from the game as well which is really really awesome final thing we need to do is fix that bug with the traps where if you get stuck in a trap you can crouch and it will change your walk speed now let's have a look and see if we can fix this so my solution proposed solution is to when you step in a trap we'll put a value inside your player called stuck and then in the crouching scripts we can detect if you have that stuck value and if you do have it then we won't let you crouch so let's see so in this debounce just after the debounce equals true we're going to say local stuck equals instance got you all value stuck dot name equals stuck and stuck dot parents equals player now I'm not going to worry about setting its value we don't need to do that all we need to do is just put it in the player so we can see if they have this tag it's more of a tagger and a value just telling us that they're stuck so now that we've done that we can or will need to delete it afterwards won't we will need to say player player dot stuck destroy and that will delete it from there player in fact we'll just do if player find first child stuck then just in case it gets deleted somewhere else for some reason and it's not there if they leave the game after getting stuck you know so that's a good idea actually you can say if player dot character in there as well just in case they leave when they get stuck so this will delete after 5 seconds and then in the crouching script is here let's just put another if statement in here if player so if not so if they don't have the Crouch value if not player find first child stuck so we only want this if statement to run the code inside of it if they're not stuck yeah so we'll add another let me just look at this we need to have a an extra end there we go so if they don't have a stuck value then we will let them crouch but if they do have a stuck value and we will not let them because they're gonna be stuck in that's trap let's go and try this out so here I am I'm gonna place a load of traps as the piggy and I'm going to go and walk into them here and I get stuck i'ma try and Crouch but it's not gonna let me I'm pressing the Crouch key because I'm stuck but as soon as I become out of the trap it will let me crouch again there we go so if we look in the player player 2 and I place another trap watch carefully over here as I step in it you ready watch here so the stuck value has gone into my player so when I press control it sees that I have this stuck value so it won't let me crouch but as soon as it gets destroyed it will let me crouch again so awesome we fixed that bug so now if the piggy was to guaran let's say for example he puts a trap here and then he shuts the door again and the pig is chasing me so I decided to go and escape in here oh I can't go down I'm stuck so he can come in here and he can kill me so there we go we seem to have fixed the traps in the game and at the end of around the roles have changed so player to who was the character to begin with has now become the piggy or as the player on the right now has the ability to crouch but when the person on the left now presses control they don't crouch instead they place the trap really really awesome so that is pretty much the piggy game completed in terms of the round you're able to play now and have a proper game so as I said in the last video publish it by clicking on file and then click publish to roblox and you will be able to it's gone off my screen here we go you'll be able to give it a name description and then click on create that will then give you a link to the place if you want to make it set to active so that players can play it click on game settings and then click on permissions and set it to public so that anyone can play it and then if you go into your roblox profile sorry your roblox create page on the roblox menu at the top then you'll be able to see your place and your webs go and play it and you should be able to get a link to it as well from this button here I think it's only just because we've published it it's not showing up but if you do go to your roblox here you go you go to the create page click on games which is the first tab anyway and then click on the starts place you'll be able to go and play it with your friends so I'm sure that a lot of people in the comments will be asking oh can you make an extra feature for this can you make an extra feature to do that for example map voting and the answer is I can't do every single feature of piggy um you need to realize that and if you want to make your own features your own other features that you want to add then you can learn the basics of roblox scripting and you can try and make them yourself because it's just impossible for me to reply to everyone's comments and add every feature that everybody wants me to make I've tried to make this games realistic as possible but we do have to end this series at some point and I am going to create some extra videos after this off some more features but this is the main game completed so just know that I'm unable to make every single feature that you request but I will try to add on to them as much as I can I'll keep on supporting this series but at some point I have to stop them so that I can work on other videos and other projects if you understand that but we've made a pretty cool piggy games giving you a great introduction to roblox to do and scripting I recommend now that you go and check out my 23 I'm counting we're adding more videos as we go along 23 part series for those that are new to roblox development so you can learn the basics of coding I'm also going to be working on an advanced series after that as well so that you'll be able to learn how to make your own games that that you want to make you know not just games like piggy but you can make what you want to create I've got lots of videos on my channel and lots of other how to make a game series for you to check out but so I will keep adding to this series if I can as I said I've got some features that I do want to think about adding such as map voting that's something that you might see coming soon so yeah anyway thank you for watching this series so far I've been having blocks your host and guide please subscribe to my channel if you haven't already don't forget to click the like button and you can go to the next episode in the series if it's out by the time you're watching by clicking on the thumbnail in the middle of your screen there will be an arrow pointing to it so I'll see you in the next episode thanks for watching and I'll see you next time Cheers bye