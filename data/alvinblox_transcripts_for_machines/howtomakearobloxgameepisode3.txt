welcome back to part three in how to make a sword fighting game on roblox so we're gonna do we're gonna continue by creating our game loop script so that we can see who's left in the game and we can crown a winner or if the timer runs out then we can restart the game award no points so what we're gonna do is we're just going to jump out of the secondlast end here so that we have a final end at the bottom of our script and we're going to update the status value to get ready to play and then we're gonna wait two seconds and we're gonna start creating our game of for loop so it's gonna be a for loop if it counts down from whatever the game length is to zero going down in increments of one so we can say for I and I is gonna be the time left okay so so I equals going from game length so however long the game is because remember we set the variable and game length at the top here so from game length all the way down to zero going down in increments of minus one do and we've added another end for us and the first thing we need to do is add a weight one because we're going down in increments of 1 each second so we need to add a time delay of one second so the I the I value counts down every second the next thing we want to do is we want to loop through every single player currently left in that table so for I comma player in pairs and then we're going to do the player's table PL RS do and then we've got another end here could you go on to the for loop we want to check to see if the player is still there they haven't left yet if player then character equals player character if not character so if there isn't a character then they've probably left the game or something else has happened to their character else if character find first child game tag if they've got that game tag that I mentioned earlier that tells us that they're still in the game then we know that they are still alive so we can say print player dot name dot docks were concatenating it together with to be a string is it still in the game so we're just printing out that the play is still in the game so that we can just see who's alive and who isn't so if they are still in the game then we can carry on we don't need to do anything to them else we know that they are dead okay so what we can do is we can remove them from the players table just like we did earlier we can say table don't remove from the players table at the position I because I is their current position in fact let's just change this to an X and change the X over here so in this for loop here where we're looping through all players in the game we'll use X as our counter okay because we're already using I up here in our in our countdown for loop so we don't really want to get confused so we're just changing I to X because at the I value the counter value can be anything anything you want it could be dog it could be cat it could be Y but we're calling X just because that's what I've thought of quickly so what we're doing we're removing them from the table at their current position which is X and then that's all that we need to to do so we'll just go back to this if statement here and we can do an else table don't remove from the players table we can do the same thing remove them from X again in case there isn't a player so they've failed at the first if statement and then we can print player dot name and then dot has been removed and if you want we can put this after the table don't remove right here so it's just printing that they've been removed from the table if they have died okay so now that we've done that just before our weight one we can update the status value to say there are and then we'll do a space because we're concatenating again i dot op seconds remaining and well then I'm gonna say how many players are remaining so you can say dot dot and then we say hashtag PL RS the hashtag for the table tells us how many players are left in that table players so this is just gonna tell us how long's left in the match and how many players are still fighting so now that we've done this we can get on to the absolute checking to see if someone's won whether the timer's run down or whether nobody won ok because there's lots of different things that could happen you know they could fight each other at the same time have the same amount of damage and as if by some absolute magic look they could kill each other at the same time it's practically impossible but you know we will still walk account for it anyway so if the number of players is equal to one then we know that there is one person standing they've got the epic victory Wow because they are the last person standing we want to get that player so if there's only one person left in the action table there can only be one person that's able and they will be a position number one so we can say status table value equals the winner is and then we can say dr. PL RS plays table we're getting the first person the first objects in that table got name Lukas in the name of that player and then what we're gonna do is we're gonna increment their books value gonna give them some books because they own the game so we can do player players 1 dot Lee's stats doc books don't foul you equal players 1 dot the leader stats doc books dot value plus 25 in fact let's make this a variable reward and then at the top we can say a local reward equals 25 so reward is how many books they're gonna get if they win the game and I've just set this to 25 if you wanted to increase it to maybe 100 you can set it to 100 whatever you like so it's the amount of currency they're gonna get if they win so we're taking the amount of books they currently have and we're setting it to whatever they currently have with their reward added on so if I can only have 50 books and I win this will be 50 and we're gonna update that to 50 at 25 so that we're gonna have 75 books so now that someone's won we can break out of this for loop because the game is over we can break out from this game length loop and we can end the game however there are different things which could happen different events okay so it's not that there's gonna be one person left every time people could go afk and the game could last forever for the whole entire time limit so we have to check to see if we could check to see if there are no players left as I said earlier else if number players equals equals zero then status not value equals no buddy one okay and then we can break from this again and obviously if the timer runs down to zero that will break itself because the timer ran out but we could say else if I equals equals zero then status top value equals time up and then we can break from that again so there we go we have done our game loop it now covers all different possible events which would happen if one person's left if nobody's left or if the timer runs down it will account for those different possibilities so what we need to do now is we need to clean up with the game when it's finished so we can print end of game and then we can loop through all of the players in the game not in the pledge table because there we nobody left so we can say for I comma player in pairs game dot players come on gets players do character equals player character if not character so if the character isn't there anymore then we're just gonna ignore them else if they have got a character we're going to destroy the game tag if they have one and we're gonna get rid of their sword from the from their backpack so we can say if if character am i spell all right yep if character fine first child game tag then character duck game tag curl them destroy so we're just getting relaxed we don't want them to have more than one okay we only want them to have one and at the end of the game we all destroy it from their character and then we can say if character come on fine first child sword then we're going to destroy that as well sorry we want to do play it up backpack because they will probably have it in their backpack so if played our backpack fine first child sword then player dot backpack doctor sword destroyed unless just do the same thing again for their character copy and paste this in case they have the sword equipped if character find first child sword then character dot sword destroy so we're just removing it from wherever it might be it could be in their character equipped they could have in their backpack so we're just removing it from all these different places and then what we're going to do is we're going to destroy the clone map from the game okay and we're also going to want to respawn all the characters at the end of the game so what we can do is we can save player turn on load character now if you don't want to if you don't want everyone to respawn then you can get rid of this line or comment out but I'm gonna keep it in because it just respawns everyone and looks as if a new game is starting so after we've destroyed the map I'm just gonna do a wait two seconds and we're gonna set the status value to game and it okay so that should be our game loop completely finished now there might be a few bugs so what we're gonna do is we're gonna go into a normal game into a test server and we're going to test the game for any books so let's go ahead and do that now so we're going to just firstly save the game by pressing ctrl s or command s and then we're going to go into a test server we're going to do two players and we're going to load it up so let's load it up and see what happens so if we do have some bugs we'll go fix it that's okay it's likely that you will have books there's nothing to worry about you just have to go and look into your script if you get one look at the line where is telling you where errored and if you are getting an error then you have to work out why that's happening so there's lots of different places that can help you you have the scripting helpers forum lots of other places where you can go and you should be able to fix your code but hopefully we won't have any bugs and we're just waiting for this test server to load up okay so we've got the server here so let's just switch out for the for the players to be added into the game so this is the server so this is where we can see what's going on we can see all of the players and these other two windows of studio which we're about to open they are the the two players which we have created this server with so they're going to be added anytime now you can see that the status is currently set to waiting for enough players let's just drag each player over here and get rid of these boxes so that's player 1 and we have player 2 over here you can see says intermission and get ready to play there are 49 48 seconds remaining and two players left we do have a little bit of delay here because studio just take a while so player 2 or player 1 her if it was just one that match because of that but if we just go and wait for the actual game starts up again we have two players in the round now and if we wait for the game to load it says get ready to play there are 50 seconds remaining and two players left which is correct you can see the timer is ticking down now let's go ahead and just test out our game for any bugs let's see if we were able to walk off them up no we're not we can't walk off the map let's see if the sort work get the sort of working for me and let's just wait for the timer to tick down all the way to zero okay so time up and game ended so we all get teleported back to the lobby it says intermission and we wait for another game just Dart nobody got awarded any books that round because nobody won however let's go and kill somebody and actually see if we get the points so it says there are 48 seconds remaining and two players left now one thing that is going to happen is if we go over here and kill somebody I don't think that the two players left is going to update straight away I think it's only going to update when the player down here respawns because there they will be respawned and they won't have their player tagged there we go so it said the winner is player two when the person respawn so what we need to do when the one we finished testing is we need to create a event so that when somebody dies then we will immediately remove their game tag and we can crown the winner so now let's try and die at the same time now hopefully it should say that play a to one or player one whoever it was that died first and there we go you can see that everything needs to do working fine so let's go back into studio add that that event which will run when the player dies so that we can immediately remove the game tag and we should be good to go so let's click on clean up and go back to our stats are screwed because that's where we're going to create this event we're gonna have a humanoid died event which ones when the player dies and we're just going to we're gonna make it so that the player has their game tag instantly removed so let's go back in to stats here and we can say player top character added turn on connect function character okay the character parameter here that's going to be the character that we're working with and any characters that do any player that is in the game whatever we do to the character we will do to the actual player so we're just using character as as the cur a dummy right now and anything that we write and here will happen to each player so we want to do character dot humanoid got died connect function so let's have a look dice power that wrong yes I did so whenever the person dies whenever somebody dies this event will run now the reason we're putting this inside a character added event is because we need to get their character and the only way to do that it's used character added and that will fire whenever the person respawns when their character is added back into the workspace so inside of there we're getting the humanoid and then we're doing an event on that humanoid waiting for them to die and when they do die we connect that to this function and this function is a block of code which will run whenever that happens so what we want to do is we want to say if a character cut on find first child game tag then characters look game tag cut on destroy just like that and then what we want to do is instantly reload their character so that they go back to the lobby straight away so we don't have to wait five seconds for them to respawn and one last thing that we're gonna do a nice little bonus is we're gonna create a little kill feed that shows when somebody's killed someone and it will say in the GUI at the top player one killed player two to do that we're gonna use a feature in this specific sword now if you're using a different sword this isn't going to work so you can still add it in but it probably won't work you'll need to code it into your sword yourself but the sword which I'll put into the description just have this feature and I'll show you it now so in the resources module script in player damager you can see that whenever somebody gets damaged we create a tag called creator and the value of that tag is the player that killed that player or damaged them so when they do die we can look at this crater tag in their player and we can update the status to say that the value of that crater tag killed the player that died so we can say if characters like humanoid and characters are humanoid find first child creator because the crater tag is actually going into the humanoid as you can see being parented into the humanoid here then we can say game replicator storage dot status dot value equals to strength we need to convert this to a string it's because the crater value is it's it's actually the player object it's not actually the name of the player so we can say character dr. humanoid got create or dot value and then we say dot dot actually it's the player's name I believe do yes it is the player's name so we're concatenating it together and we just want to make sure that it is a string so we can say dot dot killed with spaces in between because we're concatenating I don't say dot dot player name and then if we go and test this out our kill feed should be working so what I'm going to do is we're going to load up another local server now because it took ages last time to load up I'm gonna pause the video and restart it when we loaded up ok I just drew in the game you can see says intermission it says get ready to play and for some reason I cannot new I think this is a roblox issue yep there we go so it says there are 39 seconds remaining two players left so let's go ahead and kill this person okay there we go and it said the game ended intermission and I got 25 books so if we wait for another game to start get ready to play you can see that the animations don't work for me that's because I haven't actually used them but you can download the animations think I will leave a link to a depth or on person how to do that so let's go ahead and try to get a second win on the bounce can we do it no because he it said that we got killed at the top with our kill feed try and look out for that in the future so the kill feeds working and you can see that it will show up that you have one instantly after because the game tag is instantly being destroyed so have a look at the kill feed at the top it says that I killed Magic Man it doesn't pop up very long but that can be edited in the future if you want I might remove the game end didn't add a longer waits just so you can see the kill feed and the states updates but all no it's pretty good you can see I've got 50 books I no sir I haven't got 50 books nako right here it's got 50 books I've got 25 books let's see though if we can't run the timer down don't kill anyone testing needs time so hopefully no one will kill me let's let's have a look I'll just pause this and speed it up okay so there are 5 seconds remaining let's see what happens when the timer ticks down to 0 it says time up game ended nobody got any points and the game restarts so I've done a little bit more testing and I've discovered a few more books one of the books is that sometimes you will spawn in the map so you're stuck in the map and sometimes you'll fall out of the map so what gonna do is we're gonna just make the spawns a little bit higher and we're also going to do is we're also going to fix another book which I found which is that if you leave the game when it's running it won't register that you left so what we're gonna do is we're just gonna reset and I'll show you how to fix these bugs but this is what's going to happen when they are fixed if you wait for the game to start I will say get ready to play but you see that one of the players is stuck in them up so we need to make sure that the players are teleported a little bit higher than the spawn so they don't get stuck so it says three players left and if I just ask someone to leave so we'll say magic believe what we want is for the number three at the top to change to a two which it does but at the moment without the fix it will stay at three so I'm going to show you how to fix that now what we're going to do is we're going to go back to the main script and just on line at 98 in the for loop here where we're checking to see if not character then we're going to say table don't remove players X so make sure that's added in there and also what we're gonna do to fix these spawn issues is we're going to go back to where we teleport the players to the spawn and we're just going to do where we're setting the humanoid route part C frame we're going to do plus C frame dot new actually we're going to do the Plus vector three dot new zero five zero okay actually let's make that ten so that they well above the the spawn so that should fix both of the issues and also here we've got the kill feed and let's go back to the main script at the end now let's just do a weight of about two seconds after the end of game just so that we can see who won before it ticks over to say game ended so let's go ahead and publish those changes and we'll get some more testers in to see if the issues are fixed okay so we're in the game and it says 24 seconds remaining and four players left but there's one two three players left actually so let's go into the console and go back over here and see if there's any errors so it says that there are four people soon the game one two three four one two three where's the last person hmm oh there they are they're hiding underneath a cactus so there are four people left so that's okay so let's just change this let's hide that and let's wait for the next game to start so there's one two three four there's five of us I think one dude yep I so let's have a look get ready to play five players left now let's see who kills first so it should go down to four yep let's see who's gonna die next so still four players left let's see if we can kill some more people oh I got killed a case there's 30 seconds left three players remaining nobody has spawned in the ground yet which is good and let's see who's going to win out of last three okay so there's two left and the winner is Magic Man 12 so there we go we've got some more people in the game now so let's go and see if it handles well with some more people wait for the game to start so six players left I just came to one for now so one two three four yep and I'm gonna go and kill groovy over here so we've got three left now and hopefully I'll be able to win this one and get the epic a victory royale alright I see if we can do it can we do are we got killed okay so it's pretty good at the moment pretty good I don't see any bugs in the console either all looks good so the last thing that we're going to do we're going to go back into the stats and we're just going to do in player added character dot humanoid don't walk speed equals 16 now walk speed has a capital W and a capital s the reason we're doing this is we're just setting it to the default value because sometimes the player will freeze and I don't think I don't know if this is because of the the sword or the walk speed but I think adding this should fix it and also position positioning the spawns above the map should help as well so that is all we need to do now and I think that's the end of this part so that's the end of part three in future parts we'll be learning how to add things like game passes developer products and data saving to the game so make sure you like and subscribe to my youtube channel so you don't miss that this has been how to create a sword fighting game on roblox make sure you turn on the notification about seen em miss out when I upload a new video and this is Alvin blocks or see you in the next part