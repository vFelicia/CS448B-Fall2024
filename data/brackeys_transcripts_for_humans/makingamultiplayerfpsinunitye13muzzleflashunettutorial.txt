With timestamps:

00:00 - thanks for tuning in at brakus hello
00:04 - everyone and welcome to this video on
00:05 - making a multiplayer FPS in unity today
00:08 - we are going to be adding the first
00:09 - shooting graphics to our game so we'll
00:12 - be adding a muscle flash that will
00:13 - display at the end of the barrel of our
00:15 - gun each time we shoot and that's going
00:17 - to be a very cool looking particle
00:19 - system and we'll also be adding a hit
00:22 - effect so that we have some sparks
00:24 - bouncing off the wall and some smoke
00:26 - coming from the place that we hit
00:29 - anything so that's going to look super
00:31 - cool we are not going to be adding any
00:33 - bullet hole decals or any bullet trails
00:38 - if that's something you also want to see
00:40 - leave a comment in the description or
00:42 - visit the brac is firm to let me know
00:44 - it's not something that I'm going to add
00:46 - today because it's too much for one
00:48 - video and also I think we have a lot of
00:50 - gameplay elements that we still need to
00:53 - add so I don't want to spend too much
00:54 - time working on kind of details if you
00:57 - want so I think these two are pretty
01:00 - important the mass muscle flash and the
01:02 - hid effect because they make the gun
01:04 - feel real and it gives some visual
01:05 - feedback on the fact that you're
01:07 - actually shooting and what you were
01:08 - hitting but that's what we're going to
01:11 - be doing today again if you want to see
01:12 - more let me know so without further
01:16 - adieu let's dig right into unity and I
01:18 - pretty much haven't touched this project
01:19 - since we left it the last time where we
01:21 - created our weapon manager and that's
01:24 - something that we are going to be
01:25 - editing just a bit in this video to
01:28 - allow for syncing this stuff over the
01:30 - network so the first thing that I want
01:33 - to do is kind of make actually a muscle
01:36 - flash with a bunch of particle systems
01:40 - that we can play and stop playing
01:42 - whenever we want the muscle flash to
01:44 - begin and end and it's pretty much only
01:47 - going to be displayed or
01:50 - the particle systems are only going to
01:51 - be emitting one single frame at a time
01:54 - so we are going to set that up and as a
01:57 - base for this I'm going to go into
01:59 - standard assets and then particle
02:01 - systems again this is imported by
02:03 - right-clicking import package and then
02:05 - choosing particle systems and then going
02:08 - to go under prefabs and select the flare
02:10 - this is a super cool looking
02:12 - particle system if we just reset the
02:14 - transform here and drag it up you can
02:17 - see what it looks like and you can see
02:19 - that this smoke is also right now going
02:20 - kind of in the wrong direction but we'll
02:23 - have a look at changing this let's do
02:26 - that right now actually so this is going
02:28 - to act as the base of our muscle flash
02:31 - and the first thing I want to do is
02:33 - delete the spikes we are not going to be
02:36 - using those in our muscle flash and also
02:38 - go ahead and rotate this smoke 90
02:41 - degrees I think along negative 90 along
02:44 - the X nope maybe negative 90 along the Y
02:50 - that's not it that's this Z so let's try
02:52 - that that's K so we need to rotate it 90
02:56 - degrees along the Z there we go and so
02:59 - this should be working cool and this is
03:02 - set to 90 okay so that's Y so the that
03:07 - one needs to be zero and we need to
03:10 - change the flare here to zero there and
03:14 - now we can rotate the smoke okay so see
03:17 - route the flare zero out the smoke and
03:20 - then we should be able to do negative 90
03:23 - on the X here there we go that was why I
03:26 - was confused and let's try and bring in
03:29 - our gun graphic so we can kind of see
03:32 - what this looks like in relation to our
03:34 - gun because you often go ahead and
03:37 - create some cool-looking particles and
03:38 - then they're huge compared to what you
03:40 - need so always have some kind of a
03:42 - reference when dealing with particles so
03:45 - this is our sci-fi automatic prefab and
03:48 - let's just drag this over here let's go
03:51 - in and find an empty object here or
03:54 - create an empty object and we are going
03:56 - to call this the fire point and that's
04:00 - just going to sit right at the end of
04:02 - our barrel so let's go over here and
04:05 - drag that up and drag that in right
04:11 - there it's going to be the fire point
04:13 - and maybe just a bit out from the gun
04:15 - cool and then we can take our flare and
04:18 - let's drag that under the fire point and
04:21 - let's rename this to muscle flash
04:24 - and we have the smoke prefab there good
04:27 - so whenever we stop and simulate or
04:30 - pause this particle effect it's also
04:34 - going to do the same to the smoke that's
04:36 - the cool thing about rested or nested
04:38 - particle systems in unity so that gives
04:41 - us kind of a lot of freedom and what I
04:44 - want to do here is the one change the
04:46 - duration to one and do the same thing
04:49 - with the smoke and then I want to undo
04:52 - emission instead of having did this at a
04:55 - fixed rate I'm going to do a burst
04:58 - instead so down here on the bursts let's
05:01 - set that between 1 and 1 so you can see
05:04 - what that looks like and with the smoke
05:06 - again no rate but instead a burst
05:09 - between 1 and we should maybe do two
05:13 - here to randomize the smoke just a bit
05:15 - so you can see now it looks like a
05:17 - muscle flash we also want to of course
05:19 - reset the transform on the muscle flash
05:22 - here and again the smoke is going off in
05:25 - the wrong direction
05:26 - so let's OH
05:29 - that needed to be zero okay so that's
05:31 - perfect so now it's going straight up
05:34 - and you'll notice that's also a negative
05:37 - gradov gravity modifier on the smoke
05:40 - here so that's super cool so if you
05:42 - wanted to kind of give it a bit of
05:43 - direction you could tilt it over just a
05:46 - tad so it will shoot a bit outwards and
05:49 - then go up I think that's actually even
05:53 - better so let's do that cool so now that
05:58 - we have that set up we can maybe change
05:59 - the size of some of these elements just
06:01 - a bit so I think this flare itself here
06:04 - is a bit too large so let's do a start
06:07 - size between 0.3 and 0.6 and also the
06:12 - lifetime to 0.05 we want that to be very
06:14 - short so you can see it's only one short
06:17 - burst there and we want we don't want
06:21 - this to play on awake that's very
06:23 - important the simulation space we want
06:25 - that to be local because this is only
06:26 - displayed very quickly and therefore we
06:28 - want it to snap through the barrel
06:30 - however on our smoke we want the
06:32 - simulation space to be global or world
06:35 - so that when we move around on the smoke
06:38 - just does
06:38 - just follow the gun it will stay where
06:41 - it was created so in the simulation
06:43 - speed space need to needs to be world
06:46 - and we can go in here and maybe bump
06:50 - down the size a bit so instead of having
06:52 - this random between two curves let's
06:54 - make it random between two constants and
06:57 - let's do that between 0.5 and 1 maybe
07:01 - that's maybe a bit too small so we can
07:05 - try point seven and 0.2 that looks
07:11 - pretty cool but again we kind of need to
07:13 - see this in game I also think the life
07:15 - time is way too long so let's do one
07:17 - instead you can see it disappears much
07:20 - quicker and I think we are kind of
07:22 - getting there so this needs to be a
07:24 - subtle effect we don't want anything
07:25 - huge
07:27 - so actually 0.7 and one I think it's
07:30 - going to do and yeah I think that was
07:34 - all the settings I wanted to change
07:36 - maybe let's make this just a bit more
07:38 - transparent so that's going to the start
07:40 - color and just make that a bit more
07:43 - opaque cool so I think this is a really
07:46 - good base to work off and let's just go
07:49 - ahead and hit apply on this prefab so
07:51 - the next thing I want to do is actually
07:53 - implement this muscle flash in game so
07:57 - to do that let's add a new component and
07:59 - this is going to call be called weapon
08:01 - graphics and it's going to sit on our
08:04 - sci-fi automatic graphics so simply
08:07 - going to sit on the well the weapon
08:09 - graphics and the cool thing here is we
08:11 - can have a script that is separate from
08:14 - everything else that stores references
08:17 - to prefabs for graphics we want to spawn
08:19 - in so that we can have different hid
08:21 - effects and different muscle flashes for
08:23 - different weapons and it can also store
08:26 - local references in the hierarchy over
08:29 - here to stuff like the muscle flash
08:31 - which we want to enable and disable so
08:33 - it's much better than searching through
08:35 - the weapon to find something this way we
08:37 - can position things on the object and
08:40 - this object and this component here will
08:42 - know what is going on so in here we
08:46 - simply want for now just two variables
08:49 - we want a public particle
08:52 - system and this is going to be the
08:55 - muscle flash and we also want a public
08:59 - and this is going to be a game object
09:03 - and that's going to be our hit effect or
09:07 - impact effect of whatever you want to
09:09 - call it and it's going to be a prefab so
09:12 - we are going to put that in there and we
09:14 - haven't created this yet that's for
09:16 - later use and that's pretty much all I
09:17 - want to do here it just makes sense to
09:19 - group it this way so let's head back
09:21 - into unity and see these two variables
09:23 - appear and let's just fill out the
09:27 - muscle flash when we are still on that
09:29 - so let's do that and hit apply and now
09:33 - we can actually go ahead and delete this
09:34 - weapon from the scene we are not going
09:37 - to be needing it right now next up let's
09:41 - open our weapon manager in Visual Studio
09:43 - so you can see I have it here and you
09:46 - can see that we currently have a
09:47 - reference to our current weapon that's
09:49 - something that we keep track of what is
09:52 - the current weapon we have equipped well
09:56 - I kind of want to do the same but with
09:58 - for the weapon graphics so we can very
10:00 - easily access the graph the graphical
10:04 - elements of our weapon and I'm also
10:07 - going to be creating this getter just
10:10 - like we can get the current weapon which
10:13 - we are utilizing in our shoot script we
10:15 - also want to be able to get the current
10:16 - graphics so let's just keep track of
10:18 - that in here and in order to do that
10:21 - let's go in and say our private weapon
10:28 - graphics current graphics and then we
10:33 - want a getter here so we want to make a
10:37 - public weapon graphics get current
10:42 - graphics or weapon graphics whatever you
10:45 - want to do and that's going to return
10:46 - the current graphics and under the
10:50 - equipped weapon this is where we want to
10:52 - store this reference so you can see here
10:55 - that we set up a weapon instance and we
10:58 - set the current weapon up here well
11:00 - after having creating having created
11:03 - this instance we want to look for
11:06 - the weapon graphics component on that
11:08 - instance so we'll go on weapon or
11:11 - current graphics equals skate component
11:15 - of type weapon graphics and we want to
11:20 - get this component from the weapon
11:22 - instance here so we spawn in a some
11:25 - weapon graphics respond in a weapon and
11:28 - we search on that weapon for the
11:30 - component weapon graphics and we put
11:32 - that into our current graphics that's
11:35 - all we are doing here and because we
11:36 - have no assurance that the weapon we are
11:40 - using actually has this component we
11:42 - should do a check here in case we forgot
11:44 - to add it so let's check if current
11:46 - graphics is equal to null well then we
11:49 - want to freak out then we want to debug
11:51 - that log error no weapon graphics
11:56 - component on the weapon object now we go
12:03 - and we could also print out the name of
12:05 - the weapon which we are going to do so
12:09 - plus weapon ins dot name there we go so
12:16 - that's just good practice to do it this
12:19 - way the next thing is if you notice down
12:22 - here we check if we are the local player
12:25 - and if we are well then we want to
12:29 - change the layer of our weapon we also
12:32 - want to do this with our muscle flash
12:35 - and I'm going to show you why so if we
12:37 - just go into our prefabs here and find
12:40 - this sci-fi automatic and bring it in
12:43 - here and let's just make the muscle
12:45 - flash here play on awake let's just do
12:49 - that and again it's set to loop here so
12:51 - this is what we should be seeing as soon
12:53 - as we spawn it in let's just try this
12:55 - for a second and let's disable that gun
12:58 - what we will see now when we hit play
13:00 - and we go in on the land host is that
13:03 - the particle system is playing just fine
13:07 - but it's not aligned with our gun and
13:10 - that's kind of weird behavior you might
13:12 - think because if we go into the scene
13:15 - it's right there it's completely aligned
13:18 - with the gun it's actually looking
13:19 - really really great and the reason why
13:22 - is because we are setting our weapon to
13:24 - be rendered using a different camera
13:27 - remember that's what we set up the last
13:29 - time we have the normal camera which
13:30 - renders everything else and we have the
13:32 - weapon camber camera which renders the
13:35 - weapon and this is positioned positioned
13:37 - differently this precision for the out
13:40 - and it also has a different field of
13:43 - view than the normal camera and this
13:45 - allows us to control how the weapon
13:48 - looks in here but that means that if we
13:51 - are drawing the muzzle flash with the
13:53 - other camera they are going to be
13:55 - unaligned so we need to make sure that
13:59 - when we spawn this sci-fi automatic gun
14:02 - in that the lair it's assigned to is
14:05 - weapon and that all of the children of
14:09 - that object Slayer is also weapon and
14:13 - currently they are not you can see that
14:17 - only the root object only the parent
14:21 - game object has the lair weapon assigned
14:24 - all of the others are just set to
14:26 - default so that means we need to loop
14:28 - through all of the children and all of
14:30 - the children's children to make sure to
14:32 - set the lair correctly and we've
14:34 - actually done this before remember in an
14:36 - earlier video we created a recursive
14:39 - method to do this so I thought that
14:42 - since we are using these recursive
14:44 - methods more often that I thought we
14:46 - would and since it's also a good idea to
14:48 - kind of group together reusable code
14:51 - that we should go ahead and create a new
14:53 - c javascript called util which is short
14:56 - for utility and in here we'll have
14:58 - different very general methods that are
15:01 - not part of any particular function in
15:03 - the game but just have some useful
15:06 - generic methods for doing stuff like
15:09 - setting the lair of all game objects in
15:12 - a hierarchy so let's do that
15:15 - let's do exactly that so we have this
15:16 - public class util and it's not going to
15:19 - be a mono behavior but it is going to be
15:22 - using unity engine and what we are going
15:25 - to do here is we are going to make a
15:27 - public static void called set
15:32 - here recursively here so we'll change it
15:37 - on all objects and it's called a
15:41 - recursive method because it's self
15:43 - referring and therefore it will range
15:45 - out to process all different things
15:49 - so let's first off taking a game object
15:52 - and this is going to be the object we
15:54 - want to change the layer off and we're
15:59 - also going to have a integer which is
16:02 - going to be the new layer index so
16:04 - that's going to be our new layer and the
16:06 - first thing that we want to do is
16:07 - because this is a very general method we
16:10 - want to make sure that obj is not equal
16:12 - to null so if that is we want to simply
16:14 - return if it's not equal to null well
16:19 - then we want to set obj dot layer equal
16:23 - to the new layer it's that simple so now
16:26 - we've changed it for the current object
16:28 - then we want to loop through all of the
16:30 - children to this object so we want to
16:33 - say for each transform child and let's
16:38 - do an underscore child here child in obj
16:43 - dot transform so this is going to go
16:48 - through all of the different different
16:49 - transform all of the different children
16:51 - in the object and for each of those we
16:56 - want to check if underscore child is
17:00 - equal to null again we want to make sure
17:01 - that we don't get any null references if
17:03 - it is we want to simply continue to the
17:06 - next child that will skip this iteration
17:08 - if it's not meaning if we've actually
17:10 - found a child here we want to set layer
17:13 - recursively and put in child dot game
17:17 - object and put in the new layer so what
17:21 - we're doing here is we're looping
17:22 - through all of the children and we are
17:23 - calling the same method we're calling
17:25 - this method again so that will jump up
17:27 - here now the object is going to be the
17:29 - child of the previous object and it's
17:31 - going to be the same layer we're going
17:33 - to set the layer of that child and we're
17:35 - going to loop through all of the
17:36 - children of that child and that means
17:39 - that it will go through and keep on
17:41 - doing this to all children of children
17:43 - of children of children however many of
17:46 - them
17:46 - might be have been set to this layer so
17:49 - that is the super cool thing about this
17:51 - recursive method so now if we go ahead
17:54 - and find our weapon manager here instead
17:59 - of calling weapon ins or setting weapon
18:02 - in stud lair we want to now call util
18:04 - dot set lair recursively and you can see
18:07 - I can just do this without a reference
18:09 - because I marked it as static and we can
18:11 - set the game object we want to change is
18:14 - changes weapon ins and the lair is going
18:18 - to be a layer mask dot name to layer and
18:22 - the name of the lair was something like
18:25 - weapon layer name there we go so that's
18:27 - just a variable we have up here so that
18:30 - should set all of the objects and when
18:32 - we now go ahead and hit play and
18:33 - hopefully we get no compiler errors
18:35 - looks like we don't you can see that the
18:38 - game object or the muscle flash is now
18:40 - correctly aligned with our game object
18:42 - you can see just how cool that actually
18:45 - look good so now that we have that set
18:50 - up we can go ahead and delete this
18:51 - sci-fi automatic we're not going to be
18:53 - using that or actually that's setting me
18:56 - let's just turn off looping and let's
18:59 - turn off play on awake and also turn off
19:01 - looping on this and make sure playing
19:04 - awake is also turned off there let's set
19:06 - apply that and now we can go ahead and
19:08 - delete that we'll bring it in later so
19:11 - we can go on to our weapon manager and
19:13 - just make sure everything here looks
19:15 - good which it does and then we can go
19:18 - into our weapon shoot script and I
19:21 - actually want to change a player shoot
19:24 - script quite a bit because currently in
19:28 - our code in our update method here we
19:32 - are simply checking for input and if we
19:33 - get some input put we're shooting but
19:37 - what I want to do in here is I want to
19:39 - differentiate between what happens if we
19:42 - our local player and if we are not a
19:44 - local player more specifically more
19:47 - specifically if we our local player I
19:50 - want to come I want to call a command
19:53 - that will then call a method that is
19:57 - handled on all players shoot scripts
20:00 - or on the player shoot scripts of this
20:03 - game object but on all clients that will
20:06 - then display this muscle flash but in
20:10 - order to do this I need the player shoot
20:12 - script of this game object to be enabled
20:14 - on all clients and currently we are only
20:18 - enabling this player shoot script on the
20:21 - local player and we are doing that using
20:23 - the player setup remember we added it up
20:26 - here if we're going to play a setup we
20:29 - have the player shoot script right here
20:31 - as one of the components to disable so
20:33 - that's one I want to delete to lead that
20:36 - array element just right-click it delete
20:39 - the array element right click it again
20:40 - and it will remove it from the list here
20:43 - and then I want to go down into the
20:45 - player shoot and add in some
20:47 - conditioners myself so the start method
20:50 - we want this to be done no matter if we
20:52 - have the local player or not that
20:53 - doesn't matter in our update method we
20:57 - want to set the current weapon again
20:59 - that doesn't matter we want that to be
21:00 - done for all and then we are calling
21:03 - these different different shoot methods
21:05 - and if we go and look at the shoot
21:07 - method and this is again going to be
21:10 - called for all clients we are actually
21:14 - doing some ray casting here and this is
21:17 - something I want to only do if we are
21:20 - the local player so I can add in an if
21:22 - statement here saying if we are not the
21:25 - local players so exclamation mark is
21:28 - local player but then we want to return
21:30 - now we don't want to do all of this down
21:34 - here but if we are then we want to do
21:37 - the actual shooting this allows us to
21:40 - add some stuff to this object so which
21:46 - will be called for all others that are
21:49 - not the local player so let me give you
21:52 - an example here basically what I want to
21:54 - do is I want to create a command again
21:57 - remember a command is a function that is
21:58 - executed only on the server so let's
22:02 - make a command here and this is going to
22:05 - be a void it's going to say CMD on a
22:10 - shoot and this is going to be called
22:13 - every
22:13 - time we shoot no matter if we hit matter
22:16 - if we hit something or not this function
22:19 - is going to be cold and we are of course
22:21 - going to be doing that here and again I
22:24 - want to this to be below this if
22:27 - statement because we only want to call
22:30 - this command from one place and that is
22:33 - if we are the local player this way on
22:35 - the local player will will be in charge
22:37 - of when he shoots not all of the other
22:40 - clients that's a much much better way so
22:42 - we'll do that and yeah so if we are the
22:48 - local player we want to call the command
22:49 - on shoot and then in here we can put
22:53 - some functionality for what we want to
22:55 - happen when we shoot such as calling a
22:58 - method on all clients that will display
23:01 - a muscle flash so let's do that
23:03 - so remember when we want to call a
23:05 - method on all of the different clients
23:07 - we use what is called a client RPC so
23:11 - when we mic this it means we can go from
23:14 - the server to all clients so we put in a
23:19 - void here and this is going to be called
23:21 - RPC do a muscle flash or do shoot effect
23:30 - here and we don't want this to take in
23:32 - any more arguments and this here can
23:34 - refer to different stuff up here you can
23:36 - refer to variables so what we want to do
23:39 - here is we want to change the value of
23:42 - our muscle flash so we have this command
23:45 - on shoot and we want that to call the
23:47 - RPC to shoot effect and I think it's
23:50 - time to come in some of this out so we
23:54 - are shooting come a call beyond shoot
24:00 - method on the server this here is called
24:07 - on the server when a player shoots it's
24:16 - called on all clients um um
24:24 - it's called on all clients when we need
24:28 - to do a shoot effect and yeah that
24:35 - should be good
24:38 - let me think your for a moment good so
24:42 - the first thing that we could sort of do
24:43 - here is just try and enable our muscle
24:46 - flash just to see if this is going
24:48 - through and in order to do that we need
24:51 - a reference to that muscle flash and
24:53 - again we have that reference in the
24:55 - weapon graphics and we have a reference
24:57 - in the weapon graphics in the weapon
24:59 - manager so if we just go into our player
25:02 - shoot just as we are getting the current
25:05 - weapon by calling current weapon equals
25:08 - weapon manager to get current weapon
25:10 - every frame we can do the same with the
25:12 - graphics so in here will simply say let
25:16 - somebody have a private actually instead
25:20 - of doing that every frame here let's
25:23 - just down here say current or let's say
25:29 - weapon manager dot get current graphics
25:34 - dot muscle flash dot play that is going
25:39 - to play the particle system muscle flash
25:43 - that we have set up so this is kind of a
25:46 - long and maybe T to some way to do it
25:50 - but it's going to get the job done and
25:52 - it's going to work just fine so let's
25:54 - try this out now it should happen that
25:56 - when we shoot the massive flash gets
25:59 - enabled it's not going to get disabled
26:01 - again but it is going to play so let's
26:04 - try to play here and let's select land
26:07 - host let's try and click and again it
26:10 - does get enabled and you can actually
26:12 - see that it hmm it's actually working
26:17 - just fine I did think that I was going
26:20 - to go ahead and we're going to need to
26:22 - disable it but since the particle system
26:25 - only emits and bursts that's actually
26:28 - not something we want so that's awesome
26:30 - I thought that we would have to go in
26:32 - here and create an enumerator and that
26:36 - we call from here a curve
26:38 - team that would play the particle system
26:40 - then wait a frame you'll return zero and
26:45 - then stop the particle system but since
26:47 - the particle system is so short unity
26:51 - does it for us of K so unit is awesome
26:53 - as always let's just stick with this and
26:56 - again if if it becomes a problem we'll
26:58 - do what I talked about groups are
27:00 - accidentally swap testers they're good
27:04 - so now that we have that done what we
27:07 - can do is just see if this works on the
27:11 - network so let's test this out so let's
27:13 - hop into unity let's build this player
27:17 - here semi control-v or command-v if
27:20 - you're on the Mac let's see if this
27:22 - works I'll just drag this over here and
27:24 - wait wait for unity to build the lining
27:26 - there we go
27:28 - hit play let's join here as in host and
27:31 - let's join here as a client and you can
27:36 - see here that when I press this it's
27:39 - indeed networked and also make sure that
27:41 - when you are pressing or when you're
27:45 - firing here that the other player
27:46 - doesn't fire it doesn't look like it and
27:49 - you're not going to be able to see that
27:51 - this but I'll drag the other one over to
27:54 - the other screen and just make sure that
27:56 - this is working and indeed it is so just
27:59 - take my word for that and that's awesome
28:02 - so next up let's do some bullet impact
28:06 - effects and those look so cool when
28:10 - they're implemented properly so what
28:13 - we're going to be doing is actually
28:15 - really simple most of the scripting for
28:17 - this tutorial is actually over but we
28:20 - are going to be creating the particles
28:21 - first so that's going to standard assets
28:23 - particle system script or on prefabs and
28:27 - find the flare I think this is a great
28:30 - actually base for a impact effect as
28:34 - well especially with the awesome spikes
28:37 - here they are going to look super cool
28:39 - in the game so again let's reset this
28:42 - transform drag it up let's take the
28:46 - smoke now and if we just think about
28:50 - this for a second
28:51 - so first off we want this to be again
28:55 - emitted in a very short burst so let's
28:57 - keep looping on for now because we want
29:00 - to see what this burst looks like but
29:03 - let's change the duration to one and do
29:06 - the same here and the same here and then
29:09 - we can go under a flare here and let's
29:11 - rename this to hit particles or heat
29:16 - effect on whatever let's go into
29:18 - emission and change the rate from zero
29:20 - to burst between 1 and 1 that looks good
29:26 - let's take this smoke here and again go
29:29 - to mission zero let's change the burst
29:32 - here to be between 1 and 3 maybe let's
29:38 - take the sparks go to mission zero and
29:41 - let's make those go between zero and
29:45 - four maybe something like that looks
29:50 - pretty cool and what we can then do is
29:54 - maybe drag this over to a wall just so
29:55 - we can see what it looks like if it's on
29:58 - a cube and there we go
30:01 - strength and oops we only drug the
30:05 - sparks there I want to take the entire
30:08 - particle effect and drag over and see
30:12 - what's what this looks like so it's kind
30:17 - of hard to send you in on right now so
30:21 - the first thing I kind of want to figure
30:23 - out here is how this is oriented so okay
30:29 - this is being weird let's just reset the
30:31 - transform and zoom in on the effect
30:34 - there we go
30:35 - and let's just see we hit say we hit the
30:38 - floor here well in that case I want this
30:40 - Z here to be pointing upward so I'm
30:43 - going to rotate negative 90 negative 90
30:47 - Oh negative behind Lee on the X and then
30:53 - we want our smoke to go upwards so we'll
30:56 - take our smoke here and let's zero that
30:59 - there we go
31:00 - so we hit down in the smoke go goes up
31:04 - and if we take a look at that that looks
31:06 - just fine the next up we'll find our
31:13 - sparks and again we want to zero that
31:16 - out and they are currently being emitted
31:18 - if we go and open up shape here in a
31:21 - sphere instead I want those to be
31:23 - emitted in a hemisphere which is a half
31:26 - sphere so they will not jump in towards
31:28 - the wall they will only jump outwards
31:30 - and that looks very cool actually let's
31:34 - also take the smoke and make that a bit
31:36 - smaller and change the lifetime so let's
31:38 - set a lifetime of maybe two seconds
31:42 - that's more than plenty let's do one I
31:46 - think one is a bit more manageable it
31:49 - really depends on the size of the gun
31:51 - that you want the effect to cover this
31:54 - box the lifetime here is going to be two
31:56 - that's fine and for the hit particles
31:59 - the lifetime should be very short so
32:02 - point zero five the start size of those
32:06 - I think 0.4 and 0.8 maybe we want the
32:11 - start size of the smoke to be some again
32:15 - random between two constants and we want
32:18 - that to be between let's see one and two
32:23 - point five or maybe one and two that
32:28 - looks super cool and I think actually
32:30 - this size of the sparks are pretty good
32:33 - we could maybe do point zero two there
32:38 - yeah like that quite a lot so I'm very
32:41 - subtle but a cool looking effect what I
32:44 - will also do let's go ahead and actually
32:47 - create an empty game object which we
32:50 - will reset the transform of and we'll
32:53 - call this one hit particles and then
32:56 - we'll call this one let's just do flare
33:00 - and we'll take all of these put them on
33:02 - the hit particles we'll take those and
33:04 - drag out here and reset the prefab
33:08 - instance that's just fine and then we
33:10 - can find the prefab here and delete uh
33:15 - all right not delete anything let's just
33:18 - find the pre
33:18 - and let's take the hit particles and
33:21 - drag in here so that we have this object
33:25 - with three different particles in it and
33:28 - this way we can take our flare here
33:30 - which is too large I think it should be
33:33 - point two and point four instead maybe
33:37 - something like that we can take that and
33:39 - we can drag it out a bit and that will
33:41 - make sure that it doesn't clip through
33:44 - the ground you can see if I drag it down
33:46 - here you can see it's current it does
33:49 - this ugly clipping on the ground if we
33:51 - just drag it out just a bit something
33:53 - like this it's going to look a lot
33:56 - better and no one will really notice so
33:58 - that's going to make the effect a lot
34:01 - cooler and let's just I think we should
34:04 - just try this out so let's it apply on
34:06 - those hit particles and let's save that
34:08 - and let's then find our our prefabs
34:13 - sci-fi automatic and drag in the hit
34:16 - particles under the hit effect prefab
34:19 - and that is good and then we need to
34:22 - spawn it in through code so let's open
34:24 - visual studio and just as we called the
34:27 - command on shoot we also want to have a
34:29 - command on hit so let's just go ahead
34:32 - and make that and we can just have that
34:35 - down here we're going to have a command
34:38 - void CMD on hit and this is going to
34:43 - take in some parameters for first off a
34:46 - victor 3 for the hit position and then a
34:48 - vector 3 for the normal of the surface
34:52 - that we hit and again a normal is a
34:55 - vector 3 that points straight out from
34:59 - the surface so it's orthogonal on the
35:02 - surface meaning that there is a 90
35:03 - degree angle between the vector that
35:06 - points out from the surface and the
35:08 - surface itself so yeah
35:10 - and then we want to call of course an
35:15 - RPC so let's just duplicate this RPC
35:17 - right here and this one is going to be
35:19 - called RPC do hit effect or impact
35:23 - effect or whatever you want to do and
35:26 - what we want to do in here we'll figure
35:28 - out in a second and this is also going
35:30 - to take in a vector
35:32 - three position and a vector3 normal cool
35:38 - and inside of our command on hit will
35:42 - simply call our pea seed do hit effect
35:45 - with the position and the normal data
35:48 - there we go and then down here we only
35:53 - want this to be called if we hit
35:55 - something and that is within this if
35:57 - statement so if this raycast returns
36:00 - true we've hit something and and if that
36:04 - is true we want to call command on hit
36:06 - and we want to enter in hit dot point
36:10 - the point that our raycast hit and hit
36:14 - dot normal it will simply return the
36:16 - normal coordinate of that only normal
36:20 - vector of that surface so good it will
36:24 - call that and we can just come this out
36:28 - we hit something call the on hit method
36:36 - on the server and here it's called
36:47 - on the server when when we hit something
36:54 - takes in the hit point and the normal of
37:02 - the surface cool and here is called on
37:10 - all clients here we can spawn in cool
37:18 - effects good so and that's it that's
37:23 - exactly what we are going to do we are
37:25 - going to instantiate and then we are
37:28 - going to do weapon weapon manager dot
37:31 - get current graphics dot um hit
37:42 - effect prefab there we go and we wanted
37:45 - to be instantiated at position and the
37:48 - rotation is going to be quaternion dot
37:51 - look rotation and then that takes in the
37:55 - vector so this will transform a
37:58 - direction to look in into a quantonium
38:02 - which is what unity uses for rotation so
38:04 - that will take in the normal surface and
38:07 - that will make sure that our our effects
38:11 - are spawned looking directly out from
38:13 - the surface so let's say we hit our cube
38:16 - here right on the wall it's not going to
38:19 - be looking that way or along the wall
38:22 - it's going to be looking straight out in
38:25 - an arrow so that's going to look super
38:27 - cool good so now that we have that set
38:30 - up and we instantiate any instantiating
38:33 - it in let's also just store a quick
38:36 - reference to the instantiated object so
38:39 - that we can delete it after let's say a
38:40 - second so we don't clutter up a scene
38:43 - with unnecessary object so let's store a
38:48 - hit effect reference and we want that to
38:54 - be a game object so we also need to cast
38:55 - it and then down here we simply say
38:58 - destroy hit effect and we want to
39:03 - destroy that after two seconds this way
39:05 - we get the effect plenty of time to play
39:09 - to finish so that looks super cool and I
39:12 - think this should be working now keep in
39:14 - mind that you are spending quite a lot
39:16 - of resources on instantiated in a hit
39:19 - effect especially if you have some kind
39:21 - of machine gun and a lot of people are
39:22 - shooting at the same time if that starts
39:26 - to bother you performance-wise
39:28 - you should look into object pooling
39:31 - there are plenty of good tutorials on
39:33 - this on the Internet I might do one
39:34 - myself at some point but you should
39:36 - definitely be covered it's a more
39:38 - effective way to kind of spawn in
39:40 - objects so you should check that out
39:43 - again object pooling like swimming pool
39:46 - good so now that we have that let's save
39:50 - that close that and first off try this
39:53 - off local
39:55 - and we can see that it's working but
39:58 - it's also the effects are also looping
40:02 - and I actually don't think they're
40:04 - oriented correctly oh I might be wrong
40:07 - about that actually let's just try and
40:11 - hit something here and pass that let's
40:15 - find our hit particles here and there I
40:17 - actually oriented correctly it looks
40:19 - like no they are not these sparks here
40:25 - should be pointing outwits the smoke
40:28 - should be pointing outwards and the
40:29 - flare yeah now it's correct about that
40:32 - okay so let's go ahead and find our
40:34 - prefab here and fix those box so let's
40:36 - find our hit particles so when this hit
40:41 - particles this hit particle here is
40:44 - pointing upwards meaning it has a
40:47 - negative X well then we want our flyer
40:50 - to reset there so that should be
40:53 - pointing upwards we want this to be
40:55 - reset so that should be pointing upwards
40:57 - and we want our sparks to be reset so
40:59 - though those are pointing outputs and
41:01 - also we need to make sure that we
41:04 - disable looping play on awake should be
41:06 - true though we also want to disable
41:08 - looping here and we can just make the
41:11 - assimilation space local because the
41:13 - it's not going to be moving at any time
41:16 - so let's just spare yourself the
41:18 - calculations and let's apply that delete
41:21 - that and let's just try this again it
41:23 - should look a lot better there we go
41:26 - so this looks super cool just a very
41:29 - tiny impact effect with a lot of Sparks
41:33 - and some smoke and I think that looks
41:35 - really cool you will also see in a
41:37 - moment when we test this out on the
41:40 - multiplayer that it also works when we
41:42 - are hitting pots or each other or the
41:45 - players so let's try and build this and
41:49 - wait for it to build here and I'm going
41:52 - to it's going to open up here and let's
41:54 - wait for unity to calculate the lining
41:57 - once again there we go let's just say
42:00 - that and let's try and hit play here
42:02 - bring this over
42:04 - let's select land host on this one and
42:06 - land client on this one
42:08 - and you can see here that others other
42:11 - players can see this impact effect as
42:15 - well so it's synced over the net we're
42:17 - going to can see because of my lack of
42:20 - network ping here or a delay that it's
42:25 - actually going really quickly it's very
42:28 - responsive and we can also shoot each
42:30 - other and that actually looks super cool
42:32 - so look here can shoot each other in the
42:36 - face so and now I can't because this guy
42:41 - is responding and you can see there he
42:42 - became responsive again so that just
42:45 - looks super awesome and I think you
42:47 - should go ahead and have a lot of fun
42:48 - with that also if you are having
42:51 - performance issues and you've tried out
42:53 - object pooling these dynamic spikes
42:56 - which jump off everything in the
42:58 - environment those are kind of taxing
43:01 - they require a lot of physics
43:02 - calculation so maybe spawn few of those
43:04 - in or maybe make them non bouncy meaning
43:08 - that they shouldn't collide with the
43:09 - environment so that was basically all I
43:12 - wanted to show you for this video I hope
43:14 - you enjoyed it and I'll see you in the
43:16 - next one

Cleaned transcript:

thanks for tuning in at brakus hello everyone and welcome to this video on making a multiplayer FPS in unity today we are going to be adding the first shooting graphics to our game so we'll be adding a muscle flash that will display at the end of the barrel of our gun each time we shoot and that's going to be a very cool looking particle system and we'll also be adding a hit effect so that we have some sparks bouncing off the wall and some smoke coming from the place that we hit anything so that's going to look super cool we are not going to be adding any bullet hole decals or any bullet trails if that's something you also want to see leave a comment in the description or visit the brac is firm to let me know it's not something that I'm going to add today because it's too much for one video and also I think we have a lot of gameplay elements that we still need to add so I don't want to spend too much time working on kind of details if you want so I think these two are pretty important the mass muscle flash and the hid effect because they make the gun feel real and it gives some visual feedback on the fact that you're actually shooting and what you were hitting but that's what we're going to be doing today again if you want to see more let me know so without further adieu let's dig right into unity and I pretty much haven't touched this project since we left it the last time where we created our weapon manager and that's something that we are going to be editing just a bit in this video to allow for syncing this stuff over the network so the first thing that I want to do is kind of make actually a muscle flash with a bunch of particle systems that we can play and stop playing whenever we want the muscle flash to begin and end and it's pretty much only going to be displayed or the particle systems are only going to be emitting one single frame at a time so we are going to set that up and as a base for this I'm going to go into standard assets and then particle systems again this is imported by rightclicking import package and then choosing particle systems and then going to go under prefabs and select the flare this is a super cool looking particle system if we just reset the transform here and drag it up you can see what it looks like and you can see that this smoke is also right now going kind of in the wrong direction but we'll have a look at changing this let's do that right now actually so this is going to act as the base of our muscle flash and the first thing I want to do is delete the spikes we are not going to be using those in our muscle flash and also go ahead and rotate this smoke 90 degrees I think along negative 90 along the X nope maybe negative 90 along the Y that's not it that's this Z so let's try that that's K so we need to rotate it 90 degrees along the Z there we go and so this should be working cool and this is set to 90 okay so that's Y so the that one needs to be zero and we need to change the flare here to zero there and now we can rotate the smoke okay so see route the flare zero out the smoke and then we should be able to do negative 90 on the X here there we go that was why I was confused and let's try and bring in our gun graphic so we can kind of see what this looks like in relation to our gun because you often go ahead and create some coollooking particles and then they're huge compared to what you need so always have some kind of a reference when dealing with particles so this is our scifi automatic prefab and let's just drag this over here let's go in and find an empty object here or create an empty object and we are going to call this the fire point and that's just going to sit right at the end of our barrel so let's go over here and drag that up and drag that in right there it's going to be the fire point and maybe just a bit out from the gun cool and then we can take our flare and let's drag that under the fire point and let's rename this to muscle flash and we have the smoke prefab there good so whenever we stop and simulate or pause this particle effect it's also going to do the same to the smoke that's the cool thing about rested or nested particle systems in unity so that gives us kind of a lot of freedom and what I want to do here is the one change the duration to one and do the same thing with the smoke and then I want to undo emission instead of having did this at a fixed rate I'm going to do a burst instead so down here on the bursts let's set that between 1 and 1 so you can see what that looks like and with the smoke again no rate but instead a burst between 1 and we should maybe do two here to randomize the smoke just a bit so you can see now it looks like a muscle flash we also want to of course reset the transform on the muscle flash here and again the smoke is going off in the wrong direction so let's OH that needed to be zero okay so that's perfect so now it's going straight up and you'll notice that's also a negative gradov gravity modifier on the smoke here so that's super cool so if you wanted to kind of give it a bit of direction you could tilt it over just a tad so it will shoot a bit outwards and then go up I think that's actually even better so let's do that cool so now that we have that set up we can maybe change the size of some of these elements just a bit so I think this flare itself here is a bit too large so let's do a start size between 0.3 and 0.6 and also the lifetime to 0.05 we want that to be very short so you can see it's only one short burst there and we want we don't want this to play on awake that's very important the simulation space we want that to be local because this is only displayed very quickly and therefore we want it to snap through the barrel however on our smoke we want the simulation space to be global or world so that when we move around on the smoke just does just follow the gun it will stay where it was created so in the simulation speed space need to needs to be world and we can go in here and maybe bump down the size a bit so instead of having this random between two curves let's make it random between two constants and let's do that between 0.5 and 1 maybe that's maybe a bit too small so we can try point seven and 0.2 that looks pretty cool but again we kind of need to see this in game I also think the life time is way too long so let's do one instead you can see it disappears much quicker and I think we are kind of getting there so this needs to be a subtle effect we don't want anything huge so actually 0.7 and one I think it's going to do and yeah I think that was all the settings I wanted to change maybe let's make this just a bit more transparent so that's going to the start color and just make that a bit more opaque cool so I think this is a really good base to work off and let's just go ahead and hit apply on this prefab so the next thing I want to do is actually implement this muscle flash in game so to do that let's add a new component and this is going to call be called weapon graphics and it's going to sit on our scifi automatic graphics so simply going to sit on the well the weapon graphics and the cool thing here is we can have a script that is separate from everything else that stores references to prefabs for graphics we want to spawn in so that we can have different hid effects and different muscle flashes for different weapons and it can also store local references in the hierarchy over here to stuff like the muscle flash which we want to enable and disable so it's much better than searching through the weapon to find something this way we can position things on the object and this object and this component here will know what is going on so in here we simply want for now just two variables we want a public particle system and this is going to be the muscle flash and we also want a public and this is going to be a game object and that's going to be our hit effect or impact effect of whatever you want to call it and it's going to be a prefab so we are going to put that in there and we haven't created this yet that's for later use and that's pretty much all I want to do here it just makes sense to group it this way so let's head back into unity and see these two variables appear and let's just fill out the muscle flash when we are still on that so let's do that and hit apply and now we can actually go ahead and delete this weapon from the scene we are not going to be needing it right now next up let's open our weapon manager in Visual Studio so you can see I have it here and you can see that we currently have a reference to our current weapon that's something that we keep track of what is the current weapon we have equipped well I kind of want to do the same but with for the weapon graphics so we can very easily access the graph the graphical elements of our weapon and I'm also going to be creating this getter just like we can get the current weapon which we are utilizing in our shoot script we also want to be able to get the current graphics so let's just keep track of that in here and in order to do that let's go in and say our private weapon graphics current graphics and then we want a getter here so we want to make a public weapon graphics get current graphics or weapon graphics whatever you want to do and that's going to return the current graphics and under the equipped weapon this is where we want to store this reference so you can see here that we set up a weapon instance and we set the current weapon up here well after having creating having created this instance we want to look for the weapon graphics component on that instance so we'll go on weapon or current graphics equals skate component of type weapon graphics and we want to get this component from the weapon instance here so we spawn in a some weapon graphics respond in a weapon and we search on that weapon for the component weapon graphics and we put that into our current graphics that's all we are doing here and because we have no assurance that the weapon we are using actually has this component we should do a check here in case we forgot to add it so let's check if current graphics is equal to null well then we want to freak out then we want to debug that log error no weapon graphics component on the weapon object now we go and we could also print out the name of the weapon which we are going to do so plus weapon ins dot name there we go so that's just good practice to do it this way the next thing is if you notice down here we check if we are the local player and if we are well then we want to change the layer of our weapon we also want to do this with our muscle flash and I'm going to show you why so if we just go into our prefabs here and find this scifi automatic and bring it in here and let's just make the muscle flash here play on awake let's just do that and again it's set to loop here so this is what we should be seeing as soon as we spawn it in let's just try this for a second and let's disable that gun what we will see now when we hit play and we go in on the land host is that the particle system is playing just fine but it's not aligned with our gun and that's kind of weird behavior you might think because if we go into the scene it's right there it's completely aligned with the gun it's actually looking really really great and the reason why is because we are setting our weapon to be rendered using a different camera remember that's what we set up the last time we have the normal camera which renders everything else and we have the weapon camber camera which renders the weapon and this is positioned positioned differently this precision for the out and it also has a different field of view than the normal camera and this allows us to control how the weapon looks in here but that means that if we are drawing the muzzle flash with the other camera they are going to be unaligned so we need to make sure that when we spawn this scifi automatic gun in that the lair it's assigned to is weapon and that all of the children of that object Slayer is also weapon and currently they are not you can see that only the root object only the parent game object has the lair weapon assigned all of the others are just set to default so that means we need to loop through all of the children and all of the children's children to make sure to set the lair correctly and we've actually done this before remember in an earlier video we created a recursive method to do this so I thought that since we are using these recursive methods more often that I thought we would and since it's also a good idea to kind of group together reusable code that we should go ahead and create a new c javascript called util which is short for utility and in here we'll have different very general methods that are not part of any particular function in the game but just have some useful generic methods for doing stuff like setting the lair of all game objects in a hierarchy so let's do that let's do exactly that so we have this public class util and it's not going to be a mono behavior but it is going to be using unity engine and what we are going to do here is we are going to make a public static void called set here recursively here so we'll change it on all objects and it's called a recursive method because it's self referring and therefore it will range out to process all different things so let's first off taking a game object and this is going to be the object we want to change the layer off and we're also going to have a integer which is going to be the new layer index so that's going to be our new layer and the first thing that we want to do is because this is a very general method we want to make sure that obj is not equal to null so if that is we want to simply return if it's not equal to null well then we want to set obj dot layer equal to the new layer it's that simple so now we've changed it for the current object then we want to loop through all of the children to this object so we want to say for each transform child and let's do an underscore child here child in obj dot transform so this is going to go through all of the different different transform all of the different children in the object and for each of those we want to check if underscore child is equal to null again we want to make sure that we don't get any null references if it is we want to simply continue to the next child that will skip this iteration if it's not meaning if we've actually found a child here we want to set layer recursively and put in child dot game object and put in the new layer so what we're doing here is we're looping through all of the children and we are calling the same method we're calling this method again so that will jump up here now the object is going to be the child of the previous object and it's going to be the same layer we're going to set the layer of that child and we're going to loop through all of the children of that child and that means that it will go through and keep on doing this to all children of children of children of children however many of them might be have been set to this layer so that is the super cool thing about this recursive method so now if we go ahead and find our weapon manager here instead of calling weapon ins or setting weapon in stud lair we want to now call util dot set lair recursively and you can see I can just do this without a reference because I marked it as static and we can set the game object we want to change is changes weapon ins and the lair is going to be a layer mask dot name to layer and the name of the lair was something like weapon layer name there we go so that's just a variable we have up here so that should set all of the objects and when we now go ahead and hit play and hopefully we get no compiler errors looks like we don't you can see that the game object or the muscle flash is now correctly aligned with our game object you can see just how cool that actually look good so now that we have that set up we can go ahead and delete this scifi automatic we're not going to be using that or actually that's setting me let's just turn off looping and let's turn off play on awake and also turn off looping on this and make sure playing awake is also turned off there let's set apply that and now we can go ahead and delete that we'll bring it in later so we can go on to our weapon manager and just make sure everything here looks good which it does and then we can go into our weapon shoot script and I actually want to change a player shoot script quite a bit because currently in our code in our update method here we are simply checking for input and if we get some input put we're shooting but what I want to do in here is I want to differentiate between what happens if we our local player and if we are not a local player more specifically more specifically if we our local player I want to come I want to call a command that will then call a method that is handled on all players shoot scripts or on the player shoot scripts of this game object but on all clients that will then display this muscle flash but in order to do this I need the player shoot script of this game object to be enabled on all clients and currently we are only enabling this player shoot script on the local player and we are doing that using the player setup remember we added it up here if we're going to play a setup we have the player shoot script right here as one of the components to disable so that's one I want to delete to lead that array element just rightclick it delete the array element right click it again and it will remove it from the list here and then I want to go down into the player shoot and add in some conditioners myself so the start method we want this to be done no matter if we have the local player or not that doesn't matter in our update method we want to set the current weapon again that doesn't matter we want that to be done for all and then we are calling these different different shoot methods and if we go and look at the shoot method and this is again going to be called for all clients we are actually doing some ray casting here and this is something I want to only do if we are the local player so I can add in an if statement here saying if we are not the local players so exclamation mark is local player but then we want to return now we don't want to do all of this down here but if we are then we want to do the actual shooting this allows us to add some stuff to this object so which will be called for all others that are not the local player so let me give you an example here basically what I want to do is I want to create a command again remember a command is a function that is executed only on the server so let's make a command here and this is going to be a void it's going to say CMD on a shoot and this is going to be called every time we shoot no matter if we hit matter if we hit something or not this function is going to be cold and we are of course going to be doing that here and again I want to this to be below this if statement because we only want to call this command from one place and that is if we are the local player this way on the local player will will be in charge of when he shoots not all of the other clients that's a much much better way so we'll do that and yeah so if we are the local player we want to call the command on shoot and then in here we can put some functionality for what we want to happen when we shoot such as calling a method on all clients that will display a muscle flash so let's do that so remember when we want to call a method on all of the different clients we use what is called a client RPC so when we mic this it means we can go from the server to all clients so we put in a void here and this is going to be called RPC do a muscle flash or do shoot effect here and we don't want this to take in any more arguments and this here can refer to different stuff up here you can refer to variables so what we want to do here is we want to change the value of our muscle flash so we have this command on shoot and we want that to call the RPC to shoot effect and I think it's time to come in some of this out so we are shooting come a call beyond shoot method on the server this here is called on the server when a player shoots it's called on all clients um um it's called on all clients when we need to do a shoot effect and yeah that should be good let me think your for a moment good so the first thing that we could sort of do here is just try and enable our muscle flash just to see if this is going through and in order to do that we need a reference to that muscle flash and again we have that reference in the weapon graphics and we have a reference in the weapon graphics in the weapon manager so if we just go into our player shoot just as we are getting the current weapon by calling current weapon equals weapon manager to get current weapon every frame we can do the same with the graphics so in here will simply say let somebody have a private actually instead of doing that every frame here let's just down here say current or let's say weapon manager dot get current graphics dot muscle flash dot play that is going to play the particle system muscle flash that we have set up so this is kind of a long and maybe T to some way to do it but it's going to get the job done and it's going to work just fine so let's try this out now it should happen that when we shoot the massive flash gets enabled it's not going to get disabled again but it is going to play so let's try to play here and let's select land host let's try and click and again it does get enabled and you can actually see that it hmm it's actually working just fine I did think that I was going to go ahead and we're going to need to disable it but since the particle system only emits and bursts that's actually not something we want so that's awesome I thought that we would have to go in here and create an enumerator and that we call from here a curve team that would play the particle system then wait a frame you'll return zero and then stop the particle system but since the particle system is so short unity does it for us of K so unit is awesome as always let's just stick with this and again if if it becomes a problem we'll do what I talked about groups are accidentally swap testers they're good so now that we have that done what we can do is just see if this works on the network so let's test this out so let's hop into unity let's build this player here semi controlv or commandv if you're on the Mac let's see if this works I'll just drag this over here and wait wait for unity to build the lining there we go hit play let's join here as in host and let's join here as a client and you can see here that when I press this it's indeed networked and also make sure that when you are pressing or when you're firing here that the other player doesn't fire it doesn't look like it and you're not going to be able to see that this but I'll drag the other one over to the other screen and just make sure that this is working and indeed it is so just take my word for that and that's awesome so next up let's do some bullet impact effects and those look so cool when they're implemented properly so what we're going to be doing is actually really simple most of the scripting for this tutorial is actually over but we are going to be creating the particles first so that's going to standard assets particle system script or on prefabs and find the flare I think this is a great actually base for a impact effect as well especially with the awesome spikes here they are going to look super cool in the game so again let's reset this transform drag it up let's take the smoke now and if we just think about this for a second so first off we want this to be again emitted in a very short burst so let's keep looping on for now because we want to see what this burst looks like but let's change the duration to one and do the same here and the same here and then we can go under a flare here and let's rename this to hit particles or heat effect on whatever let's go into emission and change the rate from zero to burst between 1 and 1 that looks good let's take this smoke here and again go to mission zero let's change the burst here to be between 1 and 3 maybe let's take the sparks go to mission zero and let's make those go between zero and four maybe something like that looks pretty cool and what we can then do is maybe drag this over to a wall just so we can see what it looks like if it's on a cube and there we go strength and oops we only drug the sparks there I want to take the entire particle effect and drag over and see what's what this looks like so it's kind of hard to send you in on right now so the first thing I kind of want to figure out here is how this is oriented so okay this is being weird let's just reset the transform and zoom in on the effect there we go and let's just see we hit say we hit the floor here well in that case I want this Z here to be pointing upward so I'm going to rotate negative 90 negative 90 Oh negative behind Lee on the X and then we want our smoke to go upwards so we'll take our smoke here and let's zero that there we go so we hit down in the smoke go goes up and if we take a look at that that looks just fine the next up we'll find our sparks and again we want to zero that out and they are currently being emitted if we go and open up shape here in a sphere instead I want those to be emitted in a hemisphere which is a half sphere so they will not jump in towards the wall they will only jump outwards and that looks very cool actually let's also take the smoke and make that a bit smaller and change the lifetime so let's set a lifetime of maybe two seconds that's more than plenty let's do one I think one is a bit more manageable it really depends on the size of the gun that you want the effect to cover this box the lifetime here is going to be two that's fine and for the hit particles the lifetime should be very short so point zero five the start size of those I think 0.4 and 0.8 maybe we want the start size of the smoke to be some again random between two constants and we want that to be between let's see one and two point five or maybe one and two that looks super cool and I think actually this size of the sparks are pretty good we could maybe do point zero two there yeah like that quite a lot so I'm very subtle but a cool looking effect what I will also do let's go ahead and actually create an empty game object which we will reset the transform of and we'll call this one hit particles and then we'll call this one let's just do flare and we'll take all of these put them on the hit particles we'll take those and drag out here and reset the prefab instance that's just fine and then we can find the prefab here and delete uh all right not delete anything let's just find the pre and let's take the hit particles and drag in here so that we have this object with three different particles in it and this way we can take our flare here which is too large I think it should be point two and point four instead maybe something like that we can take that and we can drag it out a bit and that will make sure that it doesn't clip through the ground you can see if I drag it down here you can see it's current it does this ugly clipping on the ground if we just drag it out just a bit something like this it's going to look a lot better and no one will really notice so that's going to make the effect a lot cooler and let's just I think we should just try this out so let's it apply on those hit particles and let's save that and let's then find our our prefabs scifi automatic and drag in the hit particles under the hit effect prefab and that is good and then we need to spawn it in through code so let's open visual studio and just as we called the command on shoot we also want to have a command on hit so let's just go ahead and make that and we can just have that down here we're going to have a command void CMD on hit and this is going to take in some parameters for first off a victor 3 for the hit position and then a vector 3 for the normal of the surface that we hit and again a normal is a vector 3 that points straight out from the surface so it's orthogonal on the surface meaning that there is a 90 degree angle between the vector that points out from the surface and the surface itself so yeah and then we want to call of course an RPC so let's just duplicate this RPC right here and this one is going to be called RPC do hit effect or impact effect or whatever you want to do and what we want to do in here we'll figure out in a second and this is also going to take in a vector three position and a vector3 normal cool and inside of our command on hit will simply call our pea seed do hit effect with the position and the normal data there we go and then down here we only want this to be called if we hit something and that is within this if statement so if this raycast returns true we've hit something and and if that is true we want to call command on hit and we want to enter in hit dot point the point that our raycast hit and hit dot normal it will simply return the normal coordinate of that only normal vector of that surface so good it will call that and we can just come this out we hit something call the on hit method on the server and here it's called on the server when when we hit something takes in the hit point and the normal of the surface cool and here is called on all clients here we can spawn in cool effects good so and that's it that's exactly what we are going to do we are going to instantiate and then we are going to do weapon weapon manager dot get current graphics dot um hit effect prefab there we go and we wanted to be instantiated at position and the rotation is going to be quaternion dot look rotation and then that takes in the vector so this will transform a direction to look in into a quantonium which is what unity uses for rotation so that will take in the normal surface and that will make sure that our our effects are spawned looking directly out from the surface so let's say we hit our cube here right on the wall it's not going to be looking that way or along the wall it's going to be looking straight out in an arrow so that's going to look super cool good so now that we have that set up and we instantiate any instantiating it in let's also just store a quick reference to the instantiated object so that we can delete it after let's say a second so we don't clutter up a scene with unnecessary object so let's store a hit effect reference and we want that to be a game object so we also need to cast it and then down here we simply say destroy hit effect and we want to destroy that after two seconds this way we get the effect plenty of time to play to finish so that looks super cool and I think this should be working now keep in mind that you are spending quite a lot of resources on instantiated in a hit effect especially if you have some kind of machine gun and a lot of people are shooting at the same time if that starts to bother you performancewise you should look into object pooling there are plenty of good tutorials on this on the Internet I might do one myself at some point but you should definitely be covered it's a more effective way to kind of spawn in objects so you should check that out again object pooling like swimming pool good so now that we have that let's save that close that and first off try this off local and we can see that it's working but it's also the effects are also looping and I actually don't think they're oriented correctly oh I might be wrong about that actually let's just try and hit something here and pass that let's find our hit particles here and there I actually oriented correctly it looks like no they are not these sparks here should be pointing outwits the smoke should be pointing outwards and the flare yeah now it's correct about that okay so let's go ahead and find our prefab here and fix those box so let's find our hit particles so when this hit particles this hit particle here is pointing upwards meaning it has a negative X well then we want our flyer to reset there so that should be pointing upwards we want this to be reset so that should be pointing upwards and we want our sparks to be reset so though those are pointing outputs and also we need to make sure that we disable looping play on awake should be true though we also want to disable looping here and we can just make the assimilation space local because the it's not going to be moving at any time so let's just spare yourself the calculations and let's apply that delete that and let's just try this again it should look a lot better there we go so this looks super cool just a very tiny impact effect with a lot of Sparks and some smoke and I think that looks really cool you will also see in a moment when we test this out on the multiplayer that it also works when we are hitting pots or each other or the players so let's try and build this and wait for it to build here and I'm going to it's going to open up here and let's wait for unity to calculate the lining once again there we go let's just say that and let's try and hit play here bring this over let's select land host on this one and land client on this one and you can see here that others other players can see this impact effect as well so it's synced over the net we're going to can see because of my lack of network ping here or a delay that it's actually going really quickly it's very responsive and we can also shoot each other and that actually looks super cool so look here can shoot each other in the face so and now I can't because this guy is responding and you can see there he became responsive again so that just looks super awesome and I think you should go ahead and have a lot of fun with that also if you are having performance issues and you've tried out object pooling these dynamic spikes which jump off everything in the environment those are kind of taxing they require a lot of physics calculation so maybe spawn few of those in or maybe make them non bouncy meaning that they shouldn't collide with the environment so that was basically all I wanted to show you for this video I hope you enjoyed it and I'll see you in the next one
