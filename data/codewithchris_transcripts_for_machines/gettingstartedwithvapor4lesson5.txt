Hey, everyone. My name is Mikayla Karen. I am a fulltime iOS developer and recently I've been learning Vapor. So I'm excited to share with you how we have finished building our Vapor API and how we can take that and actually deploy it to the real world so anybody can use it and how we can use it, use it from our iOS app. Let's get started. First thing we need to do is install Heroku. So we are going to use Homebrew like we have for Vapor. So just type brew, install Heroku and then just hit enter. Mine is already installed. But every time you try to install something new, it will try to update Homebrew if it hasn't been updated in a while. So mine is fine. And then it's telling me a warning that it's already installed and up to date and then just tells you, hey, if you want to reinstall it, that's the command you write, but we have that installed. So that's good. And second thing we need to do is make a new account. So let's do that right now. So go to sign up Heroku. Com and we're just taken to the sign up page and let's type in my name, type in your email. You don't really need a company name role. I'm a professional developer, so we'll put that I don't think it really matters. And then primary country. I'm in the United States and primary development language is I use another language because Swift sadly isn't here. So just check. I'm not a robot unless you are. Yeah, I spelled everything right. Okay. Click create free account. And now I need to go check that the address is correct and you'll get an email about that. Okay. So the email that you're going to get will just direct you to this link to actually input a password. So type in whatever password you want, make sure it meets those minimums and click set password and log in. Then we can close the other window here. Okay. It tells me my new account is all set up, so we'll just click to proceed page not found. Okay. I think it did this to me when I tried it the first time too. So if we just go to Heroku. Com. Yeah, it looks like we're good because it let me sign in. It has my name has my email and we're fine. Okay. Wants us to accept terms of service. I click accept, and then we're brought to this main page. So what we are going to do, we are going to deploy our API to Heroku and we do part of that using the GUI. So the graphical user interface. So that's just the website and then part of it we are going to do from the command line for our project here. So the first thing we are going to do, let's set up our command line what we want to do after we've installed it correctly I click command K all the time, and that's what clears the terminal. We want to type Heroku login, and what this will do. We'll press any key to open up the browser or login or queue to exit. So I'll just press the space bar and then we see it automatically opens my browser and tells me, hey, do you want to log in? So I'll just click on log in. We will do that later. We don't need that right now and it says We're good. So it says we can close this page and return back to your CLI. So CLI is command line interface if you didn't know, and that just means your terminal. And then we see right here. This is it tried to open a web browser in case it didn't work. Says logging in and done because we did it. And then we are logged in as. And then that's my email. And you can verify this with Heroku off colon, who am I? And then this stuff like here. This is like just part of a plugin that I have on my computer. So you pretty much won't see that unless you have this exact same plugin. Click Heroku off. Who am I? We just see my email come up because that's just the email that we're signed in as. Let's create our app within Heroku on the web now. So let's just click on this button here that says Create new app, or you could click from here for Create new app. But this is already here because it's the welcome page. So what do we want to call this must start with a lowercase. That's interesting. So that popped up because I have CWC automatically as like a keyboard shortcut to show like code with Chris because I type it so often, but we'll just keep it like this CWC vaporapi. I'm in the United States and then we'll just click on Create app and then this is the main page. So part of this, we won't use a pipeline for this right now. And then the deployment method. We're just going to use the Heroku get CLI and then here it gives us the instructions deploy using Heroku Git. We have done this step already. And right now here we are. We are in our project directory. So that's why it says ytvaporapi on mine. And that's also part of a plugin that I have downloaded, and it wants us to CD into our project and type get in it. But we don't need to do that because our project is already uses Git. So the only thing we need to do is actually copy this, which says Heroku, which is part of the Heroku command from what we downloaded. And then we're using Git. We're adding a remote and it's going to be called CWC vaporapi, which is what we called our entire application. So we just copy that and paste it here. We hit enter and it shows us set get remote Heroku to that link. And what that really means is we added a new remote. So if we type get remote V, I have two remotes here. So here is the origin remote that I called it. And then this is the one on GitHub where you can find all of the code. But then we added a new remote called it Heroku, and then this is the link for it. So before we deploy this application, we want to set what is called a build pack before we go and deploy it. So a build pack is really just a script that runs before the app is deployed. So what we want to do is type Heroku business. Build pack. Set Vapor Vapor because this is a vapor application. So we want everything that comes with the dependencies of vapor to install before everything is deployed. So we just type this command hit enter. Okay, after we hit enter, we can see it says Build pack is set. Next release for our app, we'll use Vapor Vapor and then run this to push the new release using this build pack. So that is the command we're going to end up using. And you can see it's just Git push Heroku main, which is the same as if you're pushing to GitHub or you would write like Origin Main or Origin feature branch. It's the exact same thing. But we do have a couple of things we need to set up first. So first we need to tell it what Swift version we want to use. So we can do that with this command of Echo five, two, one, and then this little carrot. It's a karate van sign Swiftversion. So what this will do? It will make a new file called Swift version. And inside of that file, it will just have these words five, two, one. So if we hit enter on that, you see this little lightning Bolt come up on mine because of the extension that I have. And it just means that we've changed something. So when you type get status and hit enter, you can see that we've added a new file called Swift version. I don't actually know what Cat stands for. Honestly, I'd have to look it up. But what we do here is this is just printing out the contents of this file. So when I type Cat Swift version, we just see that it's a file and the Swiftversion is five two, one. That's all it is. That's what's inside of that file itself. So we have that. But we have to add one more thing. So Heroku uses a thing called a Proc file, and it just tells the app what it needs to look for. So we write that with this command. So Echo again, and then all of this comes with it, and it's just telling it where to put the file and what Port. And then it's creating. All of this will be inside of a new file just called Proc file. So if we hit enter, it does that. And then if we type get status, we can see our two new files that we have. So we want to commit these files because they have to be there when we deploy everything. So let's type get add and that will add our two files. So if we hit enter and type get status again, we can see it changed from untracked files to changes to be committed. And let's go ahead and commit these. So we'll just type get commit M and we'll make a message at Heroku build files, and now we can go ahead and deploy it. So we will type get push. Heroku and I have not tested this. So we will see typically you'll type get push, Heroku, Master or Main because that's the main branch that you have, and you'll typically only have one branch within your not one branch within your project. But you may have one branch that you're using for deployment, so you would use that one. But because I've split everything up in lessons, I'm going to type lesson five because that's the one that's ready for us to actually deploy. And let's see how this goes because I do not know. Okay, there we go. It worked. It created a new branch called lesson five. Let's see if we look at Heroku and refresh this page. Did anything happen? It has not. Okay. Looking at the docs to actually deploy code. It does say that the branch name has to be Master or Main. Otherwise, if we push to a different branch, it really will not matter at all. So because I have this less than five branch, it kind of doesn't matter. So let me make a new branch and I will call it Main, and I'm branching from my lesson five branch, which has that new commit with our new build files. So let me type get checkout to check out the new branch. So now I have a new branch called Main and I will type get push, not origin. We're going to go to Heroku and then Main. Once I hit enter, there we go. Okay. Now it failed. Wouldn't it fail? So after some troubleshooting and then this is my testing repo where I've done everything before. It was because the Swift version file that we created needed to be 5.5. I don't actually remember changing it, but it has to be 5.5 instead of what we Typed originally, which was 5.2 .1. So then once you successfully deploy it and you have to deploy it on the main branch, so it has to be either Main or Master. It can't be what I was doing, which was I called it lesson five because that's how I broke up the whole course. So once I switched to the main branch and then changed that to version 5.5 rather than 5.2 .1 we're able to deploy and you can see what's going on in terminal right now is everything trying to deploy. So you can see over in the website. That was me troubleshooting. You can see build progress and whatever is happening here is actually the same thing that's happening in our terminal. So we can wait for this to finish. Here we go. More compiling, I'll solve Rubik's Cube while we're waiting. I'm still not doing it right. What am I missing? I forgot how to do this for a minute. Okay, we have successfully deployed everything so you can see all the build files right there. Or you can see the View build blog right here which show you the same thing that happened in the terminal. And then in the end it shows you it created a new branch called Main, and then it's been deployed. And what we have to do after doing that, we need to add a server basically so that our application can go somewhere. So we do that using Heroku Psscaleweb equals one and you'll see this appear. So once we hit enter on this and it runs, you will see this and it'll say done. So if we go back to the web interface and we refresh it, we will see something. Now we see this that we had from our Proc file, so I don't know exactly what this is, but it's needed to get everything running. So we have that and we can see we deployed. This is our commit hash. So if we were to type get log one which only shows us one in our log, the beginning of this commit hash matches what is right there. And that was my last commit was updating that version. Now it is completely deployed. So we could use postman, which let me open that up and we could then hit our API already. Everything's running, but we haven't yet set up the database. So our app is fully deployed right now. So if we go to settings, it tells us this is the name of our app. We are using Swift and that's the get URL that we have. We scroll down a little bit more. We find this too much. We find this add domains so you could configure this to use your own custom domain like codewithchris. Com. If you wanted to make the API from a domain like that, you would have to configure it. But here is our API for the built in domain. So when we use CWC vaporapi, that is the name of our application and then the subdomain is herokuapp. Com. So if we just put that directly into postman and hit send without adding any kind of route, we get back 503 service unavailable, which is not good. If we go to this in the web browser and hit this, it gives us application error. So you can see this is application error and it's telling us an error occurred. And that's how we view the logs which we'll look at. But we also see when we do this in postman. This is the HTML that came back for that web page because just basic like going to a website. You are doing a get request. So if we see down here we'll see the same thing. It's showing us whatever this web page is. And I guarantee if we command click, we'll see the exact same thing. It takes us to the same error page because here the URL is our project URL and it's showing you it's making an iframe which is just like embedding a website. And what it's embedding is this like application error website. So when we go directly to that, we see the exact same thing. So let's see what the error is. Let's type Heroku logs, tail and hit enter. What does this tell us? So you can see it gives us an ongoing log, as in it doesn't stop. So we would have to hit CTRL C to get it to stop. But let me see if I can make this bigger. So it's kind of not all one. So if we try to go to our application and hit enter, we see a new status appear and it says App crashed. So part of what is happening when we go to configure our application. So if we look at our configure code right here, it's trying to create migrations and set up our database, but we haven't done anything in Heroku to actually set that up yet. So that's part of why it's failing. I believe so we will do that the rest of that. And then we'll go back and try to see if we can hit our main routes, which we didn't take out the Hello and the root route these two. So that's what I was trying to hit first was to return it works. And then let's try to hit Hello and see if anything happens. So they still give us 503 unavailable. And then we can see in the error down here. It tells us App crashed and you can see we tried to hit the Hello route, so okay, let's set up the database and then go back and try this again. So to get out of this, we type control C and then now we're no longer live monitoring the logs. And I don't like this being gigantic. So we're going to make it smaller again. Let's go and add our database. What we want to do is go to the overview tab and installed add ons where you're going to add a new one, and we will search for Postgres because that's the type of database we want to use. So we want to do Heroku Postgres. Click on that one and we want to use the Hobby Dev one, which is free as opposed to paying a ton of money for it, because we don't need any of that right now. So we have the Hobby version and click submit order form and here we can see that it's been added. And I believe this is the command we could have Typed into the command line to do this as well rather than doing it from the website. But the website is pretty easy. So that's why I did it that way. So we have our database, and we can click this Heroku Postgres right here, which opens up a new window, and it takes us to a new part of the website that tells us about the data and the database. So this is fetching everything, and we can see we don't have any rows in our database because we just created it. So basically, it exists as a database. But we haven't added any of our tables and any of our migrations. So when we go to migrations for create songs, here's our songs table, and we haven't ran any of this yet. So what we need to do is go back here. We need to change our code because how it works right here, it doesn't actually work it's. And if we go and look at the vapor documentation, which is mostly what I'm following here. If you go to Docs Vapor codes and you click on the side, there is this whole menu and you go down to deploy and go to Heroku. You get to this page and we are way down at the bottom for Rocket have almost everything running. It's telling us to change the code to look something like this for getting our environment URL, which is the database URL. Actually, I'll keep this right here for a minute. When we are looking at this here we are getting our environment database host and database username password because these are the values it's using Vapor password and Vapor username because it could not find an environment variable because we never added any. But we still need like a URL and a database host. So like where does the database live? We have to tell our app that in some way. So what we are going to do is it's going to look for a database URL. But again, this is not a value. We want to hard code and it even tells you if we type Heroku config, it tells us how to access the database. They called their app. Today I learned ours is called CWC vaporapi. It gives us this URL to use to connect to the database. But here in the docs it tells you don't ever hard code this because Heroku rotates through these URLs because it might change because for whatever reason and because of that, we can't use a hard coded value for anything. We are going to be using a database configuration. So if we look at the Heroku app, go down to settings, reveal config VARs. So we go to database VARs and then config VARs. We can see the database URL that Heroku is storing is right here. So this is the one that it will use. We need to tell our app now to look for this value. Let's keep it on that and let's go and change the code to do this. The next step it's telling us within the docs is mostly what I'm following along with is to add the database URL and make a postcard configuration with both of these. And I tried to type this code and it does not work or did not work for me. So you can try to type this and deploy again and see if that worked. But here is the code change that really actually worked on my machine. So what we wanted to do was first check if we have that database URL. So what we are doing here is first we are going to make a URL string from this database URL in the environment variable, which will look for the environment variable we saw over here in Settings, this config variable, and then we are going to make a Postgres configuration because that's the type of database that we use. And then all of this will be in this if statement. Otherwise we'll set it up like this which is how we've done it on our local computer and everything worked. So we have our Postgres configuration, and we also need to make something called a TLS configuration. So we have made our Postgres configuration for our database, and we are going to configure the database using this database URL. And then we make a TLS configuration and let me double check that. That is right. Make client configuration. Yeah. So we make the TLS configuration and it says make client config and we set the TLS certificate verification to none. I honestly don't really know what this is. Tls is part of like the Internet. It's a I think transport layer. And then we set our Postgres config to use our TLS configuration. And then lastly, we do app databases use, which is almost exactly the same as this rather than hard coding everything, though. We are using Postgres and we are using our Postgres configuration to set everything up. And then this is just the name of our database because you can have multiple databases within an application, but we are only using one. So that's what setting up right here is doing. And lastly, we have this try auto migrate line right here because when we ran our application for the first time, we wanted the migrations to run and for the app to basically not work unless basically make the app not work until the migrations ran. But that's not what we want to do within Heroku. We want it to still run and we only want to run these, like in development, and we can write a command to run it within Heroku. So what we are going to do is change this to be we are going to change this to make an if statement. So if our app is in development mode or development environment meaning on our computer, then we want to run the migrations. Otherwise they won't run. And we are going to just run it from the command line. So we've made all these changes. Let's commit these changes. So if we type get status, if I can spell which I can't, there we go get status. We see we changed our configure method, which is correct. So I'm making a new message called Update config for database. And when I do am, that allows me to add whatever here was ever ready to be committed and write the message at the same time rather than just writing get add and then get commit. So we have committed that. Let's go and push these changes to Heroku. So we Typed get push Heroku main and this will deploy to Heroku again. So when I hit enter on that, you can see it's starting to build again. If we go to Overview, we can see what we've done here is we deployed. We created the new database, we set up the database URL, and then that's just what it sort of does automatically when we made the database and then right here because we tried to push you can see now it's going and building the project again. So let's wait for that to build. After we built everything, it has been fully deployed so we can see right here and then it's deployed our new commit. And so if I click on this, it'll take me to this Heroku data tab because I've already clicked on it and we should be able to refresh it. And it doesn't look any different right now because we haven't ran our migrations just yet either. So if we look at data clips, this allows us to create new queries that we can run on our database from this interface, as opposed to connecting to it from Data Grip. So if we try to do Select Star from songs, it won't work because the songs table still doesn't exist yet, and we need to give up a title. And then if we click Save and run, I think. Yeah, it tells us Songs doesn't exist. That's because we have now configured our application to run and use our new database URL, but we still haven't ran the migrations themselves. So to do that, we need to use this line Heroku run migrate environment production. So Run is by default the name right here of what it calls our application. Oh no, it's in the package. That's where it's at. So here app name is called App, and then the target is called Run by default. So that's why it says Run run. So if we type this and hit enter, this is going and running our migration. So I'm not sure if anything shows up in this latest activity. I don't think it does. Yeah, nothing shows up there, but we can see right here. Something is happening. It says we wanted to run our migrations on our new app, and then it asks us, do we want to run this migration, which is app createsongs because right here that's what we call the migration. So we say yes with a y hit enter and it tells us migration successful, which is awesome. So now when we go to Data, which is again, we get to it by clicking on Heroku Postgres or you could go to Resources and then click on it right there. I just like the overview page. We get to this. And if we go here and try to run it again, which I'm not sure why it always makes you click save and run as opposed to just run. I don't know. I think you can just run it. I've always had to click Save and run. Yeah, because it just doesn't do it again, which is weird. So click Save and run. We get back nothing because not the database. The table itself exists, but there's no data in it yet because we haven't added anything. Does that show us anything? No. So now if we go back to postman, let's try to hit our base URL. Sowe can use again. This is the error that showed us originally, which is Heroku logs tail. We can see the logs for what's happened. So we'll keep that up as well. While that is running. If we go to configure two routes, we have our two routes of it works. And Hello. So let's try to hit the base route that has nothing and we should get back. It works. Yay. Okay, we got back. It works. So we got 200. Okay, it says it works, which is awesome. And then we see here we got back the root path, which is also a get request, and it's just a slash. And that's the request ID. That's the web one and that's it. So it didn't show us an error, which is amazing. And if we try to go to Hello, we hit this, we get back Hello world, because that's what we have Typed right here. Now the moment of truth. Let's go to our slashsongs endpoint. So we get back an empty array, which is good because we don't have anything in our database yet. So that's exactly what we want back. And we got back at 200, which is also a good thing. So I have this other tab for new songs, and what we do is let me copy this JSON and go back to the tab that has the actual URL in it. Let's add a new body. I already have it here and we have a song just called Money, and we change the body from none to Raw and change it to JSON. And if we click send, it got back 200. Okay. Which is good. Oh, wait. I have to change this to post that's. Whysend post. There we go. So we still got back to 200, which is a good thing if we go and change this to a get request now and hit send, we should get back our one row that says Money. So there we go. We got that back. And that's the new song that we just posted. So when we go to this data clips tab again, I don't know why we have to do save and run. I don't know where the button is to actually just run. It like normal. I think there was a refresh somewhere, but we click save and run and here we go. This is our table with the ID and the title, and we have our one song called Money in here. So that is great. That's exactly what we want. So we know at least it is reading data and we are sending data. So let's try to do an update. So if we do an update, we need this ID number. No, we don't. We just do a normal put request. That's what it is, right? I don't remember. Let me look, I don't remember. We do a put request and we decode the whole thing. Okay. So we do need this whole object, so it would look like this, but instead of money, we want to do how you like that? And we change it to put. And if we hit send, we got back 200. Okay. Which is good. And is there a refresh button here? I could have sworn there was, but I can't find it. So I just had a semicolon hit save and run. And there we go. Our one row in here says how you like that for the same ID number as this one, which is good. So we were able to update and let's add one more song to it. So let's just add a new song. We'll just add another song called Lovesit Girls Hit Send. No, that's put. Okay. So because I tried to do a post request or I meant to do a post request, but I didn't change this. So it said put it just came back four or four because it couldn't find one right here. It tried to look for that song right here from the ID, but we didn't give it any. So it came back four or four. So we know that's working. So that's good. So let's change this to a post to add this new song. Messed up the brackets. That's fine. Click send. We got back 200. So that's good. And if we go to our data right here, save and run, we should have two songs. And then let's check delete. So we want to delete buythecingid, so we know the ID. Let's delete how you like that. So copy this whole ID, and technically, we don't need the body here, but we could erase it or keep it. It kind of doesn't matter. We'll just keep it there. And then we do the ID number, the UID, and we change this to a delete request and hit send. It gave back 200. So that's good. So now let's look at it and click save and run. And there we go. We only have the one property, so we know all of our operations are working. So that is a good thing. Lastly, we need to use this for our own application. And to do that, all we need to do is open our iOS app, click Control C to close this. And I'm going to open the iOS app. So that was in the folder above. And then I put it right here. I still have it on lesson four. So I need to make a new branch. So let's open our project and Xcdspace that would open an Xcode project if you have, like, an Xcode project file within whatever directory that you're in. Okay. So we have opened our iOS project. Let me close postman because we don't need it anymore because we've confirmed everything works. And all we need to do for our iOS app is go to the constants file. And instead of using our in grok URL, we want to use the one for our application. So let's go to the Heroku app, click on Settings and scroll down to domains. We want to copy this URL and paste that right here and make sure you still have one slash at the end. So if we do that and let's change this from my cell phone to the simulator and click on Run. The first thing we should see is the one song that we have called Love Six Girls. So let's refresh this or run it. So Commandr and wait for my simulator to come up. And once our project runs, we see our songs Love Sick Girls that's here, which is amazing. That means we successfully read from our database that's hosted with Heroku. So let's edit this and change it to Pretty Savage and click on Update. We see our song appears properly here, but we can double check by looking at the database within Heroku Save and run, and now it says Pretty Savage. So let's go and add a new song. So we've tested read. We've tested update, let's create a new one. Click on Add song. There's a song called Whistle, so let's just type that click on Add song. We see both of them here and double check again with our database in Heroku Save and Run and there we go. We have those two songs and let's then delete one. So delete, pretty Savage delete. We only have our one song here, and if we refresh our database on this side, there we go. We only have one song left. And that is it. We have fully deployed our Vapor API with Heroku and our Postgres database. Then we used that instance within our Swift UI iOS app. So during this lesson, we created a new Heroku account. We installed Heroku Via homeboro on our computer and we configured it within the terminal to use our new account. We created a new Heroku app within the website and then configured that app. And lastly, we set up our database to use a Heroku Postgres database, and we ran the migrations so that our app had our brand new table that we made. And finally we configured our Swift UI app to use our brand new Heroku instance running up in the cloud. So if you like this video series on paper, be sure to like and subscribe and let me know how I did on my very first YouTube tutorial series, and we can confirm that this works by going down to Azure Data Studio and just running our query again. Of course it didn't work. Now I have to disconnect. So please hold. Come on back. While that is billing.