welcome to Peugeot to challenge well I really need just I don't know when you're watching this in the future in the past on a spaceship on your phone but I need I need I need some good vibes right now I'm gonna try to make this is gonna be a hard one for me I'm gonna make a Chrome extension that allows you to on any webpage like this steam locomotive Wikipedia page select some text and look up the look up the definition of a word that you've selected I'm gonna use the word Nick API and have the definition appear in a popup now we could make some case that this is not like the most thoughtful and elegant user interaction and so my challenge for you after I do this is there's probably a nicer way to do this like it's select should you actually just have the definition popup right there what's what's it what's a more elegant user interaction I can't even think of it but I'm actually the reason why I want to do this is because this particular idea requires all the pieces that I've shown you in my tutorials and requires a Content script a Content script it knows about the page is going to be a listen for the event of me selecting some text it requires a popup because I say so because I want to show the definition in the popup so in theory all that it requires is the content script and the popup because why not just send a message from the content script of the popup the problem is I can't guarantee that the popup is open if I probably couldn't open the popup automatically so I'm not gonna open the popup automatically that's a code challenge to you if that's even possible I'm gonna select the text I'm gonna send the selected text to the background script by the way I was talking about this earlier that's why this white board already has some notes about this then the background script is going to hold on to that selected text the popup is gonna get it from the background script it's going to go out to word Nick and it's gonna show the results all right I can do it I could do it I'm gonna do it all right so let's let's work on this I'm gonna open up my chat that's going here just in case anybody can help me out the first thing I might need from the chat is how I get the selected text in the content script but actually before I even get to that let me look what's going on here so I need a Content script I've got that permissions tabs and that actually might be unnecessary so let's just take that out right now I don't think I'm using that I need a browser action which is going to look up a definition so I'm gonna put that as the little message definition definition and then I need a background script it's just right background is is it script is it scripts something is definitely wrong here ooh boy no no not an array an object right oh let's just look at one of my previous ones background scripts oh boy I had it wait wrong I was way wrong okay so adding a background script I need background which has scripts and then an array of JavaScript files that are part of the background script okay so now I have a background script a and by the way the code base that I'm starting with is from the end of my popups tutorial so I'll link to that video in this description so if you actually want to like what's up what's the code that I started with you can watch that video and wherever I ended that's this code okay but there's very little in it I I'm the the the webpage the popup has nothing in it just it's I'm using the p5 library so just set up in no canvas and the background script it actually has some code in it from a while ago which i think is i'm gonna get rid of cuz that's no longer relevant I'm going to leave the but yes okay so here we go and the content script has some other code is actually data as well so I can actually get rid of all this it's a very terrible idea so first let me at least get the selected text in the content script okay so I think I want to say like document dot event what is it what is it somebody told me document get selection a mouse up I want it I want the mouse up event in the content script alright so by the way I the chat I'm being told a better way of doing this would be when you open the popup send a message to the content script asking for the selected word and then send that back so that's actually true I'm gonna still do this in a ridiculous way because I want to show you some other pieces of how you can have the background on the popup talk to each other but that is a better way to do it you should fix my code after I'm done so the first thing that I need is window dot add event listener this is a way for me to listen for the by the way I'm looking at the chat here is people are giving me some of this co2 your mouse up and then I need a callback which I could write in a fancy way but I'm just going to say moused UPS function worst name ever for a function so now if that event happens what I want to do is get the selection so I want to say the selected text is window dot i think it's just got to get selection let me just console.log that so what this should do is get this little all i should see is a console log of what's been selected yeah and i like this we're word selected it's gonna be a problem if you select more than a word but less that was a that was a good name Thank You Simon all right window decade selection okay so now oh I've got to load my extension look at my extension we're Nick it's called Wernick it's working I mean it's there I'm gonna go to this page I'm gonna open up the console and I'm gonna listen for this that event is not happening well let's just see if this has even happened oh wait okay hold on the Queen note get selection must be wrong let's see if at least if like were let me just console.log word select I'm sure window that get selection is totally wrong so let me reload the extension yeah oh and I'm having a weird thing where I'm either not reloading or refreshing properly because I'm getting more stuff happen so word selected and then so you can see here that the selection is this whole elaborate object thing and I I just spent some time which you might have watched or I might have I'm not sure be trying to like find the text in there but I thank you I just realized thank you to Alka in the chat that I can actually just say to stream and what that's going to do it's going to take the selected text instead of giving me the full object about the selection just going to give me the actual text and put it right there and so so let's now let's go back reload this extension refresh the page select and there we go and we're middle right you can see that I'm getting stuff selected wonderful okay now what I need to do is once I've selected something I want to send this information to the background page okay so first thing let's get rid of this console.log and let me first check if selected text dot length is greater than 0 so if you know I could have a mouse up where there's no actual selected text so I want to make sure there's at least something there and then I need to send a message I'm looking for my notes about all the different ways to do things in a Content script if I want to send a message all I need to do I think I could just do because I don't need to send to a tab I want to send to the background script I can probably use chrome runtime okay so all I need I was right I'm right I think I just need to say chrome runtime send message this is a generic way and this runtime lower case let me look guys notes somewhere at lower case yeah so this is a generic way to just send a message and it's going to go to the background script and I can make the message an object and I could say the text is selected text so I want to send that message so now what I'm doing is whenever I select a word send that message backgrounds great okay we're sending a message to the background script so now I need to write some code in the background script to receive the message and I have that somewhere I'm pretty sure actually this is the easy part because I can use chrome runtime dot on message add listener receiver so I'm going to write a function called receiver which is going to so I now want the background script to just listen for messages so I need to add a listener and that function receiver it takes a bunch of arguments like the request the sender and the send response because if you want to send something back but all I really need to do is look at what's in the request so I think I'm just gonna say console dot log request cuz I just want to see what's in there that's where the message should come in okay save everything save everything close a bunch of scripts save everything save everything go to extensions reload click here up content script has a syntax error line ten I always do this I really have a problem with a JavaScript object notation there's no semicolon here I should probably put a semicolon there okay I'm gonna hit refresh and oh wait I have to reload boy how much are you just watching me reload and refresh refresh okay so now I'm gonna click this I see the word majority now the question is if I inspect the background page there it is came in text majority yes so I have now the the message from the content script to the background script okay so now in the background script what I'm actually gonna do is just I'm gonna do something really kind of terrible I'm gonna say let word equal and I'm just give it an empty string I'm gonna say word equals request dot what did I call it text so I'm actually just gonna store the result in a global variable there may be some reason why I don't want to do this but here's why I'm doing this because and actually just put something I just want to put something in here here I'm just gonna put a coating train I'm gonna start word because there is a way that I can access variables from a background script from the popup without actually sending a message so in other words and in other words what I can do so of course what I could do is when I open the popup again it would make more sense for an open the popup to send a message to say the background script asking for the answer or more directly I could just send a message from the pop into content script so all this background syrup is kind of unnecessary but it is a useful trick just to see that I can do this in the content script what I can actually do I'm no sorry you know in the popup in the popup what I can actually do is I can say let word equal chrome dot extension dot get background page so if I say let me actually just say let back wrap BG page so I can actually access the background page and then the word is BG page dot word I think I could just go and access a variable that's within the background pages scope so something that I've emphasized is that the content script the background script the popup they all live with our own scope but I can access the background scripts scope and pull variables out so let me do that and I'm only going to do is say create pword so let's see if I made a mistake here let's see if this is working and I'm going to close this I'm going to whoop s reload this I'm going to refresh this page and I'm just going to click the button whoa undefined so I did something wrong so first of all I forgot that I had some stray code in the index of HTML so I'm gonna say call this word Nick look up get rid of this so what did I get wrong here the problem is here because I'm using Lent which is a wonderful thing let is a wonderful thing but let is locally go in a much stronger way than the old var thing with this I don't want to get into that now I've got a whole video about lettin var but what I want to do if I really want to make this global Global global which is probably a bad idea I can say window dot word so if I say window dot word and I guess I need to do that here to window dot word I can put something in a more global scope attached to the window object of the background page there's actually this like secret background page the weird thing you don't see it but it's actually a page and so now what I should be able to do is once again reload the page refresh the page I might not need to actually read further I'm gonna select locomotives I'm gonna do this and then look at that locomotives is there so all I need to do is query word Nick now we're in good shape now I now have what do I have I have a Content script that listens to me selecting some text it sends a message to the background script the background script stores it in a global variable for itself and the popup asks the background script for its variable again not a really sort of awkward in elegant way of doing this but to show all these pieces I could have said var word by the way but the reason why I'm saying window dot word and actually I wonder once I do that I can probably just do this right I think we know that word cuz I want to avoid using var that's which is sort of silly okay a couple things one is I should trim the text because it can sometimes end up having like whitespace and stuff in it so I'm gonna call dot trim which will get rid of any extra like weird whitespace stuff and now what I need to do is look up the stuff on word Nick so this is a little bit out of the so let's go to the word Nick so I'm gonna go to the word Nick API and I'm gonna go to the documentation what I want is the definition of a word so if I look up a word I can ask for its definitions and let's say I'm looking up the word Apple and I just want one definition I don't care about part of speech include relate I don't need include related and I'll take all the sources whatever so I'm gonna try it out so this is the call this is the request URL that I need and then the definition is in an array oh boy Italy the definition is in an array and it comes under text okay so what I'm gonna do is I'm gonna grab this request URL and what I can do in the sketch here I can say let URL equal you know see other people talking in the hallway and actually all I need to do is what I need is I'm gonna split this into two because what I want what happened here oh I need what I need is to put the word in between so this is a kind of awkward way of doing this but I need to form this big URL all right I'm gonna attempt to use a new feature that's part of JavaScript es6 which allows me to form a string by embedding the variable inside the string and instead of using single quotes so I'm gonna get rid of all of the single quotes and everything's gonna look like a disaster right now get rid of all these single quotes and then I'm gonna use backtick backtick backtick so this should be this is now correct it's a little bit weird leaf syntax highlighted because so just to emphasize that I'm how this is working this is kind of useful I could actually write it like this like I can really see all this stuff so this is really useful to be able to break a URL break a string over multiple lines and what want to come right after here is that's where I had the word Apple so I can now say I think it's dollar sign bracket curly brackets word so dollar sign curly brackets word this is now like fill in the value of this variable as part of this URL so I should be able to say load JSON that URL then I can have a callback like got data I can write that function got data one of these days I'll start using the arrow syntax and stuff for an anonymous functions for the callbacks but got data data and then now I just want to say create P data index 0 so if we remember what was here it's data it's an array index 0 dot text so I just want to get the first definition because I'm only getting one data index 0 dot text so this should be it right now my speak 5 sketch grabs the word from the background page forms this long URL to request stuff from word neck look uses the p5 load JSON to grab the data and show the result okay here we go here we go there's gotta be something wrong here but so first reload the page refresh this page I'm even gonna get find a word to highlight like number didn't work alright so let's look let's see where things went wrong I probably made a mistake in the URL one way for me to do that is just to put it here in Adam so let's see HTTP oh look at this I got some weird oh there's an extra semicolon in there that's bad there's also extra spaces how come my trim didn't get rid of the spaces so let's so one thing here is a couple things I need to fix for sure let's go back to my code I had this semicolon the error was just totally unnecessary it just totally messed everything up and let's just trim it here also hey I thought I trimmed it over there but I'm gonna trim it uh it adds new line at the end of the string hmm hmm does it add the new lines or the new lines in there I kind of feel like it's okay I'm gonna I don't think the new lines are gonna be a problem okay oh I might need to replace all right so I'm being told breaking news I'm being told let's just put this in here to be safe replace any new lines with nothing so I'm just putting this on multiple lines just so I can make it more readable but obviously it can be on one line but just in case those new lines are going into the URL and messing it up let's do that all right let's reload the page refresh Here I am going to select railways I'm gonna click here okay look up didn't work but let's see what happens now console the server is well there's like another semicolon look at this there's another semicolon right unauthorized because I stuck a silly extra semicolon so many ooh that didn't work Oh the spaces are because of the new they're not from the trim they're from the new line that's all these spaces are being added these are spaces I'm really losing so let's actually make this a regular expression this is so weird you know what I'm gonna do so I can fix this but I probably just put it all on one line could be so much better what if this is such a coding trainwreck but what I'm gonna do is I'll make a regular expression that takes any new line or any any white spaces new line of white space any white space any amount of white space and replaces it with nothing let's try this oh I need the global I need the global flag I need to go thank you breaking news I'm being told that I've forgotten that regular expressions when you use the replace function they only replace the first thing you find and let's use the global flag so I'm gonna go back to white space any white space replace it and and if this doesn't work I'm putting it all in one line okay you can't stop me I'm gonna put it all it wasn't and go back and I'm gonna go reload I'm gonna go to the steam locomotive page and I'm gonna select locomotive I press this button a selfpropelled vehicle usually electric or dieselpowered for pulling or pushing Freight or passenger cars on railroad tracks so now I can go over here and I can open up the and I can see here for early and one thing I would like to do is I would just like to say dot style font size 64 now I wonder if all I'm doing is changing the pop up so I have to reload the whole I probably reload the whole extension right 64 point let's make it like 48 point is it text size or font size I just wanted to be bigger I just I just wanted to be I assume yeah look at that so interestingly enough if I'm just changing the code in the pop up I don't need to I don't need actually need to reload the whole extension because it's kind of loading that on the fly which is weird how that works and also this is not really how do I make the size bigger I'm pretty sure that if I want that pop up to be bigger to give me more space it's actually going to dynamically size it based on what it is when the page first loads but because I'm getting the data from Wernick later it's not resizing so I could probably say body and then do something like with window resize by oh I could do window resize I so like I don't know you guys wouldn't know who know CSS would know this stuff better like can I do something like this and this has to be in a style tag according to my research according to my excellent research I don't need to reload the extension refresh the page yes oh look at that there we go so now I can click on locomotive and I get that I can click on America and I get United States I can click on obtain now again this is like the worst most awkward interaction somehow if you're still watching this video first of all thank you they really appreciate it this has been a big struggle for me even though I made an example like this two years ago this is quite hard to do on the fly live even though you're seeing kind of an edited version of this I did do this live but I would like you to think about what is a more elegant interaction how might you want to augment someone's browsing experience to learn about additional context so this could actually be a practical tool or you could just do something kind of goofy and when you select a word you know it shows you and maybe shows you an image associating so I look forward to I will share some Chrome extensions next time I come back on a live stream of people who have like made more elegant interactions so please write your send me a link to your Chrome extension in the comments or tweet me at Schiffman something like that but this is certainly the end of this video thank you and good night fadeout