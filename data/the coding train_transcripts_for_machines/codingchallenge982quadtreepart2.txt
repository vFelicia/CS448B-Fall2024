oh hello welcome to part 2 of my coding challenge quadtrees so what I want to do in this part is I want to look at how I can retrieve a list of points from a given area without having and this is going to I don't have to like I could tell like this boundary over here give me all the points in that area well I could just look through every points and see if that they're contained within that boundary but the quadtree is going to allow me to do that more efficiently by kind of looking at the sections that are that are near this particular range that I'm going to create boy am I not explaining this well let me explain this visually so what I'm going to do let me just draw a rectangle let me say something like stroke 0 255 0 let me draw a rectangle and I think because I'm gonna say rect mode Center and I'm gonna draw a rectangle that's how big is the canvas 400 400 so I'm gonna go over to like 300 down to like 300 and then say 100 comma 50 so and that this is way too exact like so let's let's say 107 and like 92 okay so and I'm always really bothering me that there okay so basically what I want is I just want the points and there's not a lot of points there so let me move this over wasting so much time 1 it's perfect this is what I want what I want now is to say like just give me all the points that are in this area but I want to ask the quadtree for it because the quadtree is gonna have a capability of giving me those points more efficiently it's not gonna have to check every single point so let's see if I can do that so in order to do this what I need is in the quadtree I need a new function and I'm gonna call it query and let me put it above show show is just sort of a drawing stuff which is really for just for debugging at this point I'm gonna write a function called query and it's going to take as an argument or range and what that range is it's essentially a boundary I don't want to use the word boundary cuz it's gonna get confusing cuz the quadtree object itself has a this.top boundary so the first thing i need to do is i just need to I I need to does this range and this quadtree do they overlap if they do then there might be some points that I want to give you if not it could be ignored and if it can be ignored that means I don't have to check any of its any of the points that are in it or any of its nested subsections so that's the first thing I need to say is say if this dot boundary dot intersects range if it does not intersect the range let's just get out of here I'm done I don't need to look I don't need to look look away don't need to look any further I'm done I'm gonna have to change this in a little bit but but this should work now now here's the thing if I'm saying if this dot boundary intersects well it kind of got a bit of a problem here which is that the boundary is a rectangle object and I don't see an intersex function but guess what I can write one so what idea I'm gonna write an intersex function intersects another I'm going to say range why not range so there was there was another coding challenge where I had to do this I can't remember what it was is one of my early coding challenges or I had to test do two rectangles overlap or do they not overlap and I think there's a nice way of doing this with an or basically saying hey if any of these or conditions are true they can't possibly be overlapping for example if the X of this one is greater than well the X this edge if this edge is greater than that edge or if this edge is less than that edge or if this edge is greater than that edge or if this edge is less than that edge if this is anywhere outside then they are not they are not not not not intersecting this is going to be so painful to write oh there's got to be a really easy way to write this if okay so let's think about this if range dot X plus minus range dot W is greater than right so if this is the rectangle range and it's left edge is greater than this this right edge actually this isn't gonna be so bad it's greater than this dot X plus this dot W or right range dot X plus this dot W is less than this X minus this dot W or so let me I think I can do this now with the Y's range dot y h y h h y h this is really you're watching a person here type this stuff H alright so and I want to return this not if I want to return so if they intersect if and if this is true they don't intersect so I want to return not this whole expression all right nobody can seem to tell me that I'm wrong I stared at it enough time I'm sure I'm gonna move on also it was pointed out it was the Frogger coding challenge where I struggled through this for a very very long time so I could go back and check my Frogger code and I probably could also use somebody else's library that has like geometry math in it but let's move on okay so now if this this should work now what if they do intersect if they do intersect ah here's what I need to do actually so I need to recursively go through everything and I'm gonna say I want them have a I'm gonna create a variable called found so I want to find all the points so if they don't intersect return found it'll be an empty array so this will be an empty array otherwise now now if they do intersect let me look through all the points that are part of this quad tree and say if range dot contains P found dot push P so now and now I know that these the boundary in the range that this quad tree intersects that range let me check all its width points and see if they're within the range then I can add them perfect I've added them and now what I need to do though is say if this dot divided then okay well basically what I want to do is I've got a return so then I should return those points right but before I return those points what do I need to do well if it has some children quadtrees that I used to check if any of those points are in there so what I need to do is say if it's divided so if it's not divided I can ignore this I can say return this dot northwest query query range okay I know it's gonna be easier here right I could pass the array and keep adding to that array reference which is what I think what you would normally do with recursion but for some reason the way that I'm thinking about this right now is I can say found dot concat this dot Northwest query range and then I can say north east south west south east what this is going to do and then I can return found here so what I can do is right I'm going to start with an empty array if it does intersect just return an empty array because and all this concatenate cat concatenate you're just joined two arrays together so what I need to do is if I if I if I if there's nothing here move along return nothing otherwise if there is something here check my points to see which ones I should add then if I've divided I should also add any of the points that are from my children and then when I'm all done finally I'm gonna return that array I think this is good I'm sure something's wrong here and get rid of all these extra line breaks so they don't need any more and now here I should have okay so I have this rectangle but this is actually I need to say a range is and I really should make this let range be a new rectangle that is 250 250 107 75 and I'm gonna multiplied those by whatever that's fine I'll make it bigger and then I'm going to draw the rectangle at range X range Y range W times to range H times 2 so let me just take a look at this w is not defined whoops times 2 all right so I just make it a little bit bigger so now what I want to do is I want to say oh boy let points equal cue tree dot query range and just to see let me consult out log that array without even trying to draw stuff let me just see if this function even returns anything it gave me a three points okay so this can't possibly be right I've done something wrong which is that I only got three points so I bunch of people in the in the chat I can't credit everybody tell me the concat method is used to merge two or more arrays the method does not change the existing array but instead returns a new array this is from Pierre in the chat so what the issue there is and maybe now I'm kind of don't want to use this concat because I have to write this right I have to say fat I think passing the array is gonna be better so apologies I'm gonna say return I kind of like passing the array better so query range array if if no array then I'll call this found then found is a blank array so I create the array if it doesn't exist then I could just return the empty array then I can push the stuff here and then now I can get rid of this crazy this concatenated idea was very silly I don't know who thought of this and we've got extra parentheses like mad here now I can say with the array and I can just pass the array so I'm just gonna let you know just gonna pass the array around and I actually don't even need to oh I do want to return found when I get because now I want to return it but I only want to return it at the end the very first so I think let me do it this way there's got to be a better way for this but let me just to get this work let me pass let me pass in an array I'm gonna think about how to return it better in a second but let me create an empty array and then pass it in and then be a little bit look at that array so okay this just gets me out of here etc etc etc okay okay here we go all right 160 that makes a little bit more sense there could be 160 points in there so let me now in the sketch let me say 4 let P of points and then stroke 0 255 0 I guess I already have that let me just let me draw the points and let me say point P X P dot Y so let's look and see if that worked hey this is looking pretty good day per day hey good all right let's make this rectangular range random so let's pick a let's pick a random point a random height and let's give it a let's give it some random width within a hundred actually let's just always make it a hundred 100 and let's see what happens all right so we're a will wait why are some of the yr there's some points here not showing up something is wrong guess what remember this function that I spent like an hour staring at apparently I was looking at the chat the whole time there's a significant error in here that I have mixed up oh yeah look at that range dot X plus this dot W range dot W range H range range range range range range range range this this this this this this this this I got to stare at that for a little more time alright so I think that's corrected it we'll find out I don't can't find any points oh look at that look at that beautiful I found all the points within that region now just out of curiosity I just want to check something for myself if there are 300 points so if I create of just I'm just going to create a global variable called count right and if I were to check every single point I would have if I would look through every single point to see if it's within that range count plus plus count would equal 300 but I am going to here just as a little sort of like hacked check is I am going to increase the count here and I shouldn't have to look at all 300 points I should only have I should be looking at a sub set of points so let me console.log that count 31 2748 219 now of course I've got to look at a lot with this big range because you know I kind of got picked randomly through the center but so but I never have to look through all the points and so this algorithm like you know if I make the range the whole canvas well then I have to look through all the points the point is if my range is something much smaller like even if it's like 25 by 25 right I only have to do very very few checks even if it's randomly in the center and let's now let's get rid of this count idea cuz I don't need that count idea anymore let's go this is gonna be fun oh so much fun let's let's go put this in draw and let's make the rectangle Mouse X mouths Y count is not defined we're at draw sketch touch yes line 26 Oh quad tree line 87 sorry quad tree line 87 save so now you can see as I move the rectangle it is highlighting only the points that it finds I kind of want the count back because I kind of want to like know how many checks but this is great all right boo boo oh I think I've successfully now implemented the full quad tree because I have both an insert function and a query function let's quickly go to that Wikipedia page and if we look at the pseudocode right we can sort of match this up with what we did there's this idea of a point in X Y and AABB which is my rectangle and axis aligned boundary box there's the quadtree class and as the capacity has a boundary north west north all of those things will have an insert subdivide and query range right query insert yeah so I think that I have basically done everything and probably I did read this Wikipedia page the other day and that's why I think I started using concat because it's using append so but I think I like my so here's the thing ah I really should just this video should be over cuz it's taking way too long but I do kind of want I really sort of want this oh I know what I can do I want to return I want to return the points array let me fix it so it returns the points array let points equals query that range I really just want to get an array back so now if I go in here so if found does not exist found should equal a empty array and then can I just say return found down here is that gonna work that works I don't know why I thought it was so complicated the reason why I kind of was afraid to do that is that these are also returning their reference to the array but doesn't matter because I'm not doing anything with it so that's fine so we don't only really own the only return that really counts is the very very very last one which is the original call to the query function so so now okay that was that was much easier than I thought so now at least I have the function return that array okay I'm gonna be done there's one more video I need to make and I think though I mean there's many more videos I need to make but part three of it's going to come later hopefully by the time you watch this it might actually be linked to but what it's what that video is going to do is I want to apply the quadtree algorithm to a collision detection problem and in particular a really good one for me to apply it to it's not really a collision detection is my flocking simulation I also would like to port this to processing and make a Java version of this so those are all the things that I want to do I'm gonna so but if you're watching this video right now and the next one isn't available as a challenge to yourself see if you can take this and apply it to a collision detection problem and then I'll be back and doing that myself someday and and and that's what's gonna happen okay thank you everybody you