here we are again well this is the third video in this series about nearest neighbor and similarity scores and we're finally finally kind of figure out which Star Wars movie you should watch so how are we going to do that what I need to do first is I need a forum where a new user could enter this world hi my name is user that's my name user and I have only seen episodes 4 5 & 6 of Star Wars so I'm going to make some ratings and that is going to predict which Star Wars movie I should watch or how I like Star rated something like that okay so first a sort of it's unfortunate for you that I didn't cause her to do this before is very nice we could fast forward a little bit if you don't want to bother with me building the form to get the stuff but I'm going to do that now so what I'm doing here is I'm adding and I need a comma I added to the JSON file just a list of all the titles obviously I can extrapolate that from the data set in different ways but this is just going to make my life so much easier right now let's do this let's be happy let's just make our lives easier why worry so much let's do it this way okay happy JSON file so I'll have easy happy easy JSON files okay so now that I've done that what I want to do is where am I it was set up I want to create I first I want to do is I want to get all the titles is now data titles and I want to loop through them titles dot length I plus plus and I want to say I took it this way I'm going to do it this way though it's looking ahead gonna be fine I'm going to say VAR div equals create div yeah this is going to be fine creative with the title let's look at what I got so far alright see I got to deal with all these titles okay okay this is great this is good VAR select equals create select select parent the div so that's that drop down this should I'm going to call this a drop down that drop down should go in the div well look there is the worst design for ever but it's fine yeah there's so many better somebody's going to save me on the internet someday and make a really nice version of this with better data and better design and then what I want to do is save our you know star what are the possible stars because 0 stars one star I didn't give in I didn't give it a star is let you could have 1 to 5 stars so I'm going to say drop down dot option star so now what what's wrong oh this needs to be parentheses I'm giving all these stars and this is not start it star that's hot I star my brain is melting now look at it so I could say I want to rate this movie this way and this movie this way and this movie this way and this is it this way now then it's submit ba ba ba ba ba and what I'm going to get what I want to see is the movies that I didn't rate I want to see what it would guess my rating should be so I'm going to actually add an option where I'm going to say dropdown option I'll just call it not seeing I guess so I can just rate the movies that I've seen and get a prediction for the other movies that's where we are so far okay weird we're good we're good now we're ready to do something so now I don't need any of this stuff from before but I need to handle the mousepressed so what I want to do is I need this find nearest neighbors function so when I press the mouse what I want to do is what predict ratings so I need a function that's predict radix okay and what am I going to do in this function okay so first of all I need to create I need to create a new user new user is me and then what I need to do is make a user object that has a rating so how is the data organized originally it's to each user object as the user's name and the a lookup of the movie title and the rating okay so now what I need to do is I need to say for so what would be nice is if I put all of these drop down somewhere in like a variable so I'm going to say drop downs equals an array and I'm going to I mean I could select them but I'm going to say drop downs dot push dropdown so this is where I can now get I can get for all I can look at all of the dropdowns and I can say new user new user oh okay interesting what do we need to do I need to figure out how to pair when I look for each of these dropdowns I'm going to get this number but I need to be able to pull out the actual value so hold on everybody I'm thinking so I need to actually pair it with it so I'm going to just do something silly but I'm going to do is I'm going to attack them and when I make this dropdown I'm going to say dropdown dot title I'm just going to title index I so any a JavaScript object the dropdown is an html5 of people I've element I can just attach another variable to it and put some data in it so I'm going to do that and I'm going to now say new so as I go through this new user so the title is drop downs index I dot title the value the rating is drop downs index value the function this is a function that returns the current selected value out of those options so new user index title equals the rating so let's just now console.log that new user here we go let's take a look at this so I am now going to say three five and I'm going to submit and look I now have an I know I have a new user object that has all of these movie ratings and not seen now here's the thing I think previously the way I had written this is I use no to ignore a similarity score too so what I should do here is I think it might be useful is to say if rating equals not seen let's just instead of using the string not seen let's say rating equals null so I'm just going to change that to be null in that user object so let's just see if that works so I'm just going to only rate one and we should see now okay so now I have known for all the other ratings perfect so now what I could do is I could definitely see who are the most similar users to my particular rating here because that we just did so let's do that so what I'm going to do is now I'm going to say once I've done that I want to say find nearest neighbors but what is fine nearest neighbors do before well it got the user from a dropdown menu but I don't want to do that anymore actually what I want to do is give myself get this I'm going to pass in a particular user so what I want to do is I want to say find nearest neighbors for this to our user when a buying the nearest neighbors for this particular user so here where did I get the user like I said sort of I got the user from the name Euclidean distance name ah so the Euclidean distance function it looks up so many problems so many things I have to fix you like to restructure the way I did it this is the life of programming it just seems like oh this won't be any good just going to add this one little feature and then I've made all these weird kind of notsogreat decisions earlier so we got it we got to do better okay so I'm going to I'm just going to have to live with myself but I'm gonna try to make my life is easy and friendly and happy as possible this function Euclidean distance should really receive to user objects so what I'm going to do is now have this receive ratings 1 and ratings 2 so these should be to user objects with all of the readings it's stripping out the name and timestamp thing but that's fine the titles that the titles I could actually just use so now one thing I can do to simplify since I have that movie title thing is I can get ok when I look for the title to save our titles equals data titles ok so that simplifies it so I want to get the two user objects so I'm going to come back up and I'm going to so what I want to do is back up to where I call Euclidean distance this is where I call it I call it between two names but now the user is coming here so I want to call it between user and not and I don't have to worry about this anymore if this new user can't be the same aha so I can actually this is actually simplifying things I can get rid of this and other can actually be the full user object and so now I want to say Euclidean distance between this new user and other similarity scores etc etc okay so the rest should be fine what if I must have missed something right but let's try this so I'm going to rate a few movies just picking random numbers and not even thinking about it hit submit okay sketch that yes line fortysix users not the pint shouldn't know better just try this line fortysix oh this is right here I'm passing a new user let's say I lost track of so many things here and maybe you've lost me let's come back and say what we're doing predict ratings happens as soon as I press the mouse I build a new user with a bunch of ratings based on the interface and then I say find the nearest neighbors for that new user and buying the nearest neighbors for that new user means go through and check all of the users in my database in that JSON file and good player compare the including distance sort all of them and show me show me the five nearest ones and one thing I want to do is now I'm gonna just leave this like this I'll fix this in a second okay let's try this now I'm going to rate a few random ones hit submit and okay so this is good I got a bunch of users it looks like these are users in the chord undefined so something didn't work here I would have to debug this uh so the lookup is no longer by name because other is the full user but I want the lookup to be by other dot name so let's just see if this works now great so I'm exactly the same as all three of these people because all three of these people rated Star Wars Episode one with a two and we can see here's the here's poor people here here's four is this five people all three five people okay but now I could start to get some more interesting similarity scores by rating more movies so here are the five most similar users to be here something that I'm just really bothering me once a nice little function at least for like looking at stuff is a number format so what I'm going to do is I'm going to say score equals number format and I'm going to format the similarity score and what number format does is I could say give me this many leading decimals and this many trailing decimals so I could say something like you know one comma two and so if I do that what I'm going to get now is this so here now what I'm doing if this looks so horribly ugly but design aside at least I'm getting just the similarity scores with and I could with just two decimal places even if they go on for much more okay what is you're getting so many of the same score because it's just a very small small data set this would work so much more this would work so much better if I had if raises a thousand movies and then I had a huge database of other user ratings now scale is also a problem the algorithm then went really slow and there's ways around that but I will get to at some point I forgot the force awakens oh yes but no but I didn't forget it in the data set right it's in movies JSON yeah yeah I just forgot it in here okay so let me add that in thank you let's include the force awakens' here and force awakens' things back there we go okay thank you for that okay we're finally ready now what I can do is get a rating for a particular movie that I the new user has not seen and after all isn't that what we're here for to figure this out and make me you fast forwarded all the way to this point of the video if you did we're good we're here okay what do I need to do I need to find the place where I I need to find the place in the code where I create all those divs I need to refactor this because I don't want to look at the five nearest people I want to use the five nearest people to compute some guesses for movies I haven't rated so first of all you need to keep track of the movies that I haven't read it so let's do that where cuz I do that here is so so let's just do that here so first let's create an array so called new titles and what I'm going to do is Bauer ie equals zero I equals data titles do I already have titles here somewhere I think I have just this is a very silly way of doing this but titles you know I don't need to create a separate array I need to go through all the titles I had less than what I want to do is go through all the titles and find out have I not seen that movie yet so I'm going to save our title if bar title equals titles index I if a my new user in here where am i phone user if and do I have access to titles now I need to say data titles data titles if user index title equals equals null now with the time create div title creative title so I want to do a result P parent Oh No yeah no no no did this should be div parent results P I had that wrong so I want to put the div inside that but that's something I want to do this creative title result gives push and then div dot parent title I just want to see the title we're going to get to this in a second this tough way that should be a really long time what brain is melting this should just give me on the HTML page of movies that I want to have my predicted ratings for ready here's a rating here's a rating submit okay cannot read property appendchild of know div dot parent not title result P try this again okay so now what is what is the button go up here and holiday went down here that is craziness what is craziness this is somehow getting parented what have I done what crazy weird thing have I done oh I know why so I need to put the head a variable and parentage okay everything's going to be okay can you hear my stomach rumbling okay here we go great so I should see a list of everything but episode 1 in episode 4 perfect so now I need to predict the star rating for those we're getting so close so now that I know this is a title I need to get a prediction for this is where I now want to look at the five nearest neighbors okay it's gotta be okay so let's get rid of this div for a second and right now I am going to look at five nearest neighbors okay so I don't care about their name but I do care about their score don't care about number formatting it because what I want to do is I want to okay how do I do this prediction I want to basically take a weighted average of all of the neighbors so let's think about this in using the whiteboard for a second okay so for example if we imagine just a 2dimensional space and if there were just two movies like episode 4 and episode you know 7 you know I could put plot everybody's you know this is somebody who rated episode 4 with 4 stars but episode 7 with 1 star right would be over here so what I want to do is I'm a new user and I'm somewhere here what I want to do is and I've only rated well this is good getting confusing okay so what I want to do is I want to look at the people who are nearest to me maybe the five nearest ones this is and make a prediction but I want to wait I don't have to do this I could just take the average of all of these but what I want to do here is I want to wait this person who's to me I want to wait the prediction that I have for there I want to wait their movie rating more heavily than somebody who's a little bit further so how am I going to do that so first let's actually just take an average of the K nearest neighbors ratings over that particular title so what do I want to forget about the similarity score for a second what am i doing here so what I want to do is get all of the ratings user title isn't right okay so how do I done the ratings are from that users my variable naming is pretty poor here and I need to do a better job with that but users remember is the lookup table of all of the users user right now is me I should probably not call it your really regain this stuff and I maybe I'll refactor this when I publish the code okay I want to get some ratings from all of the users for one particular so that's Nate okay so these are all the ratings for one particular four and now what I want to get is the actual rating is the ratings index two title right so first I need the user the knearest user where's name coming from wait a second users okay hold hold your horses I I went a little nuts here users index K forget about the name I can get the simple I'm gonna get the similarity score but the name K is what I want come on we can do this I want to look at that particulars it's sorted I'm going to get the ratings for that particular user I'm gonna get the rating for this particular title then I'm going to add them all together some plus equals that rating then what do I do some divided it equally k and now here we go I can make a nice little div and what does that div going to have in it it is going to have the title whoever I look at you're over there it's going to have the title plus a colon plus some and I'm going to just say stars equals that sum divided by K that's going to be the stars and I'm also going to number format it so that it's with a with a one leading digit and two decimal places okay here we go now this isn't good if there's a lot there's a bunch of things I want to do this to make this better and then talk about whole sorts of things that I've missed but I think we're somewhere there with me the like episode one don't like F so ii don't like episo and like episode 5 for a bit ah cannot read proper TV of undefined at fine years neighbours okay let's see if we can fix this sketch line 83 oh this is it what is ratings is okay let's think about this users is the lookup table data dot users I see I've done a lesson learned I may be what I'm going to do after this video is do a separate video where I just refactor this to make it with better variable names and make it more organized in a way that I could fall I've done a terrible job this is really the lesson in poor code management but hopefully you're learning something I see me what I wanted to look at the array is actually data dot users data is the stuff I loaded from JSON so data dot users is my array users was my lookup table so this is what I want let's see how this goes I can't 700 no I think why infinite loop right I think I froze in the browser Oh Oh terrible terrible terrible error look at this I I'm not paying close attention and I'm in a loop within a loop and I use I twice which is absolutely absolutely a disaster so no wonder I had an infinite loop let's change this to J okay I'm feeling slightly more confident now I really should stop doing I got these star ratings so and so I really think that I should have so I should really be seeing episode 5 or 6 and I'm really not going to like the holiday special this ten by the way has been in the way all the time okay so we're doing well this is pretty good and I really should quit while I'm ahead even though I'm not very far ahead I'm Way behind but we've now got a prediction engine I would be nice to sort these I'd probably want to sort these I can leave that as an exercise for you but I absolutely should do the weight I should do a weighted sum so let's at least add this and I'm seeing it in the chat I'm going to do it right now okay and I should add some emojis to this because can you receive some some happiness some smiles hearts in my chat okay here we go okay so now what I want to do is let's use that similarity score score equals similarity scores okay similarity scores in next name that what is the name so okay so the name is data users index J name so remember the name again I don't know I love the way I've organized this the similarity scores are in a separate lookup table than the original data so the data which I really Clyde should have put that in the original data but anyway the name is coming from the sorted array of users the score then it's coming from the similarity scores and then the rating is also in that original lookup table so now the weighted sum okay so a couple things I should do I need the I need this the weighted sum and then I need the similarity some I'll try to explain this I think in a minute so I need two different sums here so what I need to do is add up the weighted sum equals the ratings times the similarity to score and I don't know maybe I'll call this sin for similarity so this is the weighted sum its the rating time now remember if they're really similar the similarity score is 1 if they're not very similar the similarity score is 0.1 the reason why I also this reason why I need this similarity thumb is that what this is what to get the average like if I add up five things and divide by five I have an average but I'm not adding up five things now and adding up five things weighted by similarity so what I actually want to do is the number of stars is the weighted sum books is the weighted sum divided by the similarity sum so this is actually going to give me the weighted average does this make sense to you if it doesn't ask in the comment maybe I can sort of answer this again another time or make another video but now I have the weight of something the other thing here is it's very likely in a more elaborate system that the user is not going to have rated all every user is not going to have rated every other movie so I would add need to do an error check to make sure I should do that here so I should check as long as rating is not equal to null that could be no then I add this up and this is going to work so there could be a thousand movies it's only going to add up the ones that that particular user has rated okay okay here we go okay here we go here we go here we go here we go and I am now going to rate some movies ah stuff using the sound effects for no no I really don't like episode one or two three was kind of okay you know these are all good no that's this is a good one come on Empire Strikes Back Return of the Jedi I like Alex seven okay here we go so what will be my estimated star rating for rogue one in the 1977 I think that's on whatever the Star Wars Holiday Special my the guess is I'm going to rate road one and three point nine six stars and holiday at one 26 stars we did it okay I wish I could play some Star Wars sound effects but I'll get a copyright problem so this is now a recommendation engine it has got a very limited data set there's a lot of problems with this but let's think about what are some things you could do with this going forward first of all you could think about a whole other context of what you might use this in I mean think about similarities and predictions of Ray it doesn't have to be you know product ratings moving ratings you can think about any property associated with a person a thing you know think about word counts what if you look at like all the emails sent to yours all the emails sent for all of your friends and you counted all the words in all those emails essentially those word counts are equivalent of star ratings for each word can you find similarities between your friends can you predict so this is sort of laying the foundation of how you might do spam filtering for example so there's a lot of ways you could think about a data set that's full of key value pairs and how you might have a lot of data points and make predictions based on that and that's what's happening here that said maybe you're interested in doing something really close to this like a movie recommendation system getting your own data set now here's a challenge for you I've met a lot of this code I should thank again I'm building this based on after having read this collective intelligence book I put a link to this book in this video's description something you might think about is okay what makes you think about movie lens so there is a website called movie lens and movie lens has a giant dataset with 20 million ratings so you could actually build this exact same program with a large massive data set now you're going to have a lot of issues all of a sudden with performance and so how do you approach that now that's a topic for a whole other video but that's kind of a challenge for you and something that you'll notice here is I have to go through every single other user because this is all and looking up everything by user but I could have some precomputed lookup tables that kind of know something about how movies are similar based on user ratings and calculate calculate the predictions based on movie similarities as well so I think it up this is covered in this book maybe I'll come back and do another video on that and explain that very well but this is user base you can do something that's item based and that's going to really improve speed maybe if you use a database and have some pre computed lookup tables in certain ways it's other ways you could approach it write in the comments ways that you think about like how you might do this with a large data set but even just redesigning doing a better interaction building a like actual serverside program that saves stuff in a database I would encourage you to go do something creative with this something strange something useless something playful and share with me so thanks for watching and I'll see you in a future coding challenge video thing etc good bye you