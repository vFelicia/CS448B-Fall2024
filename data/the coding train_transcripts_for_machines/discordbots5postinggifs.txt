welcome back here is another discord bot tutorial in this tutorial i'm going to attempt to retrieve a gif from tenor.com and post that gif to uh discord itself so i'll use a command like exclamation point gif a search term and then i'll get a gif back from tender.com so there's lots of different gif apis you could you could have your own library of gifs i'm actually using tenor because there happens to be an official coding train uh gif page i don't know why this exists or how this exists but it exists so you're with you know if you like the gifts on the coding train you can make use of those enjoy now there is a tenor api so you will need to get your own api key log in create an application and it's very it's a pretty easy process i'll put links to it in the video's description and once you've gone through that process you will have an api key like this which i will now delete or regenerate as soon as i finish recording this video so i've made two example and test application let's grab this one coding train example this is a perfect way reason to use my env file yet again so going back to the code i'm going to go to dot env i'm going to put tenor key equals so now i have my tenor key saved in a dot env file in bot.js you know again i have my bot restricted to one channel which is sort of an artificial restriction right now just for testing purposes it's hard coded in there and then i want to do kind of an awful thing which is i want to say if the message content is choo choo reply this way otherwise if the message content equals exclamation point gif reply somehow with a gif now how am i going to do this first of all this is terrible like ultimately you might make a bot that has hundreds literally hundreds of commands a giant if statement a switch statement's not gonna do you any better so that's gonna be the topic for the followup video to look at how we can break out these commands into separate javascript files and handle them in more elegant way but right now let's just get this second command going and i am just going to make sure that it works to have two commands let's just send back the words gif and if if you like i can make a whole separate recording of this video with me saying jif like so you could decide which one you want to watch but i can't i can't bring myself to do it i'm sorry i'm sorry let's run this bot let's go to discord i'll say choo choo never forget that this dot i will say gif and i get the response back gif so we can see it's handling multiple commands now i want to get an actual gif so back to the tenor api there's lots of documentation here things i'm sure we could try i'm just going to do something quite simple um with implementing a search and you can see here uh it's giving me i can actually look at the javascript code first of all tenor it's capital s it's capital s in the javascript oh it makes me crazy second uh i could click over on javascript but it's the example code is showing it with xml http request which is kind of an ancient way of doing of requesting data from an api i have been using the fetch function i have a whole video tutorial series about the fetch function about async and await so i'm going to use a more sort of modern technique so i'm just going to refer to this sort of curl which is a command line tool for getting data from the api and what i want is this url i'm going to grab that and i'm going to bring it into my code so i'm going to say let url equal this string and then i'm going to use the back ticks to make it a template literal and then i can do things like ah where the key is supposed to go i can say guess what process dot env dot tender key so you can see here now i have replaced in the url the place where the key would normally be hard coded with the environment variable tenor key and then the search term here is just excited so i'm just going to hard code and replace the words coding train in here and see how that goes and then i'm going to call fetch to get the data from that url response equals await i need to use the await keyword if i want to have asynchronous code running with this particular methodology fetch the url then i want to get the data in json format so i say await response dot json now there are this is not a let's just run uh console.log json so this actually isn't going to work because two things one is if i have asynchronous javascript with the await keyword i need to indicate that with modifying the function as an async function and again i'll refer you to my other tutorials about this but there we go modify as an async function now also i don't know node doesn't know about fetch natively fetch is part of the javascript api in the browser but it's very easy for me to add fetch to a node application and by the way you could also use axios which is kind of like what people are using these days but i'm a little bit behind a little mind i'm going to use fetch i'm going to go back to my console and i'm going to say npm install node fetch there we go and then i can in here i can say constant fetch equals require a node fetch so now the fetch function is imported from the node fetch module by the way this requires stuff i'm going to make use of that in an interesting way in the next video when i show you how to do a command handler it's very exciting okay require node fetch now i believe i should be able to run this run the bot go back to discord i'm going to say exclamation point gif i won't get a gift back yet but i should see a console log of the data from tenor there we go look at this so i now have what do i have i have an array a javascript object with a results array and every element of that array as an object with a url which is that particular gif so and the url for it so if i go to this page here and take a look at it this is a coding trade gift that somebody bunny gamers i guess made which is like the this dot with the fire coding challenge that is awesome i love seeing that thank you for sharing that so i think what happens if i just say uh message dot channel send where was it json dot results index zero dot url json.rt that's what i am looking at right there json is the object dot results is the array index 0 is this one url i probably want to pick a random one that would be a nice thing to do but let's just see if this works like if i just send the url back to discord is it going to post the gif i think it might like obviously i might in other contexts i might need to actually download the file use this you know binary data but i think actually giving it the url might be enough in this case so let's restart the server go back to discord gif there we go we've got it oh that is wonderful mwah okay next up two things let's pick a random one so let r index equal math.random times the length of the array and then it's actually exactly what i'm doing here i should probably put this into a function but i'm doing exactly this i could actually just take this let's just take this right here right i want to uh but instead i want to look at the array of gif results and then send that particular one restart the server go back here a gif oh sad what happened i got an error unhandled result is not defined ah sorry json.results json.results i probably should put that variable into that array into a separate variable but good enough no cannot read property url of undefined hmm i guess i have to debug this a little better what did i mess oh results index zero ah the array is results right i want the length of the array not index zero then get the index and look in the race sorry all these mistakes so many mistakes hopefully seeing these mistakes helps you there we go we've got a gif there's one let's get another one okay we're getting fun coding train gifs amazing okay one more thing let's modify this so i can say gif and then i can have a search term after it so if i were to say gif coding trained then i would get a coding trained gift back right now i'm not going to get anything because the way that i have written this is that i have to have the full content exactly exclamation point gif so the first thing i want to do and this is leading the way to the command handler is let's make a variable called tokens and i am going to say message.content.split and i'm just going to split it up by spaces and again i could be kind of a more sophisticated way of splitting it but this is a way of taking a string and splitting it into an array where every element of the array is separated by a space then what i'm really looking at is if tokens zero is choo choo then do this and then if tokens zero is exclamation point gif do this but i want to look for a search term so let me change this to uh i'm going to say keywords right this now i'm going to add a variable called keywords into the tenor api search and i'm going to say if tokens.length is greater than one so let's say um keywords is just by default coding train right so if you don't specifically offer a search term you just get a codingtrain gif but if you have more tokens than just exclamation point gif then keywords equals i think i can use slice tokens i think slice is a function that takes a slice out of an array so i don't want the i don't want index zero i don't want the command i just want from one until the end of it and then i want to join it back by spaces so i did that kind of quickly i don't usually in my tutorials kind of just plop code out like this but let's think about this in multiple steps if i have exclamation point gift kitty cat i then have an array with three things in it slice from one to the end of that array and i don't know why i put cat with a k there kitty cat will give me a uh a smaller array that looks like this i guess i could have just spliced out the first element and then join will put it back into a string with spaces in between so now that should give me keywords and i think let's see what happens i can search for a given gif before i do that before i just unleash the world of gifs onto this discord server let me look for one more thing in the documentation which is content filtering so i'm going to use the grated just to like filter everything out make sure it's sort of family friendly content that i'm getting right now so i think i just write another argument here oh and i'm limiting it to 8 which i don't need to do so let's add content filter equals g i think that adding that argument should filter out filter the gifs sorry i double checked i found in the documentation that actually i don't put equals g i put equals high i want the high safety filter so let me go back to the code and put in content filter equals hi and i'm pretty sure i've done it right there is an issue by the way that um in a url you can't have a space so normally those get encoded as like percent 20 as a sequence of characters that indicate space i'm hoping it's going to work anyway like i think the fetch function might take care of encoding the url for me we'll find out let's run this back to discord let's first just say exclamation point gif i've got a coding train gif now let's say gif kitten and i've got a kitten gift now let's try two words cute kitten i think i think it's good i think we're we're good oh this is fun so now the coding train bot will always get a gif from um tenor now i don't know if i am one thing i should probably check and i will add it to this after if i should include some extra information like for example i should include alt text for the gif maybe i want to include a url to credit the gif of where i got it from um but so i should be able to without too much trouble at a minimum add some additional text and maybe i could just send it right now as a second message gif from tenor and plus the keywords so i'm just going to send it as two messages right now or i could have made it one but just to just as a quick uh update so we get the gif and it says gift from tenor coding train let's get a puffy gift from tenor puppy okay so we now have a bot that can handle more than one command it can even handle arguments to a command right the command can be the first token with arguments after it but if i want to expand this if i want to build this up further a really long if statement isn't going to be such a great way to do it so that's what will come eventually in the next video how to modify this to use a command handler to be able to break out different commands into separate javascript files and build a much larger bot and then more things will come too we'll see we'll see what i get to thanks for watching and hope to see you in future discord bot coding train videos yikes