hello welcome to another episode of the coding train and I'm going to do a coding challenge and what I'm going to do in this coding challenge in honor of may the 4th Star Wars day is I am going to make a simple movie recommendation engine where what I have a collected a lot of ratings from the coding train community of all the different Star Wars films you can see alkis here ratings are 5 5 5 2 4 5 4 based on the episode number road 1 and no rating for the holiday special you know what though I'm going to I think Alka what Alka give me a rating Alka you're in the chat right now give me your rating for the holiday special let's see if there's any other no no there's a lot of gnomes for the holiday special you know what we're going to leave those nulls in there we're going to work around the Noles that's going to be part of our challenge here to deal with the fact that some people don't have ratings for particular movies ok so what am I going to do the first thing that I want to do in order to build this movie recommendation system and first I should mention a couple things number one is most of the codes that I'm going to write even though I'm going to write it from scratch is essentially the same code that's in this book collective intelligence and it's a wonderful book it's from you know I think probably from like eight years ago at this point because it's 2008 or 2009 but it's because my knowledge is old still try to get there and so I highly recommend this for you I read this book again about a month ago and so I'm sure whatever ideas are in there are still in my head that's ultimately what I'm going to end up programming here the book is in Python by the way so if you want to see a Python version I'm going to build this all as an interactive example in the browser using javascript so what is this a part of so before I actually get to coding this is part of a set of videos where the topic is really K nearest neighbor but in this case I'm going to not worry about the K right now I just want to think about nearest neighbor what I want to be able to do is you know Alka and look find somebody else and haba lwg Q and Hubbell uma Alka and alga Luca have both rated movies are they similar to they rate movies in a similar way do they have similar tastes how could we numerically establish whether people who are rating movies are have similar tastes or not similar States and that has to do with nearest neighbor that has to do with this idea of a similarity score now there are a lot of different ways you can calculate a similarity score and the kind of similarity score I'm going to use in this video is a one of the easiest simplest ones called Euclidean distance you click being the mathematician who invented a lot of geometry stuff and so including a distance meaning actually just a sort of distance you space between these two people now what does that even mean these are people rating movies they don't live with space they live in out Wow does that mean that they're far right now if I said to you what's the distance between this little dot and this little star where we could pull out a ruler and actually measure that distance in inches and centimeters and pixels this would be Euclidean distance the actual length between these two things Euclidean distance on a twodimensional plane so when X Y values it's sort of easy to think about distance the same thing goes for X Y Z values in fact in this room I could have you know this hand here and this hand here and how far away are there I could measure that's the Euclidean distance but let me let me ask you something what if you thought about color for a second color is our G and B at least digital color has a red green and blue value so what if I have two red green and blue values I have color one and I have color two which might be R hey r2d2 calculate it Alice red what's the con that starts with D I'm sure we get a million comments it just colors it starts with D all right I wrote it R G B right I can have R 1 G 1 B 1 I can't even do it anymore point is they could have two colors and I could actually think of the distance between those two colors in the same way that I might calculate the distance between two exwives viewpoints after all it's three values and in fact if I have four values or five values I can use the same formula that I would use to calculate the distance between two points in XY space between two points in five seven ten dimensional spaces are very hard for us to imagine in our heads what that would look like but the math is the same what is that math that math is actually based on the Pythagorean theorem if this is point a and this is point B and the sides that we probably should not call these a to a B but at the sides of this triangle a B and C C is the distance between those two points and a squared plus B squared equals C squared so C equals the square root of a squared plus B squared and in threedimensional space a squared plus B squared plus F squared for Memphis Q squared these are the X differences the Y differences so this is ultimately what we're going to do now at the end I'll show you why there are some I'll talk about why there are some issues with leaked Linea distance and other ways of calculating similarity but ultimately what I've now established is with these two let's say both of these critics have evaluated have rated given a star rating to five movies all I need to do is get a distance score which is the square root of the rating of movie 1 move of movie 1 algas movie 1 so alkyd movie 1 minus 8 mu b 1 squared plus alphas movie 2 minus H mu V 2 squared etc etc etc for all five of those movies so this is what worked where we're going to start and eventually this is going to lead us to be able to get recommendations for a new person who comes in and maybe has it raised one of these movies to calculate guess whether they like it or not okay coming back over here let's start to write some code now so the first thing that I need to do is I need to load all this data so I'm going to go into Sketchup yet oh look I already did this lucky me I actually wrote some code before I started so let's close some of this stuff here so let's just make let's take a look and make sure that this data is actually loading into our sketch I'm going to go to the browser and I'm going to go and open this up similarity score it's not happens here why do I have this error here save there we go I don't know why it didn't work but it's working now and you can see I loaded there is an object that it loaded with a property called users and that users is an array of 100 3 users each one of them has a set of ratings for all of these movies ok great so first thing that I want to do is I want to make something where the user can select two different critics by which to calculate the similarity score so the way I'm going to do that is by two little dropdown menus so so what do I need to do so the first thing I want to do is I want to save our users equals data users now I want to loop through all of those users and I'm just going to say console dot log users index I dot and what was it what was their their name is their name by the way because all this data came in beat all this data came in via Google form I'll put a link to that Google Form and that's what this time stamp is this is the time that on maybe the fourth this was submitted okay so let's just make sure that works and there we go we look Finch will ship it Jr is somehow participating in this there's no Daniel shipping jr. Leo okay look at all these people okay z3r oh okay so now okay so what do I want to do let's p5 has on some functions for creating dropdown menus and so I'm going to say person 1 equals create select and var person 2 equals create select and then I'm going to say so create select should give me whoa I have an error oh I don't have the Dom library so one thing I'm starting the Dom library so I need to make sure I have a reference to the library so let's try this again so we can see there are two dropdown menus here and this very silly page it has this unnecessary styling in it okay whoops so let's make that a little bigger so I could see I have two dropdown menus but nobody in them yet so what I want to do now is I want to say person 1 dot option users index dot name and I want to do that with person 2 as well so actually I want to call this dropdown one because we call this dropdown one and this B drop down to so now we should see here I've got these dropdown menus so what I want to be able to do is just say okay I want to look at code land which was a wonderful conference by the way and he walks and calculate a similarity score so I probably want to button to so let's let's create a button I can actually just do that right in here using the Dom library as well I can say create button submit and there we go and so I can do this okay so alka and unicorn what's the similarity score submit I want to get this little similarity score okay so we have a little interactive system set up here we go we're getting somewhere okay so button dot mousepressed and button dot mousepressed a similarity like let's call this Euclidean Euclidean similarity boy that's really hard to spell you Euclidian similarity so that's a new function I need to write function Euclidean some Euclidean similarity so now what I want to do is get who are the two people that I want to look up var person 1 equals person 1 equals dropdown one value so the value function in p5 gives me the current selected value drop down menu and person to is drop down to value okay now let's try console logging person 1 and person 2 let's just make sure this works alka and unicorn and we can see Alka unicorn there okay so we're getting somewhere now what I need to do is say so I just realized something I have the two people that I want to compare but I don't have an easy we have their names but they don't have an easy way of accessing their data and that's because my JSON file just came in as like a giant array so I could look through the whole array to find the ratings for each one of those people that's not going to be great so what I want to actually do is and I'm sure there's think about if there's a nicer way to do this but what I want to do is I want to create a lookup table that is essentially called and where's that did I say I call this bar users but really what I want to do with this is I want this to be an empty object because I'm going to actually have this users variable become a lookup table for all the data associated with each user by their lookup by their name so this loop I'm just going to take data users data users name data users name so I'm going to forget about this variable as being this shorter version of data users and just use data that users there and then what I'm going to do is I'm going to say users index so you know what I would like to do is var name equals data users index I name and I'm going to put the name as the dropdown option and then say users name equals data dot users index I so in other words all of the stuff is in an array that's how came in is JSON file I could reorganize the JSON file to work in a different way but I'm just going to build a lookup table here in the code I might as well so now I'm just going to show you the difference here if I say console dot log data and console dot log users I think you'll see in the console what I need so I'm going to hit refresh and I'm going to pull this over here now look at this this is the original array and you can see look at that it's just an ordered list where each critic is a look of Feist index but this is useless to us the order doesn't actually matter so I reworked the data and now I have an object where each particular critic is actually listed by their name so I can instantly see Cory's ratings are right here look up by Cory so now that I have that in my code if I come back to the code I can make it I don't need this console log anymore I can now say console just go to a console that log users index person one console dot log users index person now you might be asking yourself oh wait person one is a string but you're using array syntax users index person what's JavaScript objects are collections of key value pairs and I can access the key of an object like I could say users index Dan or I could say users index Dan these are 100% well these are identical but a lot of times Dan might have a space in it and so this is a completely invalid syntax but this is valid syntax so I have a whole video tutorial about this topic in particular called what is an associative array I'm going to link to that it's video description so if this is new syntax for you you could pause here and go watch that video and then come back okay but I'm going to move on now okay so let's just see if I have those ratings and what I'm going to do is I'm going to sorry ah where am I too much stuff here I'm going to now hit refresh and I'm it hit submit and look at this nice alka and alka now I'm going to go switch to alka and unicorn I'm gonna hit submit and I have alka and unicorns ratings so we can see I've got those objects with the range now it's finally time how long is this video going on are you still watching if you are thank you very much I'm going to actually do the similarities now okay so what do I need to do okay so first of all I need to get all of the movies associated with this particular person now this is a little bit tricky actually because once again I haven't been too thoughtful about how I structured this data so the data has all of these movies and these particular time stamps so you know what I'm going to do this is a little bit silly because I could I'm just going to have an extra thing I'm going to hard code in the list of all the movies just to make this a little bit easier I could certainly extrapolate this I probably should do that let's extrapolate it what I want to do is get rid of a time stamp and name so what I'm going to do what I'm going to do this is fine sorry I thought about the stuff before I started there's a lot of different ways I could approach this I'm figuring it through right now but one thing I'm going to do is I'm going to say VAR titles so the movie titles equals object keys person one so this is going to give me an array of all of the keys that are part of person 1 what are those things they are time stamped name and all of these now I want to ignore time step in name so then what I'm going to do is I'm going to look through all of the titles and I'm going to say rating 1 equals okay so the actual title is titles index I and then I'm going to set you know what I should do let's remove from the array titles will this actually work can I say let's let's think about this let's what's the best way to so if I say VAR titles equals a b c titles dots below it's never going to I could say titles index of be right and then title splice 1 comma 1 and so that removes B so what I'm going to do is this is a little bit awkward as I'm going to say I equals titles index of name and I'm going to just say title splice I comma 1 I just want to clean the data here a little bit I don't want the name I don't want the timestamp title J is title index of timestamp so that should work so now I should be able to see a console.log title let's take a look at this hit submit and I got huh 0 1 what ok I'm back I've made a silly Eric's this is not the full object the whole reason I built that users table was when I could grab the full object so I don't want the keys associated with person 1 person 1 is just the name so this is really name 1 this is name now person one the whole thing or I could actually could say like ratings 1 is odd is is user's name 1 ratings 2 is user's name then what I want to do is get all of the titles ratings 1 so let's look at that we get there all the titles but it has timestamping name in it so now if i console.log titles again after removing them we should see there we go what the array with n times have a name and now here it is removed and so now what I can do is I can get rid of these console logs and how I can actually do is say rating 1 equals ratings for that ratings 1 for that title rating 2 equals ratings 2 for that title so this is me looking at each and every one of those ratings one at a time and now I want to look at the difference the difference between how did user one rate episode four and how did user 2 rate episode four so so now I'm going to say VAR difference equals rating one rating this is if I come back over here this the difference squared and in the formula I need to square that difference sum all the squares of the difference in take the square root again lots of other formulas we could apply the square root calculation is perhaps unnecessary here and it's expensive but I'm going to do it the standard traditional way so what do I need to do I need to add up the squares of all these differences I'm going to say sum equals zero sum of squares and so now I'm going to say sum of squares plus equals difference times different and now I'm going to say I'm going to say a square root of difference equals the square root of the sum of the squares and actually this is the distance so this is now the distance so what I'm going to do now is I'm going to say create P distance so let's look at this okay create P distance so we're now going to see let's see if we get something here now if I do to alpha and alpha if everything works correctly I should get a distance of zero zero right because two people he out got is identical to alka okay oh now I'm going to switch to Alka and unicorn and I also got zero I'm a little bit concerned here Alka and he walks zero okay I don't like the way this is going let's let's see if I have an error hi I can see it in the chat already look at this ratings 1 equals oh no no no no up here aha very important that I actually get the ratings from the second user if I get the range from name one name one it's going to be wrong so now let's go back and say Alka and alqaida similarity score of zero and unicorn in alqaeda a score of 6.3 now here's the thing if they're more similar the number should actually be higher and if they're really far apart that number should be lower I want to have a similarity score where the more similar two people are the higher their score so what I really want to do is make some adjustments to the formula so one way to invert a value is to actually say similarity equals one divided by D right I want to invert the distance if if the distance is 10 I get 1 divided by 10 which is a bigger number then if the distance were 21 divided by 20 but here's a problem what if the distance was 0 so a nice way that I can fix that is just say 1 + D what this will actually give me is a number between 0 & 1 because if the two people are identical 1 divided by 1 plus 0 is 1 divided by 1 a similarity score of 1 and if D went to infinity like the distances as far away as possible 1 divided by affinity approaches 0 so I have some number between 0 & 1 so we can now see al Qaeda and al cuts and so now I want to create P and let me actually change this to what I'm going to do is I'm going to say I'm going to make a variable called result P and I'm not really being thoughtful about how I'm designing this at all let me say result P equals create P with nothing in it and then so I'm just going to instead of creating a new paragraph element each time I'm just going to replace what is in that existing paragraph element with a new similarity score so here we go alka now customary score of 1 alkane unicorn where score point 1 3 al Kamandi walks similary score of point 1 9 let's grow it's Chewbacca I saw a Chewbacca in here Chewbacca Chewbacca and the Ewoks a similary score of 0.1 6 6 6 6 6 okay so similarity score between two people what have I missed so one thing is there were some ratings that were no so I gotta watch out for this what am I getting if I have a null rating so let's just say if rating one equals no console dot log no so let's just check this did alka have yeah so Alka had one particular rating that was null so what happens when I say no null it probably javascript is sort of worked itself out anyway but I what I really should do is check and make sure if either these ratings is null or undefined I can't say not because it could be zero and that would evaluate to false I guess in this case the only only value of getting is null based on my data so this is going to be fine but I might have to be more thoughtful about error checking ultimately but as long as rating 1 is null and rating 2 is not is not equal to no I could go forward and continue to do this so so here we are now the only issue I maybe might get is if somebody didn't rate anything I'm ultimately going to get a similarity score of 1 but anyways error checking aside I could do a better job of that at least I'm now checking to make sure there isn't a particular value of null okay so here we go unicorn and this dot and we have our similarity score okay so we've come to the end of this particular video I would encourage you to try that getting this code get your own data make a different data set see what you can do with this sort of idea of similarity scores and here's an exercise for you which I'm going to do in the next video what if I wanted to take any user and just give me a list of the 5 most similar users and this is the next step we need for something called K nearest neighbor because what I want to do is start to evaluate to look at how can I find it based on all the data what can I find that's similar to similar to me and so that's something I'm going to do in the next video and that's going to lead us towards this idea of making a recommendation system for a new user who might not have rated all the movies how can we then predict a rating for a movie that that new user hasn't watched that's coming the other thing I'll mention is something you might want to look into is the something called the Pierce correlation score so one one issue with Euclidean distance is that lets say I let's say the ewok rates all the movies four and five four and five four and five four five stars Chewbacca rates all the movies oneandtwo oneandtwo oneandtwo stars well let's say that for every movie that the Ewok rates of for Chewbacca rates a one and for every movie that you operates a five to baka rate the to their different score might be quite their distance score might be quite far apart but their tastes are actually quite similar so the Pearson correlation is a way of calculating a similarity score that kind of accounts for that difference in range it has to do with fitting the data to a line and looking at the slope of that line if I were to graph all of Chewbacca's scores and they looked kind of like this and I were to graph all of the ewoks scores they look like this well even though the ewoks scores are all much lower it's the same shape as Chewbacca so the Pearson correlation would be a very high similarity whereas the Chewbacca scores look like this then they're going to be up it's going to be very low similarity so I do have this built and you can check this particular video's description for a link to an example that has the Pearson correlation score built into it maybe I'll come back and do that as a coding challenge but it's a bit of an ancillary point to this particular video okay maybe I'll see you in the next one