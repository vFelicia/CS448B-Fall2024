hello this is a train welcome its flowing into the station and it's brought with us a map of the world and what the craft of the world is showing you is little dots everywhere and earthquake has occurred in the last 30 days and the dots are actually sized according to the magnitude that earthquake and that's exactly what I'm going to build in this particular coding challenge so a little while ago I built this from scratch and it involves a lot of pieces so the point of this coding challenge is really to learn about the idea of mapping data in a world like the earth that the sphere in the twodimensional space so you need to learn about projections latitude longitude how to convert latitude longitude to pixel XY space and how to do that based on what you're how to get a data source in how to then draw it and so that's what I'm doing the pieces here is I'm getting this image of the world map from an API called mat box yet but certainly you could you know you have your own image you drew an image you design an image you got it from somewhere else as long as you know how that image was made you can you can do the same kind of project that I'm doing in this particular video I'm also getting earthquake data from the USGS the United States the US Geological Survey they have lots of wonderful scientific data that you can experiment with and then I'm using p5.js to draw the image of the world and then draw all these circles now one thing I want to mention is towards the end of this video I work on something to try to scale the size of the circles according to the magnitude of the earthquake and I have a little bit of math backwards for probably about five minutes of the video someone in the chat points it out and then I correct it so if you're watching and you realize like oh no my reference backwards there that's what happens but by the end I'm pretty sure I have the math right but if I have it wrong boy do I know that I'm going to hear about it in the comment so I look forward to hearing your feedback your suggestion I hope you make something with this you share it with me at shipment on Twitter and that you enjoy this ride on the coding train see you soon okay I'm starting this coding challenge now here we go so the first thing I'm going to do there's a lot of pieces to this but the first thing I want to do is just see the map of the world on the screen on the canvas I want to draw it and you know there's a lot of your ways you could do this you could find some JPEGs go draw your own map you could scan them half the question you have to answer for yourself by the way though one thing you have to remember is right the earth is a sphere so and I'm going to do this visualization in a 2d space a flat twodimensional space so when you take the information that's wrapped around the sphere and peel it off into a twodimensional space you have to apply some math and what that is typically referred to as a projection there are a lot of different math projections this is one from 1482 this is not something related just to coding and computer graphics the idea of how do you represent spherical information spherical imagery on a twodimensional service a surface there there are lots try out history I'm gonna scroll all the way down here there's one that's kind of I think a nice tip find it now illustration of what I'm talking about you could imagine if you had an orange and you peel the orange and you flattened out the peel what would it look like it might look like this one over here Mercator Mercator projection is one of the kind of standard ones and you know this this looks kind of like a little bit oh this is like Mercator projection now you can see though that what happens is things that are close to the top or close to the bottom when you sort of stretch out the poles of the earth become really really large so Greenland over here is incredibly massive as compared to say Africa which is kind of close to this which is there right with the equator which is not at all accurate so I think there are a lot of complex questions about the sort of you know Western view essentially of a lot of these map projections and I think that's a really interesting topic but I'm getting way off track here but it's important to mention really think about how you're presenting information and what you're highlighting and what you know what's up versus down what's center versus and so there's a lot of design considerations that I think are very important to mention but what I'm going to use is something of a standard these days called web Mercator and web Mercator is used from what I understand by most of the online mapping tutorials refine like Google Maps Open Street Map MapQuest that even exists probably does overlay all these who loves MapQuest out there I apologize I'm sorry it's wonderful I'm going to MapQuest that do you say that so they might said it anyway um so this is going on way too long okay so what I got to do what I'm going to do is I'm going to grab a map image from Matt box and then I need to understand what projection it's using so that I can apply the math to convert my latitude longitude to an XY location in that pixel canvas okay so the map map box you can you can find out information at Matt box.com you'll have to sign up for an account and get an API key and all that sort of stuff I'll include links in this video's description to where you can do that and I'm going to use something called a static map so Matt box has a lot of features that you can embed a map that's zoomable and you can put those little pins in it and do all sorts of stuff with it I just want to use it to get an image so the way that I can get an image for example is through a call an HTTP request to a particular URL so I'm going to grab this URL and what I'm going to do is I'm going to go to my code and I'm going to say I'm going to add a function preload and I'm going to say I'm going to have a variable called map image and I'm going to say map image equal load image and notice here that there's this piece of the code it says your access token so this will work right now if I were to run it I need to get my API token which I'm going to do right over here I already am on the page and it's right here I'm going to click copy so if you just go to this particular URL that's where you can create your own access token if you can painstakingly copy behind if you want I'll probably regenerate it later and then it won't work but okay so I put that in and then what I want to do is I'm going to say create canvas now you'll notice there are a bunch of arguments in here this is in this path this is the latitude longitude of the center that's the zoom level and then somewhere in here at 600 by 600 that's the pixel resolution that I'm getting so I'm going to now go and say create canvas 600 600 and then I'm just going to say image map image at 00 so if all goes according to plan when I go and run this code in the browser we see there it is whoa what kind of crazy angles Matt fig did I get oh my good so I wanted a flat nap I might have to adjust the API calls I just made interesting to see that it does that what I wanted is a oh I'm in the class I'm no oh dark I think dark beat so there's a lot of things like dark v.9 here using them so why is it angled oh you know what it is it's because there's a lot of arguments here there's latitude longitude we can look at the documentation zoom level and then this is like an angle I think so if I change this to zero there we go I flattened it so I don't know what the default is is this somewhere I'm guessing like in like San Francisco or something could possibly be but what I want to do now is I want to see a world map so I'm going to change the latitude and longitude I'm just going to change it to zero zero which is going to be at lab right there and then not really the center of the world this is a sphere like what's the center huh but our latitude longitude Center I'm going to change the zoom level to like 4 and then I'm going to hit refresh and we see oh let me zoom out some more I'm actually the change the zoom level to 1 and we can see there we go so I've got the world map now I want to see a wider picture of the world map so I'm going to change let's change this to 1024 by 512 I think this should behave nicely for us up but if I do that I want to change create canvas to 1024 512 so let's refresh that whoops oh it's just super big now whoops nope sorry I got a zoom out here a little bit so there you go so now you can see I've got the world map with this dark theme and there it is in my p5.js canvas we're getting somewhere now if I wanted to do more of this I would suggest if you're watching and you actually pull this code I would probably do something where I make assess avaria Buhl's for width and height and zoom level and all that sort of thing but I'm just going to leave this stuff kind of constant for right now I am going to though I am yes not only that stuff constant right now so now that I have got what I need to do is figure out let's say I have a latitude longitude so let's say I have a latitude longitude that is the latitude of zero longitude is zero now it might be worth me refreshing your memory if latitude and longitude are familiar concepts to you but you've sort of forgotten what exactly they are and how they work so let's say I were to try to draw as best as I could spear and I can kind of represent it with these lines and by the way what are these lines these lines are longitude so longitude are the line I can think of them as like long because they go too long up and down but there are the vertical lines and they're really going to map to our X location because we're going to take this and kind of unfurl it so to speak onto into a flat rectangle so we want those longitude lines to end up like this so these are the X values our longitude and then the Y values are latitude and you know this being perhaps like a zero zero the Y values then being latitude okay now there's another sort of key aspect of this what is the range of these values so they are described as angle essentially good because there's angles of rotation in the way around the center of the earth and so if there's a full rotation of 360 degrees we can kind of go all the way this way to 180 degrees and then go all the way this way to negative hundred eighty degrees the thing is I'm going to need to use radians as a measurement in my code and so that's something we're going to have to sort of think about this is PI and this is negative PI and I have other videos that kind of go over the basics of radians and units of measurements that you could be watching try to find if that's a new copped concept for you now latitude on the other hand will gone all the way around it's just going halfway up and halfway down in a way so the range is between 90 and negative 90 and I probably got that wrong I think 90 is north and negative 90 is up by the way if you look up the lat lunch your latitude with you if you google like a latitude longitude latitude of New York City you'll find the number will be something like 74 degrees west so 74 degrees this is actually 180 degrees west this is 180 degrees east this is 90 degrees north this is 90 degrees south so the negative numbers are what we need to use in the math but you'll often see them listed as north south west east which is something you might need to convert depending on what how your data is formatted okay so hopefully that clarifies that a little bit so I'm actually going to what I'm going to come back over here and I'm going to do a couple things I'm going to do I'm not absolutely called center latitude Center longitude and then I'm just going to have a variable called latitude a variable longitude I would like to pick a city somewhere in the world that's not the United States that may be I know approximately where it is even though I've got the sort of bad American sense of geography so let's look for a city where where there a lot of trains well this lot trains did Europe and Asia ever where there's trains that's a bad bad clip let me let me look for let's look for Shanghai latitude longitude so you're seeing here we've got thirty one point two three zero four North 100 to one point four seven three East so let's take this into our code and let's put that here I'm going to just comment this put this in comments here so the latitude is the north number and the longitude is the East number and it's not negative if we're west it would be negative and what I want to do now is draw is draw the location it converts to its X&Y so what I need to do here and I don't need the draw function I need to figure out how do I convert those things ah guess what we're going to just look up the formula it's going to look kind of terrifying but I think I'm going to write it for you in code and it will hopefully be possible so here we are in web Mercator and web Mercator is based on what what we need to do is to calculate this X&Y we need to apply this formula so the reason why this number is 128 is web the standard of web Mercator is that it's giving you the XY for a square where the top left is 0 0 and the bottom right is 256 256 so the centre is 128 128 I think actually nap box does but tiles that are 512 so I think I actually need to change that number to 2 56 so that really depends on the kind of again the system you're using the zoom level is this value of how far zoomed in or zoomed out this lambda here is longitude and the letter of the greek letter fee is latitude so if i write this code and i'm just going to kind of do this a little bit i'm going to write a function called i'm going to write a separate function for x and y i could wrap this into one function i'm going to write a function called web Merc I'm just gonna call it Merc Merc X and it takes Merc X takes in a longitude value and now what I like to do sometimes with formulas like this is I'd like to break them into parts rather unnecessary but I think it'll make us less likely to make a mistake so I'm going to just do the first part I'm going to call it a and that is 128 divided by PI times 2 to the zoom level right so 180 divided by PI times 2 to the zoom level so what is this we've the zoom level is right now is something that I've defined here as 1 so this is something that I could make into a variable I really should make it into a variable and I'm going to say zoom equals 1 so again I should put that in here but I'm gonna leave that out right now okay so so now the zoom is taken care of great you know what I could do actually is whenever I could give this Merc X argument longitude and zoom level but I'll just use it as a global variable okay that's barrei now I'm going to say var be the second part if I go back to the formula is just the longitude plus pi okay so longitude plus pi but guess what one thing I need to make sure I'm going to have an issue I'll get to it later whether its degrees or radians is important the formula is assuming longitude is going to come in in Radian so I have to make sure I remember that now I can just say return a times B right because it's this 128 divided by PI times 2 the zoom level times the longview plus pi okay great now let's write 1 for y Merc why latitude and we can see here that the parts a little bit more complex once this part a is exactly the same let's make part be just this tangent part of the equation so I'm going to say Part B is a tangent of pi divided by 4 plus C which is the latitude divided by 2 latitude / okay that's B and C is law pi minus log of B so PI minus log of B now you might notice right here that this says Ln Ln means natural log so logs have a log what a logarithm is that merits or of a separate video but if you see LM it means natural log base E which is a special wonderful number but in in most of programming frameworks if you have the log function it's doing by default a natural log and you can obviously adjust that to a different base but so this dis mapped to it perfectly here log of B okay so now I need to say a times a a times c right a times c because b is just for the purpose of this so a times C this is now giving me the Y location okay I think we're doing well here now what we can do is say um so one thing I'm going to do which is kind of unnecessary but I need help a lot of people I don't even get messages of how I don't need to do this but it helps me think about it I actually would like to work from the center so I'm going to translate with / Q height divided by two if I do that look that moves the origin point from the top left to the center and I'm going to go to my code I'm going to refresh it and you're going to see now the image is the origin is in the center so I'm going to change image mode to center so that now the image is drawn from the center so now I'm back the reason why I'm doing that it's a little bit weird but what I want to do is I want to draw everything the value that I'm going to get from this math is relative to a center point so it's going to be a little easier for me to kind of figure that out this way so what I want to do first is I want to say var Center X E old Merc ex of launch of longitude sender longitude and center y equals merc y of center latitude then i want to say x equals merc x mercs x of that of the longitude this is the Beijing I mean sorry Shanghai longitude and then the Shanghai latitude and then what I want to do is where I'm going to position them on the screen is the difference between those two points so if CX CY is the center wherever that is relative to the center of the window is its location that center location so now I should be able to say let's make a nice little circle with some alpha and let's draw an ellipse at that x + y 20 by 20 pixels let's not be afraid let's hit refresh Earth okay so it's not there what's the problem I forgot about my units of measurement so this is definitely a problem here which is that these measurements are in degrees and the fact is the calculations are assuming radians so what I need to do is convert these things beat them to rating so I'm just going to add a line of code here that says longitude equals radians longitude and I'm going to say latitude equals radians latitudes and and the reason why I'm going to do this is I know that when I go get that earthquake data I'm going to get values and degrees because I've looked at that data before okay so now I'm gonna hit refresh it's there but it's not in the right spot the reason it's not in the right spot is remember I said map that box actually uses tiles 512 by 512 and so I'm going to change these to 256 256 and I'm gonna hit refresh and there we go that looks right to me somebody tell me that's not where Shanghai is let's go to the other side and let's look at Vancouver Vancouver latitude and longitude and let's try that out I'm going to grab this here and put this into my code and so now I need a latitude of forty nine point two eight to seven and in the longitude not of one twenty three point one 207 positive because it's West I need to add the negative number there okay and here we go let's go back to our code it refresh there somebody tell me that's not where Vancouver is I'm pretty sure I've pinpointed it now that circle is kind of large really shouldn't I shouldn't do anything that might cause me to discover a mistake but I'm just going to make that circle a little bit smaller hit refresh and I think that's that looks right deadon where Vancouver is right somebody from Canada tell me if I've got that wrong okay so we're doing well here so now I've actually done almost everything because what I have now is a framework for re4 taking the latitude longitude and converting it to an XY that I can draw so let's go get some data that has lots of latitude and longitude in it so the data that I'm going to use is from the US Geological Survey here is the page usgs science for a changing world let me tell you something science very important wonderful thing I'm all about the science I wish I knew more about science and what they have what USGS website is in addition to lots of things I'm on a page which I'll link to in this video's description is it'll give me a data feeds of earthquakes so I could get just significant earthquakes in the past hour I think just to get some data but not too much data let's get all earthquakes in the past day so I'm going to copy paste this link address and I'm going to go to my code and in preload I'm going to say earthquakes I'm going to make a variable called earthquakes and in the preload function only move this low I need more space to look at this code I'm going to go here and I'm going to say earthquakes equals load strings there and I'm now notice what it's actually loading it's a CSV file so that file is actually a comma separated value file it's essentially a spreadsheet and I can look at it this is a different one but if I go to the I downloaded one already which is right here this is actually everything from the last month and you can see here it's a it's a table it's a table which starts at time latitude longitude here's the time here's the latitude here's the longitude and here is then there's some other things magnitude is something that√≠s I want to look at because we can use magnitude to decide how large to maybe draw something on what color to draw something but I'm going to leave most of those kind of interesting design decisions to you to do something more creative with or maybe you're going to do map different kind of data but what I really want to focus on it's just first getting those latitude and longitude so the way I can do this now is there is a function in p5 called load table this is such a simple bit of data that actually think using load strings a little bit simpler I'm going to redo this challenge making a 3ds version of it in processing and use load table there just to show the difference that will come sometime eventually so now what I'm going to do here in setup is once I have the data I'm going to say for VAR I equals 0 I is less than earth quakes dot length so low string will give you an array of strings each string being a line in that data file so all I need to do with each one of those is call a function called split so I'm going to save our data equals earth quakes index I dot split then I'm going to write something kind of weird here so what I want to do is say what is the delimiter that I want to split everything up by what I want to split everything up by a comma but why didn't I just put a comma in quote because normally in JavaScript you'd put a yellow string in quotes I use these forward slashes this is something known as a regular expression which is a sophisticated way to match a particular pattern of text and I'll link in this video's description to a whole set of tutorials on regular expressions but here we get simply the only pattern I want to match is a single comma so that's going to be easy so now if I do that I'm just going to say console dot log data and let's take a look at what we get in the console I'm going to kind of move this over here we can see I'm getting a whole bunch of a arrays so I get an array and I can see here the first element is the timestamp the second element is the I believe it's latitude first then longitude yeah it has to because that's negative 166 some other data about the earthquake this 2.2 is the magnitude on the Richter scale and the chapel 20 odd split with the comma with it with quotes as a string does work also but in case you end up wanting to do more elaborate splitting it's kind of useful to have the option of a regular expression okay so I am going to now I am going to what am I doing here so what do I want to do the latitude is the first it's not the first if I go back to this it's this is element 0 element 1 element 2 so latitude is index 1 of that array latitude is data index 1 longitude is data index 2 and then guess what all you do is take this this exact same code once I get that latitude longitude convert it to X&Y draw a little circle and now we will see I'm gonna take out this console.log something I need that and move over here and I'm hit refresh and there we go these are all the earthquakes that have happened in the last what was it the last hour I think did I do let's go get the last now that we see this is working let's go grab let's go wrap all earthquakes from the past 30 days that's going to be a lot to ambitious of me so I'm going to I'm going to just paste this here and I'm going to do this and I'm going to comment out this line of code so I can now which is awkward to do here I'm gonna paste this end up time I must have gotten rid of a quote or something yep got rid of the end there ok so so many ways I could make this code a little bit nicer but that should do now I'm going to refresh we go it's going to take a little while a lot of data actually didn't take that long look at that so you can see all the earthquakes from the last month and you know things that I could do to this I could first of all I could think about zooming in on a certain part by changing the zoom level on the width and the height of the map and that sort of thing you want to be careful you know again the way that the way that map box works if you start playing around with a zoom I would if you want I would I would not make with our height greater than 1024 and it actually seems to work really nicely if you keep that as a multiple of like 256 or but I don't think that should be required but you know play around with it I could you could change but also you could just think about animating it you could look and one thing I would like to do that I think is worth doing is just drawing these with the size based on magnitude so let's figure out let's look at how we would do that so right now where I'm drawing the size is just here 8 comma 8 so what is the actual size in the data it is latitude longitude depth magnitude so I'm just going to use the magnitude which is one two three index four so let's go back to the code and I'm going to say var M for magnitude or magnitude equals data index three now I'm gonna do something wildly not accurate but I'm just going to get started with its just so we can see something I'm going to say var diameter equals map the magnitude from a range from zero to ten to arrange from zero to two to a sixty so I'm just going to take that Richter scale magnitude and map it again there's lots of mathematical problems what I'm doing but just to get something on the screen that's got some difference I'm gonna put this D now into here and we can run this oh boy look at that ah we've got some what did I do wrong did I get the wrong oh I said three should be four I was using the wrong value okay so we can see we've got something but look at this there aren't really lots of earthquakes of such like large magnitudes happening all the time all over the place and the reason why this is there's a couple reasons why this is terribly inaccurate and we find my eraser two fundamental reasons number one is magnitude on the Richter scale for earthquakes is measured if I'm correct in a logarithmic scale meaning if I have a earthquake of magnitude five and I have an earthquake of magnitude six this earthquake is actually ten times as powerful as the earthquake of magnitude five some research at tell me about that wrong I can come back and correct it so that's one thing so I need to think about drawing the other thing that's really quite important is here is when I take a circle and I give it a diet in it let's say it has a diameter of four which means it has a radius of two and then I have another circle that has a diameter twice the size of eight which means a radius of four the thing that I'm seeing visually is the area of it and the area is PI R squared so the area of this is four pi and the area of this is 16 PI so I'm actually drawing this is something that is four times as large as this but the radius is only twice so I need to account for that when I'm visualizing stuff using circles that's kind of an important you know if I were just doing population for example I wouldn't map population directly to diameter I would map it to the square odd map into the square root square root of population to diameter something like that we're going to get that right as we come over here if we come back over here now I can start to implement some of this math into the actual code itself so looking at the code the magnitude what I want to do with the magnitude really if if the magnitude is five and the Richter magnitude of six is ten times that what I could say its magnitude equals itself to the tenth power so this is kind of unknown inverse logarithm logarithmic again it's inverse logarithm I'm going to actually set it to the power of ten now the other thing I want to do is take the square root of it because ultimately I'm going to map that to the diameter of a particular ellipse so I also want to say magnitude equals the square root of itself so now this mapping instead of going from zero to ten meaning to Memphis to sort of maximum on the Richter scale of ten I don't know if that's an actual maximum I should look up the Richter scale but what I want to do is get a new maximum so I'm going to say var mag max equals power the square root of ten to the tenth power so if ten is my maximum magnet dude then I want to make that the maximum and then so the mapping now goes from here to here and let's take a look at that and we can see now almost everything has disappeared because most of the earthquakes are small but there was I believe recently I saw in the news a very large earthquake I don't know I should look this up where this was but I'm pretty sure I've got things accurate here we could we could look into the data and see what this is I could also try to make this a bit more everything a bit more visible one thing is I could say give me a stroke of color to put around the circles and I can also you know make this 180 for example to really sort of like emphasize so now we can see you can see lots and lots of tiny earthquakes up along here lots and lots of tiny earthquakes here and really some larger ones over and around here so I think we've done it this is now mapping earthquakes I did it wrong I totally did it wrong stop everything it's not thank you this is not correct it should actually reverse the logarithm it has to be 10 to the magnitudes power right I'm sorry about that y'all everybody screaming about at me watching this video I wonder if I should just go all the way back and redo this because GUI or watching it but maybe it's fine to have this wrong so I just go back so in other words 10 to the 4 is 10 times 10 times 10 times 10 10 to the 5 is is 10 to the 4 times 10 so this is really how it works so I actually had it quite wrong there so let's take a look at that and that should you know it's really the same idea but it's going to you know make it a bit more right this would actually looks fine because both of these worked 10 so I think they're worth quick you're going to get quite a bit smaller actually the small ones and you can see there we go so I got the similar effect apologies for that mathematical error and now I think you know those of you injure you can enjoy see the process about how I constantly make mistakes but I think I have it right here now and I could change the mapping I could change the color alka in the chat made a great suggestion of if you wanted sighs here see if you can create a time lapse version of it so I actually use the time stamp and now to see the earthquakes all pop up over time over 30 days but how that all happened in 30 seconds you could also write it so that your refresh the data query so if you look here on the webpage here on the on the webpage here I'm on the wrong webpage if you look here on what am I looking for uh the USGS website you can see that you can get every five minutes earthquakes updated from the past hour so this would be interesting to think about how you might animate them and refresh the data every five minute so I hope that you code here will be linked I hope that you make something with this I or even if you just use this to create some other types of mapping project please share it with me share in the comments or share that shipment on Twitter thanks for watching and another coding challenge