[TRAIN WHISTLE] Happy Pi Day 2023, everybody. Oh, I'm excited for what I'm going to do today. I thought I would just combine two things that I love. One is delicious wonderful pie and toothpicks. Now you might be asking, you love toothpicks? That's a little weird. Well, I do have a coding challenge all about toothpicks. And I thought there's no chance I'm ever going to get to use toothpicks again. But today is the day. I am going to approximate the number pi by dropping a box of toothpicks onto the floor. How could that possibly even work? This problem is known as Buffon's needle named for GeorgesLouis Leclerc. Comte de Buffon. It's a very famous geometric probability problem from the 18th century. And it goes like this. Let's say you have a desktop, floor, whatever some horizontal surface. And it's made of wood, strips of wood with a given width. All of the strips are the same width. Now you have a box of toothpicks. Those toothpicks are shorter than the width of those strips of wood. And you take that box, and you dump it out on the table. What is the probability that any given toothpick will land and cross the border between those strips of wood? Well, guess what? This is another case where magically the number pi shows up. That probability is linked to the number pi. I'm going to simulate this idea of toothpicks as lines and see if we can approximate the number of pi in a p5.js sketch celebrating the wonderful day that is Pi Day (SINGING) It's Pi Day, Pi Day. Delicious and sweet, It's the only number that you can eat. It's Pi Day, Pi Day. Before I write the code, let's unpack the scenario a bit more and take a look at the math and where the number pi shows up. Imagine this whiteboard is the surface upon which I am going to dump a whole box of toothpicks on. And the important variable here is what is the distance between these parallel, vertical lines. Let's call that variable t. Now I'm using t because that's the naming convention that's on the Wikipedia page that defines the Buffon's problem. I don't know if I'm pronouncing it correctly, but I'm just going to say Buffon. The next thing we need is to discuss, well, what is the length of the toothpick? And I'm going to call that variable l. Let's start with the length of any given toothpick to be half of t. And let's make a gross oversimplification of the scenario just for a moment and say that there's some magical force at play that only allows the toothpicks to fall perfectly perpendicular to these vertical lines. So maybe a toothpick falls here, one falls here, one falls here, one falls here, et cetera all perfectly horizontal. The important number that I need to evaluate to determine if this particular toothpick is crossing one of these boundaries is the distance between the center of the toothpick and whichever vertical line happens to be closest to. So it's not this one. It's much further from this one than it is to this one. And we'll call that distance x. If x is less than half the length of this toothpick, if x is less than l divided by 2, then it is crossing one of these boundaries. How often will x be less than half the length of l? Well, because l is half the length of t, it's actually going to be 50% of the time. Think about that. If x is anywhere a quarter of the way across, then the toothpick is covering the boundary. If it's anywhere in between here all the way to 3/4, it's not crossing the boundary. Anywhere here, it is crossing the boundary. So that's 50% of the values in between the two borders it won't cross and 50% it would. Let's say l just happens to be the actual length of t. Well, then, it's always going to be crossing the boundary. There's nowhere for me to fit it where it's not touching one of the boundaries, so that would be 100%. So we can see here that there's a relationship between the length of the toothpick and the probability that it will cross one of these borders in the case of when the toothpicks are all falling perfectly horizontally. Now, of course, this is not actually how the toothpicks will fall. They'll fall askew at an angle. Maybe one falls like this. Maybe one falls like this, like this. Now, we have a new variable at play This particular angle. This is known as the acute angle. I know it's cute, but that's not why it's called acute. An acute angle is the angle that's between 0 and 90 degrees or pi divided by 2. So looking at this case, let's think for a moment. That's about 45 degrees. I'm sure I didn't draw it perfectly. But let's just now also say how's another simplification? Let's say the magical force now drops all the toothpicks at perfectly 45 degrees. So this is my toothpick, and this is the border. Remember, the distance I care about is the distance between the center of the toothpick, which is eyeballing it maybe about here, and the closest border, which is here. That's x. But right now, I want to calculate something different. I want to calculate this distance. This angle here is theta. What is this length here? Remember, the length of the entire toothpick is l. So the length of this hypotenuse of this right triangle right here is l divided by 2. Remember a nice wonderful trigonometry function called sine of an angle which equals the opposite over the hypotenuse? Well, this is the opposite, and this is the hypotenuse. Opposite equals l divided by 2 times sine of theta. So if this distance x let me get another color marker here. This is x here. If x is less than l divided by 2 times sine of theta, then the toothpick this whole toothpick is crossing a border. And if I were to take this idea essentially and consider it like I was doing here, now I can say, well, if all of the toothpicks are at a 45 degree angle, that's essentially the equivalent of the length of all the toothpicks being their actual length times sine of 45 degrees. So if all of the toothpicks were really to fall at 45 degrees, then I could say that the probability, if the length of any given toothpick is half of the width of each of these columns, then the probability is 50% times sine of 45 degrees. Essentially, the probability is the ratio of the length of the toothpick to this width times sine of theta. But the toothpicks don't actually fall at all the same angle. So we need to apply the idea of a uniform probability density function. There is an equal chance that an angle will fall at 0 degrees to 90 degrees to every angle in between. Theta will always be somewhere between 0 and pi divided by 2. x, that distance between the center of the toothpick and the nearest parallel line, that will always be somewhere between 0 and t divided by 2. So how do we calculate the probability for any toothpick that falls inside of this range of x uniform chance of all possibilities and inside of this range of theta uniform chance of all possible angles? What would be useful to do is look at a graph where one axis relates to x and another axis relates to theta. I know this is kind of counterintuitive, but let's have the yaxis be x. And let's just assume right now that t is 1. It's going to make things much simpler. So we have a range between 0 and 1/2. This is that distance to the border. Let's consider the xaxis to be the angle. And we have a range between 0 and pi divided by 2. And I'm just going to put pi over here, and maybe I'll get to y. I'm adding that along the xaxis as well. So what exactly, again, am I graphing here? Let's stop for a second. Remember, I have a space with parallel lines. And I've defined the distance between those lines as t, and that's equal to 1. t is equal to 1. Now I also have a toothpick with length l. And I want to assume my toothpick is also of length 1. With t equal to 1 and the length of the toothpick equal to 1 and this toothpick always touching the border, so if the angle were pi divided by 2, this would be the toothpick, what is the distance from x, the middle of it, to the border? It is 1/2. So I can plot that with an angle of pi over 2. The distance is 1/2. Now let's look at the case where the angle is 45 degrees or about pi divided by 4. I'm not going to draw this perfectly, but I'm going to try. This is now the angle 45 degrees. This is x. What is that distance? Well, if this is 1/2, then it is 1/2 times sine of theta, which is going to be I don't know maybe like 0.35ish. So the generic formula here for this value is equal to 1/2 times sine of theta. And if I were to plot that, I get this nice circle extending it all the way out to pi. Now remember, the toothpick isn't going to always fall with it precisely touching the border, but that's what this curve represents. Anywhere where that distance is below the curve, it's crossing a boundary. Anywhere where that distance is above the curve, it's not crossing the boundary. So this is really the same scenario in some ways as a coding challenge I did when I was throwing darts at a circle, and the ratio of the number of times the dart would land outside the circle to inside the circle was a way to approximate pi. We've got the same thing here. The ratio of how many times the toothpick lands and crosses the border versus doesn't cross the border can help us approximate pi. So how do I calculate the area here underneath this curve? Well, I need to use calculus. The area under a curve is known as the integral of that curve. And I should also point out that this isn't actually a circle. 1/2 is a much smaller distance than pi over 2. I really should have drawn it like this. So it really should look much more like this. And basically, this is half of this kind of ellipse. Actually, now it's getting to be a mess. Let me erase this really quick. [MUSIC PLAYING] Not my finest work, but this is a better version of that graph drawn to scale. And you can see that the area of this total rectangle is pi times 1/2, or pi divided by 2. And if we were to do the integration, the calculus, we would discover that the area of this half of this kind of ellipse here is actually 1. So the ratio of the area under the curve to the full rectangle is 1 divided by pi over 2, or 2 over pi, meaning, if we could take a box of toothpicks all of length 1, drop them onto a surface where the columns were spaced out by one, count up how many toothpicks crossed a border versus didn't, we can solve for the value of pi. I don't want to admit how many times I drew that graph. Here's a version of the graph that's actually drawn precisely, and I'll include the code for that graph as well. Additionally, if you want to do a deeper dive in the math, let me suggest three resources. There's a wonderful description of this problem from the College of Education at the University of Illinois. Includes the same graph and a discussion of the area underneath the curve. There's, of course, the Wikipedia page for Buffon's needle problem, which actually shows the integration formula. And you can see there that that's a more general purpose version of the formula for any value of l and any value of t. You can also find this wonderful post on Thomas Ogden's website that describes the problem and includes many different links to other resources as well. I don't know if I thought I'd ever get here, but I can start working on the code part, which I think will be the part that I'll be a bit more comfortable with. That was a struggle for me to try to explain that math. And thank you for tolerating it. So let's consider a p5 canvas, 400 by 400. We need some variables. For example, what if t is equal to 100? That'll make things kind of easy. Maybe I should go for 50 right now. And then let's have the length of and I'm going to call that len for the toothpick equal to 25, half of that width. So in the draw loop, first step is to draw the vertical lines. There we go. Looking good. And then I need to randomly drop a toothpick every frame. So what am I picking? If I'm dropping a toothpick, it's going to land with its center somewhere between 0 and the width of the canvas and a random angle between 0 and pi divided by 2. But visually, I want this to look more interesting, so I could actually have it any angle between 0 and 2pi. So that's a random angle, and that's a random position. Now let me just draw the line. Oh, and I'm going to need a random y. The y does it matter. But to make it look interesting, I'll pick a random y. How am I drawing the line? So the line will be a horizontal I'm going to rotate by the angle. And then I need to draw the line with x at the center. So x minus length divided by 2, 0 x plus length divided by 2, 0. There's all my toothpicks. So clearly, let's draw just the background and the lines once in setup. And now we're drawing all these toothpicks. Great. We're really cooking here. We're going to be done so soon. Why are there so many toothpicks over on the lefthand side? I must done something wrong. Oh, look at this. I forgot my pop. This looks better now. Oh, look at me. No, no. No x there. All that math really broke my brain. I'm translating to the x, y position of the line, so the line is then drawn from negative length divided by 2 to positive length divided by 2 along the xaxis, y being 0, and then rotated by an angle. Now we've got all of our toothpicks. So I need to figure out is the toothpick intersecting one of those lines. Let's also change the stroke weight here to 1 so that it's a little easier to see the lines underneath the toothpicks. There's a lot of toothpicks there because I've been sitting here for the last 5 or 10 minutes trying to think about, wait. Is there a way I could do this without I don't know using the builtin variable 2pi in my code? I mean, after all, I'm trying to create a simulation to approximate the value of pi in a scenario where I wouldn't know the value of pi. So if pi is in my code, haven't I just this is terrible. I think you and I together right now just need to admit that, yes, the core idea here is doing this in real life with actual toothpicks. And there, you would never be using the value of pi in your physical manifestation of dropping the toothpicks. But in terms of being able to draw the stuff to just simulate it, the point is for the viewer to see what's happening. And if I'm using pi underneath the hood, I think that's OK. Are we OK with that? I'm OK with that. I hope you're OK with that. So now I just need to write a function to determine if the toothpick has crossed one of the lines. So if I know the x, y, the middle of the toothpick, I need to find what column is closest. So I can actually take that x, y position and divide by the width of the column and round up or down. So x divided by t, and then round that. Then the distance is the difference between that closest column location and x or the absolute value thereof. Now if that distance is less than 1/2 the length of the toothpick times sign of the angle, it's crossing one of the columns. Let's draw it as green if it is intersecting one of the lines. What's wrong here? Oh. So I found the closest column is the index of the column not the actual x position of the column. I need to multiply that by t. Something is wrong. Oh, oh, oh. Oh, my goodness. What a mess I have done of this. First of all, I'm picking any angle between 0 and 2pi. And then, I'm using sine of that angle. But what's going on? This is my p5 canvas. This is the horizontal axis. I drew my line like this between negative length divided by 2 to positive length divided by 2 with this being the center. If I'm going to rotate it by an angle, I'm rotating it relative to the xaxis, whereas, really, I want to rotate it relative to the yaxis. I also want the acute angle, not any angle that it happens to be. So I need to account for that in my code. So the first thing I can do is draw the line as a vertical line. That will help me quite a bit. So you can see here, if you zoom in, some of them are correct, and some of them are incorrect. So let's just, for right now, only do any random angle between 0 and pi over 2. So this is correct now. But I only have a very small range of angles. So visually, it just doesn't look right. it looks a little wonky. I think it's going to be fine if I pick any angle between negative pi over 2 to positive pi over 2 is actually all the possible lines you could draw. I don't need to go the full 360 because it mirrors itself. That looks right now. I could also do between 0 and pi probably. I think it still looks correct, although, visually, this is a very poor way that I'm drawing it. Let's see if we can come up with something better to highlight the lines that intersect versus the ones that don't. Let me try switching to a darker background and use a brighter color for the intersections. And let me make the lines thinner. And now maybe I'll make the whole thing much bigger. And let's do like 10 lines per frame. We're ready. Now what I need to do is calculate an approximate value for pi. Let me get a little bit smaller. So I need to find the ratio between the number of toothpicks that are intersecting and then the total number of toothpicks. So every single time total goes up by 1 and only when they're intersecting, intersecting goes up by 1. Then the ratio equals intersecting divided by total. And the probability is 2 divided by pi times l divided by t. So the probability equals 2 divided by pi times l divided by t. So I want to solve for pi. So pi times the probability equals 2l over t, or pi equals 2l divided by the probability times t. And for me, I'm not calculating the probability. I am inferring it from the ratio of the number of ones that intersected versus didn't. So this is my ratio in the code. So my pi approximation, which I'll name pi, is equal to 2 times the length divided by the ratio times t. What error am I getting here? Oh, there's a reserve function called ratio, so we'll call this probability or prob for probability. So dare I look at my pi approximation? Hey, that's not so terrible. That looks kind of like pi. I think I might have done this correctly. Let's at least put that onto the canvas. Well, actually, let me make a DOM element because drawing it out of the canvas might be a little bit wonky. Let's make the page have a white background, so the text is more visible by default. [MUSIC PLAYING] So now I have a div that I made in p5 that's just showing the value 0.0. And now I'm putting in the approximation of pi to five decimal places. Let's go back and just drop one toothpick per frame. I enjoy watching it slowly converge. 3.1415926535. I should also mention that, even though I didn't take this approach, I could have actually used the formula, the algorithm for testing whether one line segment intersects another line segment. And, in fact, I've done this before in the 2D raycasting coding challenge. I don't remember what number that was, but I'll put it up here on the screen. So I'll make sure to include a link to the time code in that video where I go through that algorithm, as well as this other p5 example, which looks at how I can actually test whether two line segments are intersecting or not with this particular algorithm. Well, I'm not getting the best approximation here, but I I've really enjoyed this project. I am curious to see what it looks like if I have a much smaller length. What if I do 100 lines per frame? 897932384626433. This is kind of fun to see. And there you have it approximating pi with Buffon's needle. Now I had a lot of fun doing this. I found it quite challenging to explain all the math. Let me know if you have questions or something didn't make sense or certainly if I got something wrong. I would love to hear from you. Are you inspired to make your own version of this simulation? What could you add to it, change the design, the color, the interactivity? Could you try some kind of physics simulation of the toothpicks bouncing around? Maybe you try different shapes. What's the probability if it's squares or circles or other kinds of polygons besides just simple lines? If you make your own version of this, I would love to know about it. And guess what? We've got a whole passenger showcase at the codingtrain.com in the video description. I'll include a link with instructions for how to submit your own. I would love to check it out. Thanks so much for taking this time with me and celebrating Pi Day. I will see you next year, 2024 Pi Day and maybe beforehand through the internet or whatever. I'm going to stop now. Goodbye. [TRAIN WHISTLE] (SINGING) Pi Day. My favorite treat. Circumference divided by diameter t. It's Pi Day, Pi Day. Actually, now it's getting to be a mess. Let me erase this really quick. [MUSIC PLAYING] Not my finest work.