chrome extension coating challenge number two I'm also going in this coating challenge I just made one that replaces images with kittens if you didn't watch that already you can also check out the Chrome extension tutorial playlist for a lot of background information but in this video I'm going to attempt to make a Chrome extension for any web page that you're on like the p5.js library page that I can like doodle over it so and I'm going to do over it with a p5.js sketch so how do I do that so one thing is so I I did already but one of the first things you need for a Chrome extension if you're watching in other videos you already know this is a manifesto JSON file that is the configuration and all the information about your Chrome extension that you need so this being just a Content script I want it to work on any URL and more likely I probably want to do something where I press a button and then I can draw on maybe I get a popup with an interface to pick the color but we'll get to all that later right now I'm just gonna do the simple thing that for any web page I can suddenly draw on it so I'm gonna put all the code for drawing in sketch j/s and just to show you what I mean like a simple p5 sketch would be something like this function set up function draw I'm going to say create canvas I'm just gonna just give some arbitrary size right now I'm gonna say I'm gonna like absolute position it so that it is over and I'm gonna say clear so I don't think I need to say clear I think by definition is clear so that it's a transparent canvas and actually I'm not even gonna do that I just want to see the canvas on the page so I'm gonna say background zero so here's the thing now let me try running this extension let's see what happens so I put I I have this manifest.json I have this sketch let's load the extension let me close a bunch of this extra stuff if you're wondering why everything appears to be an image of a kitten it's because I'm still running my other Chrome extension so I'm going to I'm going to keep that enabled I'm gonna load a new extension called because I can't turn off the kitten one sketch and so again you need to be at Chrome slash lash extension and you need to have developer mode on and you can find out more about this in some of my other tutorial videos p5 sketch version 0.1 is now running so let probably I probably should turn this one off but let's go to this web page now that I want to draw on open up the chrome console I'm gonna let this be myself some more space here I'm going to so actually it's time I've got to disable this because this extension is spitting out a lot of stuff in the console and I want to just look at the stuff for the p5 sketch so I don't see anything like the extensions I think nothing going on here well let me at least say console dot log sketch started sketch looping I know why this isn't working by the way and being I'm kind of like setting the stage here for what I want to talk about and then I'm gonna say console dot log its sketch block okay so let's reload this extension reload and I'm gonna hit refresh sketch blah but no setup a no draw so here's the thing well a couple things number one is I didn't include the p5 libraries I mean I have them in there I have sketched a sp5 dot JSP five dom dot yes so I've gotta at least in manifesto JSON reference those so let's say and I might not p5 Dhananjay s and this should be double quotes so I want all of these JavaScript libraries so this is by the way how you can reference another JavaScript library in a Chrome extension and I think there's a way to do this with a URL path I'll have to come back to that another time so I can do that let's reload the extension I'm gonna laughs if this works which it really shouldn't hit refresh ah there we go Oh Sita whoa oh my goodness it sort of did something well it actually ran set up whoa so interestingly enough I'm kind of intrigued by this because there's a thing that I was about to explain which is that I have to use something called instance mode opening up so I'm gonna just let's just just humor me for a second I'm gonna take out this now let's just see what happens now for some reason the Dom library didn't seem to work but the other stuff did which is weird let's run this again Oh weird oh it's there I'm shocked I'm shocked it just worked that's so weird but the Dom library stuff didn't work why does the order matter oh maybe it's just that interesting something changed since the last time I tried this this is gonna be much easier than I thought I thought I was gonna have to explain instance mode let's try putting the Dom library gigs they ordered late load in these orders let's try this again reload so now let me let's try sorry let's go back to sketch and let's let's use the Dom library now and once again reload again and it refresh yeah look at that huh well ladeeda so amazingly I can actually just put a p5 sketch in the content script maybe this is a bad idea for some reason when I made an example for this last year I had to use something called instance mode and if you want to know instance mode is I will include a link to a video tutorial about that I thought p5 does this thing where it before to be beginnerfriendly it allows you to declare set up and draw in the sort of global world of JavaScript and for whatever reason I thought that that didn't work in a Content script and you had to kind of namespace things in the instance mode way these terms might not mean anything to you but you can watch that instance mode video if you're kind of wondering about that let's keep going so let's let's let's let's finish this off so I'm gonna take this out I'm gonna put clear in draw I'm gonna say a line from Mouse X Mouse Y to previous Mouse X previous Mouse Y and I'm going to say stroke zero stroke wait for and what else do I want to do ah so this is the other thing I probably want to make the canvas fill the page so right now I'll just use window width and window height so let's go back now and reload hey where's my canvas let's see do I have an error sketch blah now alright let's let's see hmm so how do i D bug this mmhmm let's not put let's put a background here what a pain to reload can I just I can just do a refresh no okay refresh okay that worked ooh and it's there oh oh oh weird okay hold on a second so why didn't that work first of all I wanted this I want to say if mouse is pressed hmm so it's working that canvas is there it's interesting how its underneath some things and I wonder if that's kind of the issue so let's reload reload again somebody in the chat I'm sure it's telling me exactly what I'm doing wrong and then oh well it works I don't know why it work before okay so I can do things like I love p5 and I'm going to make a little heart so this is this is just a very beginning stuff here now here's the thing there's some some flaws here that I can give you I'm gonna scroll and I can't draw down here anymore cuz that canvas is actually just a very is I said window with and window height so I could do something like get the body height I think of the whole page to make the canvas over the whole page but it could be a really long page another thing I could do is like move the canvas as I scroll I couldn't like just do the body height but one of the things you might notice here is that I've really messed with your ability to click on links because the canvas is kind of stole is overlaid on top of everything and it's stolen it's stolen a focus from all of the underlying stuff so thank you to me I am so me and others in the chat who have given me some good advice about this there are some CSS properties that I can try to add so since I've got the p5 library loaded anyway I could say see that style what was it pointer in the pointer events like this is a CSS property that will say like hey I don't want the canvas to receive any point your events so those pointer events will pass through underneath now this might not totally work hit refresh so now I'm sort of able to get it but like it's working but and you can see yeah so this is kind of and interestingly you can see that the the canvas is still there that's because github is actually not going to new pages it's kind of refreshing within the same page but if I really went to a new page which like me went to the github home page yeah it's gonna go away hello there was a weird edit point there but I discovered something while making this video tutorial look how nicely this is working this is me on my Schiffman net website and i refresh the page and it works nicely it draws I close the console i refresh the page again it's not working anymore oh weird it's sort of worth so that's not working I don't know that it's working so here's the thing I think I got lucky remember earlier in this video I started rambling about this thing called instance mode well I think I got lucky in that V okay so a Content script by definition executes after the page has loaded but the page itself is not does not include the p5 library and the p5 these these I don't think the order of this really guarantees you much of anything could it could I put sketched a che s first let's just try this I really don't think so I think p5 what it's does what the p5 library does is it looks for your setup and draw function and it that that sketch not J's file might not really like the content script might not be available when it's like loading the p5 library and then something not finding the set of a draw function and everything so I might need to actually explicitly say like hey hello p5 here's my set up and draw functions which I'm going to show you how to do in a minute using something on instance mode unless this fixes the problem but really do you really think they load in that order in some way that's illogical but that doesn't make any sense because sketch would have to come after I can't load it first let's try so I'm gonna go to reload this extension reload I'm gonna hit refresh huh not working oh now it's not working at all oh now it is working it's the same thing I think I'm getting lucky sometimes and not cuz maybe I have things cache things over to ram or somebody much smarter than me we'll know detective but I I think I really want this to work I'm going to I'm going to go ahead and do what I think will work which is instance mode so what is instance mode I have a video tutorial about it it's a way of namespacing everything in your p5 sketch and kind of wrapping it into a function so what I'm going to do is I think I have to say let's look let's let's go to let's go to the p5.js wiki because you might as well know about this page which has a little tutorial about instance mode by the way sometimes oh I'm like killing okay first of all let's disable the extension and let's go to instance mode it's probably under I because I start global and instance mode so this webpage is going to explain this is global mode everything living in the global namespace this is instance mode I am going to just copy this over and I'm gonna I'm gonna probably change this to using let instead of R and that sort of thing but I'm basically going to take this out and I'm gonna put my code in there whoops and what I'm gonna do is put it in here and I'm gonna say how did that work I need to say sketch dot setup equals function I'll try to explain a little bit more about this and sketch dot draw equals function and then everything that's a p5 function I just say sketch dot so sketched out create canvas sketched out clear sketch dot stroke sketched out screw stroke weight if sketch mouse is pressed sketched out Mouse X sketched out Mouse Y sketched out P Mouse X sketched out P Mouse Y and then this is fine so this is just now this is actually instantiating the p5 sketch of getting some more these are injected in the order they appear in the array so from breaking news from the Chrome extension API this order actually does matter they are injected in into the script in the order that they're in the array so let's do this I think sketch touches should be last and now what I'm going to do is this should be exactly the same now this is instance mode it's the same exact sketch but I've so let me explain a little bit what's going on here what I'm doing is I'm saying I want to make I want to make a new P 5 thing and so normally this happens automatically the p5 library starts to make its own P 5 thing by looking for your global setup and draw but here I'm saying I'm gonna make this wrapper function and it's going to have setup attached to it and draw attached to it and this whole thing is the thing you can make the p5 sketch from a bit more to it that you can read the wiki page but that's the basic guide yeah let's see if this works I'm sure I made some mistakes Oh window with is that's a p5 variable so sketch that window with I think I'm gonna have to say all right let's see what happens here so one thing I want to do by the way is I'm gonna just change this to I want to change this to sketch dot window height again just so it's just so it's only covering part of the page because that really just slow it down if it tries to make a sketch a canvas the size of the whole body alright so let's now reload the extension enable the extension reload the extension and refresh the page paint hold on refresh the page uncaught reference this line is not defined sketched outline thank you very much so it's very easy it's kind of like forgetting this dot I kind of have sketched out for everything that's p5 so I'm going to reload the extension again I'm gonna come back here hit refresh there we go this works hit refresh again it works I'm gonna get rid of the console so now it's working consistently no matter what I do let's make one more thing a little nicer about this notice how I keep selecting the text box in it while I'm drawing out cuz the chat gave me some code to do that I see it now I can change I can affect the CSS of the entire body and set the user select property to none so user selects the property meaning making something available to be selected and so what I'm gonna do here in setup is I'm going to say document dot body dot style right dot user select equals none so and I kinda I don't know why but I have this like habit of doing this because a lot of the CSS properties are not valid keywords that you can just say dot like background color you wouldn't be able to say style dot background color but so you can userselected work because it's like a valium variable name so let's try adding this see if that's in the right place I'm going to reload the extension refresh and now there I am drawing it's not selecting the text I can still click on the links I can go over here I can draw on here and then I can also because I can also enable my chrome kitten extension I can go to this web page and I can draw oh I can draw books I can draw I can draw on the kittens yay I love you kitten oh you're a star kitten rainbow okay oh are you still watching this video because I'm just gonna be here doodling on this web page for a while okay so I'm gonna leave it here I did show you how you could actually create the canvas to be taller with document.body that client height one other suggestion from Austin and the chat said I could start with no loop and only render when I'm actually drawing that'll actually really help with performance as well of course there was another suggestion being like well if you just used SVG's nor have this giant canvas that's probably a much smarter idea but the point is I'm showing you how you can have a canvas overlay with p5 and load P 5 P 5 library and by the way you can load other libraries the same exact way whether you want to use jQuery or 3GS or anything this is the same exact way so I hope you enjoyed this coding challenge about creating a canvas overlay p5 sketch in a Chrome extension content script if you made it through this whole video MA thank you something good bye