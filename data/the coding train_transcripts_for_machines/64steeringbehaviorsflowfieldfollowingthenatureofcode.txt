hi welcome today in this video we're going to look at flow field following and processing what is flow field following well it is one of Reynolds steering behaviors if you if you're watching videos before after that's where we are a whole lot of videos about steering behaviour and here we have from Reynolds website this is the example of flow field following and what we see is we have a two dimensional grid of vectors so everywhere in this space behind me there's a vector pointing in a given direction and remember the central question we're asking with every steering behavior example is what is the vehicle's desired velocity in this case this vehicle moving around this space it it's moving around and looks below it there's like an arrow painted on the ground and that arrow represents its desired velocity now Reynolds actually does something a little bit different than what I what I do in my example where the vehicle actually looks ahead it looks in the direction it's moving and looks ahead and looks at the arrow on the ground in front of it but it's for simplicity's sake we're just gonna look at the arrow below us it's a small detail there but one to consider okay so this is what we're looking at how do we implement this in processing and what kinds of applications and exciting results can we get from doing that so let's sort of move over here for a second and and think about what it is we're doing so the cold so we have a processing window and what we're going to say is if we could say every single pixel in this window represents a vector but we're not going to do that that's too many vectors too many vectors notes aren't too many vectors so what we're going to do instead is we're going to subdivide the the window so here you can see you know you could imagine if this were 1 2 3 4 5 6 7 8 like 800 by 1 2 3 4 by if this window was 800 by 480 cells is 10 by 10 pixels so you're going to see in the example we're going to have a variable I think I called it resolution or finding it afloat or an INT but that tells us how much to scale down for every ten pixels in the window there's a particular arrow going in a certain direction and we could start by saying hey everywhere on this screen everywhere in this space there's just an arrow pointing to the right or there's an arrow pointing in a random direction or there's an arrow pointing according to Perlin noise or some other algorithm and and what you what you're gonna see is we're gonna use perla noise and a few different things but this is a nice if you're looking for creating some type of fluid system meandering path of a river or if you simply want to examine that contours of an image and have things flow around those contours this could be a model that you could use and we're gonna see that as we get to the actual example so what do we need we know we have a vehicle and the vehicle is able to calculate a steering forest according to desired velocity now we're gonna need a class called a knot in my example I called it flow field and the flow field of this is just a plug here that I'm bumping into hi the flow field as the class is stores all the data for this representation right here what do we need well what does this look like to you it looks to me like a twodimensional array now you you might be saying to yourself I hey I don't know what a twodimensional array is if so stay tuned I will link below to a tutorial about 2d arrays and as well a perhaps another video somewhere that I've made when I make it or if I already made it I don't recall but what is it two dimensional array just to sort of briefly get us up to speed here right a onedimensional array we're quite familiar with we could say hey P vector bracket bracket vectors this is a onedimensional array at every element in that array as an index this is vector 0 vector 1 vector 2 vector 3 vector 4 vector 5 that's a onedimensional array a twodimensional array allows us just to think ah instead of this linear list of data of items of vectors let's have a matrix of them and instead of each one having a singular index 0 1 2 3 4 5 we could say hey this vector here is vector 3 comma 1 index instead of index simply through it's index three comma one it's a twodimensional grid of information the truth you know underneath the hood and the computer it's really just everything's just linear information but this is how we get to think of it and this is how we get to write our code going off on tangents okay so what does that look like you're going to see that we are going to make a twodimensional array of vectors so this is the core piece of data that's going to be in the flow field class it's a twodimensional array of vectors a twodimensional array of vectors and everywhere as soon as a vehicle is here right the vehicle has an XY location which is in pixels and we need to know which arrow should it look up in this case we can see it's 4 comma 2 but maybe it's location did I say 10 I meant 100 Wow there's got to be some way of like going back and like dubbing my voice over and the tape Rahul's today so that was my April Fool's joke to get that wrong if it's 800 pixels and we only have eight spots that would be 100 pixels each anyway so what are probably we're not going to make them that big I've kind of gone off the deep end here but if we know the object's location is that XY we simply need to divide by that resolution resolution if it happens to be a 430 pixels comma 203 pixels if we divide each of those by 100 what do we get 4 comma 2 that's the values we need to look up in our twodimensional array and then that vector we pull out of the 2 dimensional array becomes the desired velocity then we calculate steering and boom we're done okay so this is kind of the map this is the framework of course the really interesting stuff is the question of how do you calculate your flow field I'm gonna give you a few little examples of how to do that and ultimately a couple exercises for how you could extend that further but really this is the case where we have an example that you can use verbatim and just look for the place where the flow field is being calculated and adjust that ok so let's take a look at the example so uh so this is Reynolds and now we're gonna switch to processing and here we've got it so look at this this is exactly what I was talking about we have a flow field class which has a twodimensional array of vectors and it's columns and rows to keep track of how many columns and how many rows in that grid and it also has a resolution that resolution variable tells us what is the relationship between the number of columns and rows to the width and height of the window and we can see that right down here the number of columns is with divide the resolution the number of rows is height divided brilliant perfect hooray okay so when we run this example what do we actually see so what we're seeing here and I guess it's a little bit light but I don't know how the quality of these videos is only zoom in a little bit you can see I have on the window I've I've drawn a line to represent the vector in each one of those spots and if I click the mouse here I'm adding a vehicle and you can see now this vehicle is following those lines so there's two things we need to look at one is how are all those lines calculated and then how does the vehicle look up those line by lines I mean vectors how are all those vectors calculated and how does the vehicle look up it the vector for its desired velocity so let's take a look at both of those things in the code the first one we said is how do we calculate all of those vectors well let me just do something here I'm going to change this to zero so what I'm actually doing is I'm making up an angle and every single vector is made from that angle P vector dot from angle theta so what if every angle is zero look what we have we have a whole lot of lines just pointing all to the right what if every angle was PI divided by 4 we have a whole bunch of lines all pointing 45 degrees below what if every line was a random angle between negative PI / 4 and PI / 4 let's run this again we have a whole lot of random angles mostly pointing to the right so you can see here we're starting to get something even just with this simple flow feel when I click something we almost have like this illusion of this intelligent behavior when these vehicles are moving according to some they're like in water are they're flocking there's some kind of almost close to there so you can see how just by picking angles and you can think of what if I you sign or cosigner try to get them all in a spiral pattern how could you calculate those angles a nice way of doing it is just to use Perlin noise and when we see we've got pearly noise here and I'll put a whole bunch of vehicles and we see that we've got this nice kind of smooth path so what's going on with perla noise remember perla noise is random but every value is similar to the two values around it and here we have perla noise in a two dimensional space every angle is similar to the angle above loads left to right and diagonally but it's different so we have this really nice behavior where we have this kind of smooth randomness and almost has this quality of a flow of water of lava there's lots of things you could do with this so so so oh I forgot the last thing so I just wanted to briefly point out in the code then where is the vehicle looking up its desired velocity that was the second thing we wanted to say and there is a function called follow and uh it calls a function called lookup so the flow field has in it a function called lookup that can receive a location on the screen and pass back the vector at that location and when we go to look at that function look up here it is it's very simple we're saying hey divided by resolution divided by resolution hey constrain to make sure we're not off the screen we don't want to be off the array and return that vector so this is really what we're doing here we're making a bunch of vectors in a twodimensional array all the vehicles are there in the space they look up the vectors below themselves those become the desired velocity steering was desired minus current velocity and apply that steering force and we've got flow field following now what are some things you might do here so an exercise to yourself you might think these are all well and good but what would happen if the flow field animated over time what if it actually changed it wasn't the same and one way that we can do that and I'm going to not show you the code but you can make this an exercise for yourself is what if you used three dimensional Perlin noise so instead of write twodimensional perla noise we're seeing a slice of time of all the Perlin noise values now we're seeing the third dimension as / frames of animation so look at this we almost get this like strange hair like behavior I mean we drew this in a different way we have an interesting simulation just on our own but using this as flow field following once we drop the vehicles in here you can see and if I take that away look we're gonna spend a lot of time trying to get a nice flocking behavior where the vehicles actually look at their neighbors and move away and of a line and all that stuff we almost have that here just with simple a Perlin noise flow field in whoa take this into three dimensions and have the stuff fly around in three dimensions and you've really got something there too so that's something to think of the other thing that you might occur to you is oK we've got this two dimensional grid right what other what stuff that we programmed with all the time is a two dimensional grid pixels let's think about this for a second or have an eraser I've got to find it there it is so let's think about something we have a flow field right which is a 2dimensional grid of vectors what if I have an image like a silhouette of a person this is like a strange weird nonsensical alien ghost okay a silhouette of a strange alien that came from outer space what if I could make a flow field where the vectors all followed the contours of that image or all pointed towards the image are out from the image could I analyze the pixels of an image what if I looked at every pixel and looked at its neighbors and had the vector always point from the brightest pixel and or the pixel most similar or pixel most different or you know so doing edge detection there's some image processing algorithms can you translate can you map a pixel color to the angle of a vector or a pixels relationship to its neighbors to the angle of a vector so I don't actually have a solution to this exercise currently in the github repository although at some point in the future when this video is made or changed or you're watching it maybe there will be one but this I think is a great exercise can you think of a creative way of defining a flow field three dimensional Perlin noise from an image from depth data from a Kinect sensor from some other from some other piece of data from you can imagine creating a kind of pliable surface that you're measuring its topology with with the Kinect and then turning that into a flow field so you project on and stuff flows around it I'm just kind of going crazy with maybe obvious ideas I don't know but so hopefully this helps you understand what a flow field is how flow field works and gives you some ideas for projects you might make from it and I look forward to you sharing some of those with I don't know people okay I think I was recording I was and the audio seems to be working so hopefully we'll be watching this later bye