hello and welcome to another coding challenge in this coding challenge I'm going to program a fireworks simulation Bing um and I'm going to program it from scratch in JavaScript in the browser the version that's running actually behind me is a version that I've made in processing a Java base platform the code for the one behind me and the one that I will make in this video will both be available in links in the description and at the end of this video I'm I'm hoping to return back to this processing one and also uh turn it into 3D fireworks this might have a threedimensional like quality to it but it's really just two Dimensions um okay so here we go so let me minimize this code which was the processing version get rid of that and I have a blank JavaScript can HTML 5 canvas and I have some JavaScript code so the first thing that I need to do is I need to have uh I want to have this idea of a particle I need to have a particle so I'm going to just write a particle uh a Constructor function uh where oh you know what I'm going to do is I'm going to the particle should have a position which will be a vector the particle I need to use physics here it's going to have a velocity which will right now be just zero and the particle is also going to have an acceleration so I'm going to kind of custom bake a physics engine this the same sort of model that I use in all my nature of code tutorials and videos about physics but I'm and I'm just going to kind of bake this from scratch really quickly and then I'm going to add a a function called update and that function does what it takes the velocity and adds it to the position and it takes the uh acceleration and adds it to the velocity now where does it get acceleration well that I need to have a function I'm going to call it apply force and in that function I'm going to get some sort of force and I'm going to add that Force to the acceleration this is the idea of force accumulation Force equals mass time acceleration or acceleration equals acceleration equals for Force equals mass time acceleration or acceleration equals force divided by mass but I'm going to eliminate mass in for Simplicity so acceleration equals force are all the forces of a moment added together so once I do that I also need to make sure that um after I update the particle each frame that I multiply its acceleration by zero to sort of clear it out because the acceleration at each moment in time is going to start with zero okay so now I'm kind of got this the last thing I need to do with this particle is I need to have a fun I'm going to call it show which draws just for Simplicity just draws the particle at um where where where makx it as a point this.position dox and this.position doy and what I'm going to do just for um one thing I learned recently about p5js which by the time you watch this video in the future may not really be the case anymore but if I set the stroke and the stroke weight up just in setup and don't set it over and over again it sometimes can run a lot faster um so just to test that things are working I'm going to U make a variable called a firework and I'm going to say that firework is a new particle which lives in the center of the window and I'm going to say here in background firework in draw I'm going to say firework do update and Firework doow so I want to now go back to my sketch and see ah I have some errors so particle. JS let me make this a little bit bigger that's really big but uh particle. Js line uh number six has an error uh let's see particle D this do apply Force equals ah function is spelled with a c me refresh there we go so you can see there's the particle in the center things are working so far uh the next thing I want to do is let me give let me have this particle start uh at a random width and all the way at the bottom of the window and let me give that particle a velocity pointing up so let me say its velocity is 4 pointing up let me run this there we go we can see it's going up each time I refresh it it starts in a new random location and starts going up so we're getting somewhere the next thing that I want to do is see if I can add some gravity so I'm going to make a Glo gravity a global variable and it's going to be a vector that does what it points down so negative uh no pointing down is positive so0 comma I'm going to say point two and then I'm also going to say firework do apply Force gravity so I'm now adding gravity to that particle so let's run this uh acceleration is not defined let's go back to the particle uh where where H this. acceleration I always forget the this Let me refresh H didn't make it very high but that's sort of reasonable so let's make the particle's velocity a lot bigger like 10 okay so that's good so we can see so this is the start of our firework simulation something shooting up from the bottom and then at some point it's going to explode and make a lot of particles but before I could do that what I want to have is just have a lot of things shooting up from the bottom continuously so let's get that going so instead of having uh one single firework what I really want is to have an array of them and actually what I want is for the firework to be its own object so I'm going to create a firework uh uh function sorry and a Constructor function and the first thing I'm going to do is it's going to have a a local variable which is a so I'm I'm basically going to do what I did here right I want it to have in this firework object I want it to have a particle it's going to have that particle the firework itself can have an update function and whoops what happens in the update function it does all these these these things it adds gravity and updates that Firework and then I'm going to also have a show function for the firework object and I have a I can see I have a syntax error uh which I'm going to fix in a second so the idea here is the particle right a particle is an individual particle this firework object right now is one particle but the firework object is also going to in a moment not just be the particle moving up but suddenly all the particles that explode from it so I need this object to keep track of that individual particle and then also an array of particles but this should at least get me now if I say uh um firework do push new Firework and then I should be able to say firework dot uh I should be able to say oh Fire Works should be an array then I should be able to say look at all of the five Works do a length i++ and you know I could use a for each Loop but I'm choosing not to just for clarity um update fireworks uh indexi doow okay here we go so now okay firework is not defined in line six uh yep I need the as always I always forget the this dot this dot this dot I'm going to do the this this dot this dot this dot the this Dot Song never forget the this Dot somebody composed that song for me uh and run this again there you can see okay so it happened and now what I'm going to do is I have this line of code that puts a new firework object in the array and I could put that line of code in draw and if I put it in draw over and over and over again it's just making these fireworks making these fireworks I don't want to make them that often so I am going to say if random one is less than 0.1 so every frame there is a 10% chance of making a new firework let's try that that's a little bit better so it's making them kind of randomly every so often so that's a good start and now what I also want to do is you know I think this should be a random value so let's say random between 15 and5 so that way they don't all go and so that the range might be off there let me make the range a little bit commer let's do this so anyway you get the idea that they're not they're also not all going to just go up to exactly the same height so now we're pretty good we've got our system of the fireworks going up over time but I need to figure out what's the point where I want them to go poof and explode into a bunch of particles okay so how do I do that here in the update function one thing I should edit Point timeout back um I what I need to do is I want to check something I could do is I say how do I know when the firework gets to the top Point well its velocity is negative its velocity is negative its velocity is negative in the y direction now it's zero now it's positive now it's positive I want it to explode the moment it reaches that top point so I can say if this firework dot velocity is Le pointing down is greater than zero is greater than or equal to zero this is the moment where I want it to explode so what I'm actually going to do is I'm going to say this. firework equals null so I'm just going to like set the firework to null so that um uh it's like that will make it disappear essentially so in the and I'm going to need some like I'm going to have to say if this. firework so I only want to update apply force and update it if it exists and I also only want to show it if it exists so let's just see you know there's lots of other ways I could do this but this is just going to be a sort of way of me tracking I could have actually a Boolean variable like exploded or something I might I might change it to that later but let's see how this works so oop H that's weird uh if this oh well that's if the Y component of the Velocity right if the Y component of the Velocity let's add that oh cannot read velocity of null where did that happen ah okay well this is a issue so this little bit can go inside here like also as long as it exists there you can see now it's disappearing the moment it kind of gets to the top so that's good and what I want is when it gets to the top I want it to just go into a whole bunch of particles so I actually kind of feel like I'm going to just change this just for to be I'm gonna say this do exploded is false as long as not this do exploded apply Force if it's then say this do exploded equals false because as long as this uh as long as not this dot exploded I I think I would prefer to use a Boolean variable uh it equals true so this should be the same exact result but I'm not doing the sort of null thing okay so I used a Boolean variable to track when it's exploded now what do I do when it explodes well what I need to do is I need to suddenly right here I'm gonna just say this. explode so I want to put this in a separate function and I'm going to write a function now called this. explode and what do I need to do in this function I need to make a whole lot of particles let's make a 100 of them so for VAR I equals z i is less than 100 i++ what I need to do is say VAR P equals a new particle and where should that particle start so it's about to explode where should that particle start it should start where this. fireworks position dox and this. fireworks Doos doy so I need to make a whole lot of these particles and now I need an array the firework object in addition to keeping track of this sort of like seed firework should keep track of this do particles an array so it has an empty array and I am now going to say particles do push P okay particles push P now what I also then need to do is and I'm going to just do this here right here what I need to do is display all those particles index i. show so oh and this has to be this. particles and this has to be this. particles index I Dosh so what I've added here is the moment the particle reaches the top it makes 100 new particles and then draws all those so let's see what this looks like oops cannot read show of undefined firework JS index 30 oh this should be this. particles do length because I don't want it to show nonexistent particles that array is only going to have 100 as soon as as soon as it is exploded let's run this again look at that oh it made 100 particles none of which move or do anything pretty weird right well first of all why aren't they moving well I forgot something I forgot that I also should call uh here in update I should also call for all those particles apply force uh gravity and for all those particles I have to update them so I need those particles to experience physics as well look what's happening it's making those fireworks but they're all why what happens when you make a new particle it shoots straight up so I need to make those particles in a different way so let's look at how I'm doing that if I go back to the particle object the particle is always made with a velocity that randomly points up between 2 and8 so I could use like inheritance and have like a different two different kinds of particles that inherit but I think what I'm going to do is just I'll just add a third argument here and I'll call it uh Exploder and I'll say if Exploder I don't like Exploder that sounds violent I'm already using explode I guess uh I'm going to call it um firework uh if firework make the velocity that way otherwise make the velocity and I'm I I'm just going to do something different just so what I'm going to do is I'm going to say I want to say P5 Vector random 2D so I'm going to have any random Direction okay so if that's Boolean variable is true it's going to make it as like one of those original firework things so let me go back to this firework object and this particle it needs the last argument of true these particles um it needs the last argument as false but in JavaScript if I don't I could also just pass nothing in and that variable will have the value of undefined which will evaluate to false so this should now if I refresh this we can see that I'm getting something closer so now why are they why are they exploding in this perfect circle well the reason why they're exploding in A Perfect Circle oops I have some old notes from a computer vision tutorial is I'm giving them a random velocity which is a unit Vector all of length one so they're all going to explode out in a perfect circle so one thing I might do is just have those the lengths of those vectors be a slightly random length but and I'm not going to do this in this tutorial but you should make heart fireworks for example so what if you could figure out U if I draw a heart like this from the center vectors pointing out to the edges of a heart so you could actually or you could use you got a fireworks at this display letters or particular kinds of shapes so the way that you pick those initial velocities of that explosion can really make hearts or rainbows or unicorns or whatever kind of shapes you can imagine that you might like to make so I encourage you to do that as a kind of Riff Off of this you can also notice that right now it's running really really slow so that's another thing we're going to have to fix but let me just go back to here and I am going to um uh where was I under particle now the other thing I want to do um is I actually want to to in the particle object I think I want to keep track of this this whether it's the original firework or the particle because I want to like do other things that are different so I'm going to say this um because I also want oh you know what I'm but I'm I'm going to leave that for later okay so let me fix this and say um random 2D and then this do velocity multiply by something like I'll I know what I'm going to do in a second multiply by between um you know uh uh two uh one and six so now it's a magnitude is going to be scaled by some random amount let me run this again oh okay that didn't work what did I not do right let me look at this this velocity multiply oh random a random value between one and six okay so you can see now they're really exploding kind of like wildly there's also too many of them so I can't really see what's going on that well so I'm going to go back to the sketch and make them like quite a bit less often lost power but I'm back now and where I just was is I was saying if this is not one of the seed fireworks particles if it's not one of the seed firework particles let's take its velocity and multiply it by something like .85 so that it slows down um slows down every uh frame and you can see that kind of gives it this sort of like burst out that sort of slows down and stops now there's sort of a funny thing happening where they're still there and when you see a firework it explodes and kind of like Fades out and you know I'm not going to get too crazy with visual dressing here you can make stuff Sparkle and have trails and glow and all sorts of stuff like that but at leasts leasts add something where the fireworks Fade Out so what I want to add is a variable oh I already did because that's before the power ran out I'm going to add a variable called this. lifespan equals 255 and what I'm going to do is in the update function I'm going to say as long also if it's not one of the seed ones I want that lifespan to uh go down by one and this maybe I want it to go down let's actually have it go down by four each frame and what I want is for the particle to uh have a stroke which is is its lifespan so uh so I want to give it some Alpha so I'm going to say if it's not the uh the sort of seed firework do that to the stroke otherwise uh just have a regular stroke and then also let's make them stroke weight two and we'll make the uh those a little bit thicker so let's see what this looks like now is it running really slow no oh lifespan is not defined because because I need to say this do lifespan let's try that again so you can see here now this is a little bit better now you know I should fiddle with these values like maybe this should be uh you know 0.9 and its initial values should actually be between like two and 10 and whoops uh and over here we could see what that looks like now and whether this is better or worse I don't know but I'm going to let you sort of like consider that on your own but I now have the basic idea you can see very quickly now though it's starting to run rather slow so we're losing a lot of frame rate here why are we losing a lot of frame rate well it doesn't matter whether the particles have faded out or left the screen I'm never I'm never getting rid of them so there's a bunch of things I need to do number one I need to say I need to figure out a way of getting rid of particles so here in this um in the fireworks system what I need to do as I'm looping through all the particles first of all I actually want to Loop through the list backwards because I'm going to do something where I'm start plucking them out of the list and if the list is shrinking it's Contracting from the end it works better if I'm going through it backwards and taking things off the the the back end so what I'm going to do is I'm going to change this Loop to say go from particles. length minus one and greater than or equal to Z and iusus let's make sure that still works so nothing's changed it's still working and what I need to do ah go away finder what I need to do now is say okay well if this particle's index I is done then this particles uh splice I so splice is a JavaScript function that deletes something from an array and you can actually splice at I a bunch of things after it but I just want that one particle so if the particle is done splice well how do I know if it's done I need to write a function that says if it's done so in particle. JS I've got another function I need to add I'll just add it over here this DOD and what I'll do is I'll say if if this do lifespan uh is less than zero then return true so that lifespan which is counting down else return false so let's run this it's hard to oops we have an error particle. JS line 30 uh line 30 here this DOD equals function so now I have no way of knowing if it's actually removing the particles it does seem to be like performing a bit better like not slowing down so those particles are being deleted but they're actually still a firework object the system object in that list so what I want to do now is add over in the firework object also a function that says this Doone and how do I know if that thing is done well it is done if that particle is exploded and this firework do sorry this do particles. length equals zero right the particle system itself is done as long as it's in a state of having exploded and there are no and all those particles have faded out so if that's the case I should be able to say return true otherwise return uh false so now I can go back to the sketch here and what can I do here in this sketch I also want to Loop through this thing backwards fireworks. length minus one I is greater than or equal to zero iusus and I want to say if fireworks. length oh sorry fireworks. dun ah fireworks indexi DOD then Fire Works in uh splice I comma 1 so now and what I'm going to do is I'm also going to add just to make sure this is all working I'm going to add console.log fireworks. length so now we should be able to see you know as a you can see that that length is going down so it's never going to be too many things on the screen so performancewise it's going to work fine so this now is and you know JavaScript canvas drawing can be a little bit slow but you can see I've got kind of you know with 100 particles per system it's kind of running reasonably well now we can make this look a little bit nicer uh for example I could um add oops I could add a little bit of alpha to the background meaning have the background um transition in to and we'll have each firework draw a little bit of Trail let's see how this looks right that has a little bit more firework like quality to it that's nice then of course I could say well let me give it a color mode of HS B and I could say for each firework let's for each firework system is going to get its own color uh so uh it should get a hue value is a random Hue and then oh every time I make a particle I'm going to also want so the system gets a hue and then I'm going to want to send that Hue into um let's do that before the last argument here into the particle object so they can use it as well uh so I anytime I make a new particle even in the explode function I also make new particles so I'm going to say this. Hue and false and then now in the particle object I can add a variable to get that Hue value and then I can say uh stroke is the Hue 255 255 Hue 255 255 uh with uh with no Alpha and now when you run this we can see we have now we have rainbow oh how come I lost the trail that's weird what did I do to lose the trail oh you know why I lost the trail is because I changed it to huse the color mode to HSB and the background is now doing something weird so this should fix that I think whoops ah look at that I wonder if this is a bug in P5 GS that we've just found well I'm going to do something here which might make things run a quite a bit slow but I'm going to just change the color mode to RGB here and in each particle right before the particle is drawn I'm going to change the color mode to HSB let's see if that works there we go so uh that should be I think that seems like a bug to me like there should be a way to have an alpha with HSB color mode but now we've got it working um and you can see there we go so there could be a lot of finesse here right I could have those velocities go at an angle I could think more thoughtfully about what the velocities of the bursting particles are I could have uh a variable amount of particles um I could think more thoughtfully about the design I could actually store a list of history of the positions to draw a trail myself I could use like textures I could use something called additive blending maybe I'll um to make things appear more glow like but um but you can see here here's the basic idea so I encourage you to take my JavaScript code and make some improvements on it and I want to make a 3D webg version of this but before I'm ready to do that I'm this is this kind of concludes this video but I'm just going to keep going I'm GNA go back to my processing one I'm going to close this I'm going to go back to my processing sketch which is basically ex 100% EXA the same code that I just wrote but it is oh it's doing it full screen I forgot that it's doing it so one of the things about using Java in a desktop environment is I can kind of get a bit more speed out of it so I have now this full screen application but this is still 2D so what I want to do with this one and let's um let's take off the full screen for a second just so I can kind of see it a bit more clearly let's make it 800 by 600 what I'm going to do here is I'm going to change this to P 3D each particle when it gets drawn is a point but I'm going to say um push Matrix I'm gonna I need to do three actually I could just use I'm going to do do this anyway I'm gonna use translate to add that Z axis and I'm going to say uh point at 0 0 so let's just make sure this still runs oops they're all shooting off above the screen because when I made it smaller the initial velocity uh should uh be less strong so let me just run this again I'll fix that again later okay so that's still working now what I want to do though however is these particles when it explodes somewhere somewhere I create that Vector the random Vector probably in particle system that firework object uh and uh yes and then it makes a new right here it makes a new random 2D Vector I want this to be Random 3D let's look at that let's see if this works now can you see anything different here I'm not so sure you can but technically speaking it should be a random 3D Vector let's see if we can now actually start to rotate the scene to see if this really works so I'm going to add uh I'm going to import a library called pcam which I all which I've been doing which uh I can s say I can add a PC cam object and I can say a cam equals new pyam this and I'm going to say 500 like I want to look at it from 500 pixels away the other thing that I need to do is when I make the initial particles um their location uh sorry when I make that initial particle its location should be random uh py cam makes everything relative to the center 0 Z so I want to look for random negative width divided two to width divided by two and then I also want to change the bottom of the screen is now height divided by two so let's run this and see what happens ooh o py cam oh okay hold on py cam is very unhappy with with my oh clearing of the background technique so I'm going to lose the trails I can get those back in another way and just say background zero I forgot about that once I have peasy cam okay now let's start manipulating the scene can you see I'm looking at it from above now yeah so you can see I need to make a lot more of these to be able to see this more easily let's add let's have a lot more being added um and let's also make the stroke weight of these particles uh much bigger and let's have their lifespan last a little bit longer um and let's run this and okay so now and let's actually just make this full screen again because that might help uh so I want to also make the initial random velocity much bigger and I'm going to go back and make this full screen uh in p3d and let's see if we get some nice 3D fireworks here oh that I can kind of like yeah you can see there they are oh no no no oh yeah they are 3D but they're all like in one plane so I should also probably mess with where they start okay so let's mess with where they start so this starting is uh oh it happens here which is a particle and I don't give it a z location it's Z new particle a random uh okay hold on the new particle gets a random XY and a z and it should have that X Y and Z and so let's give it a z random and then let's give it a random Z which is going to be sometime somewhere between 300 and 300 and so I'm going to run this okay now let's sort of zoom out and look there we go so we can see H that's not so there is some zdepth there it's not very much let's make that more extreme I'm pretty sure did I get it we should know now yeah okay now you can see I've got 3D fireworks so and then can see that I could probably do something where I have them burst out quite a bit more and I now have upside down so anyway you get the idea you can play with this more so I encourage you I'm going to post in the description of this video the processing code I'm going to clean this up a little bit the processing code for the 3D fireworks as well as the browser JavaScript code uh I need to get rid of the full screen thing is has to stop stop as well as the um I lost I lost everything ah come on no come back uh fireworks fireworks fireworks somebody see it fireworks P5 as well as the this code the JavaScript version of the 2D fireworks and I hope that you will make pretty shapes out of them I hope that you will add angles I hope that you will think of different ways of doing this and come up with a creative take on this and post it share it with me in the comments or on Twitter or whatever wherever you find on the internet to share it and I hope you enjoyed this quick coding challenge wasn't very quick probably uh of of how to program a fireworks simulation from scratch thanks for watching