hello and welcome I'm your code monkey and in this video we're continuing to create the waiting queue in battleground Tycoon we're going to create the logic to have our guests enter the building perform an action and leave let's get started okay so here's the waiting to you from the previous video guests are being automatically added and they're firing an event when they reach the front of the queue after reaching the front of the queue they are simply sent away the game is still in development so if you like the concept go to the same page and add it to your wish list and fall so based on the events we added in the previous video now let's create some logic for our building to make the interaction based on those events since this building represents a bathroom we're going to grab a guest from the queue in here send him to a toilet placed in here have him play an animation and leave through the exit in here then repeat the process for every guest on the queue okay so to make our building logic let's create a new C sharp script name it cm building bathroom I'm adding the prefix cm simply to avoid naming conflicts with the actual game classes since I'm doing this video on the game's actual code base now inside here let's first remove all of this since we want this as a nice clean class without being dependent on monobehaviour let's start off by making a constructor so public cm building bathroom so on our constructor first of all we're going to receive a reference to our waiting queue then for the logic of the building we're going to get a list of positions for our toilets so a list of vector3 for the toilet position list and let's store these as number variables okay now let's just spawn some sprites on our toilet position so we can visually see them so go through each vector3 toilet position in toilet position list and in here I'm going to go into the world sprite which is part of the code monkey utilities which as always you can grab for free from unity code monkey comm so I'm going to grab from the utilities a sprite and create it on this toilet position with a vector 3.1 okay so back into our game handler in here let's create our building so down here in order to create our building first we need to have list of our toilets positions so Melissa a vector3 a toilets position list is gonna be a new list and in here I'm going to give it okay I have two positions in here so let's finally create the building bathroom building bathroom equals new building bathroom and I'm going to give it the waiting queue that were created previously and the toilet position listen Anna let's also go down here and remove this code or sending them automatically we're going to leave the pop up to know when the guests arrived in front all right so let's test and we should be able to see some sprites on our to analog position list yep as you can see both toilet positions are being spawned with a sprite okay since they're in the correct position now let's actually spawn the correct sprite so in my game handler I'm going to add a private sprite and college eight solid sprite and make it a serialized feel so we can set it in the editor and down here on the constructor and let's also send the sprite and here let's receive the sprites for d2l it sprite and it's what we're going to use to spawn in here okay so there you go the sprites are correct all right so now back into our bathroom code we need to identify which toilets are empty so we can send a guest in there in order to do that let's create a simple sub class to store the toilet position and the guest currently using it so down here I'm going to make a private class and call it toilet now in here I'm going to have a public guest which is the guest that is using this particular toilet and a public vector3 4d toilet position and go up here instead of having eternal position list we're actually going to have a list of toilets and college 12 listen so let's instantiate that list and in here when we're cycling through the list we're going to add a new toilet and we're going to give it the toilet position to the we're on the position and the guest states as known since it is empty okay now down here on our sub class let's make a simple function to test if it is empty so make a public bowl is empty and in here we're simply going to return if our guest is No if it is no then it is empty if not then someone is in here and then our bathroom let's make a private toilet called get empty 12 this was we're going to use in order to get a toilet that we can assign to a specific guest so in here let's just cycle through the 12 list in topless and here if toilet dot is empty then we're going to return this toilet if not then we're going to return no okay so if you don't let subscribe to the waiting queue event of on guest arrived at the front of the queue make subscribe to this event which won't be fired when it guest arrives at the front of the queue and in here and let's call a function and we're going to name it try send guests to toilet and let's make this function in here so this function needs to test if we have an empty toilet if so it's going to try to grab a guess from our waiting queue if it successfully grabs a guest it won't send that gas to that 12 so let's first make a an attempt eternal it equals get empty toilet okay now if empty toilet is different from No so we have an empty one if not then we're not going to send anyone anywhere so here let's grab our guests so go into the waiting queue get first in queue this is going to be a yes and again if the gas is not know then that means someone is waiting in there so this is the guest that we're going to send to that particular torrent so I'm going to go into the empty toilet make a function called set guess I'm going to give it this guest and then I'm going to go into my guest and I'm going to move him towards the empty toilet dot get position so you go down here and let's make these functions so first of all a public voice set guests which will receive a guest object and Wilson set the internal guest object to this guest object and a public Victor three gets position it wrong return the toilet position okay our logic should be correctly working so when a guest reaches the front of the queue it won't fire this event which won't be caught by this function in here so this function won't trigger this function and in here we're going to test if we have an empty toilet if we do then this is not gonna be known then we're going to try to grab the first guest in our queue if we can grab and that means someone is waiting in there so we're going to send this guest into this toilet set the internal value so we make sure that this is no longer empty and we're going to move the guests towards this to unlock position all right so let's test this we should be able to see a guest enter the queue when you reaches the front he won't fire the event and be moved towards an empty toilet okay here's my scene here's my waiting queue when he reaches the front he triggers the event and he gets called that one goes into that one that one goes into that one okay great so the logic is correctly working both of them are going each to its specific empty toilet and since there are no more empty toilets everybody else is just waiting great now in here let's add some debug sprites to be able to see if the toilet is empty or not just so it helps to visualize the logic that is going on inside this object so when you create our own sprite let's create another sprite into our 12 position plus a bit to the right so let's say 50 zero since by the font it is empty by the font it will be green and in here let's make a function updater created and this will trigger an action a function of data triggers in action every update so in here we're simply going to set the caller to this debug sprite so let's store our world sprite call it debug sprite and in here we're simply going to set the color based on whether or not this particular toilet is in so in here instead of creating Taunton here let's grab a reference to Almaty Kazakhstan would add it in here set the corner if it is empty then we're going to put the color in green if not then color done right okay this is just an easy way so we can easily visualize which tournaments are empty which are occupied so we can easily see the logic going on inside this class okay so we can see our debug sprites in here and now this one when the first get reaches the front both of them become round okay right so we can easily visualize the internal workings of our class that is very helpful for debugging now when they reach the eternal position let's have them play an animation when completed they're gonna leave and then call the next one and so on so forth so back in my bathroom in here when I got the move to function now this function calls an action when the guest arrives at the given position so this action in here will be triggered when the guest arrives at the toilet position so what we want to do in here is go into the guest and I have a function here that plays a animation and in there it also has another action that is fired when the animation is complete so when the animation is complete let's first of all clear the guest from our toilet so go into the empty toilet which is the turnout that this guest is using come a function call your guest so go down here make a public void clear guest and we're simply going to set our guest to know so this toilet is now empty again and after we empty it let's just send this guest to move to a exit position now we're going to go up here into our constructor and we're going to receive a vector3 for our exit position and we're going to store it internally and here okay so our logic in here we're testing if we have an empty toilet if we do we have a guest if we also have a guest then we set that guest into that empty toilet we send them to the toilet position when he reaches that point it triggers this action in this action he's going to play an animation when the animation is completed it won't trigger this action when this action gets triggered we cleared the guests from the toilet so it's empty again and we move them towards the exit position okay so let's go into our game Handler and we have to send them a exit position so let's say a new vector3 seven four five two four five that should be good so let's test and see if all of that logic is correctly working okay here's a guest on the queue he goes in he reaches the front one of them goes in there the other one in there when they reach they're gonna play a certain animation okay okay the animation is completed you can see the toilets are now empty and they leave the bathroom okay great everything is working so the logic is working perfectly but as you can see no one else is entering from the queue we need to try to grab another guest when this one actually leaves so back in our code here on our bathroom in the end when he arrives at the exit position we need to request another guest from our queue okay here we are again guest enters the queue reaches the front goes to his toilet he occupies it he plays a certain animation when the animation is completed he leaves and when he reaches the end and yep there you go he grabbed both of them and there you go so there you have it we have successfully connected now we're waiting to you to a building the building has its own logic which requests the guests when needed and gets notified when one reaches the front of the queue in the next video we're going to add the ability to modify the positions in our queue again the game is still in development so if you don't like the concept go to the scene page add it to your wish list and phone as always you can download the project files and utilities from Unity code monkey calm if you have any questions post them in the comments and I'll do my best to answer them subscribe for more videos and I'll see you next time