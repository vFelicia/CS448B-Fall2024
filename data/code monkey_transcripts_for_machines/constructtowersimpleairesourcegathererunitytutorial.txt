hello and welcome I'm your code monkey and in this video we're continuing our resource gatherer AI we're going to use our resources and some simple building construction let's begin so here's our scene I have the two gatherers in here I can select either one of them and I can give them orders I can tell this one to go mind some gold and listen to you chop some wood and they go they gather the note gets depleted as you can see and then they go for another one after some time the note gets replenished and they can mine it again okay great so now that we have this basic ecosystem working let's use our resources to actually build something we're going to construct a tower object and let's say it takes ten wood and five gold so four stars let's go into our game Handler and in here we're going to construct the tower on the right mouse button so let's go on the update make a private void update and in here if input back yet mouse button down and in here we want to test on the right mouse button so that's my button one if we have them in here that we want to construct a tower so to test our logic let's use this p.m. debug quanis which is part of the code mock utilities that you can grab from unity code Maki calm let's go there and do a text pop up on the mouse just to make sure that this is triggering so construct our and let's test right here I am hit the right mouse button and yep we are capturing the right mouse button okay now in here let's test if we have enough resources so in order to do that we are going to go if game resources and in that class we have the function get resource amount then we take the resource type which in this case let's first test for wood and let's test if the wood amount if it is bigger than 10 and again get resource amount of our gold and we're going to make sure that it is above 5 so if in here then we do have resources tell us not enough resources so in here the CM debug all right so we are testing if we have ten wood and five gold so let's see okay so just like that we had zero zero so if I click no resources okay so let's grab some gold and some wood okay we have twelve gaunt of wood and if I right click yep we now have resource okay great so in here if we do have resource then we're going to spawn a tower if not and we're not going to spawn before we do spawn the tower we need to remove those resources from the game resource game resources and in here we need a function to remove resource amount and we're going to move remove game resources that resource type remove would let's say ten and remove five of gold so let's go into that class and make this function so in here make a public static void remove resource amount and here we're going to take a resource type and also an amount and in here simply do the same thing that we did in here and also fire the event sort of increasing we decrease okay great so we can now remove resources from this class all right so let's test again make sure the resource are being removed okay here I am no resources tell them to gather there they go all right we have enough now let's try and poof has resource and as you can see they were removed okay great so the logic for testing our resource amount and removing them is working perfectly right now let's visually spawn the tower in order to keep our code clean let's first create a tower class so let's create a new C sharp script and let's name it tower now in here we're going to make this a simple class so remove monobehaviour and these functions and first of all let's make a static function to try to spend the resources so make a public static ball try spend resources cost and in here we're going to do the test for the resource cost which we used in here so copy this code and drop it in here so this class is the one that is responsible for testing how much eighthour cost and removing that cost so in here if we do have resources then we return a true if not then we return a false okay so now back in our game handler instead of using this we're going to do if tower dot try spend the resources cost if that one returns true then we have spent the resources so in here let's construct a tower so we're going to make a tower and make a create function so let's make our public static create function so public static it will return a tower object and let's call it create now in here we're going to receive a vector3 for the position to spawn the tower and we're also going to receive a transform for the tower prefab okay now in here let's instantiate that prefab in sin she ate it into the position and put turn n dot identity then we're going to create a tower object and make a new tower and give it the tower transform and then we're going to return that and down here let's make our constructor for the tower which will receive a transformed for the tower transfer all right so we're doing this just to keep our code nice and clean so we call this function from the outside and this function returns the only constructed tower object so let's go into our game handler so let's go up here and add another serialize field for our tower prefab okay that's what we're going to send to instantiate and for the position let's go into the utils class and get the mouse world position ok so this is the code for now now let's make that prefab so in here I have various sprites for the tower and various stages of construction so here let's create an empty game object we're going to get a sprite renderer and let's just give it the phone tower just for now ok so that's all we need for the prefab so let's go up here create a new prefab let's go PAF town we're going to drag this in there okay so let's drag the prefab in here and let's test now in order to make testing easier and let's go into the game resources and in here when we initialize instead of starting with zero let's start with nine nine nine this is just so testing is easier so we don't have to wait for our gatherers to gather the resources so let's go all right I have nine nine nine and if I right click yep there you go the tower has been spawned and the cost went down okay great now let's an oldy tower construction so back in our tower script in here on let's spawn it in construction and do a simple construction tech timer so first let's grab a reference to the sprite renderer sprite renderer and we're going to grab it based on the tower transform docket component type sprite Brennan so now first let's set the sprite we start with the first construction sprite and now we're going to do a simple construction take timer if you've seen the video on the time.take system this would be a great place to use it but for now let's do the logic in a very simple way so in here let's simply make a private int for the construction tick and a private int for the construction tick max so down here let's start off the construction tick at zero and set the construction take max to be in let's say ten now let's make a function a private void increase construction tick and in here if the construction tick if it is under construction technics then we're going to increase it and here let us also swap the sprite so do a switch on our construction tick we have a total of four sprites so in here let's first put on three okay so in here we are very similar changing the construction based on the tick if you wanted this to be applicable to more than just this tick max you would do some simple calculation to get a normalized value but in this case let's just leave it like this to keep it nice and simple so this function is increasing our construction takes and updating the sprite let us also make a private ball for testing if is constructing and to simply return if the construction tick if it is under construction take backs and this is what we're going to use up here to keep our code very nice and descriptive and now up here let us actually trigger this function so in order to do that we're going to use the function periodic we're going to use it to trigger the increased construction tick and we're going to increase it every and let's say second so every second this function won't be triggered this function won't test if it is constructing if so it won't increase the tick and update the sprite so let's see if all that is working okay so here I am I right click there's the tower and it is Colonel in construction as you see the sprite that's right and yep now it's fully built okay great so we have the construction time we're being activated and increasing and the tower is constructing okay now let's add a construction bar so here we're going to use the world bar which again is on the code monkey Tonys to create a construction bar trying to create a new one let's place it as a child of this transform and put it slightly under going to store that construction bar as a member variable so that we can go down here and after we increase the construct untick let's actually update it so in order to do that we do need to calculate a normalized value so let's we flew construction normalized which will be the construction tick x 1f in order to convert it into a float and then divide by the construction takes max so this is the normalized value that we're going to do use set size and set the size of our construction bar okay so let's test here I am and if I right click yep there's the tower and there's the bar as you can see it is increasing on every tick and yep it's foam that's completely okay great so we got the tower construction fully working now let's actually do something when the tower is fully constructed for example let's spawn another together so in order to do that let's make a prefab a new prefab and let's make it the PF together unit now we're going to drag this in here so now let's go into the game Handler and at mother's he realized field for the gatherer unit prefab now in order to spawn our gatherer we're going to pass in a function on our tower create so in here when we create let's also pass in an action which we have to go up here and do using the system now this action will actually do something when the tower is fully constructed so in here let's call it on tower constructive action and we're going to pass it on to our constructor and receive it down here okay this is our action let's store it internally okay so now down here if construction tic if it is equal to the construction techniques then the tower is fully constructed so in here let's also hide our bar so hide this construction bar and we're going to trigger this action so the tower doesn't care what happens when it's constructed it just receives an action and triggers it so now let's go back into our game hammer so in here let's make a private void spawn gatherer unit and we're going to receive a vector3 for the position and what we're going to do is in sin she ate our gatherer unit prefab spawn it on the position returning that identity okay and that's all we need to do to spawn and you gather up so in here and let's give it the action that won't trigger on construction and the action that you will execute won't be spawn and gather a unit on this position so in here let's make a vector3 for the tower spawn position which will be this use that in here and down here and let's go on together unit in that and let's put it a bit under so new vector3 let's say on 02 okay so on rightclick we try to spend the resources if we can't spend the resources necessary to construct it tower then we actually construct the tower we get the tower spawn position based on the mouse position we create a tower using the tower prefab when the tower is fully constructed it won't fire this action and this action won't spawn a new gatherer on the spawn position well as ooh so a bit under the tower and this won't simply instantiate the gather prefab so let's see if all of that is working exactly as intended okay so here I am the resource up back on 0 so let's grab this one tell them to gather some gold this one gather some wood and if I rightclick you can see nothing happens because we do not have enough resources so let's see them grab and then we can test so go three wood three let's wait until we have ten wood and five gold so you can see nothing happened so let's wait okay we now have enough so if I right click yep there's a tower there's the construction bar it's going up these prices updating and yep the tower is fully constructed the bar disappeared and we now have any together and I can select them and tell them go mine this and there he goes and once I've got enough right now so let's go spawn another one there he goes they are mining and construct and yep there's another one and again tell him to mine and when I got enough I guess what not okay worked so there you have it we constructed a building using the resources that are gatherers picked up the tower has a simple construction timer and when completed it spawned another gatherer that we can use to mine more resources so in this series we covered everything regarding a simple resource gatherer he can look for resource nodes independently or be told where to go the system supports multiple resource types and the nodes have a limited amount of resources they also replenish that resource amount after some time we then add the ability to construct a building using those resources and spawned another gatherer when the building is completed I hope you enjoyed this series and learned something useful from it now go ahead and apply it to your own games as always you can download the project files in utilities from Unity code monkey comm if you have any questions post them in the comments and I'll do my best to answer them subscribe for more videos and I'll see you next time