in this video we're going to create the hearts base health system like in the Legend of Zelda let's begin hello and welcome I'm your code monkey and this channel is all about helping you learn how to make your own games with indepth tutorials made by a professional indie game developer so if you find the video how fun consider subscribing so this is what we want to create over here is my character it has some simple nice movement okay then here on the UI I have the hearts health system there are some spikes here to cause damage so if I move towards them clip there you go these trigger just one quadrant of damage and these trigger a full heart of damage as you can see each heart is separated into four fragments so ideal there there and there okay and down here I have a bunch of heals so this will all heal on one quadrant so if I hit it if there you go only one bit and this one a little bit these heal a full heart which includes four fragments so let's go and yep the whole thing and then here I have a mega heal which won't heal all of those and the hearts are also animated so every time a full heart is here we got a nice bubble animation so let's see and if their ego everything goes up and yep example like that alright so this is our goal let's get to it so let's start off by seeing how we're going to set up the visuals over here in the project files I have my textures folder and in here I have these hard textures the hearts are split into quarters and so we have five different sprites for empty and Telkom only fall over here in my hierarchy i have the UI canvas so inside let's create an idiom object this will be the hearts count visual inside we're going to draw all the hearts dynamically so we can have any number so that means we're not going to add anything right now let's just set the width and height to zero and now let's make a script so we make a new C sharp script this will be the parts count Viggo let's drag it on to the game object and then we're also going to have another script this will be the hearts count system we're doing two separate scripts to keep our code nice and clean and organized so we have the in logic in one place and all the visuals in another so first let's start off by just setting up the visuals so let's open up the heart's health visual now here let's make a simple function just to draw a heart so we make a private image going to call this create heart image so we're going to create an image and then return so we create a game object we instantiated with a image component and we make it a child of this transform so our game object setting turns to this transform okay so we are now creating a game object with the image component now we need to locate it and add the sprite so for the sprite let's go up here make a news here on this field for our sprite and will be the hard sprite so here we go into the heart game object we get the component of type image in order to set the sprite to our heart sprite and then we put the game object transform local position let's put it on vector 3.0 okay finally we return our image okay so this is our function to create a single heart image so now let's make a private void start in order to do some testing and we just call create heart image okay so let's test and see if we do have indeed a heart created in our you want before we test first let's go here and let's try the phone heart spread okay let's see any of their it is the foam heart spread okay great so we can now create our hearts dynamically and they are spawned as channels of our visual okay so now we want to try making several hearts so with multiple hearts we need to place them in different positions so in this function let's also receive a vector2 for the anchored position and in here we're going to go the our game object get the rect transform and we set the anchor position to this anchored position then we also set the size Delta to be correct so the size Delta and let's put it at 1010 okay so now up here let's try creating several hearts so the first one let's put it on 0 0 then put them to the side so in here let's put them on 20 and 40 okay so we should be able to see three hearts horizontally a lot let's see if there there are three hearts correctly aligned okay great now that we have multiple hearts being spawned we need to display various fragments so that means first we need references to our sprites so pyramid slightly hard 0 through 5 and here let's drag our sprites so the heart 0 1 and so on ok now in here in order to handle our various hearts we could for example store a list of images however let's create a proper object to keep our code nice and easy to understand so let's go down here and we're going to make a class this will be our class called heart image so this represents a single heart and then up here on our visual UI we're going to store a list of art image and let's instantiate it on our void awake okay we now have a nice heart image list to store all of our hearts when we create a new heart let's create a heart image so here let's rename this to heart image UI and then we have a heart image and create a new heart image and let's pass the heart image UI and this is the one that we returned and we also add it to the list okay so when we call this function we're creating a heart image great now let's go here make the constructor to receive a UI image okay so everything should be working correctly so here we have a list for all of our heart images and whenever we can create a heart image it creates a image on the UI and then our special class it has its own list and our special kiwanis keeps track of the UI image so if we run the code we should be able to see exactly the same as previously and yep there it is our three hearts still exactly the same okay now back in the code since we made this nice class to hold the heart image we can now add a nice function so we can set the current heart fragment so here we just make a simple public glowing set heart fragment and we receive an end for the fragments then in here we just do a very simple switch on our fragments so k zero then we set the heart image set the sprite to be disappeared the heart zero sprite so here as you can see we have an error since inside this class we cannot access these films directly we need to either pass in a reference to this or passing references to all of our sprites let's go to the simple way and just pass in a reference to our heart sound visual so here we pass in the heart song visual and then the image and just like that we can now access the reference okay let's apply to the others so we now have a nice function to set the fragments on this heart image and now up here we can test make sure the code works first of all let's spread them out a bit more instead of 20 to 30 and 60 okay then for this one let's set the heart fragments this one let's put a complete poem then on this one let's put it with just one and this one let's put it empty okay so let's test and if there it is this one is falling this one has one fragment and this one is come only empty so our visuals are correctly displaying all the possible values so our visual class here is already pretty robust allowing us to make hearts and set their fragments so now it's time to work on the illogic class so let's open up the other script here we are in the heart's health system first we're going to remove monobehaviour since we want this to be a simple class then let's make a constructor to receive the heart amount so a public heart sound system are we to receive an int for the heart amount and then this system also needs to store the fragment state now we could just store an integer for the total fragment amount that would work but let's do it like we did on the visual and create a specific class to handle each heart so we go in here make a power class hearts so this represents a single heart here and let's make a constructor and we're going to receive an int for the fragment then we also need a function to get the current fragment amount okay so far so good now up here let's create as many hearts as we need and we need to store them on a list so we make a private list we're going to store our hearts so this is our heart list and in here we initialize the list then we do a for starting off at zero going until the heart amount and we simply create a new heart by default let's start them off s phone so we pass in four fragments and we add it to the heart list okay so this is our basic heart sound system and finally let's just add a public to return a list of hearts this won't be get the heart list simply return the heart list alright so this is the basic setup for our hearts health system now we need to test it so in order to test let's go back into our visual in here let's go into our start and we're going to create a new heart sound system so hearts counts it let's instantiate it with four hearts and then we need to connect the visuals with our logic so let's make a function that will receive a hearts health system so in here we make a public set hearts health system so for testing create a new health system with four hearts then we call this function to set our hearts we store it and this variable and now in here when we set let's copy this code except we're going to do a 4 so we cycle through only hearts we get the heart list from the heart sound system then we cycle through it so for every heart we create a new image and then let's set the fragments based on what we get from the heart so we have the heart give me the fragment amount and put it as our friends now the last thing is to offset our images so let's make here a vector tube for the heart anchored position we start off on 0 0 then in here we use this we create an image and after we create let's increase it by the same thing so by 30 and 0 so every time we add one we go to the right alright so that you do it let's test and if here we are and as you can see we do have indeed four hearts let's make sure everything is updating so we go in here onto the health system and here on let's damage D and last heart so we go into the heart list we grab the last one so the heart is not count mine is 1 and then let's set the fragments so we need to make that function but let's set it to zero so here we make a public void set fragments we receive an end for our fragments and we simply set this okay so let's s and we should be able to see the very last heart with zero fragments and if there it is the first three are full and the last one is empty okay great so we have correctly set up our base visual and base logic class now let's add some health functions like for example damage so here on the on logic class let's add a new function to damage so away from the COI damage then you get an image for the damage amount now in here we need to cause damage to various hearts so for example if we get eight damage we should be able to completely empty the first two hearts so let's do a cycle however we're going to start from the last heart so we do 4nt let's start off at the hearts list dot count minus one so we start off at the very last heart going to keep going once this is above zero and I now here we need to test how much damage this heart can take so down here we already have a function to get the fragment amount and let's also make a function to take damage so we probably going to damage we receive the same damage amount we're going to see if the damage amount is bigger than the current fragment amount then that means this heart has been fully destroyed so our fragments become zero and if not we reduce it ok now we can go up here let's test how many fragments are in this heart so first probably reference to this current heart just on the heartless high then we test if the damage amount is bigger then the hearts dot get fragment amount then this means this heart will be fully damaged and there won't be damage left over so we reduce the damage amount by the heart fragment amount then we cause damage to the heart based on the heart fragment amount so we do as much damage as we can to this heart and then we keep going and if not then that means this current heart can handle all the damage so we just tell it to take the damage amount and then we break out of the cycle all right so that should do it so we're going through all of our hearts starting from the last one then we test if the heart can absorb the current damage amount if it cannot absorb it then we reduce the damage amount by the amount a they absorb and we do that damage and if this happens we keep going into the next heart and if we reach a heart that can finally absorb the full damage then that one simply takes the damage that it can absorb and we break out of the cycle okay so our damage logic should be working so now all we need is to update the visuals and in order to keep our code nice and clean and the logic decoupled from the visuals we're going to use some events so let's go all the way up here and first of all we need to be using system and we create a new public event event handler and let's call this on damage so this event will be triggered whenever the Health System takes damage so we need to do is go down here into our damage function and we fire the event so if we have subscribers to the event we fire it sending this and event or it's empty okay so that should do it now let's go back into the visual and here when we set our hearts health system well let's subscribe to the event so we take the horizontal system that undamaged subscribe to this event and when the event happens let's sight on through all the hearts and essentially refresh them okay so this event is fired when the Health System takes damage so the first thing we do is grab the heart list from the health system then we go through the heart image list we grab the heart image on this index and the heart on the same index and then we set the heart image that the heart fragments based on the fragments currently on the heart object so that should be correctly updating every single heart alright so now it's time to test so for testing let's go up here into our start Emma let's create some simple testing buttons so for that I can go into the CM debug class this class is part of the code monkey Tonys that you can grab for free from in Tacoma comm so inside there is a nice button UI function which creates a button in the UI so perfect for our testing okay so we should have a button on UI one saying damage one one saying damage for and all they do when we click on the buttons it triggers this action so this will cause one damage in this one for damage alright so very simple and perfect for our testing so let's see okay here we are and here are the nice two buttons and as you can see we are currently phone so four hearts on phone let's see on one damage and this one shouldn't lose 1/4 and click and if there you go with lost one click again and now it's at half now it's at 1 now it's empty and now the image and now that one take damage in that one take damage and this one should take away half so this one should lose a quarter and I click yep there you go exactly as intended alright so our damage function is working perfectly fine along with our visuals so now let's implement healing so here back in the in logic class let's make a function to heal so we have our damage and then we have a Ponyboy heal and we're going to receive an end for the heal mount now in here we're going to cycle through the hearts however this time we're starting from the first one now we need to calculate how many fragments this particular heart is missing so we can get the current amount however in order to figure out how many are missing we also need a maximum since the maximum will always be the same let's define it as a nice constant so let's go here make a public on int for the max fragments among and we set it to 4 okay so we have a nice constant for that so down here we can now calculate the missing fragments so it's our maximum minus the current so the heart that get the fragment amount so if it's phone then we get four minus four equals zero so let's go here we have our damage function let's make a phone call heal and here let's make sure our heal amount does not go past the maximum so if we go past the maximum then we simply set the fragments to our maximum okay and if we do not go past it maximum then we simply in crazy fragments by the heal amount okay so this should be working now let's go up here into our logic so we have the missing fragments on this heart so it has if the heal amount is bigger than the missing fragments then that means we can heal this heart and we still have more left over to reduce the heal amount by the missing fragments then we go to the heart and we heal the heart with our missing fragments and then we keep going to heal next one and if not then we simply go into the heart and we heal by the heal amount then once we do we break out of the cycle all right that should do it now in here we also need another event in order to notify the visuals so let's go up here we have on damage and on heal okay and down here we just need to trigger our on heal me event and yep it's that simple now we can go back into the visuals and here when we set our hearts on system let's subscribe so we hearts on system on he own subscribe to that event and when that happens we're going to do the same thing in here so let's make a function for void refresh all hearts so when we damage and when we heal we are refreshing all of our hearts okay that is working now let's go up here to make two more testing buttons to test our healing and yep here we are so we have two more buttons these two cause damage and these two cause heal all right so everything should be working let's test okay here we are with our four hearts and our four buttons so let's try causing some damage there you go one damage two and so on I can damage a full heart yep just like that now let's see the heal if I click on this one it should heal up this quadrant here and if there it is and now another one and now it should start healing this one any of there it is in heal for any up it goes the whole thing okay great so our system is pretty much fully working now for a Health System it's also helpful to know if the character is dead so let's just make a simple function so here on our logic let's make a public ball and call it is dead now in here it's extremely simple we just return if the current heart so we go into the heart list on index 0 and we check if the fragment amount is 0 if so then the entire system is indeed dead so let's go up here make another nice event so on dead and we simply call this even when we take damage we check if is dead if so then we fire the event okay that should do it so let's test on the visuals in here and let's subscribe so the hearts on system on dead and if we are dead let's just do a nice pop up alright let's test ok so here we are and this looks good and well it's caused some damage and there you go they're all going down and one more and let's see the pop up and if there you go the character is dead ok awesome alright so now let's polish things up a bit and make the hearts film up over time instead of instant so let's head into the visual script and in here and let's make a function that is going to run every certain amount of time so we can animate things so here make a private void and call this healing and mated periodic now let's trigger this every certain amount of time so for that let's go up here and on the start the perfect way is to use the function periodic which again part of the code monkey utilities this is perfect for exactly this scenario which is where we need to trigger a function every certain amount of time so we're going to trigger that function the hearts and mated let's run it let's say every 50 milliseconds and just like that okay so we now have this function being called every 50 milliseconds now in here let's see if we should be healing so let's cycle through all of the illogic hearts so the same thing we did in here except we cycle through the heart list so here let's test if the logic is different from the heart visual so we grab this and we test if the heart image that get fragments is different from the heart get fragment amount then that means that the visual is different from our logic so since we're only doing this on healing that means we need to increase the heart image and let's make a function and part the visual fragment okay so let's make these two functions and on the air we simply set the heart fragments and in crazy fragments as one and when we do and we break out of the cycle so essentially we're only going to add one heart for each time that this function runs and finally we go up here and when we take damage we do want that to be reflected instantly however when we heal let's not refresh automatically so when we heal the illogic will be different from the visuals which won't cause this code to run and it won't do this all right so let's test okay here we are with our four hearts let's cause some damage and the damage as you can see is still instant and now let's try healing and see if they go up slowly and click any of there you go you went up and yep it was not instant it when I filmed up slowly over tongue so cause damage he's dead now let's revive him and yep there you go it's great okay awesome so we got the nice effect that we wanted now in here let's just make our code a little bit more clean and more performant instead of doing this cycle through all of our hearts every single friend let's first test if we should be healing so we can go up here to make a nice simple boolean a bone is healing when we have a heal let's set it to true okay and in here we're only going to run this if we are healing if so then we run this code now we need to know when we should stop yelling so I'm glad to find a bone only heal we defaulted to true and down here if we do heal something then that means we were not fully healed so we set it to false and after the cycle ends if we are fully healed then we said is healing back to false all right that should do it so now this function should no longer waste cycles by going through the list when everything is healed so here we're on let's cause some damage and there you go it's instant and all its heal and if there you go it heals only over time in the image and heal okay awesome now we could have pointed the same thing for taking damage but it makes more sense if the damage is instant and only the heal is animated now one less thing we can have is to have a nice animation when the heart is completely full so for that let's go into the editor let's create the heart just so we can make our animation so we need to add a image drag our heart image okay here's our image now let's add the animation component now let's add the animation tab so in here at tab for the animation okay now we create a new animation clip and let's just make a very simple animation of increasing the size and getting it back to normal so we just had a property on the rect transform and let's modify the scale let's increase it by 20% and after a while we go back to zero okay so that's it a very simple animation now let's see how we're going to play this animation through our code here on our visual script let's go here to add a serialize field for our private animation clip this will be the heart phone animation clip and down here let's go to the function where we are creating our heart image right here and let's also create it with a animation component and here we go into the game object get component of type animation and we add a clip for the hearts full animation clip now on the heart image let's make a function to play that so a poet boy play a heart full animation and here we just play the animation so let's go here in order to store it and you just play the heart full animation alright so far so good now let's go where we are filling the hearts and here we are we add a visual fragment then let's also see if the heart image that kept fragment amount if it is the same as the hearts Health System dot max then this heart was only healed so we go into the heart image and we play the full animation okay that should do it let's see our nice effect okay so here we are with our four hearts let's cause some damage all the way down there now it's you know a bunch of healing and you have there you go the nice popup animation so again the system supports any number of hearts so let's increase it all we need to do is come here into the hearts health system which as you can see we receive a heart amount so when we construct this here on our start we are constructing the heart sound system and set of four let's pass in ten and let's also add another healing to heal a lot so we got a massive heal let's test here we are with 10 hearts nice let's cause a bunch of damage and all of them are going down yep and I won't tell everything and yep goes up goes up goes up and everything looks very nice if we want just like the game to Legend of Zelda we can add this on multiple lines and let's see that essentially the code is here when we set the heart sound system right now we have the anchored position however let's do this by rows and column so here we have an int for the rose and in for the cons then the maximum of counts and the distance between each row and column and then we calculate the heart anchored position so essentially the column multiply the by the row count size and the road the same thing except only negative so we can go down we create the heart image then we increase the column if it is more than the column max then we increase the row and reset the count so essentially we should be able to have ten hearts per horizontal line so let's go up here instead of making a health system with ten let's make it with 20 right see any up here we are with 20 hearts and ten of them per row so I can cause damage start off with the lower ones and then on that one and then let's heal a bunch of them and if there you go all of them filling up all the Mallick nice and yep awesome okay so our system is working perfectly now instead of using these buttons let's use a nice character also since we are creating these dynamically on this heart sound visual if we want we can simply push this on to the side in order to look a bit better so like that and now let's add our character so here is my usual character with some very simple movement okay you can check out the several videos I have done on simple character movement now let's create some spikes to damage our character so here make a new empty game object this will be nice spikes let's add a sprite renderer component and drag the spikes sprite okay let's add a box Collider so we can trigger our collisions okay make this a trigger yep on the player as you can see he's also created with a box Collider and a rigidbody now let's make this script to handle these spikes so a new C sharp script just a very simple thing for these spikes and then here extremely simple let's make a paranoid on trigger enter QD so this gets called whenever a Collider collides with this Collider so let's first check to see if we collided with the player so we grab a point of reference from the collider dot get component of type player so if player is not known then we hit the player and the player has a function called damage knockbacks tonight simply push him back so let's calculate the direction vector so we have the knockback direction and let's push him away by a little bit so let's see how this function works here it is it's quite simple it just moves the player transform and there's a nice flash so it's in here that we need to damage our hearts health system now in order to do that we need a reference so we just in this case and let's go into the visual class which is the one that creates it and let's make it a static variable so in here we make a public study heart sound system and when we set our hearts on system let's also set a static variable as well again I'm just doing this specifically to make this symbol test obviously if you are implementing this in a proper game you would put it in a more appropriate place like for example the player class would be the one responsible for containing the heart's health system but in this case just for testing this is good so we now have a nice static function so we can go back into the player in order to just test we grab the heart sound visual then we grab the instance and we simply trigger some damage so in here let's also receive an int for the damage amount so we can have varying in damage amount and that should be work now let's go into these spikes and here let's make a signalized film or a private in damage amount and this is the amount that we're going to send in here okay now we can go into the editor we drag our spikes script and let's say this one only triggers one damage then let's have a different spike script let's tint it in red and this one instead of one it won't trigger for damage and let's make another one here that won't trigger ten damage okay that should be working let's test here we are here's the player and all of our hearts in here on them our fault now let's hit this one anybody go we got a nice knock back and we took one damage and one damage every time now this one triggers for damage and this one triggers a lot of damage so just like that you have to quite a lot of damage okay so finally let's make a heal so we can just duplicate the spikes and this will be the heal instead of the spy sprite let's try the heart sprite now let's see our code so we make a new script I'll be the heart heal and here we're going to do very much the same thing so when we collide with the player we heal him by a certain amount so I like to make this function so here let's make a public void heal we trigger the heal on the hearts health system and we tint it in green okay that should be working now here just drag the heart heal instead of the spikes and this one let's heal by 4 then let's have another one on the side that will heal one and we put this one okay so let's test okay here we are let's go some damage and there you go you have some nice damage and now let's heal everything back up so go here touch the healing and if there you go everything went up nice everything flash green and it went out very well all right so we have made a very nice testing scene for our heart system so here's our final testing scene we have the heart cell system up here examine like it works in the Legend of Zelda the hearts are split into four fragments which can be either damaged or healed so if I go and touch these spikes I'm gonna take one damage and there you go it took just the core and this one's gonna take a foam heart yep there you go now with the hearts damage I can go in here into heal so this one all heal one quarter and yep exactly and this will heal a full heart and you examine like that the heels are nicely animated so it caused some more damage and I'll go in here and grab this mega heal and look at the hearts any of there you go they go up very nice and nicely animated so the whole system works perfectly and looks great as always you can download the project files and utilities from empty code monkey dotcom if you liked the video subscribe to channel for more unity tutorials post any questions you have in the comments and I'll do my best answer alright see you next time