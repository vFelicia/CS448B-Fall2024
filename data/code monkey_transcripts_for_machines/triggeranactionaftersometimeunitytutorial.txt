in this video we're going to learn how to trigger an action after a certain amount of time this is extremely useful for testing your game and creating timed events like for example when making a cut scene let's begin hello and welcome I'm your code monkey and this channel is all about helping you learn how to make your own games with inap tutorials made by a professional indie game developer so if you find the video helpful consider subscribing so here we will cover how the function timer works it's a simple but very useful class for triggering an action after some time this is one of the classes that is part of the codemonkey utilities which you can grab for free from Unity codem monkey.com this is very useful for easily setting up timers in your code so here for example I have a scene with a little cut scene set up cut scenes are one of the scenarios where timed events are really important so it's perfect to demonstrate this use so in here when I press space the unit Won Won it won stop show some cinematic bars zoom in and then go back to normal so let's see hit space there it is moving zoom in show The Cinematic and move away okay great so that's one example of how it can be useful so let's check out the code here is the code that makes all of those events happen one after the other it might seem complicated but it's actually very simple as you can see each of them is just one different function call the function call triggers a certain action after a certain amount of time so for for example here on the last one you can see that after 3 seconds we are triggering an action which hides The Cinematic bars so now that we know the benefits and one of the uses for the function timer let's recreate it to see how it works so first in here let's make a new C script and we're going to call this the function timer essentially we trigger a function after some time I want this to be a simple class and to be able to use the Constructor so let's first remove the Model Behavior to make this the simplest class it can be now let's make the Constructor a public function timer now in here to trigger an action after sometime let's receive an action which is inside the using system namespace an action in case you don't know it's a very simple delegate that takes no parameters and returns void so it's essentially the same as in here private void my action this would be a valid function that could be passed on into that action so we need an action and then we're also going to need a float for the timer now let's sort them as variables and now let's make a function that we won't run on update so make a simple public void update in here we're going to count down the timer using time. Delta time and we just do a a simple test if the timer is under zero then we trigger the action again the action is essentially just a stored function so in order to trigger it we simply call Action and execute it as if it were a function all right so that's very simple and it should be working so now let's figure out a way to test it let's create a new script for testing so Mak an easy sh script and let's call this testing and let's also drag it on to a game object that we're going to name testing and drag the testing script onto it okay so we now have this script running with mono Behavior now here we can do our test on this start so we need to create a function timer so we do a new function timer create a new instance of our class and now in here we pass in the action that we want to trigger so let's make a private void testing action and inside let's do a debug.log saying testing and now we can pass in this function as our action and we're going to trigger it after 3 seconds okay so after 3 seconds this function will be called which will do a debug.log now we still need to call the update function on this function timer so let's store this and now since this class is running with a mod Behavior we have access to the private void update and we can call the function timer. update okay so we are creating our testing timer passing in the testing action and 3 seconds then on every update we are calling the update on the function timer and once those 3 seconds are passed it will trigger this function which will do a debug.log so let's see that okay here's the scene and after 3 seconds you should see in the console yep there it is okay great so it worked and it is indeed triggering the action after 3 seconds however as you can see we also have a problem since it's triggering that action over and over again instead of doing it only once as it is intended so let's go back into our function timer and here let's create a function to destroy this function timer so let's call this the private void destroy self we're going to destroy this function timer after triggering the action and in order to destroy this object let's simply set a simple bully so we do a private bull is destroying by default we are not destroyed and when we do destroy self we set it to true and here we only run this code if we are not destroyed okay that should do it for making sure that our action is only triggered once so let's see here we are and after 3 seconds and yep there you go as you can see exactly only once okay great so we can now trigger an action after a certain amount of time so the code is all working but the setup is pretty clunky and here as you can see on our testing we need to First create the object then we need to keep a reference to it and we need to call it on update let's make the function timer class handle all of that to make it very easy to use so back in the function timer code we need to call this update function from somewhere in here now we could make this class extend monob Behavior but that would make this class more complicated and be tightly coupled with the mono Behavior system so another approach is to keep this as a simple class and then have another simple class that hooks into the mono Behavior functions so let's make a class inside this class we're going to do a public class let's call it the mono Behavior hook and this one will indeed extend mono Behavior so this class will essentially hope into the mono Behavior system which means that in here we have access to the private void update so here we can store a action for the on update action and we simply trigger it on update and just like that we can pass in whatever function we want into this on update and it w be called on update so to make this class easy to use let's make a static create function so in here we do a public static we're going to return a function timer and let's call this create and in here we're going to receive an action and a float for our time and in doing so we're also going to make the Constructor private to make sure this Constructor is only called from inside this class and now in here essentially we take care of everything we were doing on our testing so first we create the function timer then we create a game object we create the object with the name function timer and we start off with the mono Behavior hook component then we get that mono Behavior hook component get component and we set the on update function to trigger the function timer. update so with that that everything should be working and it's all contained here inside this one class so to see the benefits of doing all of this let's go back into our testing and this is what we were previously doing we were holding the reference creating an instance and calling update and now we don't need to do any of this we just need to call the function timer call the create function pass in the action and the time and just like that everything will't work so we can get rid of this this and all of this so as you can see we got rid of all that we made it just one line very simple and it's all taken care of inside the function timer so let's test and see if everything is still working exactly as intended here's the scene and after 3 seconds yep there you go there's our testing and as you can see our function timer game object was indeed created all right so everything is working perfectly fine however the one issue that you see is that even though the timer hasn't left and it triggered the action this game object is still in here that is a potential garbage problem so we need to make sure that we clean it up when the action is triggered so let's go into the function timer and here on our Constructor let's receive an action a timer and then also a game object and now we can go into our destroy sound function and in here we also destroy our game object so just like that when we call destroy self it will destroy the game object and this is called after triggering our action so we should be able to see the game object exist whilst the timer is active as soon as it's over the game object should be cleaned up and everything perfectly fine let's see we just need to also pass in the object so let's go up here first we create the game object then we pass in that game object into our function timer and then we hook onto the mono Behavior up update with our function timer update now let's test okay here we are waiting and there's the game object and yep there you go the game object was destroyed and the action was triggered great so everything is working now sometimes you might want to set up a timer to do something like play an animation but you want to cancel it if something else happens so let's see how we can cancel active timers for that really the only thing we need is to have a list of all our active timers so for that let's make a static list so in here we make a private static list of function timers this will be our active timer list now we need to initialize this list so again let's make sure everything is contained inside this class so for that let's make a private static void in it if needed so this function will deal with the initialization of everything that this class requires since our function timers use game objects we can use that to make sure if our game objects are still alive or if they have been destroyed so for that we can use a private static hold an instance to a game object let's call this the init game object and here we can use that game object to test if the scene has been reloaded so we do a test if that game object is null then it means this class is running for the the very first time or there has been a level load which does necessitate resetting our timers so in here we create the game object and we can also initialize our list so active timer list equals a new list okay so just like this we will make sure that our list is always reinitialized every time the scene changes our timers aren't meant to go beyond the current scene so this is exactly the behavior we want so now that we have the en list set up in here when when we create a new function timer all we need to do is add it to our list so we go into the active timer list and we add our new function timer now to make sure that this does not give a null reference exception we're going to call in it if needed when creating a function timer so if it is necessary it will initialize the list if it's already initialized then it doesn't do anything so when we create we add it to the list let's also make a function to remove it from the list so a private static void remove timer and here we call in it if needed to make sure that the list exists and we go into the active timer list and remove our timer okay so we have our list correctly adding and removing now let's call the remove timer when we destroy this actual timer so we call remove timer on this and just like that we now have our list that always contains only the active timers so with that we can now decide to stop a certain timer so let's make here a function a private static void let's call this stop timer and now in here we need some way of identifying a timer so for that let's use a string for the name so that also means that we need to initialize a function timer and also give it a name so on to create function in here let's add a potential string value for the timer name we want this to be just an optional parameter since most cases you probably won't need to use it so by default let's set it to null we're going to pass in the timer name to our function timer so in here we'll receive a string for the timer name so now this object also has a timer name so now in here on the stop timer all we need to do is cycle through the timer list and if the active timer list on this index. timer name equals the timer name that we want to stop then we want to stop this timer so here in order to stop the timer we simply we go into the active timer list of this index and we call destroy self that won't stop the timer and remove it from the active timer list and then since we are cycling through that list we need to go back on the index so we make sure we don't skip one okay so that's pretty much it so now let's go to our testing class to test if all of this is working so let's make two testing actions and first let's call the testing action and then 1 second later let's let's call the testing action two so first let's see if both of these run exactly as intended one after 3 seconds and one after 4 seconds here we are and after 3 seconds and yep there's the testing and yep there's the testing too okay so we have both timers working now let's give them names so this is the first timer and this is the timer two so let's say we started off both of these timers but then we wanted to cancel the first timer so we go into the function timer and we call the stop timer function we pass in the timer name that we wish to stop and let's stop the first timer okay so we are creating the first timer then the second timer and then we stop the first timer so the only one that should still be triggered is the second timer let's see okay here we are and yep there you go only the second timer was actually triggered the first timer didn't happen at all so that means that we we can trigger an action after some time or cancel a currently active timer so that's pretty much it for the function timer class as you can see we have just one entry point it's extremely simple and in using it all we need to do is call the function timer and call the create function and we can now trigger an action after some time and if needed we can also stop it so we can now look into the class that is included in the utilities so here is the class that is included in the utilities as you can see it's called function timer we still have the same monob behavior hook we have a list of our timers and a game object used for initializing the class we have our initializing function and various function calls to pass in timer no timer function time we also have a couple more extra features like for example use unscaled Delta time or the normal Delta time and an option to stop all with the same name so with the understanding of what we created in this video you should be able to understand all of the code in here and how all of this works so that's pretty much it and here is the example scene that I showed earlier as you can see the function calls are very simple and should now be easy to understand we call the create function on the function timer we pass in the action this action for example is selling the character to move to a Target position and it will execute after 100 milliseconds so .1 seconds then after 0.9 seconds we are going to move the camera after .9 seconds we also zoom in and we also show The Cinematic bars so as you can you can see with just these few lines of codes we can create a very nice complex cut scene so anytime you need to trigger an action after a certain amount of time all it takes is one simple line of code so there you have it we recreated the function timer from the utilities in order to understand how it works as always you can download the project files and utilities from Unity codem monkey.com if you like the video subscribe to the channel for more Unity tutorials post any questions you have in the comments and I'll do my best to answer them all right see you next time