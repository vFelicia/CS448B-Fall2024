hello and welcome I'm your code monkey in this video we're going to create the Health System and UI from Apex legends let's begin so apex Legends has a bunch of really interesting systems and in here we're going to create the health system it's relatively simple to implement but nicely complex during gameplay so first we have a normal health bar it has 100 HP and when we get hit the bar it goes down just like that then we have our shield segments which has exhort the damage before the health so we have the shield bars separated into four segments at most how many segments you have is dependent on the body armor you have equipped then we have the various items you can use so again let's cause some damage and we can use the shield cell to repair our shield and a syringe and a medicate to repair our health so let's create all these ailments and have our very nice final bar all right so let's do it first let's create the health bar and the UI just like in the game so here in my canvas let's start off by creating all right so here is the basic setup we have the background containing our background we have a player named Tex containing the name of the player then we have a armor and a helmet display each of them has a background sprite and then on top of it a item sprite the armor will affect how many shield segments we have and the helmet doesn't actually impact the health system but so it is part of the you want so now here in the textures folder I have all the textures needed to display the various health bars here is for the health bar and then for the shield bar the first one is different from the other one so I've got the first one and I've got the others so let's set up the health bar first as normal we make a container and inside we have our bar just like that and behind the bar we are going to have a background which will use the exact same sprite except on a dark grey color all right so now on our bar in here on the image type instead of using simple we're going to use filled we're going to choose horizontal going from the left to the right and so on and now in here we now have a very nice fill amount that goes from zero to one that we can modify to change how much health our character currently has so this is the only field we need to modify when updating our bar now let's deal with the shield bars which will have very much the same composition as our health bar and then on the shield we also have another sprite on top of it just like that it has a nice outline so this is the very first shim bar which as you can see it is slanted only on the right side on the left side it is perfectly vertical so let's duplicate this to make the second shield except instead of using that sprite we're going to use the shield slanted sprite and yep there it is and now let's fill up on the other segments all right so that's all of our human bars correctly located so now that we have everything set up in the editor let's make our code so here on these scripts let's make a new csharp script this will be the character window so first on awake let's grab references to all of our objects okay so here are all of our references as you can see the health bar is on health bar and then the bar and then we get the image component so let's see that's the health bar inside we have the bar and then we have our image which then we access this component so again we can modify the filament okay so in here on that says to see how we were going to modify the bars so we simply test the health image and set the fill amount to let's say 0.38 so the health bar should be at 3% so let's see in here drag the character window script okay let's see and yep there's the health bar currently being displayed at 30% all right now back into the code now in here this script will only handle the visuals so we're going to have all the mechanics for our health system in a separate class so let's make that class a new csharp script this won't be our character so this won't be the class that holds all the logic for the character and is completely separate from all of our visuals so the first thing we need to know is what equipment this character is using which will modify how many shown bars are visible so let's use an inhome to define our various equivalent types so we have anonymity armor then we have a film to store that body armor so now let's make a constructor and in that constructor we set the body armor by default to body armor nut also a public function to return our body armor and a function to set it all right so this is the very basic character class that contains all of our equipment so now let's test our code for testing let's create a game hammer which will be our basic starting script responsible for creating and modifying the character as well as giving the character window decal reference so let's make a very simple call it our game Handler and we're just going to drag it on to our game handler game object ok so in here on our void awake let's create a character and now we're going to tell the character window to display using this character so it's grab a reference for the character window we're going to dry this reference in the editor and then on our character window we're going to have a function to set our character so let's make that function right now go into the character window and here make a public void seven character alright so we have everything set up in order to test so in here let's just do a debug log on our character just to make sure it was correctly set so again we have the game handle just running our awake on awake it creates a new character and it tells the character window to display using that character and on the character window we simply set our internal field and we do a debug log to make sure it was set so let's run and yep there's in the console a character object ok great so now with our character we can go into our character window and we're going to enable or disable the shield segments based on the armor of that character so let's make a function to do that as the character to return its body armor so body armor we're going to go into the character and get the equipped body armor okay then let's do a switch on that bag armor case we have no body armor then we're just going to hide all of our shield segments in order to hide it we're simply setting the game object to active to false case we have body armor tier 1 then we only show you the first one and so on and so forth all right so this should be correctly displaying all the shield segments based on what the character is currently equipping let's just change the code to make it easier to follow so in here we set them all as inactive in the beginning then we do a switch and we simply set some of those back to true so we're doing the exact same thing just easier to fall and here after we set the character we update the shield segments alright so that should be correct let's try run the code and seeing if all of them are disabled and yet there you go only the health bar is visible all of the others are invisible now let's go into the ham Handler and after we create the character let's do character dot set the equipped body armor and let's give it a tea or two now let's see how many segments are visible and if there it is now two segments are visible okay so all logic is working now the shield segments also change their color based on the tear of their armor so let's deal with that so here we have the code we are defining a body armor color than if it's Tier one we set it to a simple color than another color another and in the end we update all the images with the body armor cone so now we need to define all these colors so we want to do them as a constant so let's go into the character and up here let's do a public const color this will be the tier 1 color then we do a call now in here we have an error since color cannot be defined as a constant so one trick we can use to make a color act pretty much like a constant is to make this instead of comes to make it a static readonly just like that we can instantiate a color and it works perfectly fine so we will define a tier 1 2 & 3 and on the character window let's use that so we use the character dot tier 1 cone all right so we are now using those contents so let's go and set these all right so here are our colors now let's go and see if our bars are being correctly tinted and also one more thing in here this is actually not correct based on how the game works on tier one you actually have two bars on tier two you have 390 or 3 you have 4 all right so that should be working just like in the game let's see any of there it is with a tier 2 body armour we have three segments and they are tinted in blue now let's try a tier 3 change this to a tier 3 body arm and yep there it is now we have four segments tinted in purple all right great now let's also update the armor icon in here so let's go here make a private void update body armor icon now we're going to do very much the exact same thing with it in here we get the body armor from the character we do a switch on it okay so after updating the shield segments we update the body armor icon so we go down here into this function very much the same method that we did previously we get the party armor first we set the icon to invisible and if we have no body armor equipped then we keep that body armor icon invisible if we do have something then we set it to visible and we set the background color to the character tier cone okay let's see okay so here we are with a tier 3 body arm as you can see there's the icon saying tier 3 now let's change it now let's instead we have no body armor and yep the icon is invisible and the shin guards are also all invisible ok great so now we can visually see what item we have equipped and how many segments that item gives us now it's actually set things up so we can see the damage so here on the character class let's create two fields so we have a health for our health amount initial for the shield amount now it's add some damage functions and now in here we need to figure out how much will be shield damage and how much is health damage so we do if our damage amount if it is under the shield amount then here the shield absorbs all damage if not then the shield cannot absorb all damage so let's calculate how much health won't be damaged so we decrease the health by the damage amount what was absorbed by the shield and then we set the shield to zero so if we have 10 shield and we are taking 20 damage we get hit on the health by 20 minus 10 which equals 10 so we get 10 health damage and shield goes to zero all right so this should be working after this let's do a text pop up just so we see our stats I'm going to use the code monkey utilities to go down here and create a text pop up you can download the utilities for free from me and tickle my comm so using from the CM debug class you a text pop up on the mouse position and for the text let's show the shield amount and then the health amount and now we also need to define the initial values for the health initial so when you create a character and let's give it a photon so health equals and now we need a health max so we have a constant for the maximum health and one for the shield amount per segment so we set the help to our health maximum and when we set the equipment money armor let's set the shield as well all right so when we set the equipment armor we set the shield if we have none then we set it to zero if not we set it by the shield amount per segment and here two segments three and four all right great so we now have our shield and health Valley's being correctly in Senshi ated and a damage function to reduce them so let's go into the game Handler to test it and here let's create a debug button to test that damage so again the CMD well class contains a very nice function to create a button on the UI so this function lets me create a button on a certain position on the UI in this case just under the center of our screen it won't say damaged 20 and when we click it will execute this action which won't trigger 20 damage to our character so let's see okay so there it is there's the debug button and our character correctly set up with a tier two armor so essentially he has a hundred health and 75 armor so if I click on it yep there you go 55 100 so the armor went down by 20 click again and you should say 35 100 yep coming again should say 15 100 and now it should say 0 + 95 since the whole shield will be depleted and we won't start taking damage in our health yep there you go 0 95 and so on so far ok great so the logic for the shield and the health is correctly working so now back in the code and here on the character after we take damage we need to tell the window to update the visual representation of that damage so for that let's create an event so let's go all the way up here make a public event we're going to call this on health shield change so this is our event which we're going to trigger after we caused some damage so if we have subscribers that event trigger that event with this an event arts empty okay so this event is fired when we change our health or shield so now we can capture this event on our character window in here when we set the character let's do character dot on health she'll changed we subscribe to this event and here let's call function called update health shield and let's make that now here first let's just update the health since it's very simple we just go into our health image and we set the fill amount now in here we need a normalized value in order to get a normalized value we divide the current value by the maximum value so let's go into the character and make a function to return our health value so here we are returning the health okay so now we can go in here and we get the character dot get help divided by the character dot health max all right so just like this we get our normalized Val however in here since we are dividing two ends we need to make sure one of them gets cast to float so we get the correct result otherwise we would just get 0 so in here and let's just cast this first one down to a fold okay so let's run the code and see if the health bar is correctly updating okay so here we're there's the character with full health all right now I click on the image there you go first it's damaging the shields and now it will damage the health yep there you go it cut off by a bit another bit another and so on alright great so we are correctly updating our help now let's see only the shield now the shield is more tricky than the health since its split into segments instead of a complete bar so in order to get the amount we also need a function on our character to return the shield so in here let's define an int for the shield then we get the character get shield okay now let's cycle through all of our segments so we cycle through all four of our shield segments and now in here we need to know if the shield amount is on this particular segment so let's calculate these shield segments min and Max so here we have the minimum for this particular shield segment so the shield segment on index 0 will start off at 0 multiplied by something so it won't be 0 and the maximum will be 0 plus 1 which is 1 multiplied by the shield amount per segment which is 25 so it'll be 25 so the very first shield segment will display the shield amount from 0 to 25 so now we can calculate how much of the bar is empty or filled so first we do if she'll if it is under our shield segment min if it is under or equal to that amount then this bar is completely empty in here let's define a shield array so we can easily use our indexes okay so we have an array containing 0 1 2 3 all right so we can now go down here and use the same index so the shield image array on index I this one is completely empty so we set the fill amount to 0 okay so then we do an else so if it's not under the minimum let's see if it's above the maximum if it is about the maximum then the bar is completely filled so we set this to 1 oh the bar Tskhinvali film and then finally if it's not at the minimum or the maximum then the shield is somewhere in between so here we need to calculate the fill amount all right so we can't lead the film mount by taking our shield removing the minimum from that shield and then defining by the amount per segment so if the shield is three and we are checking the second segment then essentially this will be 30 minus 25 so it will be 5 and then 5 divided by the shield amount per segment and then we get the correct film amount all right so this should be working perfectly fine now we are also cycling through the shield bars that are hidden but that is really not an issue so let's test so for starters we got three bars since we got a tier two armor and we have everything filmed now I click on damage and if there yo there's the shield as you can see it was correctly damaged the bar has a size of 25 and we damage 20 so it does make sense that it's about there so continue damaging and I went through that bar and into that one and again and into that one and then down and now that one and now the health bar started going down so as you can see all the shield bars decreased correctly and when they became empty the health bars are taking damage now it just has to be different equipment so here with no equipment let's damage any of their yo we just went through the health bar and using Tier three we can click and yep there you go everything was filmed now everything is starting to take damage the shield is going down going down and now the health bar is going down okay great so everything seems to be working perfectly fun so now that we have damage working let's see a weight healing now the items that we can use are separated by what type they heal so if we have ninety health and we have only twenty we don't end up with ten shield so we have items for increasing our shield amount and items for increasing our account amount so let's go into the character and here let's make those functions so here all we do is increase the help by our amount then we also do a clamp to make sure our health is within valid values and the same thing on the shield we increase the shield by our amount then we also do a climb on the shield with a minimum of zero and for our maximum and here we actually still need a function to return our shield maximum all right so we have a function that returns a shield maximum based on the body armor and here we come up with using that as the maximum all right so we have two very simple functions to heal our health and heal our shield and again after we modify these variables we need to trigger the event so we can notify our window all right that you do it now let's make some buttons for testing all right so we have a testing buttoned heel 25 health heel 25 shield then 100 and 100 shield no it said another one that won't heal on both of them okay let's test okay here we are with a bunch of buttons now we first start off as kamala phone okay so let's damage the radio damaging some she'll know it's heal just 25 shield if they're good she went up now mighty on the health and yep nothing happened since the health is already full so continue damaging and damage down to the home now I hear home yep works for only fine heal the shield goes up you don't shield a hundred and everything goes out now go down again heal the health the older she'll get it all down and yep every single button is working we can increase the shield and home separately and once we go past the help she'll does not go up and get both them and damage alright great so we can out damage and heal our character and whenever we do our window automatically updates alright so now let's add some effects first let's make a red bar that is visible for a while after getting hit that way we can see how much damage we took when we were last hit so let's go into the editor and here on the health bar let's duplicate the normal health bar tint it in red and put it under the normal bar okay essentially this bar is shown to display damage that the player took and then fades away so it like starts in here and then fate so let's go into our code so we get the reference for our damage health image then we're going to me the timer to know when to fade it and let's define a constant for the fade time remarks all right so we have all the information we need to be able to do our nice effect so let's go down into our update on the update let's first test if the image is visible by testing the color alpha so we go into the dimensional image we get the color we test the Alpha so if the Alpha is bigger than zero then the damage health image is currently being displayed so if it is visible we count down the damage Alzheimer and then if the damage health timer is under zero then we start lowering the image alpha all right so we tested the damage health image is visible if so we countdown the timer if the timer is over then we create a new color essentially we lower the Conger antha and we're going to make it come on the vanish within half a second and we set the new color onto our damaged melt come okay so that's pretty much it for our fade now what we need to do is show the damage health image when we get hit now we also need to know the previous health amount so we know the size of the bar to show so let's go up here so we store the previous half amount so let's set it when we set the character and down here when the health or the shield has changed so when the health changes we set first of all the fate timeline set it to the maximum okay and now let's test if the damaged count images out color alpha if it is not visible so if it is at zero if it isn't visible we need to set the correct size so we size it based on the previous health amount so it's not only we do the same thing that we are doing for the health image but for the damage health image using the previous health amount divided by the health max so the health image won't contain besides the bar as it is right now and the damage health of an image won't take on the previous size and then we also set the collar to the phone all right so here is our code again we are resetting the timer whenever the helm changes if the health bar is invisible then we set these signs and we make it fully visible if the health bar is already visible then the only thing we're going to do is actually just set the Alpha so instead we put this out here all right so let's see that effect okay so here we are no armor for health so let's try causing some damage yep there's the red health bar showing how much we previously had now click it again yeah there you go we previously had that one so we can easily see that we took this amount of damage damage again yep there you go it stays in red and then vanishes after once now let's heal it's not fully healed damage again yep there's the bar again showing and again showing it if I get hit twice it just resets the time so you gotta hit twice there you go everything shows and everything disappears all right so that's a great effect now let's add a final effect which is flashing when we are on low HP so again we're going to duplicate our bar this one won't be always completely filmed and let's make it a darker red so essentially when the health bar is too low we're going to flash this by increasing and decreasing the Alpha all right so let's go into the code so you grab the reference to the health flashing image now let's go into the update and here on let's deal with the flashing help image we're always going to have it flashing and then we either just enable or disable the game object in order to do a flashing we need to store a variable that won't say either we're increasing or decreasing the Alpha so let's go up here so we get the Alpha change and by default let's set it in here let's set it to positive so now we can go down into the update we get the low health color which is from the low health image dot color so you get the on low health color then we increase the color alpha by the low health alpha change okay and then we check if the low health color kalfa if it is bigger than one F then it has been fully flushed so we need to reverse the alpha change so we simply multiply it by minus one out so we reverse it okay and we do the same thing if it is under zero we also reverse and we set it to zero okay so after changing the low health color we go into the in low health flashing image and set the color to the new oil health color so this is our flashing code and again we're only going to run this code if the low health flashing image game object is active so if the game object is active we run this code and by default that will be inactive so let's go up here and we take the game object and set the active into phones so by default that flashing image is not visible so we need is to update this bar got set active when we change our health so let's go down here when the health has been changed let's set the active to be true if the character that get health if it is under 30 so if we have under 30 HP then this will be visible if not then it won't be invisible okay so let's test there's the health bar just as normal now cause some damage there's the normal one showing the damage okay and the flashing one isn't visible alright great damage again and still not visible and 30 HP is about here so it should now show up and yep there's the flashing right there since we are under 3 HP it says flashing now if I heal yeah there you go the flashing is vanished since we are no longer on drastic low HP and then which again there you go without showing how much we damage we took and that one is flashing since we have very low help and heal and there you go heal again now it's done yep great all right so we have added some very nice effects now let's replace these testing buttons with some more proper buttons and yet we have replaced the testing buttons with some very nice buttons and we can now still cause damage there you go there's a bar flashing now I increase the health now increase the shield shield make shield damage at all almost dead everything flashing kill everything and yep every single button works so we can now damage and heal both our shields and our health so there you have it we created the health system and UI from apex legends we have a health bar and a certain number of shield segments based on the body armor we have equipped we can trigger damage which first goes through the shields before damaging the help we also have various items to regain health and shields as always you can download the project files any tony's from unity kentucky.com if you have any questions post them in the comments and I'll do my best to answer them subscribe for more videos and I'll see you next time