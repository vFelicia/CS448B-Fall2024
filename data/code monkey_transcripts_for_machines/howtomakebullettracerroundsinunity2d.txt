hello and welcome I'm your code monkey and in this video we're going to make a visual weapon bullet tracer it won't be a visual line that we're going to spawn from the weapon shoot position to the target position and then we're going to add some extra effects alright let's get started so I have my scene here with my character I can move it around it is looking at the mouse and when I fire it plays a basic animation okay so let's go into our game handler script now in here I have a basic setup I have the camera fall script which we created in a previous video it is being set up to follow the player position and the player handler is handling the player movement and playing the animation when the left mouse button is down okay so on my player handler script I have an event called on shoot that is being fired every time the player shoots his weapon now in here this event is being fired with on shoot event args which contains the gun endpoint position and the shoot position which is the position of the mouse so just for testing let's do debug dot draw a line from our gun and quick position into the shoot position just to see the values that this event is fired let's draw the line in white with duration of 100 milliseconds okay make sure it gizmos are on and there you go we can see the line is going from the weapon endpoint right there into the mouse position okay great so our values are being sent correctly so in here in my textures I have a weapon tracer texture which is just a basic line that fades out at the beginning now this is what we're gonna spawn from the shoot and point position into the mouse target position so into our code here let's remove our debug so in here I'm going to create a function call it private roid create weapon tracer and this function will receive a vector3 for our from position and a vector3 for our target position and when I shoot we are going to call our function using a dart gun and point position towards the should position okay so now in here we're going to need to calculate the direction between these two points so let's make it vector three call it beer it's gonna be the position the front position and make it normalized okay so we now have our direction now in order to display our weapon tracer we are going to use a quad that won't display our tracer texture where the lower part of the texture is located at the gun end point and is rotated towards our target position so in order to create that quand we are going to use the world mash class that is part of the code monkey utilities which is always you can grab from unity code monkey comm if you want to know how to create a match through code you can check out the video on that so we're all mesh let's go into world mesh and create going to create on the front position onto our rotation let's leave it at zero for now mesh width that's where that six mesh I want to say just a hundred we're going to need a material for a weapon tracer so let's say weapon tracer material and we'll grab that later coordinates just leave it as now and ten thousand on the offset so that it shows up on top of everything else so up here let's make a serialized field private material called weapon tracer material okay so let's convert our direction into an angle there's also a function on the utilities for that so you tell class dot get angle from the vector float and we're going to set our direction this is gonna be our killer Z which we're going to send in here so this should be displaying a mesh spawning at the front position and pointing towards our target position so let's create our weapon material create a new material weapon tracer and this is going to be unlit transparent drag our texture and drag our reference okay let's give it a shot and there you go it's being spawned it's spawning in the middle right on top of that and obviously the rotation is all right so let's solve up going here so yours is gonna be minus 19 okay the rotation is now correct so let's also solve the size of our mansion set of being a hundred it's going to be a float or our distance which will be vector three that distance between our front position and the target position this distance is going to be the height of the mesh and for our spawn position tracer spawn position won't be our front position was the direction multiplied by our distance by half so Traci respond position will be the midpoint between the front position and the turret position so let's spawn it in there with a height of distance okay let's see how it looks okay there you go the size of the mesh is correct the rotation is correct in the position is correct okay great and I can still move and everything still works awesome now as you can see the size of the mesh in there it is looks pretty decent but if I put it together it looks quite a bit squished in the beginning there this is why we are using mesh instead of just spawning a regular sprite so that this way we can change the scale of our texture and make it look good even when the size is very small so let's do that now so back in our code here and first we are actually going to duplicate our material so we don't modify the original rating you material call it Tim weapon tracer material will be a clone of our weapon tracer material so now on this temporary weapon tracer we want to modify the set texture scale of our main texture and the scale will be a vector to four width we want the exact same width but for our height this is what we want to modify based on our distance now the texture has a height of 256 pixels so in here we are similarly going to divide our distance by 256 so this is always only going to be dependent on the scale of the units in your game but in this case essentially it means the entire texture won't be visible if the distance between the front position and target position is 256 units if it's half of that if it's 128 then this texture won't display half of it so let's use this material instead of the original and see if that issue has been resolved yep okay there you going so you can see when I fire away you can see a lot of the texture but if I fire very little you just see the very beginning of the texture so this looks much better than just having a giant thing pop up right there okay great so now obviously we want to we want to clear up these tracers after some time so what's going to our code and make it disappear after a while in here we're going to have a float timer and let's say we want it to disappear after a hundred milliseconds and I'm going to use the function of data from the code monkeytoes I'm going to create it and here just time with minus equals time double time and if timer isn't less than zero then I'm going to destroy the world mesh and I'm going to return true to destroy the function of data object so in here if not we're going to return false okay let's test that out and see if our choices disappearing and you know there we go it shows up and then it vanishes move around okay great so now this solve easily looks very simple so let's add some frame animations to make it disappear a bit more softly rather than just disappearing all at once okay so in order to do that I have a tracer spreadsheet in here and that we were previously just using this one and now I have several frames to make it slowly disappear so what's great new material and call it weapon tracer spreadsheet make it unlit transparent drag our texture go in here switch our reference for this one okay back into our code here now in here in order to do some basic frame animation we are going to modify the UV coordinates so what's going to our world mesh dot set UV chords and I'm going to send it the coordinates of to start off just the first frame so the first frame will be an X of 0 Y of 0 the width of a single frame is 16 and the height is 256 so this will display just the first frame of that spreadsheet so let's head in here and end for our current frame and let's add a float for our frame rate and let's put it at point 0 69 which is 60 frames per second so in our timeline let's edit that and now in here when the timer is under 0 we are going to increase our frame we are going to reset our timer increase it by the frame rate now if our frame is the final frame the final frame is currently visible we are going to destroy our world mesh return true to destroy this object if not then we're going to display our current frame so we're all mesh not set UV coordinates and we're essentially going to send this set instead of 0 it's going to be 16 which is the size of each frame multiplied by our current frame so when we are at frame 1 it is gonna spawn it is going to display with the necks of 16 one frame to an X of 32 so on ok so let's see if our basic frame animation is correctly working and there you go it is switching the frames and now it doesn't look as janky as before ok great so now let's add some more effects let's add a shoot flash on our shoot position so I have a text Rio which is just a basic yellow circle that signifies the flash and we're going to spawn it and very quickly and here lets you create shoot flash and we want to spawn it on the gun end point position so going here private void create shoot flash honorific two or three spawning position in here since we don't need to mess around with mesh UV sizes we're just going to spawn a basic sprite so we're on sprite spawning on the spawn positioned with our sprite for our shoot flash sprite which I'm going to go up here make it a sprite and shoot why sprite and add a function of timer to destroy it after a while the world sprite dot destroy self after let's say 100 milliseconds okay so let's add a reference to our sprite and test it out okay there you go that makes the effect a bit better all right great and finally let's add some basic screen shake once intensity of 0.5 and loss for 0.05 okay let's see the final effect and there you go we got a basic weapon tracer with a basic screen shake and popping out some effects so to make it look very nice as always you can grab the project files in utilities from Unity code monkey calm if you have any questions post them in the comments and I'll do my best to answer them ok see you next time