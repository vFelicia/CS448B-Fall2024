hello and welcome I'm your code monkey in this video we're going to make the Deadeye ability from red redemption to let's begin okay so here's the scene I have prepared I have a player character I can move around and there are enemies being spawned and I can shoot my weapon and kill them once they get shot they fly away when they are dead okay so this is the base that we're going to use so over here is the player class it is very simple it simply deals with player movement and player shooting you can check out a detailed video on the player movement with the simple character movement video but it's still pretty simple so on the update I simply have a switch on state and right now there is only one state the normal state so on case normal we handle our movement so the function down here simply tests for the keyboard input on the WUSA and D Keys it creates a movement direction using those keys and moves the player accordingly then on the update we are also calling the Hamel aim shooting and this again it's only getting the target position which is the mouse world position it sets the aim target to that target position and when we press the left mouse button if we can fire then we fire and play the animation so that's a very simple setup for the player class over here on this scene I have a postprocessing effect to simulate the Deadeye effect I have setup on the values and now in order to use the effect on we need to do is modify the weight in here so if it is on zero it's come on with disable these are the normal colors and if I increase it up to one then gets the complete effect in order to set up the postprocessing we need is this postprocess volume in here and on the main camera we also have a postprocessing layer and using that layer and so on so again all we need to do is modify the weight to go from zero to one okay so let's begin by making a new C sharp script this will be the Dead Eye class this will handle the effects and the state of the Dead Eye in here let's make this a static function since we don't want to instantiate it so make it static and remove the amount of behavioral references this is going to be a very simple clean class so let's begin with a init function this won't receive the references that we're going to use so in it and in here first let's receive the post process volume that we're going to use to modify the weight so in order to do that we have to go using the Unity engine rendering that postprocessing so now in here we can receive a post processed volume and let's call it the black/white post processed phone it isn't black and white it's more of a sepia but that's a good name for it so in here let's store it so in this class we're going to have two functions want to start the data effect and want to end it so let's begin with a public static void start and then we're going to have a public static void and now in our start let's simply enable the effect so we can see it in action so we simply do the black/white closed process volume and set the weight to one and on the end let's set the weight back to zero okay so that's the effect now let's also make a public static ball is active to test if the effect is active okay so this is our very simple that I class it has everything we need to start testing so now let's go into the player class and up here after we test for the shooting and the movement let's make another function this one will be the handle that I so let's make in here private void handle that I and in here drink test for an input let's say Kiko D so when we press E and let's toggle D that I effect so let's check if that I if it is active then we do that I dot end if it is not active then we do that either start okay so by pressing E we should be able to toggle the data effect and now finally all we need is to go and take the game hammer so in here we have the code that is currently spawning the enemies so let's add another serialize field and here we're going to receive the post processing volume and we're going to initialize that I class and give it this reference okay so just like this we have everything to be able to test okay here's my character everything well it's normal I can shoot and I can kill enemies okay and now if i press e if there go the effect is active and if i press e again yep no it's a day one so enable disable okay great so instead of enabling and disabling the effect instantly and let's add a slight animation so here on let me add a private static void and I'm going to call this the animate black/white effect receive a float for the start float for the N and a float for the animation time so in here we want to increase or decrease the weight starting at start ending at end and taking animate time to do the animation so that's essentially a very simple loop function so let's do that in order to do it I'm going to use the function updater from the code Mach utilities which is always you can grab for free from unity code Maki calm so I go up here using code monkey Dada tones so now I can go down here and use a function updater this essentially lets me trigger an action on every update so this action here on betray run every update so in here we want to set the white white postprocess volume and modify the weight now let's use math F dot work we're going to start going to Evan end and then we need a time value so let's do clear a time which starts at zero and will end at one so in here let's increase it by unscaled out the time since we're also going to modify the normal time scale and we similarly divided by the animate time okay and finally the function of theater can receive an action which returns a boolean and if that bowline is true it destroys it so in here we'll return time bigger than one so essentially if time is very than 1 then the function updater won't destroy itself if not it won't keep running on every update okay so now we can go up here and on start we want to animate we want to start on zero F we want to end on one F and let's say between one second and and we do the same thing so we go from one to zero all right so let's also do the same thing to animate the time scale so in here make animates time scale effect and we're going to modify the time that time scale by that amount so the time scale if you don't know as you can see it is the scale at which the time is passing so essentially normal is that one F but if we want to do some slow motion effects we can simply reduce this value so in here when we activate let's put the game on slow motion at about 20% so we animate the time scale effect let's start that one up at normal time then we're going to slow it down to 20% and again do it over one second okay and here we start at point two and we end at one all right so we can tweak these values but it looks good for now so again what's test okay so here I am I can still move I can shoot enemies everything is fine now if I press E yep there you the effect is animated and after a while it is phone and the same thing for the time effect as you can see everything is on slow motion I can shoot them and everything works now if i press e yep everything goes back to normal after one second okay so we need to make the time scale animation a bit faster but everything else looks good okay so now that we have the officials working let's the only way the Dead Eye tags so essentially in here we want to add a bunch of positions and then we finally shoot towards all of those positions so in order to do that let's first go into the player and in here we want to add another state because we don't want them shooting once the data is active so let's have the state that I active so here let's rename this to handle that I activate and here we are simply going to enable and once we do we set this state to state that that I active okay so now I'm here on the update let's handle the other state so here let's make a function to handle the tag so handle dead i tagging and I mean here we want to capture onmousedown so if input dark yet mouse button down of the left mouse button so button zero and okay so let's grab the target position which is the vector three for the target position which we go into the Utah's class to get the mouse world position so that's the position that we want to tag so in order to do that we have to be able to add tags on the data so in here let's make another function a public static void try add tag and this will receive a vector three for deep tag position we're calling it try a tag so we have a limit so up here let's make a private constant for the tag amount Max and let's say a maximum of five tags then we're going to need a private static list of the vector 3 this will be the tag position listen so in here let's initialize the list and down here when we try to add a tag if the tag position only star count if it is less than the tag amount max then here we can add the tag so add the tag position to the tag position list so now we can go back into the player and here when we press a mouse button we can go into that I class and try to add a tag and this is the time so now we are successfully capturing all the various tag positions with a limit of five now we need the player to receive that list when the data actually ends so in order to do that we're going to modify the DAT I start class and in here we're going to receive an action which is on using system so we're going to receive an action and we're going to call it on that I end and that action will receive a list of vector threes an action is a function so in this case the start will be called with a function on the parameters and that function will receive a list of vector three as a parameter so in order to do that let's store this up here so now on the end after we do all the effects let's call this function using our tag list okay so now we can go back into the player and in here on start it expects a action that receives a list so in here let's make a private void on that I end and we're going to receive a list of vector3 this won't be the tag position lists and this function is what we're going to pass as an argument towards this function okay so essentially when this function is called we receive the tag position list which contains a list of all the positions that were tagged so in here all we need to do is shoot towards everything on one of them so I'm going to do a for and D equals zero going to cycle through the tag position list our count now in hearing at a vector3 for the tagged position so now I want to shoot this tag now obviously I don't want to shoot all the positions at the same time so I want there to be a little delay so in order to do that I'm going to use the function timer which again part of the code monkey utilities so this lets me easily trigger an action after some time so we're going to fire towards a tag using the same pistol fire rate that we use normally so in here let's trigger an action after fire rate multiplied by the index and here we simply do the same thing for the shoot target so we should this tag position after fire rate times I so essentially the first tag position will essentially fire instantly because it won't fire this action at fire rate times 0 which is 0 so it won't execute instantly then the second one won't fire towards the second tag position after if I write x 1 so the fire rate is at 200 milliseconds so it won't fire at the first act position and 200 milliseconds later it won't fire at the second and so on ok so the last thing we need is to actually deactivate the Deadeye to call that I dot n so let's go up here handle dead I end and here let's make a fresh void handle that I N and we're going to do essentially the same thing as in here except instead of start we're going to trigger the end and we're going to bring the state back to normal ok so let's see fun with this is correct ok so here I am walking around I can still shoot I can do everything and now for pricey give there go the effects arts and Sun slow motion now I can click on various positions so click here click here here and here knife repress key yep choochoochoo yep there you go he fired into all the positions exactly as we wanted so again what's going to that I and shoot down and down and now actually there won't be an issue so let's see if there you go he actually fired five or six shots so that's because we are not clearing the list and if you can also see we also have an issue with the animation which is we click here here then we are aiming in there and check out the weapon and there you go the weapon is not working in the correct position so essentially we want to still block the normal aiming and movement until the effect is completed but after that everything is fine okay so first you fix the animation so in here when we press to end the data we check if that I dot is active if it is active then we end it and that's it we don't modify the state instead we modify the state down here or we add another function timer after the fire rate dot count so after every tag position has been shot then we are going to execute an action and that action will set the state back to normal ok so this solves the animation issue now again on the dead eye in here on start we have to reset the attack position list so it's very simple just here dot clear this list ok so let's see if those issues have been sold okay here I am again walking around naming perfectly fine okay now if I press E yeah there you go slow motion everything now I shoot there there and there and click shoot shoot shoot yep there you go the animation of the pistol was correct now it's back to normal so again let's see if it no longer save the previous one so again back into that I I'm going to shoot in here and here and it should only fire two shots one two yep there you go okay great so the effect is pretty much working right now now the only thing we need obviously is to actually see where we are actually tagging so we need to be able to view all the tags that have already been created so let's do that so over here on the antenna class let's create a inner class to deal with each specific that I tagged so in here let's make a public class and let's call this that I tagged this won't represent a single time so in here let's make a constructor and we're going to receive a vector3 for the EPAct position and we're going to store it internally then I would simply have a public vector three to get the position which will return the tag position okay so now we have a nice object that is responsible for each tag so using that we can go up here and essentially clean up our code instead of having a list of tag positions we're going to have a list of data tag so let's rename this to that I tag list so down here when we are adding a tag instead of adding a tag position we're going to add a new that I tagged using this tag position okay and on that I end up here let's calculate a list of vector three for the tag position list since that is what we want to pass back to our player so make any own list and now cycle through all the dead I tanks okay so we have reworked the code to work with a specific that I tagged object but everything else should still be working the player is still receiving a list of vector three okay so now let's see on with making the UI visual so we're here on my canvas I'm going to create an empty game object and I'm going to name this the Deadeye UI and inside I'm going to add a UI image which won't contain the cross image that I have in here so let's just tint it in red and make it a good size okay so this is our cross now let's name this into the cross template this is the template that we're going to duplicate so let's make the script to handle the UI so in here let's make a new C sharp script D dead eye UI and inside we're going to have a function a public static void add tag and this will receive a debt I doubt that I tagged that I tank in order to use a static let's store our instance so private static that UI for the instance so here let's also grab a reference to the transform for the tag template transform so in here on let's section we rename this to add tag static which will do an instance add tag and here we have a private void add tag which will receive the same thing so in here the first thing we want to do is duplicate our template so now we have our duplicated tag transform and now we need to actually position it where it should be so essentially we need to convert our data tag position which is a worm position into a UI position so in here we have a vector3 for the tag world position which is the data tag that get position so this is the position in the world so we take that and we do a camera that main that worm to screen point so we convert that Worman position into a screen position so a vector3 for the screen point now we want to convert the screen point into the UI point so we grab a vector3 for the UI world point which will be the UI camera that's what we're going to need a reference to and do screen to world points of the screen point so here what's at a private camera for the UI camera since we need that reference so now we have the UI world points all we needs to convert into a local point so a vector3 for the UI point which will be the transform dot inverse transform point so we take a world space and put it into a local space so we do that using the work world point and then we simply set the tag transform the local position said welcome position to be at this UI point and since the UI is on a different Z then let's simply reset the Z ok so again the Deadeye tag contains a world position up here on the get position so we get the world position since the camera and the UI camera are different we need to convert the position between one and the other so we convert from a world position into a screen position based on what the main camera is seeing so that gives us a position within somewhere in our screen bounds so taking that screen position then we use the UI camera to convert the screen into a world point using the perspective of the UI camera and then using that one point we convert it into a local point on this transform and that's what we're going to place it okay so now we can go back into the Deadeye class and here when we are trying to add the tag we create a new that I tagged and after adding it to the list let's also go into the data IUI and we're going to add tag static and we're going to pass in this tag so we call this and then this one calls this function which insensate s' the tag transform and so on and so forth ok so let's see that in action ok here I am everything is normal now if I press E that is now active now if I click there you go there's the tag position now I click in here and here and yep it is spawning all of the correct positions in the correct point and as you can see they are limited to five tags now as you can also see the position is correct where I click but it is not accompanying when the camera actually moves so we need to update the position on every frame so let's do that so in here let's make an inner class to dealing with each specific UI object then here I'm going to have a constructor and in that constructor I'm going to receive a dead eye dot that I tagged and I'm also going to receive the transform so then let's make a public void update which will update the position of this that I tagged so essentially we're going to copy all of this code instead of running it just when it's in sentient we're going to run it every time ok so now up here when we are adding the time let's create a that I tagged UI object give it thee that I tagged the new only created tag transform so now essentially everything is working exactly the same as previously it is only being updated on start so we need to go up here and make a list we need a private list of that I tagged UI object and here we want to add this to the list and on the main UI we can now do a private void update since this is a mana behavior and in here we simply cycle through all the objects and we call that I object our update ok so on every update we are calling this update function which this update function is doing everything we did previously so it gets the tag position and it converts into world to UI point so let's see if all of our tags are updating their position okay so here I am going to enable that I okay and I'm going to click run on top of this bush and you up there we go if I move the camera you can see that the tag is always on the same position now I click on this one on this one and now I stopped and yep there you go he fired into all the positions ok great and as you can see they are still tracking but obviously Wendy that I is ended that cross should be destroyed so let's do that so here let's make a public static void destroy all times and here I'm going to cycle through all of the tags in my list and I'm going to tell the tag to destroy it so so now let's go down here and make a destroy cell function so all we need to do is to call the destroy into the transform game object and up here and let's also clear the list so clear the UI object list okay so now let's call this over here on the Deadeye when the Deadeye is over and here when it's false we going to then I you wan and call the destroy all tanks okay so let's see so enable that I tagged in here here and here and I'll click II and there you go he fired into all and all the tags are vanish okay great now there is still one thing that we need to do which is if I enable it and I click on this one right here you can see that the tag stays in the position where as in the game itself when you click on top of an enemy the tag actually follows that enemy so in this case if I click on an enemy and then he moves away then I wouldn't hit him so it's dealing with that so over here on the player class when we have that I active we are calling the Deadeye tagging and it's in here that we are adding new tanks so it's in here that we need to check if we are clicking on top of an enemy or not so in order to test that we can simply do physics 2d do an overlap point we're going to test on the target position this function returns a Collider 2d which is a Collider on this position so first thing we need to do is test that the collider is not known then we have actually clicked on something so if we have clicked on something that we want to check if that something is an enemy so in order to do that we can simply use a dummy component to tag our enemies so in here let's make a new C sharp script and call this dead I tagged alone this won't be just a completely empty motor behavior so I have here the enemy prefab which as you can see has a box Collider and then the enemy scripts and I'm simply going to drag this component onto it again it's a component empty component so now using that we can go back into our point class and over here if we do have a Collider we get the coiler that game object getcomponent dead i taggable so if that component if it is not known then that means this Collider the game object that this Collider is on also has that i taggable so we can assume that is our enemy so now that we know that we need to know the unlock composition that we have clicked so define a vector3 for the whole contact position so that position is on the collider that transform dot inverse transform point so this converts from world space into a local space and we want to do that using the target position so this will give us a local target position hello come to the enemy transform so if you click exactly on top of the enemy transform then this will be on 0 0 if we can look slightly above then this won't be someone like 0 1 so now all we need is to be able to add a tag that actually updates its position every time so we need essentially to create a fault which will return a vector 3 and this will be the tag position func which will essentially return the transform dot position + V on low contact position so whenever the transform position changes then this whole return value will also change so then we need to be able to send that into our data system so we need to modify it to be able to receive a phone that receives this so over here on the try Italians are receiving the tag position let's receive a funk and that funk is also what we're going to pass into the Deadeye tag so let's go into Deadeye tags are receiving a straight position we receive a funk and do everything and on the that I tagged position we can simply return the return value of this phone so just like that since all of the other code already goes through this function then everything already works perfectly fine so in here we're trying to add a tag using that and we create a new tag object and the rest of the system works with that object so now we can go back into the player and deal with the other options so in here if the collider is known so if we click on nothing then we want to send the same target position as previously so we're going to send in a funk which won't always return the target position and the same thing up here in case we click on something but that's something does not have the Deadite angle then we send the same target position ok so we could click on something we send with a function that will always update whenever the transform changes and when we don't we simply send a fixed value ok so let's see if our tags are moving along with our enemies ok so here I am enemies are moving that enabled Deadeye and now I click in here and there you can see it's static now if I click on that one if there you it is accompanying the enemy and the same thing for the on same thing for that one I click on various positions and I can do it anymore now I click on e first shoot there there there and yep there we go he fired into every position again enable [ __ ] down one down one down and that one boom boom boom boom yep exactly so I can shoot into various empty positions and also with an object that goes on with that object and just like that so there you have it we created the deniability from Red Dead Redemption 2 as always you can download the project files and utilities from Unity code monkey comm if you have any questions post them in the comments and I'll do my best to answer them subscribe for more videos and I'll see you next time