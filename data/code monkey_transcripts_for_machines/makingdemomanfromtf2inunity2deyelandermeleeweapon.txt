hello and welcome I am your code monkey and in this video we're continuing to make the Demoman from Team Fortress 2 in unity we're going to create the island it's a melee weapon that grants a speed bonus for each enemy killed let's get started ok so I have my demo man here holding the Islander with item and want animations let's go into our code and set up our melee attack so I have the code here from the previous videos where we first implemented the bounty grenade then the sticky grenade then we added the ability to reload our weapons so the first thing we're gonna do is clean up our code and put the grenade code in its separate function so grab all this code here the space to switch weapon test the animation to shoot test the reload explore grenades all of this let's copy it into a different method and call it handle grenade input now in here we don't want to call this for now since we're dealing with the melee system so let's go in here and make a private void handle manly input and we're gonna call it in here ok now in here let's test for input not get mouse button down of mouse button 0 so the left mouse button and I added some functions to the player interface of the previous video here they are I've got a function to get the position of my player play in animation for the island attack with a target position and set a move speed bonus which will add later so using these three functions I have everything necessary to implement the island or melee system okay so in here when we got the mouse button down let's first grab the mouse world position and in here I'm going to go into the player interface and play the animation I'll enter attack towards my target position so when we play the animation we want to actually damage enemy so let's go down here into our grenade exploded code and put this in its own separate function so copy all this and export into a different function and call it damage enemies in range and this will also receive a quote for the damage range which we're going to send it in here so in here let's put a blast radius of 25 and feed it to that function okay so we have this function that is now damaging enemies within range of that position we are calling that Renea they explode as previously but we're also going to call this on our mailing attacks so in here damage the enemies in range within range of the lair position player Doug at position and the damage range it's going to be similar so let's say 20 M and let's also add some camera shake going into the utils class to call it shake camera intensity of one timer 0.1 m as always you can grab the code monkey utilities from unity code monkey calm okay so this should be working we're testing for our left mouse button down if it is down we're going to play the Islander attack animation towards our target position then we're going to damage all enemies within 20 units of the player position and finally shake the camera so let's go to our scene test it out and see if that behavior is correctly working okay here's my demo man I can move around I can hit nothing and when I hit close to an enemy there he goes he's going going boom like that okay great so we have our manly attack working perfectly okay so now that we have the normal melee attack working let's add an effect to increase our bonus movement speed per enemy kill going to go into our scripts and create a new C sharp script name it I and Lander this won't be the class that will be responsible for handling all the bonus movement speed so in here you get rid of all of this doesn't actually have a model behavior just a pure simple class so in here let us make first a private const floats call it bonus speed for a kill and we're going to give it 10 F we're going to have a private static int bonus amount which will start off at 0 then we're going to have some functions to interface with this class so let's make a public static void add speed bonus in here we're simply going to increase the bonus amount we're going to have a public static void reset the bonus which will set the bonus amount back to zero and finally a public static quote get speed bonus which will return the bonus speed for a kill multiplied by our bonus amount okay so whenever we kill an enemy we want to call this function which will increase our bonus amount and then we want to get the speed bonus which will then be applied to our player handler whenever we get hit we want to reset the speed bonus and then apply the same so back to my game hammer script in here on my melee input when I damage enemies in range first of all let's modify this function to get a return value for how many enemies were killed so I need to return from void and make it return an int and in here and in for enemies killed amount and this is what we're going to return from this function and here when we do kill one we're going to increase that function okay so now here in enemies killed amount will be that and first of all we're only going to shake our camera if the enemies have been killed so if enemies killed if it is bigger than 0 then shake our camera and add it to our island or bonus so island or not add speed bonus we're going to add just one bonus regardless of how many enemies we kill so the effect isn't insanely drastic and finally in here we're going to go into our player interface which has a function for set the move speed bonus and it takes in a float for the move speed that won't be added on to its normal move speed so what we want linear is go into our Islander and get our speed bonus okay so this way if we have killed more than zero enemies so if at least one enemy has been killed we're going to shake our camera add the speed bonus to our Islander class and then set the player interface move speed bonus based on what the Islander class says so let's go to our scene and test it out we should be increasing our speed for each enemy we kill okay here I am there's an enemy and then BOOM and yep I am moving a bit faster and a bit more bit more bit more okay so as you can see the code is working perfectly I am increasing my move speed for each enemy kimba as you can see it looks quite a bit silly when reaches insane levels so we obviously want to cap our bonus move speed amount into a decent normal Valley okay so let's go into our Islander class and add a private constant load for our bonus amount max which we're going to set let's say fine so in here we're only going to increase our bonus amount if the bonus amount is indeed less than the maximum and just for testing what's going to using the code monkey utilities go into the CM debug class to do a X pop up to say our bonus amount so we can easily see if it stays within the valid ranges okay let's try it out okay here I am I can move I can attack there's an enemy and boom bonus amount one two three four five and five yep it is capped at five okay there you go it is moving obviously much faster but still within a valley valley okay great so now let's lose the bonus when we get hit by an enemy now down here on my player interface I have had an event event handler on hit that is called whenever the player is hit by an enemy so let's use that to reset our speed bones thing to go up here and go into my player interface and subscribe to the on hit event so in here all we need to do is go into our Islander and reset our speed bonus and then obviously apply it to our player interface and for testing let's add a text popup on the player interface dot get position and just say hit okay so now when the player is hit this don't be fired this function won't capture this event it won't reset the movement speed bonus it won't give the player interface the new reset speed bonus and it will make a simple pop up so we can see when the event has been fired so let's go and test it out okay here I am there's an enemy I'm going to kill okay what is amount one two three four five okay the bonus amount has been correctly capped now let me get hit by an enemy and see if it resets boom there we go reset down to zero now I'm being hit kill them all and now I can increase again let me get hit and there you get movement speed is back to normal hit it and now fast yep okay great so there you have it we added the island there as a melee weapon and applied a bonus to our movement speed when enemy is killed we also made sure to reset our bonus movement speed whenever we get hit by an enemy in the next video we're going to cover the charge ability as always you can download the project files and you Tonys for free from the MV code monkey comp if you have any questions post them in the comments and I'll do my best to answer them ok see you next time