hello and welcome i'm your code monkey so a while ago i made a poll asking if you were playing elden ring and what mechanics you'd like to see from it thank you for all the responses there are lots of great ones although a lot of them are also more general about action or open world games rather than something specific to alden ring so i do want to cover things like giant open whirls making some melee combat getting on and off mount and so on but for this video i want something specific to alden ring so one unique interesting mechanic to alden ring or really all of these songs likes is a backstab if you're behind the enemy and you attack it triggers a backstab which causes some massive damage this one is a fun mechanic in just about any melee action game and it's actually pretty easy to do but at the same time if you don't know about one specific math function then you might have no idea how to do it so we need to figure out how to identify if the player is behind the enemy and also very important this involves matching two animations so the backstab attack for the player animation and the backstep victim animation in order to really sound the attack we also need to make sure all the objects are placed and rotated correctly for the animations to perfectly fit alright so let's handle all of that to make a nice simple but really satisfying backstab mechanic over here i've got my simple character i can move around for this i'm using a bunch of visual assets just for fun these are from the cindy studios fantasy kingdom pack and speaking of cinti studios they're actually running a massive sale on their store right now everything is at 50 off and a bunch of special assets at 70 off this one the fantasy kingdom is at 70 off this week they've got tons of packs all of them in their gorgeous style so whether your game is fantasy modern scifi whether it's pirates western town or really whatever is the theme of your game you can find some great assets to really make your game shine also a nice bonus of buying from the cinti store is you get both unity and unreal assets so check it out to the link description to see everything on sale okay so back to my starting scene here i can move my character around and i can click to play a nice attack animation now there's an enemy standing around right here he's just on idle so right now if i attack him he does not react in any way so our goal is to implement our backstab mechanic but naturally the backstab can only be done if we're actually behind the enemy and for the character control that i'm using here i'm using the one from the official unity free start assets i cover them in another video it's great for quickly getting a character up and running super quickly alright so over here is my super simple player script it's really just testing for an input and when it does play the attack animation in order to play that animation simply goes into the animator and sets a trigger then over here is the player animator now all of these nodes are from the start assets by default the only ones that i had were disu so there's a regular attack animation and a backstab stab animation and then on the enemy just has an idle animation and a take damage animation and also the backstab vector animation if you're not familiar with the animator and transitions i covered them in detail in one of my lectures in my ultimate unity overview course along with 50 other unity tools and features we can preview the animations here so there you go the other one prestandard then taking the damage just a little bit and finally the backstab vector animation so there you go takes like that and falls to the ground and then the player has the backstab attack animation so there you go just like that so we need to essentially match the position of these two objects and play both animations so they really work correctly now i got all of these animations from a great animation pack it was really perfect for making exactly sounds like so if you're making this type of game and you want tons of songs like animations definitely look into that animation pack okay so here is the basic start point with the player just doing a simple attack now let's identify if the player is close enough and behind the enemy if so then we want to play the backstab attack animation whereas on any other position we want to play the regular attack animation so like i said this is actually pretty easy there's really only one thing you need to know which is how do you know if you are behind a certain object and for that we can use the excellent math function to get the vector dot product now if you are a mathematician you can just browse the wikipedia page to learn how it all works but if that looks a bit too complex like it does to me then let's look at a visual example over here on the player script let's first add a reference to the enemy so it transformed just for the enemy transform so we can get the transform position then over here on the player script let's drag the reference okay then over here the function that we're going to use is vector 3 dot this takes two vectors the left hand and the right hand side again i'm not a mathematician so really don't ask me how the math works but i do know that if we put the enemy's transform forward on the first parameter so enemy transform dot forward and for the second one if we put the direction from the enemy to the player so we call it the direction from the enemy to the player and if we get this let's do a debug download to see what this returns okay so let's see okay so there's the log and right away if i'm straight in front of the enemy you can see that the dot product is very close to one if i'm perfectly mathematically perfect in front then it's exactly one now as i move on to the side it goes under one and if i'm right next right to the side of the enemy then the dot product is around zero then if i'm behind then the dot product goes under zero and if i'm perfectly behind then it's exactly minus one also note how the dot product doesn't change if you're on left on the right side so that one does not identify so this is only good for testing if we are either in front positive value or behind we've got a negative value all right so based on this very basic math function you can already see how we're going to build this to make it backstab we just have to complete this see if it's close enough to minus one and if so we play the backstab animation and if not then we play the regular attack animation okay so here in the code when we have our attack let's calculate our dot product so let's go up here instead of a log let's call it a float for the dot and then let's just test if it's close enough to minus one so if the dot now here we should not force the player to be 100 mathematically perfectly behind the enemy we want it to be a little bit forgiving so let's put it minus and say within minus one so we give it a little bit of margin like point one so we just have to be ninety percent behind the enemy so if so then we have a backstab and if not then we have a regular attack so we're here for the animations let's play them okay so that's really it let's test okay here we are let's go right next to the enemy and play an attack and there you go it does work a regular attack now if i go all the way behind my attack and there you go got the nice backstab animation alright awesome now the next issue that we have is the distance so if we're really far but behind the enemy and we play there you go at some place he backstab obviously that makes no sense so it needs to be close enough to the backstab that one is also a pretty easy one to handle now one way to handle that would be on the fine target logic but over here on this very simple demo we don't have any fine target logic we just have the enemy reference directly so for this demo really just adding a simple this in check will do so we just check if the vector3 dot distance between this transform position so the player and the enemy if it is under a certain backstab distance and the player is indeed behind the enemy then with the backstab if not we do an attack okay so here if i'm from the side we're gonna attack if i go behind then close enough there you go nice backstab and if i go a bit far away and i attack and there you go regular attack all right awesome all the logic is working now all we really need in order to make this backstab feel nice and impactful is just apply the victim animation over here on the enemy script i've got a nice spelling function to play the backstab victim animation so over here we've got the enemy transform now we just need to get the component of that script so let's just refactor this code to make this a enemy backstab and then up here we need the enemy transform so transform for the enemy transform go into the backstab gravity transform and then down here when we play the backstab animation let's go into the enemy backstab and we play the backstab victim animation okay so with that it should be working let's see okay so over here let's approach from behind and attack and yep it does kind of work they both did play the correct animations but as you can see it does not look very good so over here the player is looking in that direction and the enemy is moving in that direction so they both play the animations but they should really be facing one another so in order to make this look good we need to make sure we rotate the player to face towards the enemy and we need to position the enemy perfectly at a certain distance in front of the player and we also obviously need to make sure the enemy is rotated in the exact same direction okay so let's handle all of those first up on the rotation let's make sure we rotate the player towards the enemy so over here let's calculate a direction to the enemy so we just grab the enemy transform grab the position minus this position so we've got a direction to the enemy and for handling the rotation i've got a nice function here where i can give it a target forward so i can give the direction to the enemy and this one is using the third person control from the center assets handle that rotation and then on the enemy script again this one is just a dummy script this one is not a phone controller and over here i also have a nice function to set the target forward and really what it does is just stores the target forward and does some nice smooth layer rotation in order to rotate towards that forward i also covered this simple method of using lerp to get some nice smooth rotation another video it's super basic super quick to handle some smoothing with lerp so we just need to call this function so in the backstab we complete the direction to the enemy we rotate this one along that direction and we also go into the enemy backstab in order to set the target forward to make it rotate in the exact same direction so they're both rotating perfectly in the same direction okay so let's see like this so here we are let's go behind the enemy and press the attack and there you go it does rotate to face towards the enemy and yep there you go it plays the animation both of them facing the perfect direction alright great now the next thing that we need is just the positioning right now if i go behind that around this distance and i play there you'll play the animation but there you go the animation is a bit too far so let's position the enemy and again i've got some simple logic on the enemy for smoothly moving to a target position so it's really using pretty much the exact same thing so instead of modifying the transform.forward modify the transform.position so we just need to call this function also onenote here in a complex game this enemy would have some ai that would control the movement so perhaps having another script also moving the enemy smoothly over time perhaps that could create some conflicts now if you were to have those issues then one simple solution is really just teleport the enemy to the target victim position you might think that it looks a bit chunky but if you actually look at the songs games that's actually what they do since the whole thing is so fast you really don't notice a slight teleport so over here on this simple demo i'm using a nice mood but in your own games if you have issues just go ahead make a nice teleport and everything will work perfectly so okay i've got my nice smooth movement just need to call this function which really means that i just need to come up with the perfect position for the animations to match perfectly over here we already have the direction from the player to the enemy so really we just need to place the enemy on the player's position plus this direction for a certain distance so let's go into the enemy backstab and we're going to call the function to set the force movement so first move to a target position and the target position will be our transform.position plus the direction to the enemy and then multiply it by whatever distance based on the animation now in this case for the animation pack and the animation that i'm using here i know that this animation matches perfectly if i put it around point seven f okay so that's it the enemy should be perfectly positioned exactly where it makes sense for the animation so let's test so here i am let's go behind the enemy stay really far away as long as i'm behind place the attack and there you go the enemy moves a bit in order to match the animation and yeah perfectly alright that's pretty awesome so i can really attack the enemy from anywhere i want i can be super close and the enemy moves a bit forward in order to go the animation perfectly matches and looks really great now over here i just had a bit more polish i added some screen shakes some blood particles and some animations on the enemy so now if i do a regular attack there you go looks really nice really impactful and for the final backstab mechanic if i go behind the enemy to the attack there you go it moves rotates nice screen shake nice particles and everything looks really awesome so again doing a regular attack looks pretty nice and if i go behind there you go really nice really impactful really cool and backstab animation okay so with this you'll learn how to use the vector.product to identify if an object is behind another one and you also learn how to combine both attacker and victim animations to really make an action feel powerful now go ahead and make your action games look awesome alright hope that's useful check out these videos to learn some more thanks to these awesome patreon supporters for making these videos possible thank you for watching and i'll see you next time