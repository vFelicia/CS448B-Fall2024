hello and welcome I'm your code monkey and in this video we're continuing to create the waiting queue in bar morale tycoon we're going to add some events to our cutes so we can later notify the building when a guest is waiting in front let's get started so in the previous video we created the waiting queue in here we have an entrance position and five Q positions I have two buttons in here one to add yes to the queue that when I click on it I guess well come into the entrance position and move towards his own position on the queue and I have a get guest button that sends the guests waiting in front away when I have multiple guests in my queue and I get the first one the others get repositioned in front okay good the game is still in development so if you like the concept get a steam page add to your wish list and follow alright so before we can create the building logic we need to add some events to our queue something that won't notify the building that I guess is ready to enter so first of all let's make it automatic to have the guests enter the queue here in our game handler let's first comment out the add guests button and let's make it automatic by creating a function periodic which is part of the code monkey table utils which is always you can wear out for free from unity code monkey comm going to go in here and create a function periodic a function periodic is just a function which is triggered after some time so this action won't be executed every second and here let's put the code that we had on our button so essentially now we no longer need to click the button automatically every second it won't check if it can't add a guest to the queue you won't grab a guess that is idle and add it to the queue now let's go into the CM debug class and create a text popup saying add guest on a position there on the side so this way we can easily visualize when this function is triggered and when a guest is added to the queue okay so let's test and we should see the guests automatically enter and see popups when one is added okay here I am and as you can see the events are firing DSR being added automatically there's the first one so you learn and so on and I can grab one and then fires again okay so every time I grab a guest he automatically adds okay good okay so in order to have our building request guests we to be notified when a guest reaches the front of the queue let's make that using an event we're going to go into our waiting queue and up here I'm going to create a public event event handler which is part of the system namespace public event event handler and call it on guest arrive at front of queue this will be triggered when a guest arrives at the front the key of course so in here when I'm moving my guest the move to function has an action which is triggered when they arrive at their position so when the guests arrive their position let's call a function and name it just arrived at queue position and it will receive this guest as a parameter so this is the action that will trigger when the guest arrives at that position now for this function let's go up here make a private void and it's going to receive a guest object and we're going to trigger the same thing down here when we're locating all of our guests okay so now I have this function being combed every time a guest arrives at a certain position now we have to figure out if that position is the one in front so as we know from up here the guest list the index in this list is the same as the position list so if the guest is that guest list zero then we know he arrived at the first position so if the guest equals guests with zero so this guest is a guest that is in front then that means the guest in front has reached the front of the queue so let's trigger our event go up here and it's the on guess arrived so if the event is not known so if we have subscribers to this event we're going to trigger the event with event archive empty and in here we need to actually store a reference to our guest guest list I and that's what we're going to use to send them to move and to send the reference okay so every time we move our guests we are triggering this function when the guest arrives at his target position then here we're testing if the guests arrived today's position is the first guest if it is then he arrived at the front of the queue and we fire our event now let's go back into our game handler we're going to subscribe to this event so going to the waiting queue to the on guest arrive at the front of the queue and let's subscribe to this event in here in order to visualize the event let's spawn a popup like we did up here make it say on yes right okay yeah exactly put it somewhere on the right side okay so now our guest should be automatically entering the queue moving between the queue when they arrive at the front of the queue it should fire this function all right so here's my queue automatically getting guests added let's let them arrive and when he arrives he triggers on yes all right the front as you can see the others don't trigger the event when they arrived at their position now if I grab this one this will move the other one will move forward and far the event again there he goes he went away boom there you go okay great alright now that the event is correctly firing let's make it automatic to send the guests when the event is fire setting the game handler let's comment out this button and make it automatic so when the guest arises from the queue we're going to trigger the same thing that we were doing on button we need a member reference to all awaiting you and we're going to send him to the right side so at 280 and 40 plus 500 okay so now he should automatically send the guests away in order to make this easier to visualize and let's send him away only after some time so he doesn't get sent away immediately as soon as he arrives in there so I'm going to create a function timer create a new function and it will trigger this function after let's say one second so when the event is fired one second later you will actually grab the first guest in the queue and send them to the right so let's test it and see if our behavior is working correctly all right here's my queue automatically adding the guests and when they arrive he triggers on yes arrived and moves forward after one second now let's also add an event for when the guest is added to the queue into our waiting queue and let's add another public event event handler and say on guest added now this is going to be a very simple event simply in here when we add our guests if we have subscribers to the event let's trigger so back in our game home let's spawn this popup right here in the event rather than directly through that function so on guest added let's create a function for that event and it's going to trigger this so as you can see in here by using events we have the cup on this code from anything else we are executing in the game Hamel but it doesn't have to you can have a separate object deciding when to add the guests and then another one deciding what to do when they arrive the front the cue and another one doing something when they get added to the queue this way everything is nice and clean so much test make sure that our event is still being fired then the app gas popup is still showing you all right there you have it guests are being added to the queue and when they arrive in front they trigger the other event and move away automatically this is what we're going to use to set up the building logic in the next video again the game is still in development so if you don't like the concept go to the steam page and add it to your wish list and follow as always you can download the project files in utilities from Unity code monkey comm if you have any questions post them in the comments and I'll do my best to answer them subscribe for more videos and I'll see you next time