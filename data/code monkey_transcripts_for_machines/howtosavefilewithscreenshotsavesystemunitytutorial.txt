hello and welcome i'm your code monkey and here let's learn how to make one feature that is relatively easy to do and it will always help make your game a bit better we want to be able to save a screenshot along with a save file and that screenshot can really be any image you want so it can be literally what the player sees at the time of saving or perhaps on an rpg game it's an image of your character showing all the equipment and stats or maybe in a city builder game it's an image of the entire city so it can be anything you want the main goal is that the image is included in the save file so you have just one single file containing both the game data and a nice screenshot okay so let's see how to do it if you prefer a more guided path with stepbystep lectures then check out my complete courses learn how to make a builder defender game using csharp just like i make my own steam games or learn how to make games internally using visual scripting or learn all about unity with the ultimate overview course which contains over 13 lectures each covering a different tool or feature of the engine to help you make better games faster i'm always available in the courses q a section answering your questions every single day so check out all the courses with the link in the description okay now let's see how to save an image alongside our save file now as an example i've got a demo scene here so i've got a simple character and i can equip some items in order to customize my character now for example i like this character and i hit on save and now i can stop playing and if i try to play again here's the default character and if i click on load yep unload my previous character so i've got a very basic save and load system fully working this system is pretty easy but if you want to know how i did it i actually covered it in detail in another video i'm saving the game data using json and some saved objects of it pretty simple so in this very simple demo i just have to save data saving the hat the armor and the weapon then i just set up all of the fields on the save data and finally use the json utility in order to convert that object into json then on load it's the same thing just read all the text in order to read the json convert it back into a saved data and actually unload the objects here is all data stored in my save file as you can see very simple again go watch that video if you want to learn how it works in more detail and then the next thing we need in order to build this feature is learning how to take a screenshot and for that topic i also covered it in another video quite a long time ago however as i was preparing for this video i realized that actually that old video only works on the builtin render pipeline and does not actually work on the universal random pipeline which is what i'm using here so there's just one tiny difference so most of the things in that video was still accurate so essentially you just set the target texture you create a temporary render texture and the main difference is in that one when using the builtin render pipeline you've got a builtin function called on post render whereas when using the srp the scriptable render pipeline so urp and agrp it works slightly different so in this one instead of that function you really just add another callback onto this action then logic is pretty much exactly the same so you get the render texture you do the render results called read pixels to read it into a texture and then you can simply save it so just take that texture and code it to png and right on the bytes again go watch that video if you want to learn about all of this in detail like i said there's the only difference is just this one everything else is still exactly the same so here in this demo i've pretty much got just those two things working so i've got the save like you saw and then over here the image is also taking a screenshot so if i save this one there you go that screenshot updates so if i change it yep it updates and here in my project files you can see i've got the save file so containing all the json saved data and i've got my camera screenshot so everything is working except we've got it in two separate files now what we need is to combine both of them into a single file okay so let's learn how to do that let's go into my script and down here i've got my simple save function so this one gets the save data json so that's what i saw previously so it creates the save that object and converts it into json so over here we've got a nice string and then take the screenshot and over here i've got the bytes and the screenshot texture now the way we're going to compose both these separate things so this one is a string and this one is a texture we can save both of them into a single file by simply working with bytes so for example over here we've got json this is a string so we need to convert a string into bytes and for that we can use the encoding so that one is actually let's set it using system.txt and with that using now we can access the encoding namespace then over here we can choose some encoding so let's go with just normal unicode and then we can call getbytes so this one takes essentially a string and returns an array of bytes alright so that's it so we are converting this string into an array of bytes now down here i've got my take screenshot now this one is working with the delegate just in case you don't know about delegates i've also made a video covering how that works the reason why i need the delegate here is because essentially you gotta wait for the camera to actually render the entire frame before we can actually take the screenshot so it's using a delegate just because this code is going to be run slightly after this one so we've got the json byte array okay then we take our nice screenshot then over here we've got the screenshot texture and when we encode it into png we already get a byte array so then we can simply append this byte array onto the json byte array let's actually just rename this to the screenshot byte array okay and instead of saving it directly like this let's append both of them so we can manually create a new array with the length of both of these or we can just do it super simple make a new list okay so i just create the new byte list based on the json byte array and then simply add the screenshot bytes so with this we can do excel the same thing we were doing here so instead of the camera screenshot let's say my save file dot something by the way you can use whatever extension you want that's around just text doesn't matter for anything so let's call it byte save and we're going to add the white list this one requires an array so just convert the list into an array okay so that's really it let's test so here i am let's build up something and then i hit on save by the way if you find the video helpful please hit the like button it's a tiny thing but it really does help thanks and yep here is the save phone and if we check the found properties we can see yep over here the screenshot 345 144 then the game data is only 30 bytes and then this one combines both them another reason why it's more than 30 it's actually 60 more that's around just to do an encoding but yep we can indeed confirm that this one does contain both this data and this data all right so far so good okay so we have our files saved with game data along with the screenshot now of course the next question is how do we unload it now down here on the unload function over here i've got the logic for unloading just based on the json game data so since that one is just text i'm using found.read on text now of course since we're working with bytes we can do the same thing so read all bytes instead of text so we can do this and essentially we will load the byte array so this is the entire byte array containing both the json game data and the screenshot and of course here comes the really important question how do we know when the json bytes end and when the image begins we need to know that in order to know which one of these bytes are meant to be part of the string and which ones are meant to be part of an image we need to know though since those two types are two component different types so actually just like this the way we did it doesn't actually work since just by looking at this file we cannot tell when the json begins and ends so that means that we need to make some sort of header where we can store the number of bytes for each section so for that let's go up here make a proper class to hold all of that data and let's make a function that receives both the json and a texture okay so in this a function we receive the json and the screenshot we convert them into bytes make the byte array and then save it okay so same thing we were doing previously now here we could just append onto the beginning of the file we could append the number of bytes that the json byte array has so that would be one way but let's make it a bit more adaptable and define a proper class for the header that way we can later on add some more data to the header if we need to so i defined the header that just contains the json byte size so now here let's create the header okay so i construct the header we're saving the json byte size so the json vital rate dot length then we convert that editor object into json and then we convert the json string into a byte array so then finally here we've got our final invite list composed of these three elements and all we need to know in order to be able to load these three pieces all we need to know is the size of the header so for that we can make the first two bytes of our save file be special so we can say that those two bytes contain the entire size of the header and the reason why i'm saying two bytes is because with two bytes you can save an unsigned short so a u short so a u short or an unsigned short this one can store any value between 0 and 65 000 so that means that our header can be between 0 and 65 kilobytes that's more than big enough for any header you can think of then we just need to save this so we need to convert our u short into two bytes so we can do that with bit converter and we can use the get bytes and pass in our header size u short okay so with all this we have our final byte list so the first two bytes will be a u short containing our header size once we know that size then we can load the entire header json and then on the header json we've got the json byte size so that means we can load the json bytes and then finally the remainder will be the screenshot byte array alright great so everything is working now we just need to make a load function to do essentially the reverse of all this okay so we do find out read on bytes in order to load our entire byte array now the first thing we need is to know the size of the header so once again we can use the bit converter and convert this one so a u short is the same thing as a uin16 this one takes an array of bytes which again remember it's the first two bytes so let's create the new byte array with the byte array on index 0 and on index 1. okay so with this we have our header size now we can load the actual header okay so here it is first of all i just convert the byte array into a byte and let's just because it's easier to work with less then for the header size we do the bit converter and we get the under size then we go into the button list we get range starting from index 2 so the 2 bytes for the header size and then going through the entirety of the header size so we do that and we get the header byte list then we just do encoding unicode and we get string and we get our header byte list and convert it into json so with this we have the header json then we just need to make the header object okay so we've got our header object now with this inside the header object we've got the json byte size so that's the next thing okay then we do the same thing so we go into the original button list we get range starting on index two pause the header size and then going for the count of header.json bytesize so with that we get the json byte list then again doing the same thing unicode string and convert from json and the final thing is just the image so once again we complete the start and the end indexes then we get to the button list we get the array so we've got the screenshot button list then we create a new texture to the object and convert image in order to convert this white list into an actual image alright so that's pretty much it now let's just modify our function to get this data out of here all right so i just made two out parameters and then down here on the unload function you can just comment out all this and said just call load and then pass in the out save data save data in this case we don't need the texture but still we need to get it okay so we've got save data then we'll load it just as usual and then the final thing is just on the ui so over here is my ui with the function to save the image all right so here just called the exact same thing got the screenshot texture 2d and then just go into the raw image and set it as the visual alright so let's see if finally all of this worked okay so here i am with my default character and if i hit unload yep it actually loaded my object and now if i try saving so let's save this one just like this hit on save and there you go you can see that the screenshot updated immediately and now if i stop playing and i play again now i go again i got the default hit on load and there you go it loaded down all right awesome so we have everything fully working so we've got both the save data as well as the screenshot all in the exact same save file so here in the project files i can just move those to make sure that those aren't being used so the old save file game data and the old camera screenshot just move them to a different location just make sure that we're only using the single save file and yep there it is everything works here's the default load and there you go we got down now let's save this one there you go save the screenshot updated and load and it's down and i'll play again there's the default hit on load and yep there it is all right awesome so with this as you can see we've got all the basics working and all of this code is extremely adaptable all the save data for this demo was just on this class so you could easily add any info you want onto this last and the whole system works same thing for the header if you want to add a bunch more data into the header for example maybe you wanted to add when the file was saved or something like that you could add over here on the header and everything would work and same thing for the image no matter what image you take it does work so you see how this system is extremely adaptable to fit whatever examples your game requires for instance instead of saving the whole screen you can do it a bit more focused so appear in the code for taking the screenshot as you can see here we're using the camera main but you could easily swap this out for a different camera so here for example i can duplicate the main camera just make one slightly different so here i just made a second screenshot camera and position it differently over here we can add a film for that new camera and then we just use this one instead of the references to camera domain and then just assign this camera okay so now i can equip my player and hit on save and there you go there's my new screenshot so as you can see the screenshot doesn't have to be just exactly what you see it can be anything from any camera so on the screenshot maybe you could add some stats some things a completely different view of the world or anything you want so just remember that it can be anything doesn't have to be just the main camera and again if we stop and play again here it is my default player and over there the screenshot from the last save file and hit on load and yep everything loads all right awesome so as you can see this system is super adaptable super versatile you can make just a normal screenshot or you can make a separate camera saying something different or maybe on a city builder it could be an overhead view of the whole city so as you can see you can do anything you want with it and while learning how to do this you also learn how to save multiple pieces of data in a single file so now you can go ahead and use that knowledge in order to save some more complex data in your own save files again if you're looking for a more guided path with stepbystep lectures then check out my complete courses alright hope that's useful check out these videos to learn some more thanks to these awesome patreon supporters for making these videos possible thank you for watching and i'll see you next time you