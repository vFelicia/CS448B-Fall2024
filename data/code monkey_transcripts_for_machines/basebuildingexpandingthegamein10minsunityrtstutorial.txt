hello and welcome I'm your code monkey in this video we're continuing to expand upon our 10 minute game and make it into a simple RTS we're going to add building construction let's begin so one of the core elements of an RTS game is Bay's melding over here we have some resource nodes a storage and a barracks building we want to add the ability to be able to construct more so we're going to start off by creating multiple storages right now the storage is just a simple transform so the first thing we need is to create a class to handle it so over here a new csharp script and we're going to convert our building storage now we're trying to create multiple storages so the first thing we're going to need is enlist to keep track of all of our storages so in here we can simply do a private static list to contain all of our building storage instances and in here on our private void awake we simply add instant list and this one and here in case this is the first one point simply do if it is known we instantiate the list ok ok so now one of the functionalities of the storage is for the workers to drop off their resources so let's make a function to return the closest storage so in here we simply do a public static function we're going to return a building storage and we're going to call it get closes now in here we're going to receive a vector3 for the position that we want to test that closes to and as a helper function let's also do a public vector3 to return our position so in here just some simple code to get the closest okay so we cycle through our list if we do not have any closest then this one becomes the closest if we do have a closest then we check to make sure that this particular index is closer than the closest and then we solve at the closest and that's we will return ok so we have the basics for our building search class now we need to modify the worker to be able to work with this instead of a transform so here is our worker code and down here we have a state called moving to storage and here Agis has the game handler to give him a storage transform so we're only there going to modify this function and it will return a building storage building storage then we simply test the distance that get position okay so we are doing exactly the same as previously except now we are using a proper class so we simply test if it is close enough if it is he drops the goal and goes back to idle if not he moves towards the storage position now we could either modify this function right here in order to ask the game Helena to return a building storage or we can just directly ask the building storage class using the function that we wrote our get closest and we give it our position so now here in the editor let's just drag our script onto our storage transform so drag it onto there okay and just like that everything should still be working exactly the same except now it uses a proper class instead of the transform so let's see hit play okay there he is mining and yep you went to sorry she dropped here the goal and everything worked perfectly fine okay so now that we have this working let's try creating a storage from code in order to do that the first thing we need is to convert this into a prefab that we can later instantiate so here is the prefab PF storage and now on the storage class let's create a function to create a new storage okay so that's it very simple we just instantiate the prefab now let's have the prefab onto our game hammer so in here we're going to add a reference that we're getting later going to ground and now here on certain let's instantiate a new transform okay and let's see if they're using both storages all right he used that one now you went to mine now and now he used that one which is the closer storage alright so we have both of our Sarge's working at the same time so now that we can create multiple storages let's deal with construction so here we're going to have a new class to deal with the building construction let's come with a construction area so for the visual let's just use a random Blue Square and add a new prefab so we have this prefab with a Blue Square and our script attached to it so onto our script we're going to set up the construction progress using ticks then the worker will increase the tech count and when the takeout goes about the tech contracts it won't be constructed so for that we're going to need some variables one for the current construction tick then one for the construction tekneqs then we're going to have a public void add construction tick and let's also do a public float get construction tick normal so in here we just increase the construction tick and on the normalize we simply return the construction tick divided by the construction take max now again these are two integers since we want to return a float between 0 and 1 we have to convert it to one of these values into a float so we can simply multiply it by 1f and right now the result will be a float now we're going to make it so that when the construction tick is completed we trigger an action so let's also store a private action which is on the system namespace for the own construction and then here if the construction tic if it is bigger than the max then this has been fully constructed so we trigger that one and then we need to destroy this construction area okay so this is some pre simple logic now let's add a create function so we can spawn a construction area we're going to do very much the same thing that we did for the storage and here we're going to need more than just the positions so let's also receive a vector3 for the size of our construction area and end for the construction take max and finally the action for the own construction complete and on order to pass these values into our class let's have a public void setup function okay so here this first we have our public static create function which takes a position size construction tick marks and on construction complete we insensate the prefab we grab the component from the transform and we call the setup function and pass in these values then these values get set locally and then all we need to do is trigger this function and when it passes the tick max it won't trigger the unconcern complete all right so let's set up a simple test make sure that all this is working first here on the game handler we need another reference to the prefab okay so now down here let's create a construction area going to give it a size of let's say 5 5 then for a tick max and let's say 50 takes and since this is just for testing let's pass in a function and we're going to use the CM debug class again this part of the code monkey utilities that you can grab for free from unity code monkey comm so in the class we have a very nice text popup function which pops up and it's perfect for this testing okay so we have correctly set up our construction area now let's grab a reference to this object and now let's make a function periodic which again part of the code mock utilities and we are going to create it from trigger an action every 100 milliseconds so every 100 milliseconds we are going to add a construction tick to our construction area and supposedly after 50 ticks the construction area the prefab should be destroyed and we should see a popup here so let's see okay so there's our construction area now if we wait five seconds we should see yep there you go there's the popup and the construction area has been destroyed now in here let's also just add a very simple progress bar so we can actually view our progress okay so here is a progress bar using the world var class which is part of the code mock utilities and it's very simple to add a simple bar and when we add a new construction tick we set the bar size to the construction teknorg west okay so there's the bar and as you can see the progress in increasing when it reaches the end give there go ok great so we have everything we need to make this work so now all we need is for the worker to be the one that calls the add construction tick so back into our work class in here let's add a few more states so we are going to construction airy and building construction area ok so we have a function to set our construction area we set the member variable we set the state to be going to construction area and we tell them to move towards the construction area position so when we are moving let's do a simple business check if we are close enough then we set the state to be filming our construction area ok so when we are building our construction area we play the animation very much in the same way that we were gathering our resources when we finish playing the animation we trigger this action this action will add the construction tic then we check if our construction area is built if so we set it to no and we go back to our idle State if not then we keep building and building and building ok so all this code should be working now all we need is to figure out where we're going to call this function so on the game handler let's make a function to create a construction area so first we need to create the actual construction area object which is what we're doing in here and now in here on this action that is triggered on construction in here we can actually go into our building storage and create a new building storage so we create a construction area then the construction area deals with adding all the ticks then when it is all completed we instantiate a new storage so now we need this to actually tell the worker to go build this construction area so we grab the closest worker and then we tell the worker to set the construction area to this construction area ok so now we have the code to be able to instantiate a new storage construction area now we need to call this function so for that let's just quickly do it on our update so when we click on the left mouse button we are going to instantiate a new search construction area on the mouse warm position later we're going to create an actual UI to be able to come this from but for now this should work so let's see if all of this code is all working perfectly ok so here we are now if I click in here yep there's the construction area the worker winter now he's hammering away every time he hammers he can see that the tics increase and the progress is increasing and when it is fully done yep there's a new storage and yep he is now using the new storage figures there that one is closed so he's going back to that one and so on so we now have three different storages all of them working perfectly fine and every time we click we can instantiate a new one so there you have it we expand upon the tenminute game by adding building construction which lets it expand our base in the next video we're going to give orders to our units as always you can download the project files in assemblies from Unity code monkey comm if you have any questions post them in the comments and I'll do my best answer them subscribe for more videos and I'll see you next time