hello and welcome i'm your code monkey and here let's learn how to make a character with a weapon aimed perfectly at a target this is essential to make your characters aim correct otherwise they will only be aiming straight forward and not up or down which makes it look quite bad so we want to have our target position in the world anywhere in the world and we want to visually see the character correctly rotate and aim towards that target perfectly this is obviously perfect for a character but the same method also works for something like a tower defense game where you want to aim a cannon or of course just make a character simply and look at a target by rotating the head if you prefer a more guided path with stepbystep lectures then check out my complete courses learn how to make a builder defender game using c sharp just like i make my own steam games or learn how to make games internally using visual scripting or learn all about unity with the ultimate overview course which contains over 13 lectures each covering a different tool or feature of the engine to help you make better games faster i'm always available in the courses q a section answering your questions every single day so check out all the courses with the link in the description so a while ago i made a third person shooter video in there i covered everything from start to finish how to handle the character movement find the target position in the world and so on the only thing that i didn't cover in that video was how to make the final animation aim perfectly towards the exact target position now i didn't cover it in that video just because i first needed to cover the animation rigging package which is necessary for making this work and a while ago i made a full video on that package so go watch it if you haven't seen it in there i actually mentioned this specific use case but i figured i'd make a dedicated video just to help the people searching for this exact topic that might not even know about that package so over here let's build it from scratch over here is my starting scene so i just have my character i can move around look anywhere and then when i press the right mouse button the character aims with the weapon straightforward however now i can look up or down but the character's aim does not change it's all fixed so as you can see it's constantly pointing at that height so if i aim to the ground it's definitely not aiming to the ground if i am to the sky definitely not aiming to the sky so this is exactly the point where i'm left on the third person shooter video so go watch that one to see how i got here this one obviously does not look good so let's make it aim correctly towards the actual target like i said this whole thing is based on the animation braking package so you install it through the package manager you can go watch that other video if you want to learn more about it in more detail and see all the possible use cases that this package enables so here let's start using it over here is my character now the first thing we want is to set up a rig so again just going into the animation breaking menu and going to rig setup now let's also add a bone renderer so we can see all the visual bones there they are now let's set up our aim constraint so we go inside let's go inside our rig inside let's make an empty game object call it game then let's go into add component animation rigging and let's choose a multiaim constraint okay so this one is how we're going to make the weapon aim perfectly at the target now for the weapon how i have it set up here it's actually child of the hand so here's the route the entire skeleton all the bones inside i've got the hand right and inside i've got the rifle so really what we want is to aim with the hand bone and then the rifle will follow so over here on the aim constraint for the constraint object let's drag the hand reference then let's make sure the aim and the up axis are correctly set up so let's select the hand game object and here make sure you know about this button to go between local and global space in this case to make sure the x's are correct we need to check them in local space so in local we can see the fourth vector is over here the red one and the red one is the x so on the aim for the aim axis let's put it on the x and then for the f vector we've got the blue one that's the z but that one is pointing down we want up so let's put it on minus z so here for the up axis it's a minus z okay so then we just need to assign the target so the source object and for the target we're going to use the mouse position but let's just first make a simple target just for testing all right so here i've got just a simple sphere let's make this the target so over here on the source object just attach this one okay so that's it no need to play around with any more settings so let's test just like this and yep just with this you can see it's already working so i've got the target i can place it anywhere and as you can see over there the hand is aiming perfectly at the target so i can go left right up down and it always aims perfectly all right so far so good you can even verify that it's actually working so over here as a child of the hand let's just add a simple cube and you can just stretch it out and here no matter where i place it if you can see it is aiming perfectly all right so far so good so this is already working but just like this it looks a bit odd so pretty much the only thing that is turning is just the hand the rest of the body everything else is still static so in reality you don't really aim just with your hand you move the entire body so let's solve that let's make another constraint so over here let's create another empty game object call it the body aim then let's add a component animation rigging once again a multigame constraint then for the constraint object let's apply it to the spine so this bone so over here just drag the spine bone all right then once again we need to set up the axes so let's select the spine and let's see the forward axis okay so make sure you're in local and over here so the forward one is the green so that's the y but it's reverse so the aim won't be minus y so over here for the aim minus y then for the up vector we've got the red so that's the x but it's pointing down so minus x and then for the source object let's use the exact same one okay so let's test and now as i move the target yep it does work so the hips are rotating left and right in order to look at the object alright that's great and now this is also the perfect time to look at a specific thing for how this system works you can see the hips are indeed working perfectly but over there the hand is no longer aiming perfectly so the hand is clearly not aiming towards the target like that nope now what is happening here is that the hands are indeed rotating to face the target perfectly just like before the issue is that after the hand is rotated then we're rotating the body so in the end after the body rotates the hand is no longer facing perfectly the issue here is that we're rotating the hand first and then the body second which in turn rotates the hand so really what we want is to do the reverse we want to first rotate the body and then rotate the hand by the way if you find the video helpful please hit the like button it's a tiny thing but it really does help thanks now that is super simple solved the way that this system works is based on the order in the hierarchy so if we just take the body aim and drag it above the aim on the hierarchy and now if we test and yep now it is indeed working correctly so the body rotates and the hand is still aiming perfectly no matter where i place it all right great so everything is working but here just one tiny thing is this is kind of personal preference but maybe the body is rotating way too much so the body is rotating perfectly just like the hand in order to make it a bit more natural you can actually lower the weight of the body so you can go over here onto the body aim constraint and over here you see a weight slider so if you want you can lower this to something like 0.7 and now essentially the body still rotates but it doesn't rotate exactly as much so this makes it look a bit more natural okay so everything is looking good now there's just one final thing that we need right now the chest and the hand are rotating that's great but in this case when working with the rifle the character is also supposed to hold the front of the rifle with the other hand right now the other hand is just staying up there not actually placed anywhere so once again we can make another constraint to solve this let's make another game object call this one the second hand grab weapon and let's go into add component animation rigging and now the constraint that we want for this one this one is going to be a two bone ik constraint if you don't know about this constraint again you can go watch the dedicated animation breaking video essentially this is the kind of thing that you use for arm placement or leg placement so it takes two bones like the upper arm and the lower arm and then takes a target for the tip so that's the hand and places the hand and rotates the arm in the upper arm to where it makes sense so we're here with this all we need to do is assign the tip so in this case we want for the left hand so let's go make sure we find the left hand there it is so for the second hand let's go and drag the hand reference so that's the tip and once again we can use the super awesome auto setup from deep transform and there you go it automatically selects the elbow in the shoulder okay and then for the source object when you use that menu to auto set from the tip it automatically creates these two objects however these objects we want their position to be relative to the hand so instead of being a child of this object let's go and make them a child of the right hand okay so let's test just like this and yep just like this it is indeed working so the target is currently placed on the hand positions and as you can see the upper arm and the lower arm are correctly bending in order to reach that target so we need to do is just take this game object and place it correctly so over here let's grab the second hand grab weapon target and we're going to want to grab over there up on the front and let's just position this correctly okay so like this that's a pretty good position and here's a quick empty tip so we move this object but we're in play mode so when we only play mode we're going to lose this position since then let's go into transform and go up here and copy the component now we stop playing and now the transform is back on the incorrect place so now right click and paste component values alright so now if we hit on play and yep over there we do see that the second hand is placed correctly so now just a hint right now it looks like the character has a broken arm so the elbow is meant to rotate to the other side so let's put it just over here and once again let's copy the component and paste component values and yep there it is now we've got our aim perfect and we can take it to target object place it anywhere and always aims perfectly and aims correctly so there you go just like that i can put it anywhere and everything looks much better much more natural okay great so the last thing that we need is just to connect this to the rest of the logic and set the target for the target that's actually very simple over here i already have some code in order to get the correct mouse position i actually cover this in detail in another video so i've got an object being moved and placed onto where i'm aiming the mouse really all i need is to use this object as the target so let's go into all of our constraints and just swap it out so use this one and use this one and on this one also drag the reference so here it is and yep it's already working perfectly so i can rotate i can look anywhere and it looks much more natural than the first version all right so far so good so the last thing that we need is just the aim in order to start and stop aiming right now if i stop aiming the character is still aiming so look at that this is not intentional so let's fix that over here is the script that i made in the third person shooter video so we're going to want to play around with the rig weight dynamically so the first thing that we need is an actual field to get the rig reference however if we just use serialized film of rig then nope this type is not identified so we need to add the namespace in this case it's inside unityengine.animations.rigging okay so now we've got our aim rig reference let's rename this the aim rig and then over here are my events for when the aim started and when the aim stopped so over here i could just add set the aim rig set the weight into one and then back to zero so that would make it instant or we can make it nice and smooth and use some simple interpolation so here let's just add a simple private float let's call it the aim rig weight and then with this let's go down into the events so when we start let's set the game rate weight to one when we stop let's set it back into zero and then on update we really just set it all right so that's pretty much it just using a simple in order to constantly alert the weight onto the target weight okay so let's see if it's working so starting off on idle so the ik isn't running so i can look around my character and yep everything works correct i can walk and so on all right so far so good and now as i press the right mouse button if there we go we go into a mode and the system kicks in and the animation rig is currently active so i can now point my weapon anywhere and as you can see it always aims perfectly so i can point to the ground and yep the character aims correctly at the ground i can point the sky and it aims at the sky so i can walk around i can aim i can shoot and yep everything is aiming perfectly alright awesome and again with all this remember the the animation itself is just a simple static animation just pointing straight ahead so it's the animation rating system that is overriding that basic animation in order to make all of these bones aim perfectly at the target and with this you already have a really nice controller for a third person shooter great alright hope that's useful check out these videos to learn some more thanks to these awesome patreon supporters for making these videos possible thank you for watching and i'll see you next time you