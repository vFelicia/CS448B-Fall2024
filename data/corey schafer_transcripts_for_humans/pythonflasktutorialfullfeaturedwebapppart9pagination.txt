With timestamps:

00:00 - hey there how's it going everybody in
00:01 - this video we're gonna add a little more
00:02 - functionality to our application and to
00:05 - our post so we're going to add some
00:07 - pagination so that we aren't pulling
00:08 - down too many posts at once and also
00:10 - we're going to learn how to sort posts
00:12 - by newest to oldest so let's go ahead
00:14 - and get started so first of all since
00:16 - we're going to be working with
00:17 - pagination I'm going to take a second to
00:19 - add more post to our current application
00:21 - from a variety of different users that
00:23 - way we have enough post to see what the
00:25 - pagination looks like so I'm going to
00:27 - fast forward through this so that you
00:29 - don't have to watch me enter a lot of
00:31 - different data now if you'd like to
00:32 - follow along then you could create some
00:33 - additional posts of your own you only
00:35 - need about ten or so to see this in
00:37 - action and also leave a link in the
00:39 - description section below to the JSON of
00:42 - my sample post that I'll be creating
00:43 - here if you want to use those sample
00:46 - titles and content that I'm going to be
00:47 - using in this video so I'm going to add
00:50 - some new posts now and pick up the video
00:52 - when that is complete okay so I have
00:55 - added some sample post to our
00:57 - application and should have a total of
00:59 - 25 now and we can see that if I scroll
01:02 - down through these so I'll scroll all
01:04 - the way down here towards the bottom
01:06 - then it's kind of a lot of information
01:09 - to have on a single page now if these
01:11 - posts had images included in them and
01:14 - things like that then loading them all
01:16 - in at once like this could really slow
01:18 - down our application it would be better
01:20 - if we could paginate this so that we can
01:23 - load a certain number of posts on one
01:25 - page and then display links at the
01:27 - bottom of the page to the other pages of
01:30 - the post so luckily flask SQL alchemy
01:33 - makes this easy for us with the paginate
01:35 - method so let's open up our routes and
01:38 - see how we can get this to work so I'm
01:40 - going to pull up our application here
01:42 - and I already have my routes that py
01:45 - file opened so we can see that currently
01:47 - in our home route we're simply doing a
01:49 - post query all to get all of the posts
01:52 - but we want to paginate these so in
01:55 - place of using the all method to run
01:57 - this query we can use the paginate
01:59 - method so let me run this in the command
02:01 - line so that we can see what this looks
02:03 - like so I'm going to pull up my command
02:05 - line here and shut down our development
02:08 - server using control-c then I'll clear
02:10 - the screen and I'm going to start up our
02:12 - Python interpreter
02:13 - so now let's import our post model so
02:17 - I'll say from flask blog dot models
02:20 - import post and now let's see what this
02:24 - paginate looks like so let me clear the
02:26 - screen here and we've currently been
02:28 - doing it queries like this so we've been
02:30 - saying post is equal to post query dot
02:35 - all and then we can loop through the
02:38 - post by saying for post in posts and
02:41 - then let's just print that post so we
02:46 - can see here that we get all 25 of the
02:48 - sample posts that I added but now let's
02:51 - see what we get when we do a post query
02:53 - dot paginate so I'm going to clear the
02:56 - screen here and I'm going to go back to
02:58 - where we did our query and instead of
03:01 - using dot all I'm going to use dot
03:03 - paginate and now let's look at this post
03:08 - variable so it says that this is a
03:09 - pagination object now let's see what
03:12 - attributes and methods this object has
03:14 - so if we use the dir function then it
03:17 - will print all of these out so if I run
03:20 - that then we can see here that there
03:22 - aren't very many and some of these are
03:24 - hard to read because they get cut in
03:26 - half off the screen but we have hasnext
03:29 - has previous items page and things like
03:34 - that so this is an object that gives us
03:36 - information about the current page that
03:38 - we're on how many posts there are per
03:40 - page and all kinds of information so
03:43 - let's look at the per page attribute so
03:46 - I will say post dot per underscore page
03:49 - and we can see that that results in 20
03:52 - and 20 is the default per page since we
03:55 - didn't pass anything in so if we look at
03:57 - the current page so I'll say post dot
04:00 - page and we can see that the current
04:02 - page is 1 so we're on the first page so
04:05 - we'll look more at these attributes and
04:07 - methods in just a second but the
04:09 - important one here is the items for this
04:12 - page so to print out the individual
04:14 - posts like we did before we can now say
04:16 - for post in post dot items and then we
04:22 - can print out the posts and if we were
04:26 - to count up these posts
04:27 - then we would count that there are 20 of
04:29 - them here and the last five or on the
04:32 - second page now if we wanted to get that
04:34 - second page of items then we could run
04:37 - the same query again but specify the
04:39 - page being equal to two so I will hit up
04:43 - until we rerun that paginate query and
04:46 - let me clear the screen here so we're
04:49 - rewriting that paginate query but
04:50 - instead let me pass in an argument of
04:53 - page equal to two and run that and now
04:57 - let's rerun the loop where we're looting
05:00 - looping through the items so if I look
05:03 - through those and print those out then
05:04 - we can see that we only get five posts
05:06 - and that's because this is the second
05:08 - page so that first page has 20 posts and
05:11 - then this second page only has the last
05:14 - five posts now if 20 is too much then we
05:17 - can actually get fewer per page if we
05:20 - wanted to so if we reran the query so
05:24 - instead of passing in at page equal to
05:26 - two I'm going to pass in a per page
05:29 - equal to five and run that and actually
05:32 - let me clear this out so it's a little
05:34 - easier to see and I'll rerun that query
05:36 - where we have five per page so now let's
05:39 - see what page we are currently on so we
05:41 - can say post dot page and we're
05:43 - currently on page one and if I print
05:45 - that first page so I'll loop through
05:47 - those so I'll rerun a loop and print out
05:50 - the post for those items and we can see
05:53 - that we get five values and these are
05:56 - the first five posts that are returned
05:58 - now I can pass in a page equal to two to
06:00 - get the next page of five so if I rerun
06:04 - this query and pass in a page equal to
06:07 - two and now if we check the page and we
06:11 - can see that we're on the second page
06:12 - and if I loop through these again and
06:15 - print those out then these are five
06:18 - different posts now if we wanted to see
06:20 - the total number of posts and all of the
06:22 - pages then we can use the total
06:25 - attribute so if I clear this if I say
06:27 - post dot total then we get 25 okay so
06:33 - now let's go back to our app and see how
06:36 - we can use this so I will go back to
06:40 - I'll stop py file so now let's actually
06:42 - use that in our application so instead
06:44 - of doing a query for all the posts we're
06:46 - instead going to do a paginate and use
06:50 - the paginate method and we'll set the
06:52 - number of post per page equal to 5 that
06:55 - way our pages don't get too crowded so
06:58 - I'll say per page is equal to 5 and
07:01 - right now this will always get the first
07:03 - page of posts since we're not
07:05 - specifically asking for a specific page
07:08 - and in order to get other pages we'll do
07:10 - this by passing query parameters in the
07:13 - URL and we've seen that earlier in the
07:15 - series when we did the login redirect
07:17 - query parameter so to grab the page that
07:20 - we want let's just get that from a query
07:22 - parameter in the URL by saying page is
07:25 - equal to and that is request dot args
07:30 - dot get and we want to get the page and
07:35 - also that is an optional parameter in
07:37 - the URL so let's also set a default and
07:40 - we'll set the default page of 1 and
07:42 - let's also set a type equal to int and
07:46 - setting the type equal to int will cause
07:48 - our site to throw a value error if
07:51 - someone passes anything other than an
07:53 - integer as a page number and now we can
07:56 - pass that page into our query by saying
08:00 - page is equal to page and then we'll
08:04 - just keep that per page of 5 there okay
08:07 - so now let's also make a change to our
08:09 - home HTML template so I'm going to open
08:12 - my templates here and open this home dot
08:14 - HTML template and instead of saying for
08:17 - post in posts remember that this is now
08:20 - a pagination object and instead we have
08:23 - to say for posts and post dot items okay
08:27 - so now let's save all of this and see if
08:29 - it works in the browser so I've saved
08:32 - these files and now let me open up my
08:34 - command line here and I'll exit out of
08:36 - the Python interpreter and now I will
08:39 - run the development web server by saying
08:42 - Python run PI open this up in the
08:45 - browser okay so I reloaded the home page
08:48 - and if I scroll down then we can see
08:50 - that I only have five posts on our home
08:52 - page now we don't have any links to get
08:54 - to the next pages but we'll fix that in
08:56 - just a bit but for now if I manually
08:58 - pass a URL parameter then we should be
09:01 - able to see the other pages now this
09:03 - might be hard to see but in my url bar
09:05 - here I can pass this URL parameter by
09:08 - saying question mark page is equal to
09:11 - two and if we run that then we can see
09:14 - that now we get the next five posts so
09:17 - this should go all the way up to page
09:19 - five so I saw if I typed in page five
09:21 - here then we can see that I have a
09:24 - latest post down here at the bottom if I
09:26 - type in a page six that we can see that
09:29 - that is not found because that page does
09:31 - not exist so I'll go back to our home
09:34 - page now so now let's update our
09:35 - template so that we can see the links to
09:38 - the other pages now just to demonstrate
09:40 - how these links look I think I'm going
09:42 - to want a lot of pages to link to
09:45 - because right now we're only going to
09:46 - have five pages and I'd like to have a
09:48 - lot more than that
09:49 - so in order to get a lot of pages just
09:51 - temporarily I'm going to temporarily
09:53 - change our per page argument here and
09:57 - I'm going to change that from five to
09:59 - two and save that now that should give
10:02 - us around let's see I think thirteen
10:04 - pages of two posts and I'll change that
10:06 - back to five after we have everything
10:08 - working and just to show how this is
10:10 - going to work let me jump back to the
10:12 - command line again and I will close down
10:14 - our terminal there our development
10:18 - server and I'm gonna rerun the Python
10:20 - interpreter and now let me import the
10:22 - post model again so I'll say from flask
10:25 - blog dot models import posts and now
10:30 - let's do a another pagination query and
10:33 - I'm going to run a query where we're on
10:36 - about page six of those thirteen pages
10:39 - so I'll say posts is equal to post dot
10:42 - query dot paginate and I will say that
10:45 - we're on page six and that will be a per
10:49 - page of two so now let me clear the
10:52 - screen here and now I'm going to see
10:55 - what is printed when we loop through
10:56 - this method called it err pages so I'm
10:59 - gonna say for page in post dot it err
11:03 - underscore pages and then I will
11:07 - print out that page variable so this may
11:12 - look a little strange but it prints out
11:14 - a one two and then a none and then four
11:18 - through ten and then another none value
11:21 - and then twelve and thirteen so you may
11:24 - have seen on websites before where if
11:26 - there are a lot of pages the website
11:29 - will just show you what page you're
11:30 - currently on and then a few pages before
11:33 - and after with an ellipses or something
11:35 - like that and that is what this none
11:38 - value represents so this will make a lot
11:40 - more sense once we actually render this
11:42 - and our template and we see what this
11:44 - looks like but basically these numbers
11:46 - that is showing here will be links to
11:48 - other pages that we can navigate to now
11:51 - I personally think that this is too many
11:52 - links here and we can narrow this down
11:54 - by passing in arguments to the inner
11:56 - pages method and we can specify how many
11:59 - pages we want to see at the beginning
12:01 - and the end as well as how many pages
12:03 - close to the current page so let's add
12:06 - this code to our template and this will
12:08 - be more clear so I'm going to open back
12:11 - up our home HTML template and below our
12:15 - post I'm going to add another for loop
12:18 - to loop over these pages so I am going
12:22 - to open up a for loop here and also
12:25 - close this for loop here and this for
12:29 - loop will say for page num in post dot
12:35 - itter underscore pages and then inside
12:39 - of this loop will create links to these
12:42 - pages and remember there can be none
12:45 - values here as well and we'll just
12:47 - display those as ellipses
12:49 - so we'll say open up a code block here
12:52 - and say if page num then we can end this
13:00 - if statement here and let me also indent
13:03 - this where it's obvious that we're
13:04 - inside the for loop and I'm also going
13:07 - to want an else statement for this if so
13:11 - I will say else now if page num then we
13:15 - want to put a link to that page number
13:18 - but if page num is none
13:21 - then it's going to fall down here to
13:22 - this else statement and that is where we
13:24 - will put the ellipses but if a page num
13:27 - is not none then we want that to be a
13:30 - link to our page and we can add that by
13:34 - saying that we want an anchor tag and
13:37 - this anchor tag can link to and I'm
13:39 - going to put in double curly braces here
13:41 - to put in some code and we want to link
13:43 - to the URL for the home page and we also
13:48 - want to pass in the page equal to the
13:52 - page num that we're currently on and we
13:56 - want the text for this link to be double
13:59 - curly braces again and pass in that page
14:03 - num and let me also add some classes to
14:05 - this anchor tag as well so that this
14:07 - looks a little nicer so I will add some
14:10 - classes here I'll add a class of button
14:12 - and also button outline - info which is
14:17 - a nice bluish color and will also give
14:19 - these a margin to space them out a
14:21 - little bit so we'll do an MB - 4 and
14:24 - save that ok so if we save what we have
14:26 - and reload this in our browser so I have
14:29 - everything saved I'm going to exit out
14:31 - of the Python interpreter and rila rerun
14:35 - our python development server and pull
14:39 - up our website here so if I reload our
14:42 - home page then we can see that we only
14:44 - have two posts per page and the reason
14:46 - that I did that is so that we'd have 13
14:49 - pages here and now I'm going to go to
14:50 - page 6 so we can see that these
14:53 - pagination links are working down here
14:55 - in the bottom if we click on one of
14:58 - these pages then it goes to that
14:59 - specific page up here in the URL we can
15:02 - see that it is passing in a page
15:04 - parameter of page equal to 13 this is
15:07 - page equal to 2 and this is page equal
15:11 - to 6 now we can see down here at the
15:13 - bottom it's giving us a lot of links to
15:16 - a lot of different pages and the reason
15:18 - that the ellipses are useful is because
15:21 - if we had hundreds of pages then we
15:24 - wouldn't want to display hundreds of
15:25 - links we'd only want you know some at
15:28 - the beginning and also some around our
15:30 - current page now I personally think that
15:32 - this is too many links but
15:34 - like I said we can customize this by
15:36 - passing in some arguments to the inner
15:38 - pages method also it'd be nice if the
15:41 - current page had a different style so
15:43 - that it was more obvious what page were
15:45 - on because right now we're on page six
15:47 - but we can't really tell just by looking
15:49 - at this list here so let's go add those
15:51 - changes and we will add those to our
15:53 - home template so I'm back in my home
15:56 - template here and down in our inner
15:59 - pages loop and now let me pass in a few
16:02 - arguments here to it err pages so I'm
16:04 - gonna say left underscore edge is equal
16:07 - to one and that is how many will show up
16:09 - on the far left of the links I'll say
16:12 - right underscore edge is equal to one
16:15 - and that's how many pages show up on the
16:18 - right side of the links so I'll also say
16:21 - left underscore current is equal to one
16:24 - and that is how many pages left of the
16:27 - current page will show up and we'll see
16:29 - what all this looks like in just a
16:30 - second and then I'll also say write
16:33 - underscore current and I'm going to set
16:35 - that equal to 2 because the write
16:38 - current includes the current page so
16:40 - that should limit how many links are
16:42 - actually showed at the bottom of the
16:43 - page and also let's add another
16:45 - conditional to style our current page a
16:47 - little different than the other links so
16:50 - we can come down here into our for loop
16:53 - and I'm going to paste another
16:54 - conditional here within this if page num
16:58 - so if we have a page number then I'm
17:01 - going to put another conditional and say
17:04 - if posts dot page which would be the
17:07 - current page is equal to the page number
17:10 - then we want to style that link a little
17:13 - differently but we also have to put in
17:17 - an else statement here and also end that
17:23 - if so I will copy all of those and put
17:27 - those in so let me copy this link here
17:29 - and also put this into our else block of
17:33 - this if conditional and now if the page
17:37 - that we're currently on is equal to the
17:40 - page number in our loop then we want
17:42 - this to look a little different so I'm
17:44 - just going to have that be a filled in
17:46 - button so
17:48 - to do that in bootstrap the button
17:51 - outline info will be what we saw earlier
17:54 - that outlined a bluish color if we take
17:56 - away the outline part and just do button
17:58 - - info then that will be a solid blue
18:01 - color so that should be good for filling
18:05 - in our current page okay so now if we
18:07 - save that and reload it and our browser
18:09 - so let's make sure our web server is
18:12 - still running and it is and now let me
18:14 - reload page six here and if we go down
18:18 - to the bottom we can see that now page
18:19 - six is filled in so it has a different
18:22 - style than the other pages and you can
18:24 - also see that we don't have so many
18:26 - links down here at the bottom anymore we
18:28 - only have one on the left which is that
18:30 - left edge one on the right which is that
18:32 - right edge and then shows one to the
18:35 - left of the current page and one to the
18:37 - right of the current page so that's a
18:39 - lot better and if we wanted to see what
18:41 - this looked like in different conditions
18:43 - then we can just click through and see
18:45 - what different pages look like okay so
18:48 - now the pagination is done so now let's
18:51 - change the post per page back to a
18:53 - higher number so that we don't have
18:55 - these two posts per page like this
18:57 - because that's just too few so I'm gonna
18:59 - go back to our routes and I'm gonna
19:02 - change that per page and set that back
19:04 - equal to five because I think five post
19:07 - per page is usually pretty good okay so
19:09 - now that that pagination is complete
19:11 - let's add another useful feature so if I
19:14 - navigate to the first page of our web
19:17 - app and reload this then for those of
19:20 - you who have followed on with this
19:21 - series you might notice that the post
19:23 - here at the top is the very first post
19:26 - that I wrote so that means that the
19:28 - oldest posts are being shown at the top
19:30 - and the newer posts are being shown at
19:33 - the bottom and this likely isn't how
19:35 - you'd want an application like this to
19:37 - work you'd likely want the newer posts
19:39 - at the top and the older ones at the
19:42 - bottom so getting this to work is super
19:44 - simple all we have to do is reorder
19:47 - these in our query so if I wanted the
19:49 - newest post to be first then if I change
19:54 - these around if I go to the very bottom
19:55 - here then I have a post here that says
19:58 - my latest post and I want that to be the
20:01 - very first
20:02 - on my website whenever i reorder these
20:05 - so in order to do this I'm going to open
20:07 - up our routes dot pi and then we can go
20:11 - to where we're doing our query and right
20:14 - before we do the pagination query here
20:16 - I'm going to add in something else so
20:19 - I'm gonna say post doc query dot order
20:22 - underscore bi and I'm going to pass in
20:26 - what we want to order by here and we
20:29 - want to order by post dot date
20:31 - underscore posted dot descending and
20:35 - that descending is a de SC with the
20:38 - parentheses there so now that we have
20:41 - post that query dot order by with what
20:43 - we want to order by then we can just add
20:45 - our paginate on to the end of that so
20:48 - all of that and then dot paginate with
20:51 - our options there at the end so if I
20:54 - close my sidebar down here then we
20:56 - should be able to see this whole line
20:58 - there we go so now if we save this page
21:01 - and reload it in our browser then our
21:05 - web server is still running so that's
21:06 - good and now let me rerun our
21:09 - application and now we can see the Lotus
21:11 - post that I made is titled my latest
21:13 - post at the very top and it's now the
21:15 - first post that we see so this is how
21:17 - you can sort your results through SQL
21:19 - alchemy okay so there's one more thing
21:21 - that I'd like to do before we finish up
21:22 - this video so if we look at the
21:24 - application that we have so far then we
21:27 - can see that the user name of the user
21:29 - who made the post is currently a link
21:32 - but it doesn't actually go anywhere so
21:35 - let's build a route that will display
21:37 - only the posts from these particular
21:40 - users when you click on those links so
21:42 - first let's create a route and this will
21:45 - be similar to our home route so I'm just
21:47 - going to copy that as a starting point
21:50 - so here in our routes I will copy this
21:54 - home route and I'm just going to paste
21:56 - this down here at the bottom of our
21:58 - routes to create a new route here and
22:02 - now we'll change this to the route that
22:03 - we want it to be so I'm going to get rid
22:05 - of one of these app dot routes I only
22:07 - meant to grab one of those and so we
22:09 - will make this route Ford slash user
22:12 - forged slash and now the users username
22:16 - now this is going to be a dynamic
22:18 - parameter here so just like our post ID
22:20 - we will create a variable and this is
22:23 - going to be a string instead of an
22:25 - integer so we'll say STR : and now the
22:28 - variable name so this will just be
22:30 - username and we also need to post this
22:33 - in to our route now and we also need to
22:36 - change this function name so I'm going
22:38 - to change this function name to user
22:40 - underscore post because this is going to
22:43 - be a route where we just show all the
22:45 - posts for this specific user name now
22:48 - the query that we're using is going to
22:49 - be mostly the same but we're going to
22:51 - need to query for this specific user
22:53 - first and then grab the post only by
22:56 - them so first I'm going to get this user
22:59 - so I'll say that the user is equal to
23:02 - user dot query dot filter by and we want
23:07 - to filter by the user name being equal
23:10 - to the user name that is going to come
23:13 - from the route itself and now instead of
23:17 - doing a dot first this is going to be
23:20 - like that dot get or four or four this
23:22 - is going to be dot first underscore or
23:25 - 404 and basically that just says get the
23:28 - first user with this username and if you
23:31 - get a none then just return a 404 not
23:34 - found error and like I said that's very
23:37 - similar to the get version that we saw
23:39 - of that in previous videos except this
23:41 - isn't searching by ID so now that we
23:44 - have that user now we can filter our
23:46 - post by this username if one was found
23:49 - now we're going to add to our post query
23:51 - here but this is getting a little long
23:53 - so we can actually break these up if we
23:56 - put a backslash at the end of the line
23:58 - here then we can break these up onto
24:01 - multiple lines and I'm going to do this
24:03 - before our order by as well because we
24:06 - are going to put in a filter there so we
24:10 - can say post query dot filter by and we
24:14 - can filter by the author equaling the
24:18 - user that we just got then we're using
24:21 - this backslash to break this up onto a
24:23 - different line since this was getting a
24:25 - little long and then we're doing and
24:26 - order by with the post in
24:29 - sending order by the date posted and
24:31 - then another backslash to break it up on
24:33 - another line and then we're doing our
24:35 - paginate query there so kind of long
24:37 - query but that should work so now
24:40 - instead of sending these posts to our
24:41 - home template let's create another
24:43 - template for this specific user and I'll
24:46 - call this template user post HDC
24:53 - but I'll go ahead and render this
24:56 - template now so I will render user
24:58 - underscore post and then we will pass in
25:02 - the post to that template like we're
25:04 - already doing and we also want to pass
25:06 - in the user into that template and I'm
25:08 - going to open up our sidebar so that I
25:10 - can create this template and I will
25:13 - create that now so I'll create user
25:16 - underscore post dot HTML and like I said
25:20 - this is going to be similar to our home
25:22 - route so I'm gonna copy our home
25:24 - template and paste that in as a starting
25:27 - point so I'm going to grab all of that
25:28 - and paste it in to our user post page
25:31 - and the difference here will be that
25:33 - I'll be adding a heading at the top
25:36 - specifying that this is this users page
25:39 - so I'm going to do this below the
25:41 - content block but above our for loop
25:44 - here so I'll just set this equal to an
25:46 - h1 and I will give this a class to give
25:50 - it a little bit of padding so I'll say
25:52 - margin bottom with a value of 3 and now
25:55 - within this h1 I'll say posts by and
25:59 - then double curly braces to specify a
26:01 - variable here
26:03 - then we'll say user dot username and
26:05 - then in parentheses here I'll also put
26:07 - the total post that this user has so
26:11 - parentheses and then double quotes again
26:13 - and we will say if we remember this says
26:16 - post dot total and that will give the
26:19 - total number of posts even over the
26:22 - paginate 'add links now the post for
26:24 - loop will mostly stay the same but we
26:27 - can actually set the href for the user
26:30 - to now go to the user post route that we
26:33 - just created so down here on line 9
26:37 - where we have this pound sign as the
26:40 - href let's actually do
26:42 - a double curly brace and do a URL for
26:46 - and we want this to be the URL for that
26:49 - user post route that we just created
26:52 - then we want to pass in a comma and also
26:55 - pass in the username variable and the
26:58 - user name will be equal to the post dot
27:02 - author dot username and we have this
27:05 - link in our home and our post template
27:07 - as well so we have to change those
27:10 - they're also now having that code
27:13 - repeated in multiple locations isn't
27:15 - best practice and it's for that specific
27:18 - reason because you have to update it in
27:19 - multiple places but we'll fix that in a
27:21 - future video
27:22 - when we see how to use sub templates for
27:25 - repeated sections like this so we are
27:27 - going to get around to improving that
27:28 - but for now let's go ahead and just
27:30 - update those templates so that was the
27:32 - home template and the post template so
27:35 - we need to change that URL there as well
27:39 - so right here where we have this post
27:43 - user name I'm going to paste in that URL
27:46 - for the user post with the username set
27:49 - to that post author user name and save
27:52 - that I'll also change that and our post
27:54 - dot HTML template and that is going to
27:56 - be here on line 7 where we have that
27:59 - poster user name I will paste in that
28:02 - URL for link now if I go back to my user
28:07 - post template here then we also need to
28:10 - change something with the pagination
28:11 - links at the bottom as well because
28:13 - these pagination links should no longer
28:15 - be linking to our homepage because these
28:18 - are paginating links for this users
28:21 - specific posts so we need to change both
28:24 - of these to be linking to the user posts
28:29 - route and we also need to pass in that
28:32 - user name like we've just did a second
28:35 - ago and set that equal to user dot user
28:38 - name put in a comma there and I'll also
28:41 - paste this in right below here okay so
28:46 - now let's save this and open it in our
28:48 - browser and see what this functionality
28:50 - looks like so let me make sure our web
28:53 - server is still running and it needs to
28:55 - be reached
28:56 - ardan okay and it looks like we're
28:58 - getting an error when we're trying to
28:59 - start up our web server this time and I
29:01 - think I know what this is
29:03 - this says STR does not exist and this is
29:07 - because in our routes
29:09 - whenever I specified that type so I'll
29:12 - go back to my route this should actually
29:14 - be string spelled out and not STR so
29:18 - that was my mistake so let me try to
29:20 - restart our development server now and
29:24 - now we can see we're not getting any
29:25 - errors and our development server is
29:27 - running so let's reload our web page
29:31 - here and now let's try to go to one of
29:33 - these specific users pages to see all of
29:36 - their posts so now we can see at the top
29:38 - of this page it says post by Cory MS and
29:41 - that there are 16 total and the
29:44 - pagination here should just be the
29:46 - pagination for this users post so you
29:48 - can see that we don't see any of the
29:50 - other users posts on this page if I go
29:54 - back to the home page and go to this
29:56 - users page then this user has a total of
30:00 - nine posts so he should have two pages
30:02 - total so if we go down here to the
30:04 - bottom we can see he has two pages click
30:06 - on that and he has four posts on the
30:09 - second page so we can see that those
30:10 - user pages are working well and that
30:12 - they also have pagination working for
30:15 - the posts on those pages also okay so I
30:18 - think that is going to do it for this
30:20 - video I hope that now you have a good
30:21 - idea for how you can get pagination
30:23 - working on your website and the
30:25 - different ways in which you can create
30:27 - links and handle the logic for those in
30:29 - your application and also we learned how
30:31 - to sort our posts by either the newest
30:33 - or the oldest entries and also created a
30:36 - useful route for post written by
30:38 - specific users now in the next video
30:40 - we'll be learning how to send emails and
30:42 - how we can use that to reset a user's
30:44 - password but if you have any questions
30:47 - about what we covered in this video then
30:48 - feel free to ask in the comment section
30:49 - below and I'll do my best to answer
30:51 - those and if you enjoy these tutorials
30:52 - and would like to support them then
30:54 - there are several ways you can do that
30:55 - the easiest way is to simply like the
30:56 - video and give it a thumbs up and also
30:58 - it's a huge help to show you these
30:59 - videos with anyone who you think would
31:00 - find them useful and if you have the
31:02 - means you can contribute through patreon
31:03 - and there's a link to that page in the
31:05 - description section below be sure to
31:06 - subscribe for future videos and thank
31:08 - you all for watching
31:19 - you

Cleaned transcript:

hey there how's it going everybody in this video we're gonna add a little more functionality to our application and to our post so we're going to add some pagination so that we aren't pulling down too many posts at once and also we're going to learn how to sort posts by newest to oldest so let's go ahead and get started so first of all since we're going to be working with pagination I'm going to take a second to add more post to our current application from a variety of different users that way we have enough post to see what the pagination looks like so I'm going to fast forward through this so that you don't have to watch me enter a lot of different data now if you'd like to follow along then you could create some additional posts of your own you only need about ten or so to see this in action and also leave a link in the description section below to the JSON of my sample post that I'll be creating here if you want to use those sample titles and content that I'm going to be using in this video so I'm going to add some new posts now and pick up the video when that is complete okay so I have added some sample post to our application and should have a total of 25 now and we can see that if I scroll down through these so I'll scroll all the way down here towards the bottom then it's kind of a lot of information to have on a single page now if these posts had images included in them and things like that then loading them all in at once like this could really slow down our application it would be better if we could paginate this so that we can load a certain number of posts on one page and then display links at the bottom of the page to the other pages of the post so luckily flask SQL alchemy makes this easy for us with the paginate method so let's open up our routes and see how we can get this to work so I'm going to pull up our application here and I already have my routes that py file opened so we can see that currently in our home route we're simply doing a post query all to get all of the posts but we want to paginate these so in place of using the all method to run this query we can use the paginate method so let me run this in the command line so that we can see what this looks like so I'm going to pull up my command line here and shut down our development server using controlc then I'll clear the screen and I'm going to start up our Python interpreter so now let's import our post model so I'll say from flask blog dot models import post and now let's see what this paginate looks like so let me clear the screen here and we've currently been doing it queries like this so we've been saying post is equal to post query dot all and then we can loop through the post by saying for post in posts and then let's just print that post so we can see here that we get all 25 of the sample posts that I added but now let's see what we get when we do a post query dot paginate so I'm going to clear the screen here and I'm going to go back to where we did our query and instead of using dot all I'm going to use dot paginate and now let's look at this post variable so it says that this is a pagination object now let's see what attributes and methods this object has so if we use the dir function then it will print all of these out so if I run that then we can see here that there aren't very many and some of these are hard to read because they get cut in half off the screen but we have hasnext has previous items page and things like that so this is an object that gives us information about the current page that we're on how many posts there are per page and all kinds of information so let's look at the per page attribute so I will say post dot per underscore page and we can see that that results in 20 and 20 is the default per page since we didn't pass anything in so if we look at the current page so I'll say post dot page and we can see that the current page is 1 so we're on the first page so we'll look more at these attributes and methods in just a second but the important one here is the items for this page so to print out the individual posts like we did before we can now say for post in post dot items and then we can print out the posts and if we were to count up these posts then we would count that there are 20 of them here and the last five or on the second page now if we wanted to get that second page of items then we could run the same query again but specify the page being equal to two so I will hit up until we rerun that paginate query and let me clear the screen here so we're rewriting that paginate query but instead let me pass in an argument of page equal to two and run that and now let's rerun the loop where we're looting looping through the items so if I look through those and print those out then we can see that we only get five posts and that's because this is the second page so that first page has 20 posts and then this second page only has the last five posts now if 20 is too much then we can actually get fewer per page if we wanted to so if we reran the query so instead of passing in at page equal to two I'm going to pass in a per page equal to five and run that and actually let me clear this out so it's a little easier to see and I'll rerun that query where we have five per page so now let's see what page we are currently on so we can say post dot page and we're currently on page one and if I print that first page so I'll loop through those so I'll rerun a loop and print out the post for those items and we can see that we get five values and these are the first five posts that are returned now I can pass in a page equal to two to get the next page of five so if I rerun this query and pass in a page equal to two and now if we check the page and we can see that we're on the second page and if I loop through these again and print those out then these are five different posts now if we wanted to see the total number of posts and all of the pages then we can use the total attribute so if I clear this if I say post dot total then we get 25 okay so now let's go back to our app and see how we can use this so I will go back to I'll stop py file so now let's actually use that in our application so instead of doing a query for all the posts we're instead going to do a paginate and use the paginate method and we'll set the number of post per page equal to 5 that way our pages don't get too crowded so I'll say per page is equal to 5 and right now this will always get the first page of posts since we're not specifically asking for a specific page and in order to get other pages we'll do this by passing query parameters in the URL and we've seen that earlier in the series when we did the login redirect query parameter so to grab the page that we want let's just get that from a query parameter in the URL by saying page is equal to and that is request dot args dot get and we want to get the page and also that is an optional parameter in the URL so let's also set a default and we'll set the default page of 1 and let's also set a type equal to int and setting the type equal to int will cause our site to throw a value error if someone passes anything other than an integer as a page number and now we can pass that page into our query by saying page is equal to page and then we'll just keep that per page of 5 there okay so now let's also make a change to our home HTML template so I'm going to open my templates here and open this home dot HTML template and instead of saying for post in posts remember that this is now a pagination object and instead we have to say for posts and post dot items okay so now let's save all of this and see if it works in the browser so I've saved these files and now let me open up my command line here and I'll exit out of the Python interpreter and now I will run the development web server by saying Python run PI open this up in the browser okay so I reloaded the home page and if I scroll down then we can see that I only have five posts on our home page now we don't have any links to get to the next pages but we'll fix that in just a bit but for now if I manually pass a URL parameter then we should be able to see the other pages now this might be hard to see but in my url bar here I can pass this URL parameter by saying question mark page is equal to two and if we run that then we can see that now we get the next five posts so this should go all the way up to page five so I saw if I typed in page five here then we can see that I have a latest post down here at the bottom if I type in a page six that we can see that that is not found because that page does not exist so I'll go back to our home page now so now let's update our template so that we can see the links to the other pages now just to demonstrate how these links look I think I'm going to want a lot of pages to link to because right now we're only going to have five pages and I'd like to have a lot more than that so in order to get a lot of pages just temporarily I'm going to temporarily change our per page argument here and I'm going to change that from five to two and save that now that should give us around let's see I think thirteen pages of two posts and I'll change that back to five after we have everything working and just to show how this is going to work let me jump back to the command line again and I will close down our terminal there our development server and I'm gonna rerun the Python interpreter and now let me import the post model again so I'll say from flask blog dot models import posts and now let's do a another pagination query and I'm going to run a query where we're on about page six of those thirteen pages so I'll say posts is equal to post dot query dot paginate and I will say that we're on page six and that will be a per page of two so now let me clear the screen here and now I'm going to see what is printed when we loop through this method called it err pages so I'm gonna say for page in post dot it err underscore pages and then I will print out that page variable so this may look a little strange but it prints out a one two and then a none and then four through ten and then another none value and then twelve and thirteen so you may have seen on websites before where if there are a lot of pages the website will just show you what page you're currently on and then a few pages before and after with an ellipses or something like that and that is what this none value represents so this will make a lot more sense once we actually render this and our template and we see what this looks like but basically these numbers that is showing here will be links to other pages that we can navigate to now I personally think that this is too many links here and we can narrow this down by passing in arguments to the inner pages method and we can specify how many pages we want to see at the beginning and the end as well as how many pages close to the current page so let's add this code to our template and this will be more clear so I'm going to open back up our home HTML template and below our post I'm going to add another for loop to loop over these pages so I am going to open up a for loop here and also close this for loop here and this for loop will say for page num in post dot itter underscore pages and then inside of this loop will create links to these pages and remember there can be none values here as well and we'll just display those as ellipses so we'll say open up a code block here and say if page num then we can end this if statement here and let me also indent this where it's obvious that we're inside the for loop and I'm also going to want an else statement for this if so I will say else now if page num then we want to put a link to that page number but if page num is none then it's going to fall down here to this else statement and that is where we will put the ellipses but if a page num is not none then we want that to be a link to our page and we can add that by saying that we want an anchor tag and this anchor tag can link to and I'm going to put in double curly braces here to put in some code and we want to link to the URL for the home page and we also want to pass in the page equal to the page num that we're currently on and we want the text for this link to be double curly braces again and pass in that page num and let me also add some classes to this anchor tag as well so that this looks a little nicer so I will add some classes here I'll add a class of button and also button outline info which is a nice bluish color and will also give these a margin to space them out a little bit so we'll do an MB 4 and save that ok so if we save what we have and reload this in our browser so I have everything saved I'm going to exit out of the Python interpreter and rila rerun our python development server and pull up our website here so if I reload our home page then we can see that we only have two posts per page and the reason that I did that is so that we'd have 13 pages here and now I'm going to go to page 6 so we can see that these pagination links are working down here in the bottom if we click on one of these pages then it goes to that specific page up here in the URL we can see that it is passing in a page parameter of page equal to 13 this is page equal to 2 and this is page equal to 6 now we can see down here at the bottom it's giving us a lot of links to a lot of different pages and the reason that the ellipses are useful is because if we had hundreds of pages then we wouldn't want to display hundreds of links we'd only want you know some at the beginning and also some around our current page now I personally think that this is too many links but like I said we can customize this by passing in some arguments to the inner pages method also it'd be nice if the current page had a different style so that it was more obvious what page were on because right now we're on page six but we can't really tell just by looking at this list here so let's go add those changes and we will add those to our home template so I'm back in my home template here and down in our inner pages loop and now let me pass in a few arguments here to it err pages so I'm gonna say left underscore edge is equal to one and that is how many will show up on the far left of the links I'll say right underscore edge is equal to one and that's how many pages show up on the right side of the links so I'll also say left underscore current is equal to one and that is how many pages left of the current page will show up and we'll see what all this looks like in just a second and then I'll also say write underscore current and I'm going to set that equal to 2 because the write current includes the current page so that should limit how many links are actually showed at the bottom of the page and also let's add another conditional to style our current page a little different than the other links so we can come down here into our for loop and I'm going to paste another conditional here within this if page num so if we have a page number then I'm going to put another conditional and say if posts dot page which would be the current page is equal to the page number then we want to style that link a little differently but we also have to put in an else statement here and also end that if so I will copy all of those and put those in so let me copy this link here and also put this into our else block of this if conditional and now if the page that we're currently on is equal to the page number in our loop then we want this to look a little different so I'm just going to have that be a filled in button so to do that in bootstrap the button outline info will be what we saw earlier that outlined a bluish color if we take away the outline part and just do button info then that will be a solid blue color so that should be good for filling in our current page okay so now if we save that and reload it and our browser so let's make sure our web server is still running and it is and now let me reload page six here and if we go down to the bottom we can see that now page six is filled in so it has a different style than the other pages and you can also see that we don't have so many links down here at the bottom anymore we only have one on the left which is that left edge one on the right which is that right edge and then shows one to the left of the current page and one to the right of the current page so that's a lot better and if we wanted to see what this looked like in different conditions then we can just click through and see what different pages look like okay so now the pagination is done so now let's change the post per page back to a higher number so that we don't have these two posts per page like this because that's just too few so I'm gonna go back to our routes and I'm gonna change that per page and set that back equal to five because I think five post per page is usually pretty good okay so now that that pagination is complete let's add another useful feature so if I navigate to the first page of our web app and reload this then for those of you who have followed on with this series you might notice that the post here at the top is the very first post that I wrote so that means that the oldest posts are being shown at the top and the newer posts are being shown at the bottom and this likely isn't how you'd want an application like this to work you'd likely want the newer posts at the top and the older ones at the bottom so getting this to work is super simple all we have to do is reorder these in our query so if I wanted the newest post to be first then if I change these around if I go to the very bottom here then I have a post here that says my latest post and I want that to be the very first on my website whenever i reorder these so in order to do this I'm going to open up our routes dot pi and then we can go to where we're doing our query and right before we do the pagination query here I'm going to add in something else so I'm gonna say post doc query dot order underscore bi and I'm going to pass in what we want to order by here and we want to order by post dot date underscore posted dot descending and that descending is a de SC with the parentheses there so now that we have post that query dot order by with what we want to order by then we can just add our paginate on to the end of that so all of that and then dot paginate with our options there at the end so if I close my sidebar down here then we should be able to see this whole line there we go so now if we save this page and reload it in our browser then our web server is still running so that's good and now let me rerun our application and now we can see the Lotus post that I made is titled my latest post at the very top and it's now the first post that we see so this is how you can sort your results through SQL alchemy okay so there's one more thing that I'd like to do before we finish up this video so if we look at the application that we have so far then we can see that the user name of the user who made the post is currently a link but it doesn't actually go anywhere so let's build a route that will display only the posts from these particular users when you click on those links so first let's create a route and this will be similar to our home route so I'm just going to copy that as a starting point so here in our routes I will copy this home route and I'm just going to paste this down here at the bottom of our routes to create a new route here and now we'll change this to the route that we want it to be so I'm going to get rid of one of these app dot routes I only meant to grab one of those and so we will make this route Ford slash user forged slash and now the users username now this is going to be a dynamic parameter here so just like our post ID we will create a variable and this is going to be a string instead of an integer so we'll say STR and now the variable name so this will just be username and we also need to post this in to our route now and we also need to change this function name so I'm going to change this function name to user underscore post because this is going to be a route where we just show all the posts for this specific user name now the query that we're using is going to be mostly the same but we're going to need to query for this specific user first and then grab the post only by them so first I'm going to get this user so I'll say that the user is equal to user dot query dot filter by and we want to filter by the user name being equal to the user name that is going to come from the route itself and now instead of doing a dot first this is going to be like that dot get or four or four this is going to be dot first underscore or 404 and basically that just says get the first user with this username and if you get a none then just return a 404 not found error and like I said that's very similar to the get version that we saw of that in previous videos except this isn't searching by ID so now that we have that user now we can filter our post by this username if one was found now we're going to add to our post query here but this is getting a little long so we can actually break these up if we put a backslash at the end of the line here then we can break these up onto multiple lines and I'm going to do this before our order by as well because we are going to put in a filter there so we can say post query dot filter by and we can filter by the author equaling the user that we just got then we're using this backslash to break this up onto a different line since this was getting a little long and then we're doing and order by with the post in sending order by the date posted and then another backslash to break it up on another line and then we're doing our paginate query there so kind of long query but that should work so now instead of sending these posts to our home template let's create another template for this specific user and I'll call this template user post HDC but I'll go ahead and render this template now so I will render user underscore post and then we will pass in the post to that template like we're already doing and we also want to pass in the user into that template and I'm going to open up our sidebar so that I can create this template and I will create that now so I'll create user underscore post dot HTML and like I said this is going to be similar to our home route so I'm gonna copy our home template and paste that in as a starting point so I'm going to grab all of that and paste it in to our user post page and the difference here will be that I'll be adding a heading at the top specifying that this is this users page so I'm going to do this below the content block but above our for loop here so I'll just set this equal to an h1 and I will give this a class to give it a little bit of padding so I'll say margin bottom with a value of 3 and now within this h1 I'll say posts by and then double curly braces to specify a variable here then we'll say user dot username and then in parentheses here I'll also put the total post that this user has so parentheses and then double quotes again and we will say if we remember this says post dot total and that will give the total number of posts even over the paginate 'add links now the post for loop will mostly stay the same but we can actually set the href for the user to now go to the user post route that we just created so down here on line 9 where we have this pound sign as the href let's actually do a double curly brace and do a URL for and we want this to be the URL for that user post route that we just created then we want to pass in a comma and also pass in the username variable and the user name will be equal to the post dot author dot username and we have this link in our home and our post template as well so we have to change those they're also now having that code repeated in multiple locations isn't best practice and it's for that specific reason because you have to update it in multiple places but we'll fix that in a future video when we see how to use sub templates for repeated sections like this so we are going to get around to improving that but for now let's go ahead and just update those templates so that was the home template and the post template so we need to change that URL there as well so right here where we have this post user name I'm going to paste in that URL for the user post with the username set to that post author user name and save that I'll also change that and our post dot HTML template and that is going to be here on line 7 where we have that poster user name I will paste in that URL for link now if I go back to my user post template here then we also need to change something with the pagination links at the bottom as well because these pagination links should no longer be linking to our homepage because these are paginating links for this users specific posts so we need to change both of these to be linking to the user posts route and we also need to pass in that user name like we've just did a second ago and set that equal to user dot user name put in a comma there and I'll also paste this in right below here okay so now let's save this and open it in our browser and see what this functionality looks like so let me make sure our web server is still running and it needs to be reached ardan okay and it looks like we're getting an error when we're trying to start up our web server this time and I think I know what this is this says STR does not exist and this is because in our routes whenever I specified that type so I'll go back to my route this should actually be string spelled out and not STR so that was my mistake so let me try to restart our development server now and now we can see we're not getting any errors and our development server is running so let's reload our web page here and now let's try to go to one of these specific users pages to see all of their posts so now we can see at the top of this page it says post by Cory MS and that there are 16 total and the pagination here should just be the pagination for this users post so you can see that we don't see any of the other users posts on this page if I go back to the home page and go to this users page then this user has a total of nine posts so he should have two pages total so if we go down here to the bottom we can see he has two pages click on that and he has four posts on the second page so we can see that those user pages are working well and that they also have pagination working for the posts on those pages also okay so I think that is going to do it for this video I hope that now you have a good idea for how you can get pagination working on your website and the different ways in which you can create links and handle the logic for those in your application and also we learned how to sort our posts by either the newest or the oldest entries and also created a useful route for post written by specific users now in the next video we'll be learning how to send emails and how we can use that to reset a user's password but if you have any questions about what we covered in this video then feel free to ask in the comment section below and I'll do my best to answer those and if you enjoy these tutorials and would like to support them then there are several ways you can do that the easiest way is to simply like the video and give it a thumbs up and also it's a huge help to show you these videos with anyone who you think would find them useful and if you have the means you can contribute through patreon and there's a link to that page in the description section below be sure to subscribe for future videos and thank you all for watching you
