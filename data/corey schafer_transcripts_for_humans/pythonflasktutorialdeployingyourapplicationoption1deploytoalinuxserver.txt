With timestamps:

00:00 - hey there how's it going everybody in
00:01 - this video we're going to be continuing
00:03 - the flask series and learning how to
00:04 - deploy our flask application to a web
00:06 - server so that anyone with internet
00:08 - access can use it within a browser so so
00:10 - far we've created this application with
00:12 - some good functionality but the site
00:14 - still only lives on our local machine
00:16 - right now this is just running in my
00:18 - browser on my local machine but no one
00:20 - else can access this so the point of
00:23 - building these sites is to deploy them
00:25 - so that they're accessible over the
00:26 - Internet
00:27 - now I'm not gonna lie to you deploying
00:28 - can be a bit tricky it can be
00:30 - overwhelming because there are a lot of
00:32 - different ways to deploy an application
00:33 - and it's hard to know exactly what's
00:36 - best for your specific application so
00:38 - we're gonna look at several deployment
00:40 - options in this series so we're gonna
00:41 - look at how to deploy to our own linux
00:43 - server how to deploy to Heroku and
00:46 - possibly some others so in this video
00:47 - we're going to be learning how to deploy
00:49 - our application to our own linux server
00:51 - using nginx and g unicorn now if you
00:54 - watched my django series then i deployed
00:56 - the django application using apache and
00:58 - mod whiskey but the reason I used Apache
01:00 - and mod whiskey in that video is because
01:03 - it's recommended on Django site but with
01:05 - flask I think it'll be best for us to
01:07 - use engine X and G unicorn so when you
01:10 - deploy to a Linux server you're most
01:12 - likely going to be deploying to a
01:13 - virtual machine that is hosted by a
01:15 - company so that's going to be a company
01:17 - like len么tre or digitalocean or AWS now
01:20 - I personally use 'la node for my own web
01:22 - applications so that's what we'll be
01:23 - using in this video and the node was
01:26 - actually kind enough to sponsor this
01:27 - video as well and has provided me with a
01:29 - link where you all can get 20 dollars of
01:31 - free credit towards an account so if you
01:34 - want to follow along with this video
01:35 - then I'll leave that link in the
01:36 - description section below where you can
01:38 - sign up for an account and get enough
01:39 - credit to follow along I've been using
01:41 - their services for my own personal
01:42 - website for years so I was really happy
01:44 - when they contacted me about sponsoring
01:46 - a video so with that said let's go ahead
01:48 - and get started ok so like I said we're
01:51 - going to be deploying it to a Linux
01:53 - server this method of deployment
01:55 - actually takes the most effort to set up
01:56 - but is also the most flexible in terms
01:58 - of what control you're going to have
02:00 - over your application and web server so
02:03 - in future videos
02:04 - we'll look at deployment options that
02:05 - offer some free tiers but they usually
02:08 - only offer basic services so for example
02:11 - if you want to use your own domain name
02:13 - like you know my flask blog.com or
02:16 - something like that then you'll have to
02:18 - upgrade to a paid service on those free
02:20 - options in order to set that up and even
02:22 - then you won't have the freedom and
02:24 - possibilities that you get when you have
02:26 - your own virtual private server so the
02:28 - way that we're going to do it in this
02:29 - video will give you a lot of freedom and
02:31 - room for your application to grow but
02:34 - it's not as simple as some of the other
02:36 - methods so there definitely are some
02:37 - trade-offs there so like I said I'm
02:39 - going to be using len么tre ploy this
02:41 - application to a linux server so that's
02:43 - my personal preference but you can do
02:45 - the same deployment with any linux
02:47 - server that you can access via SSH now I
02:49 - already have an account with OneNote so
02:51 - I'm going to pull that up here in the
02:52 - browser
02:53 - so let me reload this page to make sure
02:55 - I'm still logged in now I'm going to
02:57 - show you how to create and set up a
02:58 - Linux server from scratch because that's
03:00 - what a lot of you have requested but if
03:02 - you already have a server ready to go
03:03 - and want to skip directly do the flat
03:05 - specific deployment then I'll put a
03:07 - timestamp in the description section
03:08 - below or you can jump to that part so if
03:12 - you create an account with a node then
03:14 - you should be able to access a page like
03:15 - this that I have in front of me here now
03:18 - this is their new cloud manager at cloud
03:20 - le node calm there's also a len么tre at
03:23 - manage node comm but I think that's
03:26 - older and they are suggesting that
03:28 - people switch over to this so this page
03:30 - gives me access to all of my currently
03:32 - node servers so you can see here that I
03:34 - already have one created for my personal
03:36 - website called core EMS server but we're
03:39 - going to create a new one from scratch
03:40 - to deploy our flask application so let's
03:43 - go ahead and do that now so to do this I
03:46 - can just come up here to create so I'm
03:48 - going to click on create and we're going
03:50 - to click on the node so the node is
03:52 - their names for their linux server you
03:54 - can see here it says high-performance
03:55 - sss state linux servers for all your
03:57 - infrastructure needs so i'm going to
03:59 - click on that and now we choose our
04:01 - image or our operating system so i'm
04:03 - going to use a boon to here a boon 218
04:06 - and now we need to choose a region i'm
04:08 - just going to choose dallas texas but
04:11 - you can see that they also have regions
04:12 - and europe and asia as well so you
04:14 - probably want to choose a server that is
04:16 - going to be close to your audience so
04:18 - I'm going to choose Dallas Texas because
04:19 - it's a nice midpoint in the United
04:21 - States ok so now we can choose our
04:23 - Linode plan so these are the standard
04:25 - plans here you can see
04:27 - some of the computer specs and the
04:28 - prices so this is $10 a month $20 a
04:31 - month one CPU 50 gigs of storage 2 gigs
04:34 - of RAM they also have something here
04:37 - called an anode now this is a low
04:39 - performance machine but it's also a
04:41 - cheaper option so you can see this is
04:43 - one CPU 25 gigs of storage and one gig
04:46 - of ram but since our application is
04:48 - pretty simple and we're just testing
04:50 - this out and trying to deploy it I'm
04:52 - just going to choose this cheapest
04:53 - option because it's not gonna take a lot
04:55 - of resources okay so now let's choose a
04:57 - label so I'm just going to call this
04:59 - flask - server and I'm gonna skip and
05:03 - not add any tags here and now we're
05:05 - gonna add a root password so I'm gonna
05:07 - add a root password of just this is a
05:11 - test with some capitalization in there
05:13 - but you're gonna want a stronger root
05:16 - password obviously for your own server
05:18 - now you're definitely going to want to
05:19 - remember this password as well because
05:21 - this is what you're going to use to
05:22 - first log in to the system now you can
05:25 - see that they have some optional add-ons
05:27 - here such as backups and private IP I
05:29 - would probably recommend getting a
05:31 - backup if this is going to be your
05:32 - production server so that you don't have
05:34 - to worry about it but I'm not gonna do
05:36 - it for this since we are just testing
05:38 - this deployment so I'm just going to
05:40 - come over here and click on create and
05:42 - now it's going to create this server so
05:45 - we can see here that it's now
05:46 - provisioning the server and after it
05:49 - provisions it then it will boot the
05:51 - server up so I'm going to skip forward
05:53 - to where this is complete so I will
05:56 - resume once this is finished ok so our
05:59 - new server has finished booting up and
06:01 - that only took a couple of minutes so
06:03 - now we can see it here in our list of
06:05 - Leno's if we go to dashboard then we can
06:07 - also see the len么tre listed there as
06:10 - well so now all we need to do is click
06:14 - on this server and then go to the
06:16 - networking tab and once you're in the
06:18 - networking tab you can see here that we
06:20 - have this SSH command
06:22 - so this SSH command is how we're going
06:24 - to first access our machine now you're
06:27 - going to want to write down this IP
06:28 - address because we're going to be using
06:30 - that a lot throughout this video so I'm
06:32 - gonna write mine down right now it is
06:35 - for 5.3 3.1 to 3
06:40 - dot 2 1 4 so now I'm going to copy this
06:44 - SSH command and now I'm going to paste
06:48 - this into my command line to login to my
06:52 - server now if you're in a Windows
06:53 - machine then you might not have access
06:55 - to the SSH command there are other tools
06:58 - that you can use that allow you to SSH
07:00 - into a server so one of the more popular
07:02 - tools is called putty but personally
07:05 - what I recommend if you're on a newer
07:07 - version of Windows is to simply install
07:10 - the Linux bash shell on Windows and
07:12 - you'll be able to as I say it's through
07:14 - that now I'm not going to show that
07:15 - process in this video but I do have a
07:17 - separate video detailing that whole
07:19 - process and I'll put a link to that in
07:21 - the description section below and also
07:23 - putty here I also have this opened up
07:25 - here in the browser if you do want to
07:28 - download putty that is at putty org so
07:30 - you can find that there and there will
07:32 - be instructions for how to use SSH with
07:34 - putty on that site in their
07:36 - documentation but if you are using Linux
07:38 - bash shell then it will allow you to
07:40 - more easily follow along with all of the
07:42 - commands in this video ok so if you are
07:45 - using bash then we'll want to copy that
07:47 - SSH command from our networking tab in
07:49 - the note and we'll paste that into our
07:51 - command line now I have two different
07:53 - terminal windows opened up here now one
07:55 - of these I'm going to use to run
07:56 - commands on my local machine and what
07:58 - I'm going to use to run commands on our
08:00 - remote Linode server now you don't have
08:02 - to do it this way but if you only have
08:04 - one terminal window open then you'll
08:06 - have to go back and forth between your
08:07 - local machine and your server so I think
08:09 - it's easier to simply have two windows
08:11 - open ok so I'm going to paste that SSH
08:14 - command here into the terminal on my
08:16 - left side and we can see that this does
08:18 - an ssh of our root so that's the root
08:22 - user at this IP address now yours is
08:24 - going to be your IP address for your
08:26 - server and then it's going to ask us if
08:28 - we want to continue the connection it's
08:31 - only going to ask us the first time that
08:32 - we do this so I'll say yes and now it's
08:35 - asking for that root password so this is
08:37 - the root password that we created when
08:39 - we created our node so mine was this is
08:42 - a test and I'm going to delete the
08:44 - server after the video so you can't you
08:47 - know log in to this IP address with this
08:49 - root password or anything like that ok
08:51 - so now we are connected to our load
08:53 - server so this is the machine that we
08:55 - just created now just to get some more
08:57 - room here I'm gonna minimize this
08:58 - terminal here on the right and expand
09:02 - this over to where we have some more
09:03 - room to work with here okay so now we're
09:05 - working with a bare-bones a boon to
09:07 - server so we're gonna want to do a
09:09 - couple of things to get this set up
09:10 - first so first of all let's upgrade the
09:14 - software and this is going to be like
09:15 - security updates and stuff like that
09:17 - you're gonna want to always do this the
09:19 - first time you log into a Linux system
09:21 - so I'm going to do apt update and then
09:24 - these two ampersands and apt upgrade and
09:27 - that's just going to update and upgrade
09:29 - the software on the system so some of
09:31 - these updates can take a long time so
09:33 - I'm just going to fast forward the video
09:35 - until this is complete and you're
09:37 - occasionally going to be asked if you
09:39 - want to continue and I'm just going to
09:41 - hit yes any time those come up okay so I
09:43 - fast forward to where those updates and
09:45 - upgrades were complete and that took a
09:47 - couple of minutes so now we're gonna
09:50 - want to set our hostname on this machine
09:52 - so I'm gonna clear my screen here and
09:54 - now to set this hostname I'm gonna say a
09:57 - host name CTL set
10:01 - - host name and I'm just going to call
10:03 - this flask - server so now if I actually
10:06 - type in a host name then it should say
10:09 - flask server there so that's good so now
10:12 - we also need to set this host name and
10:14 - our hosts file so to do that I'm just
10:17 - going to use the program Nano since Nano
10:19 - is an easy editor that a lot of people
10:22 - know how to use so I'm just gonna say
10:23 - Nano ford slash etc' ford slash host and
10:27 - within this host file we're going to
10:30 - want right under our one 2700 dot one
10:34 - we're going to want to put in our IP
10:37 - address of this machine so I said to
10:40 - write that down because you're going to
10:41 - be using it a lot mine was 40 5.30 3.1
10:45 - to 3.2 1/4 and after that then we're
10:50 - gonna want to hit tab and then put in
10:52 - our host name again so I called mine
10:54 - flask - server and now to save this in
10:57 - Nano you hit control X to exit and then
11:00 - it's going to ask you if you want to
11:01 - save so I'm gonna hit Y for a yes and
11:04 - then the file name that you want to
11:06 - write if you just want
11:07 - keep the same file name then you just
11:08 - hit enter so now that saved that host
11:12 - name to our host file okay so now let me
11:14 - clear my screen here now we're going to
11:17 - want to add a limited user to our
11:19 - machine so right now we're logged in as
11:22 - the root user now the root user has
11:24 - unlimited privileges and can execute any
11:28 - command now that might sound nice but
11:30 - it's best practice to add a new user
11:32 - that has limited privileges that you use
11:35 - as your main account and you'll still be
11:38 - able to run admin commands using sudo
11:40 - it's just a lot more safe than running
11:42 - everything as root so to do this we can
11:45 - just say add user and now the username
11:48 - of the user that you want to add I'm
11:50 - gonna add mine as core EMS but you want
11:52 - to add whatever yours is here now again
11:56 - okay so now it's asking us for our
11:58 - password so I'm just going to put in
12:02 - something like this is a test this is a
12:06 - test and now it's asking us to fill in
12:09 - some information about our user now this
12:11 - is optional you can put this in if you'd
12:13 - like so you know full name I'll put in
12:15 - my full name but I'm just going to leave
12:18 - like the room number and all that other
12:20 - stuff blank then it's going to ask you
12:21 - if that's correct and I will just accept
12:23 - the default as yes so let me clear the
12:26 - screen here again now again I did use a
12:29 - boon to as our operating system so if
12:31 - you used something different something
12:33 - like CentOS or red hat or Fedora then
12:36 - these commands are going to be different
12:38 - so just keep that in mind okay so now
12:40 - that we've created that user
12:41 - now we're gonna want to add that user to
12:43 - our sudu group so that they can run
12:45 - those admin commands so I'm going to do
12:49 - add user core EMS and then after that do
12:53 - sudo and that will add them it says here
12:56 - adding query MS to the group su do so
12:58 - that's good okay so now that we've
13:00 - created this new user now we're going to
13:02 - want to log out of the our server and
13:05 - log back in as that user because we
13:08 - don't want to be logged in as root
13:10 - longer than we have to it's just best
13:12 - practice be logged in as a limited user
13:14 - so I'm going to exit out of our server
13:17 - and now I'm back on my local machine
13:20 - so I'm just going to hit the up-arrow to
13:22 - run that same SSH command that we ran
13:25 - before but instead of route we are going
13:29 - to log in as the user that we created so
13:32 - I'm going to log in as query MS and it's
13:34 - going to ask us for a password so that
13:37 - was this is a test and now we are logged
13:41 - in as the new user that we created so
13:44 - now I'm going to clear my screen here
13:46 - okay so now that we're logged in with
13:48 - this new user we're going to want to set
13:50 - up SSH key based authentication so that
13:53 - we can login to our server without a
13:54 - password so at this point I know that
13:57 - some of you might be thinking to
13:58 - yourselves like you know why do I have
14:00 - to do all of this stuff I just want to
14:03 - deploy my flask application well the
14:05 - reason that we're doing all of this is
14:06 - because you know a lot of people had
14:08 - requested to set up a linux server from
14:11 - scratch and this is what it's like to
14:13 - deploy a real-world application and to
14:16 - put the proper precautions in place on
14:18 - your web server so that includes best
14:20 - practices like setting up SSH keys and
14:22 - firewalls
14:23 - and you're going to want to do that on
14:25 - any real-world application that you
14:27 - deploy so I may as well include it in
14:29 - this tutorial instead of just showing
14:31 - you the bare minimum so when it comes to
14:32 - these SSH keys by default we're using a
14:35 - password to login to our web server just
14:38 - like we just now did we instead want to
14:40 - used key-based authentication so this is
14:43 - more secure and also more convenient
14:45 - because it uses keys that can't be brute
14:48 - forced and it also uses allows us to log
14:53 - in without putting in our password every
14:55 - time which is great for running remote
14:57 - scripts that connect to your web server
14:59 - now I have a separate video on this ssh
15:02 - authentication as well so i'm not going
15:04 - to go into a lot of detail of these
15:05 - commands but we are going to run through
15:07 - all of the the whole process here so if
15:10 - you want to know more details about what
15:12 - these commands are doing then you can
15:14 - watch that video and i'll put a link to
15:15 - that in the description section below
15:16 - now there's actually an easier way to do
15:19 - this by using a command called ssh copy
15:21 - ID but it's not available on all
15:23 - operating systems so instead we're just
15:26 - going to do this the longer way so on
15:28 - our server here we're going to want to
15:31 - make a dot ssh directory
15:33 - so I'm here in my home folder if I do a
15:36 - PWD you can see that we are within home
15:39 - and then our user so mine is query MS
15:42 - now this tilde here is just an alias for
15:46 - our home directory so that's it one way
15:47 - that you can tell that when we are in
15:49 - our home directory so within our home
15:51 - directory
15:51 - I'm gonna make a dot SSH directory so
15:54 - I'm gonna say m'kay Durer and I'm going
15:57 - to make a directory called dot SSH okay
16:00 - so now I'm going to stay logged in to my
16:01 - server but I'm going to open up the
16:05 - terminal on my local machine so now I'm
16:08 - going to move this over here
16:10 - so now I'm on my local machine not on my
16:13 - server now again I'm doing this in bash
16:15 - but if you're using a program like putty
16:18 - on Windows that we talked about before
16:20 - then you'll have to do this differently
16:22 - to create and copy your SSH keys to your
16:24 - web server and I did find some
16:26 - documentation in the notes guides for
16:28 - putty users on how you can do this
16:30 - through putty and I'll put a link to
16:32 - that in the description section below so
16:34 - that you can follow along with this part
16:36 - so you can use that guide if you need it
16:39 - but if you are using bash then we can
16:41 - simply say SSH - key gin and then I'm
16:46 - gonna do a dash B 409 6 and that's just
16:51 - to make it a little more secure so now
16:54 - it says it's generating the public
16:55 - private RSA key pair enter the file in
16:58 - which you wish to save this and it gives
17:00 - a default file here I'm just gonna leave
17:03 - that default file and it says that
17:05 - there's one already there because I
17:06 - already have some SSH keys
17:08 - I'm just going to overwrite that for
17:09 - this tutorial and now it says to enter a
17:11 - passphrase
17:12 - now you can leave an empty passphrase
17:14 - which I'm going to do but if you want to
17:16 - make it more secure than you can use a
17:17 - passphrase for your key ok so now that
17:20 - we've created that it says that your
17:22 - identification has been saved and we got
17:25 - this ID RSA file and we also got this
17:28 - idrs a dot pub that is our public key
17:32 - now we're going to want to move our
17:34 - public key to our server so to do this
17:37 - I'm going to clear my screen here to do
17:40 - this on bash I'm going to use the SCP
17:43 - command which I believe stands for
17:45 - secure copy so I'm going to say s
17:47 - CP and the location of that public key
17:50 - if you use the default location is going
17:53 - to be in your users home folder dot SSH
17:57 - and forge / ID underscore RSA dot pub
18:02 - and we want to copy that
18:05 - public key up to our server so now I'm
18:08 - going to say Corre ms @ and now the IP
18:11 - address so you want to put in your IP
18:13 - address here mine is for 5.30 3.1 to 3.2
18:18 - 1 4 so that is the user and the server
18:22 - to where we want to copy that key now if
18:24 - we want to copy it to an exact location
18:26 - on that server then we can put in a
18:28 - colon here and now specify that exact
18:31 - location so I'm gonna put a tilde for
18:34 - the home directory of this user and so a
18:37 - tilde ford slash dot SSH and I want to
18:41 - save that public key into a file called
18:45 - authorized underscore keys now you don't
18:49 - need file extensions on Linux so this is
18:52 - a valid file name here we can just call
18:54 - it authorized underscore keys so I'm
18:56 - going to run that and this is going to
18:57 - ask us for our password because we
18:59 - haven't set up our SSH keys yet so I'm
19:01 - going to say put in my password here and
19:04 - we can see that it copied that key up so
19:08 - now I'm going to minimize this terminal
19:11 - window here and go back to my server so
19:14 - now in my server I'm going to see if
19:17 - that file is there so I'm going to do an
19:19 - LS on the dot ssh directory and if i do
19:23 - that we can see that we now have this
19:25 - file here called authorized keys and
19:27 - that should be the public key that we
19:29 - copied up ok so now that we've got that
19:31 - copied up now we need to update some
19:33 - permissions and again I can't go into
19:35 - deep detail as to what every command is
19:37 - doing in this video or else it would
19:39 - just run on for a long long time but
19:42 - basically what we're going to be doing
19:43 - here is setting the permissions for the
19:45 - SSH directory to where the owner of the
19:48 - directory has read write and execute
19:50 - permissions on the directory and the
19:52 - owner of the files in that directory
19:54 - will have read and write permissions on
19:57 - the files so to do that I'm going to do
19:59 - a sudo
20:00 - chmod that's how you change permissions
20:02 - and I'm gonna do 700 permissions on the
20:06 - dot SSH directory in my home folder and
20:10 - it's going to ask us for a sudo password
20:12 - this is just gonna ask us this one time
20:15 - every so often we're not gonna have to
20:17 - put that in every time we run a sudo
20:19 - password because it'll remember us for
20:21 - some time so now I'm also going to do a
20:26 - command here where I'm gonna do a sudo
20:28 - chmod 609 to go into deep detail about
20:39 - this here but basically what these
20:41 - permissions are in Linux the first digit
20:45 - here are the permissions for the owner
20:48 - of that file the user who owns that file
20:50 - so we have a seven here which means read
20:52 - write and execute now the second one
20:55 - here we have a zero means no permissions
20:57 - that's for the group of that directory
20:59 - and the last one here is for everyone
21:02 - else and that's a zero as well and here
21:05 - we're saying that we want 600
21:07 - permissions for the owner zero
21:09 - permissions for the group and zero
21:10 - permissions for everyone else on the
21:12 - files in that directory okay so with
21:14 - those changes in place we should now be
21:16 - able to log in to this server without a
21:19 - password and instead it's going to use
21:21 - our public and private SSH keys so if I
21:25 - exit out of the server here now we're
21:27 - back on our local machine now I'm going
21:29 - to clear my screen I'm just going to hit
21:31 - the up arrow here to where we to run the
21:34 - same SSH command that we did before and
21:36 - if I run that then we can see that I was
21:40 - able to SSH into that machine without a
21:42 - password so that is a good sign that
21:44 - means that we're using our SSH keys okay
21:47 - so we're just about ready to start
21:48 - moving up our flask application but
21:51 - there's just a couple more things that
21:52 - we need to do here so now that we have
21:54 - our SSH keys working we also need to
21:57 - disallow root logins over SSH so now
22:01 - that we're logged in as our user let's
22:04 - do a an update on this SSH config file
22:09 - so I'm going to do a sudo nano and this
22:12 - is within forge slash
22:14 - et Cie forged slash SSH forged slash
22:18 - sshd underscore config so if we run this
22:24 - put in my pseudo password here so this
22:26 - is the ssh configuration file so i'm
22:29 - going to scroll down here and we're
22:31 - going to want to change two values in
22:33 - this configuration file so first we want
22:36 - to scroll down until we see one option
22:39 - here that says permit root login we're
22:42 - going to want to change this to no
22:44 - because we have a limited user now that
22:47 - has pseudo access so there shouldn't be
22:49 - any need for us to log into our machine
22:51 - as root so if a hacker tries to log in
22:54 - as root we're going to know that hey you
22:56 - don't need to be able to do that so with
22:59 - that set now let's also scroll down and
23:02 - we're gonna look for one called password
23:05 - authentication so let's keep scrolling
23:07 - down here and here it is here it's most
23:09 - likely going to be commented out so I'm
23:12 - going to uncomment out this here and I'm
23:15 - gonna change this from yes to no so the
23:18 - reason behind this is that now that we
23:20 - have our SSH keys working sometimes
23:22 - hackers will just you know simply try to
23:24 - brute-force passwords but since we have
23:27 - our SSH keys we shouldn't have the need
23:30 - to log into our system with a password
23:33 - so I'm going to put password
23:35 - authentication to know so now to save
23:38 - this I'm just going to hit control X and
23:40 - then a Y to save and then enter to keep
23:43 - the same file name and now we want to
23:44 - restart our SSH service so to do that we
23:47 - can say sudo system CTL restart and
23:51 - that's sshd so let's run that and that
23:55 - restarts our SSH service okay so now
23:59 - before we get to the flask deployment we
24:02 - are going to set up a firewall but this
24:04 - is going to be very quick here this is
24:06 - pretty simple so first we want to do an
24:09 - installation so I'm going to say sudo
24:11 - apt install and this is called ufw and
24:16 - this stands for uncomplicated firewall
24:18 - so I'm going to run that and once that's
24:21 - installed we're going to set up a few
24:23 - rules here now this is called
24:25 - uncomplicated firewall because this is a
24:27 - lot
24:28 - easier than some of the other options
24:29 - like IT tables or anything like that so
24:32 - the rules that we're going to set up
24:33 - we're just going to do a pseudo UFW
24:37 - default allow and we're going to allow
24:41 - outgoing traffic so I'm going to run
24:44 - that and now I'm going to hit the up
24:46 - arrow here and do a pseudo ufw default
24:50 - deny incoming traffic so now we want to
24:54 - configure a default deny rule or I'm
24:58 - sorry we're going to want to configure
24:59 - allow rules for certain ports because
25:03 - configuring a default deny rule like we
25:05 - just did can lock you out of your server
25:07 - unless you use explicit allow rules so
25:11 - we want to be sure that we have
25:13 - configured these next allow rules to
25:15 - allow for SSH and HTTP and things like
25:18 - that and any port that we want to access
25:21 - from the outside of our server so I'm
25:23 - gonna say sudo ufw allow SSH now this
25:28 - one is definitely important because if
25:30 - we don't allow SSH then we're not going
25:32 - to be able to SSH into our server so you
25:34 - definitely want to do that one
25:36 - so now let's also allow access to port
25:40 - 5000 for now now port 5000 if you
25:42 - remember from earlier in the series is
25:44 - the port that flask development server
25:48 - runs on so we're going to test this
25:50 - before we actually go live with it on
25:53 - port 80 so let's allow that port 5000 so
25:57 - that we can test that on that port so
25:59 - I'm going to do a sudo ufw allow 5,000
26:03 - and now let's not allow port 80 or HTTP
26:08 - traffic yet until we're sure that
26:11 - everything's working the way with it we
26:12 - want it to and we will allow that port
26:15 - later in the video so right now I'm
26:17 - going to enable everything that we have
26:19 - just said so I'm going to do a sudo UFW
26:22 - enable and run that and it says that the
26:25 - command may disrupt existing connections
26:27 - hopefully we remembered to allow SSH
26:30 - connection so I'm just going to say yes
26:32 - okay so we're still logged in so that's
26:34 - good now if you want to see the status
26:36 - of the things that you've allowed and
26:37 - disallowed you can go to sudo UFW
26:41 - attis and that'll show you everything
26:43 - that we've allowed so port 22 here is
26:45 - SSH and we also have port 5000 here ok
26:49 - so that is all of the server setup type
26:51 - of stuff so now we're ready to deploy
26:53 - our flask application so first we want
26:56 - to put our application on our web server
26:58 - now there are multiple ways that we can
27:00 - get this application to our web server
27:02 - so if we have it checked into a git
27:04 - repository then we could simply do a git
27:07 - clone here into our server if you're
27:11 - using an FTP client like filezilla then
27:14 - you can just simply copy it over to your
27:16 - server since we're already using the
27:19 - command line in this video I'm just
27:21 - going to use the bash terminal to do
27:23 - this so I'm going to clear my screen
27:25 - here on my server and now let me open up
27:28 - my terminal here on my local machine
27:31 - now before we push our flask application
27:33 - to our server if we're using a virtual
27:36 - environment then we're going to want to
27:38 - create a requirements txt file that
27:41 - captures everything that we need to
27:43 - install for our flash project to work so
27:46 - I am in a virtual environment here on my
27:48 - machine this is the virtual environment
27:50 - that I used throughout the entire series
27:52 - if you're not using a virtual
27:54 - environment then you'll just simply have
27:56 - to pip install everything that you used
27:58 - on the server manually but if we are
28:00 - using a virtual environment then we can
28:02 - see everything that we use in our
28:04 - project by running pip freeze if we run
28:07 - pip freeze then this shows us all of the
28:10 - dependencies for our project that we've
28:12 - installed so you can see here we have
28:14 - bcrypt we have flask obviously we have
28:17 - flask WTF which is the forms
28:20 - Jinja 2 which is the templating pillow
28:22 - which does our images and these also
28:24 - give us the exact versions of those
28:27 - packages as well so that we're sure that
28:29 - everything on our server matches every
28:32 - packaged version in development now if
28:35 - you're on Windows then you can create a
28:36 - requirements txt file and just paste in
28:39 - all of the info from this pip freeze
28:42 - command but if you're on Mac or Linux
28:45 - then we can just create our requirements
28:48 - txt file by saying pip freeze and then
28:52 - we can put the Khan
28:55 - hence of that pip freeze command into
28:57 - requirements that txt okay so now I just
29:00 - created this requirements txt file on my
29:04 - machine and I'm in the home folder of my
29:06 - machine here so I'm gonna open up my
29:08 - file explorer here and open up both of
29:12 - these windows so this is my home folder
29:14 - here and here's that requirements that
29:16 - txt file and here is my flask blog this
29:20 - is our flask project that we've been
29:21 - making throughout this series so I'm
29:23 - just going to drop that requirements txt
29:25 - file into that flask blog okay so now
29:28 - that we have that requirements file now
29:31 - let's put our flask application on to
29:34 - our webserver now since I'm using bash
29:38 - I'm going to use the same SCP command
29:40 - that I used earlier to copy up our keys
29:42 - but if you're not using bash then again
29:45 - you can use something like FileZilla or
29:47 - get to get your project folder onto your
29:50 - server but for me I'm simply going to
29:52 - say SCP - R that's for recursive that
29:57 - means that we're going to move over an
29:58 - entire directory so I'm gonna say - R
30:01 - and that is what this is on my desktop
30:04 - so on my desktop flask
30:06 - blog I'm just going to move over that
30:09 - entire folder and we're gonna move that
30:11 - to quaerimus at and now the IP address
30:15 - so you're gonna want your user here and
30:17 - now your IP address my IP address is 4
30:21 - 5.3 3.1 to 3.2 1 4 and now we want the
30:26 - colon and the colon we can specify an
30:29 - exact location for on this machine so
30:33 - I'm just going to put it in that users
30:36 - home folder by saying tilde ford slash
30:38 - so let's run that
30:42 - okay and it looks like it copied
30:43 - everything over for us so now let's
30:45 - check that that's there on our server so
30:48 - I'm going to minimize our local machine
30:50 - here and go back to our server so you
30:53 - can see how this is useful having these
30:54 - two windows open because otherwise you'd
30:57 - have to be exiting an SSH edging back
31:00 - into your server and local machine all
31:02 - the time okay so now that we're back on
31:03 - our server here let's run the LS command
31:06 - to see if we have our directory so we do
31:09 - have our flask blog here so that's good
31:11 - so now we have our flask application on
31:14 - our web server so now we're ready to get
31:16 - it running on here so first in order to
31:19 - do this we're going to have to create a
31:21 - virtual environment on our server we
31:24 - don't want to use the default Python
31:26 - that's running on our Linux system we
31:28 - always want to use a virtual environment
31:30 - when running on our server so to do this
31:34 - we're going to want to install a few
31:35 - things so I'm going to say sudo apt
31:38 - install and we want to install Python 3
31:42 - - pip now make sure you have the 3 there
31:45 - for Python 3 otherwise it will install
31:47 - for python 2 so we're gonna do the sudo
31:50 - apt install python 3 - pip and once
31:54 - that's finished I'm going to clear my
31:57 - screen here and now I'm going to install
32:00 - sudo so I'll do a sudo apt install and
32:04 - I'm going to install Python 3
32:06 - - ve + V and this will allow us to
32:09 - create virtual environments so let's run
32:12 - that and this should install fairly
32:14 - quickly ok so now that we have those two
32:16 - packages installed now we can create our
32:20 - virtual environment so I'm just going to
32:22 - create this virtual environment inside
32:24 - of our flask project so I'm gonna say
32:27 - Python 3 - M V in V and this will create
32:34 - a new virtual environment now we just
32:36 - have to specify where we want that
32:38 - virtual environment so I'm going to put
32:40 - this within flask blog and I'm gonna
32:42 - call this virtual environment ve and V
32:44 - so I will run that command and that
32:47 - should have created that virtual
32:49 - environment so let's check so I'll do a
32:51 - CD in the flask blog and now
32:54 - we do an LS we can see that we have our
32:57 - you know project directory flash blog
32:59 - our requirements file run dot PI but we
33:02 - also have this V env directory so that's
33:04 - our virtual environment so in order to
33:06 - activate that we can simply say source V
33:11 - E and V Forge slash bin forge / activate
33:15 - so I'll run that and now our virtual
33:17 - environment should be activated and a
33:19 - good hint is here at the beginning of
33:21 - our prompt in parentheses here it says V
33:23 - env so our virtual environment is
33:26 - activated so with that activated we can
33:29 - now install all of our requirements for
33:31 - our project so in order to and stop
33:33 - install all of the dependencies from the
33:36 - sort of crime at txt file we can simply
33:39 - say hip install - R and after we do the
33:44 - - our we put the path to the
33:46 - requirements txt file so it's just here
33:49 - in the same directory so I can just say
33:50 - requirements txt so if I run that then
33:53 - it's going to install everything that we
33:55 - need for our application okay so that
33:59 - should have installed all of the Python
34:01 - packages that we need for our
34:03 - application so now we want to test our
34:06 - website using the development server and
34:08 - make sure that it works using that
34:10 - development server before we install
34:12 - nginx and G unicorn but before we test
34:15 - this there are a couple of variables
34:17 - that we first need to set so if you
34:19 - remember on our local machine we set
34:22 - some environment variables for our
34:23 - secret key our database URL our email
34:27 - user and our email password for our
34:29 - password resets and we're going to need
34:31 - to set those on our server before our
34:33 - application will work properly now on
34:35 - our local machine we used environment
34:37 - variables and we could use environment
34:39 - variables here as well but I think that
34:41 - sometimes environment variables can be a
34:44 - little tricky when working with
34:46 - different web servers so instead let's
34:48 - just create a configuration file with
34:50 - all of our sensitive information and
34:52 - we'll load that into our application
34:54 - instead of our environment variables so
34:56 - first I'm going to go back to my local
34:59 - machine and grab the values of those
35:01 - environment variables so that we can add
35:03 - them to our server so I'm going to clear
35:05 - my screen here on the server and now I'm
35:08 - going to
35:08 - open back up my local machine here now
35:13 - there are a couple of different ways
35:14 - that we can get those environment
35:15 - variables now if your flask environment
35:18 - is activated then you should be able to
35:20 - grab all of those just by using Python
35:22 - so I'm just going to put Python here to
35:25 - open up our Python command line and now
35:28 - I'm going to import OS and now we want
35:32 - to grab our secret key so I'm gonna say
35:34 - Oh s dot environment and we want to get
35:38 - that secret underscore key so that is
35:42 - the secret key that we used for this
35:43 - project so now I'm going to want to do
35:46 - the same thing except I'm also going to
35:48 - want the SQL alchemy underscore database
35:53 - underscore URI so let's run that now if
35:57 - you're wondering what all environment
35:59 - variables you need we set all of these
36:01 - in our flask configuration file so if
36:04 - you look in that flask configuration
36:06 - file you should be able to see where
36:07 - you're using these environment variables
36:09 - it should say oh s dot environment or
36:12 - dot get and then secret key sqlalchemy
36:14 - database URI and etc now we also need to
36:18 - grab our email user so email underscore
36:23 - user and also our email underscore pass
36:27 - so my email user is just my email
36:31 - address now my email password I'm not
36:34 - going to actually hit enter here and
36:35 - show my email password for obvious
36:37 - reasons I don't want people to be able
36:39 - to log in to my email but our off-camera
36:43 - I'm going to grab this email pass value
36:46 - here as well and put this within the
36:49 - configuration on my server okay so now
36:51 - that I have these printed out here I'm
36:53 - going to go back to my server and I'm
36:57 - going to create a config file so I'm
37:01 - going to say sudo touch and touch will
37:05 - create a file I'm going to create this
37:07 - in forge /e TC ford slash config dot
37:10 - JSON now I'm calling it config dot JSON
37:13 - because this is going to be the only
37:15 - flask application that lives on this
37:17 - server if you need to differentiate
37:20 - between multiple flask applications then
37:22 - you could call this you know flask blog
37:24 - config or something like that instead
37:26 - then I'm also using JSON for this file
37:28 - but if you're more comfortable using
37:30 - Gamal or something like that then you
37:32 - can use that as well so I'm going to
37:34 - create that file and now I'm going to
37:36 - edit that file so sudo nano - et Cie
37:39 - config dot JSON fig JSON okay and within
37:44 - this file we're going to create JSON
37:47 - here so we need these opening and
37:49 - closing curly braces and first we want
37:52 - to create a value for secret key so the
37:56 - value for our secret key that needs to
37:58 - be in double quotes I'm going to go back
38:00 - to my local machine here I'm just going
38:02 - to grab that value from our local
38:04 - machine and go back to our server and
38:07 - paste that in and then put in a comma
38:10 - here and now I will do the same for I'm
38:14 - actually going to copy this key because
38:17 - it's a long one SQL alchemy database URI
38:21 - let me move this over just a little bit
38:23 - here okay so I will paste that in for
38:27 - the key and the value for that key was
38:31 - let me move this over a little bit here
38:33 - the value for that key was just our
38:36 - simple SQL Lite database so I will paste
38:40 - that in and don't forget your comments
38:42 - here after these key value pairs in your
38:44 - JSON so now we need our email user and
38:49 - our email pass now you're going to put
38:53 - in your email user here and your email
38:58 - pass now I'm not going to put those here
39:02 - in this video because that is sensitive
39:06 - private information for myself but off
39:08 - video I'm going to put those values in
39:10 - so that we can see how the password
39:14 - reset functionality works on our server
39:17 - so I'm just going to save this file so
39:20 - I'll hit ctrl X Y to save and then enter
39:23 - and now I'm going to pause the video and
39:25 - go back in to that config dot JSON and
39:29 - I'm going to put in my email username
39:32 - and my email password so that that
39:35 - functionality works here
39:36 - the server I'm just not gonna show it on
39:38 - video so I will resume the video once I
39:41 - finish with that okay so I went back in
39:43 - that config file and I put my email user
39:46 - and my email pass so now whenever we
39:48 - test this that reset password
39:51 - functionality should work with our email
39:53 - service okay so now that we've created
39:57 - this config dot JSON file now we're
39:59 - going to want to edit our config file in
40:02 - our flask project and set those values
40:05 - so I'm going to do if we do an LS here
40:08 - on our flask blog you can see that this
40:11 - flask blog directory here contains our
40:15 - other project files so I'm gonna do an
40:17 - LS on flash blog and you can see that
40:19 - that is where our config PI file lives
40:22 - so I'm going to edit that file so I'm
40:24 - gonna do a sudo nano flash blog config
40:29 - dot PI and within this file here at the
40:32 - top I'm going to import JSON since we're
40:35 - now using JSON instead of environment
40:37 - variables and also here at the top I'm
40:40 - going to load in those values so I'm
40:43 - going to say with open and we're going
40:46 - to open that file that we just created
40:48 - and so this is the path so as in 4/8 ici
40:52 - ford slash config dot JSON and we will
40:57 - open that as config underscore file and
41:01 - now within here we will say config is
41:06 - equal to json dot load and load in that
41:11 - config file now when you use JSON load
41:15 - on a JSON file what that doesn't Python
41:19 - is it makes this variable here a Python
41:22 - dictionary so now this Python dictionary
41:25 - called config is equal to all of the key
41:28 - value pairs from our JSON config file so
41:32 - now here at the bottom parts of our file
41:35 - let me scroll up here a little bit
41:37 - everywhere that we're using environment
41:40 - get we can now use config dot git since
41:45 - config right here is a dictionary with
41:48 - those configuration
41:50 - values so instead of OS not in firing
41:52 - I'm going to say config dot git so we're
41:55 - doing config dot git on the secret key
41:57 - we're going to do a config dot git on
42:03 - the SQL alchemy database URI and we are
42:07 - going to do a config dot get on the
42:11 - email user and on the email pass okay so
42:17 - once that is done I'm just going to save
42:20 - that file so since I'm using nano that's
42:22 - control X Y to save and then enter okay
42:26 - so now we're ready to actually test our
42:27 - application and see if it works on our
42:29 - server
42:30 - so there are a couple of ways we can
42:32 - test the application let me clear my
42:34 - screen if you remember we can do a if I
42:37 - do an LS here on our project we can see
42:39 - we have this run dot pi if you remember
42:41 - I usually do this Python run PI but if I
42:45 - do a cat on that file and print out the
42:47 - contents of that file then we can see if
42:50 - I run that then it's just going to do an
42:51 - app dot run of debug equal true but I
42:54 - actually want to set our host equal to
42:57 - zero zero zero zero and what that'll do
43:00 - is that will expose it to the outside
43:04 - world so to do that instead of doing
43:07 - python run pi i'm just going to do like
43:10 - we saw earlier in the series and I'm
43:12 - going to use flask run now if you
43:14 - remember in order to use flask run I
43:17 - have to do an export of our flask
43:21 - project so I'm going to do an export and
43:24 - this is just going to create a temporary
43:26 - environment variable so that we can test
43:28 - this so I'll say export flask underscore
43:31 - app is equal to and there's no spaces
43:33 - here so is equal to run dot pi because
43:37 - that is what contains our application so
43:39 - now that we've done that export flask
43:41 - app equals run dot pi now I can simply
43:43 - do flask run now don't hit enter yet
43:46 - instead of doing flask run we also want
43:49 - to set the host so I'm going to set the
43:51 - host equal to 0 0 0 0 and that will
43:56 - allow us to access this development
43:58 - server from the outside so from our
44:01 - browser so I'm going to run that
44:04 - and it should spin up our server so we
44:06 - can see that it's running one our IP
44:09 - address one port 5000 so now if I open
44:14 - my browser here then whoops let me
44:17 - actually open up my other browser here
44:22 - so now I want to go to my IP address at
44:26 - port 5,000 so my IP address you're going
44:30 - to want to use with yours mine was 4 5.3
44:33 - 3.1 to 3.2 one 4 now if we just go to
44:38 - that IP address then we're not going to
44:40 - get anything because port 80 currently
44:42 - isn't open on our firewall so you can
44:46 - see it says the site can't be reached so
44:47 - to go to a specific port we want to put
44:50 - in : 5,000 to go to port 5,000 if I run
44:54 - that then you can see that we get what
44:57 - seems to be our application ok so it
44:59 - looks like our application is working
45:01 - but we're always going to want to do a
45:03 - little bit of testing here so to make
45:05 - sure that the functionality is working
45:07 - let's try a couple of things so let's go
45:09 - to login and see if we can log in as a
45:13 - current user so I will try to log in as
45:16 - my Cori em Schaefer user it looks like
45:18 - that worked logout that seems to work
45:22 - let's go to register and try to create a
45:24 - new user so I'm going to create a new
45:26 - user here and just call this deployed
45:28 - user for the email I'll do deployed user
45:31 - at test comm password I'll just do
45:35 - testing password testing signup and that
45:39 - seemed to work so now let's try that so
45:41 - deployed user at test comm testing to
45:46 - log in that seems to work let's try to
45:49 - create a new post deployed post and I
45:54 - will copy that
45:55 - and post that so it looks like that
45:58 - worked see if we can update a post
46:01 - updated deployed post that works let's
46:05 - try to delete a post so if I delete a
46:07 - post that seems to work as well let's
46:10 - see if we can change our profile picture
46:12 - so right now we just have this default
46:15 - profile picture
46:17 - I will try to choose a new picture here
46:20 - just choose one from my desktop update
46:23 - that and that seemed to work okay that's
46:25 - good
46:26 - and let's also test that our email is
46:29 - working so if I go to login forgot
46:35 - password if I say that I forgot my
46:37 - password for my Cory M Schaffer gmail
46:40 - account if I run that then it says an
46:43 - email has been sent with the
46:44 - instructions and reset your password I
46:45 - actually have my gmail opened up here
46:48 - and we can see that I got the password
46:51 - reset request here so if I click on that
46:54 - then we can see that I got my password
46:58 - reset link and I can now change my
47:01 - password so instead I'll change that to
47:03 - testing one two three
47:05 - instead of just testing and if we log in
47:08 - with that new password testing one two
47:10 - three
47:10 - then that seems to work okay so
47:14 - everything all of our functionality for
47:17 - our website seems to be working so
47:19 - that's good but if we go back to our
47:22 - server here we are running a development
47:25 - server on our live production server
47:29 - this is not what you want to do this is
47:31 - great for testing but you don't want to
47:34 - go live with this and send this URL out
47:37 - using a development server it's a
47:40 - development server for a reason it's not
47:42 - meant for you know a lot of performance
47:44 - and to be hit by a lot of people so
47:47 - that's why would you use something like
47:49 - engine X and G unicorn because those
47:52 - applications are you know do allow for
47:55 - high traffic and for good performance so
47:58 - now we're going to want to get our
47:59 - application working with engine X and G
48:02 - unicorn but this is a very good sign
48:04 - that it's currently working in our
48:06 - development server so now I'm going to
48:07 - contain control C and clearing my screen
48:12 - here and now let's install nginx and G
48:15 - unicorn so I'm going to CD back to my
48:17 - home directory just so I have more room
48:20 - here to work with and now I'm going to
48:22 - say sudo apt install and we're going to
48:25 - want to install engine X so let's run
48:28 - that
48:30 - and once engine X is installed then I
48:33 - will clear my screen here and now we
48:35 - want to install G unicorn so we can
48:37 - actually install G unicorn with pip so I
48:39 - can do pip install now you're gonna want
48:41 - to make sure that you are still within
48:44 - your virtual environment here so make
48:46 - sure that you haven't deactivated that
48:47 - because we'd want to install gene
48:49 - unicorn in that virtual environment so
48:51 - I'm going to do a pip install G unicorn
48:54 - so we will run that okay and once that's
48:57 - installed we just need to change a
48:58 - couple of configurations with nginx and
49:01 - with G unicorn and we will be done so
49:04 - first of all we're going to update the
49:07 - configuration file for engine X so the
49:10 - way that engine X and G Unicorn work
49:12 - together is that engine X is going to be
49:14 - our webserver and it's going to handle
49:17 - the requests such as static files and
49:20 - things like that it's not actually going
49:22 - to handle the Python code it's going to
49:25 - use G unicorn to do that so we're going
49:29 - to allow engine X to handle you know
49:32 - like the static information like the CSS
49:34 - files and JavaScript and pictures and
49:37 - things like that but when it comes to
49:39 - handling Python code we're going to pass
49:41 - that off to G unicorn so in order to do
49:44 - this first let me clear my screen here
49:47 - first let's remove the default engine X
49:50 - configuration file so I'm going to say
49:52 - sudo RM and this was was is in ford
49:56 - slash et Cie engine X and sites enabled
50:01 - sites
50:02 - - enabled and default so we're just
50:05 - going to remove that default file and
50:07 - now we're going to create a new file so
50:10 - this is going to be sudo nano and we
50:13 - will so this is going to be in /e TC
50:16 - forged slash nginx porch last sites
50:19 - - enabled and we will call this flask
50:22 - blog so let's run that this is a new
50:25 - file this doesn't exist yet so it's
50:27 - going to be completely blank so now to
50:29 - create an engine X configuration file
50:31 - we're just going to say server and then
50:35 - in these curly braces here we will say
50:38 - listen on port 80 and you're going to
50:41 - want to remember these semicolons here I
50:43 - know that
50:44 - Python code we're not used to putting in
50:45 - semicolons but here you have to remember
50:48 - that so now we need server underscore
50:51 - name and that is going to be equal to
50:53 - four now it's just going to be our IP
50:55 - address so my IP address you're going to
50:58 - want to put in yours mine is four 5.33
51:01 - dot one two three two one four semicolon
51:04 - and now we're going to forward all of
51:07 - our static files so our CSS and
51:11 - JavaScript and our pictures and stuff
51:13 - like that we're going to let nginx
51:15 - handle that but we need to tell nginx
51:19 - where those are located so I'm going to
51:21 - say location ford slash static and then
51:25 - another pair of opening and closing
51:27 - curly braces so for location static that
51:32 - is going to be alias so alias to ford
51:36 - slash home and then your user name my
51:39 - user name is corey ms but you want to
51:40 - put yours and then your project
51:43 - - flask underscore blog and now the
51:47 - location - our static directory so
51:50 - within that flask blog directory I have
51:52 - another directory called flask blog that
51:54 - holds our project files and then there's
51:57 - a static folder within there so you're
51:59 - going to want to put the location to
52:00 - your static folder but it should be
52:02 - something like that if you've been
52:04 - following along with this series okay so
52:06 - having that in place now we're ready to
52:09 - forward all of the other traffic to G
52:13 - unicorn so now we can say location and
52:16 - just do a ford slash and then some
52:19 - opening and closing curly braces here
52:21 - now I am going to put this file this
52:24 - engine X configuration file I am going
52:27 - to put this on github if you're worried
52:29 - about miss typing any of this so I will
52:32 - have this up on github so that you can
52:33 - use that as a reference okay so at this
52:36 - location here at this root location
52:39 - basically this means if we go to our IP
52:42 - address then this is what's going to
52:44 - happen so we're going to do a proxy
52:47 - underscore pass and then we're going to
52:49 - pass this off to G unicorn now by
52:52 - default G unicorn runs on port 8000 so
52:55 - I'm just going to say do a proxy pass
52:57 - - HTTP forge / localhost so our
53:02 - localhost is the server in this case on
53:05 - port 8000 so that will forward all that
53:08 - traffic to G unicorn and let that handle
53:10 - the Python code now there's also a
53:12 - couple of other things we're going to
53:13 - want to add in here that just passes
53:16 - some extra variables for that proxy so
53:20 - to do this we're just going to say
53:21 - include and we're going to want to
53:24 - include this file here /e TC flurried /
53:28 - nginx forge / proxy underscore programs
53:32 - and put a semicolon there and then we
53:35 - will also do a proxy underscore redirect
53:39 - off and then a semicolon now there are
53:42 - all kinds of things that nginx can do if
53:44 - you want to know any more details about
53:46 - any of this stuff then I would highly
53:47 - suggest looking at the engine X
53:49 - documentation and it'll explain in more
53:52 - detail what a lot of this stuff is doing
53:54 - but this should be good for our engine X
53:56 - configuration file so I'm going to save
53:59 - this so since I'm using nano I hit ctrl
54:01 - X Y to save and then hit enter okay so
54:04 - in our engine X configuration file we
54:07 - said that we were listening on port 80
54:09 - so if you remember we haven't actually
54:11 - opened up that port on our firewall yet
54:13 - so let's go ahead and do that now so I'm
54:16 - gonna say sudo UFW our uncomplicated
54:19 - firewall allow and we will allow HTTP
54:23 - TCP traffic so it said that it added
54:26 - those rules and since we are done with
54:28 - our testing we will also disallow any
54:30 - traffic on port 5,000 since that was our
54:33 - testing port so I'm going to say a sudo
54:35 - ufw delete and I will delete the allow
54:39 - of port 5,000 so again I'll make sure
54:42 - that that is enabled so sudo ufw enable
54:45 - and hit Y for yes okay and now we want
54:50 - to restart our engine ax server so I'm
54:53 - going to say sudo systemctl
54:56 - restart engine X okay so that restarted
55:02 - our nginx server so now I'm going to
55:04 - clear my screen so now our engine X
55:06 - server is running but G unicorn is not
55:09 - running so our server is not going
55:11 - to know how to handle that Python code
55:13 - so if I go back to my browser here and I
55:18 - try to reload this page then it's not
55:22 - going to work so if I just let this spin
55:25 - up here it'll give me an engine ex-air
55:27 - eventually and I'm actually still on
55:29 - port 5000 here so that's not going to
55:31 - work at all and actually instead of
55:34 - using regular Chrome here I'm gonna go
55:37 - back to using my incognito because
55:40 - incognito if you don't know it doesn't
55:43 - cache things like h or CSS and things
55:45 - like that so it's easier for development
55:48 - so if i run that then you can see that
55:51 - we got a 5 i too bad gateway and we can
55:54 - see that this is an engine X error here
55:56 - now that is because it's listening on
55:58 - port 80 so we got in contact with nginx
56:01 - but it doesn't know how to Ford Python
56:04 - code so we have to run G unicorn so the
56:07 - engine X Forge this request to G unicorn
56:10 - and then G unicorn knows how to handle
56:12 - that Python code now we can access our
56:15 - static files so if we try to access like
56:18 - one of our CSS files I can go to forge
56:21 - slash static forward slash main dot CSS
56:25 - that should be working because that is
56:27 - just nginx handling that information so
56:30 - we can see that we can see our CSS code
56:32 - here so that works but we need to run G
56:35 - unicorn in order to get the Python code
56:37 - working so let's go back to our server
56:41 - here and now let's get GE unicorn
56:43 - working now to run G unicorn it's
56:45 - actually a very simple command we can
56:47 - just run G unicorn and then we can also
56:52 - run some workers here so I can say dash
56:55 - W and then the amount of workers so I
56:57 - can say three and then we want to
57:00 - specify the file that has our
57:04 - application so the module that contains
57:06 - our application variable is run dot PI
57:09 - so we can just say run and then a colon
57:12 - and then the variable name of our
57:14 - application so the variable name in our
57:16 - application is app now I'm not going to
57:18 - run this yet because I actually have to
57:21 - change directories here but first of all
57:23 - let me also explain the
57:25 - workers here so a lot of people say ok
57:27 - how many workers do I need to run for my
57:30 - machine well if you look in the G
57:32 - unicorn documentation then they say that
57:35 - the number of workers should be two
57:38 - times the number of cores on your
57:42 - machine plus one so in order to see the
57:46 - number of cores on your machine it's
57:48 - pretty easy to figure that out in Linux
57:51 - one way you can just do an in Prague - -
57:54 - all and remember we got the Nano done of
57:57 - the node here which is your cheapest
57:59 - version so I just have one core here so
58:01 - that's why I chose three workers because
58:03 - that is two times our number of cores
58:06 - which would be two plus one so that's
58:08 - how you figure that out if you're
58:10 - interested okay so in order to run G
58:12 - unicorn here I'm going to actually CD
58:14 - back into my flask blog and now if I do
58:17 - an LS we can see that we have run PI
58:20 - here
58:20 - now let me cat out the contents of that
58:23 - file and you can see that within run PI
58:26 - we have app equal to our create app and
58:29 - that's what creates our flask
58:31 - application so to run that G unicorn
58:34 - code again again it's G unicorn and I'm
58:38 - going to use three workers and that is
58:40 - within the run module and that variable
58:44 - for our application is app so if I run
58:47 - that then we can see that it says that
58:50 - it's listening on our localhost at port
58:53 - 8000 and that it booted up three workers
58:56 - for three different processes so now if
58:59 - we go back to our browser here and
59:03 - reopen this in our browser you can see
59:05 - that now we are just going to our IP
59:07 - address and nginx is forwarding that
59:10 - traffic to G unicorn and G unicorn is
59:13 - handling this Python code so now our
59:16 - website is working in production okay so
59:18 - I'm not going to go through all the same
59:20 - tests that I did before but we can see
59:22 - if I just you know try to log in we can
59:25 - see that at least that is working so it
59:28 - seems to be working well so far but
59:31 - there is one more thing that we want to
59:33 - do this isn't quite ready for production
59:35 - just yet because if
59:38 - we looked at our server you know this
59:40 - isn't really good the way that this is
59:42 - running here because this is running in
59:44 - the foreground we can't do anything on
59:47 - our server here this has to remain open
59:50 - so if I was to close my server so if I
59:52 - hit control C and stop that then we just
59:56 - killed G unicorn and if I run try to
59:59 - reload the page this isn't working
60:01 - anymore so what we need is something
60:04 - that is constantly monitoring G unicorn
60:08 - and making sure that it's running and
60:11 - will auto start it and auto restart it
60:13 - if it crashes and things like that
60:15 - so in order to do that we're going to
60:17 - use some software called supervisor and
60:20 - this is very easy to use on Linux so to
60:23 - install supervisor I'm just going to say
60:24 - sudo apt install and this is called
60:28 - supervisor so let's run that and install
60:31 - that I'll say yes ok and once that is
60:35 - installed we just need to set up a quick
60:37 - and easy configuration file for
60:40 - supervisor so to do this will say sudo
60:42 - nano and this is going to be in /et see
60:46 - Forge slash supervisor conf dot D and
60:50 - within comp D we're going to create a
60:53 - configuration file so this is going to
60:55 - be flask blog.com sorry that this is
60:59 - running on the other line here I know
61:01 - that that makes it hard to read but I
61:03 - called this flask blog.com so if we run
61:07 - that then now we have a blank
61:09 - configuration file here and I'm gonna
61:11 - put this file up on github as well but
61:13 - to create a supervisor configuration
61:15 - file here first we can just put these
61:17 - square brackets first we want to say
61:19 - program and the name of our program so
61:22 - I'm just going to call this flask blog
61:23 - and now we want to put in a few
61:27 - variables here so I'm gonna say
61:29 - directory so directory is where this is
61:33 - going to run a certain command from so
61:36 - we want to run a command from our flask
61:39 - project so this is in fort slash home
61:41 - slash CMS you're going to want to put
61:44 - your user name there and mine is called
61:47 - flask underscore block and now we
61:52 - to put in the command that we want to
61:54 - run so the command that we want to run
61:56 - from that directory is G unicorn with
62:00 - three workers and then run app now if
62:03 - you remember G unicorn is actually in
62:05 - our virtual environment and we're not
62:08 - going to activate the virtual
62:09 - environment here from within our
62:10 - configuration file so instead you're
62:12 - going to want to put in the full path to
62:15 - G unicorn and that is just within the
62:17 - bin folder of your virtual environment
62:19 - so this is gonna be a little long here
62:21 - but this is within our home directory of
62:24 - our user and that is within flask blog
62:28 - is where I put that virtual environment
62:30 - and that virtual environment is called V
62:32 - E&V and within the bin folder of that
62:35 - virtual environment that is where the G
62:37 - unicorn command lives so we want to run
62:41 - that command with three workers so I'll
62:44 - say - W three and remember that is just
62:48 - we want to run that on the run module
62:52 - and app is the name of our application
62:54 - so now a few more things here we'll say
62:57 - user is equal to core EMS we want to do
63:01 - an auto start equal to true that means
63:04 - that the that supervisor will make sure
63:06 - that this auto starts we'll set an auto
63:09 - restart equal to true that is if it
63:13 - crashes for any reason then it's just
63:15 - going to start it right back up now we
63:17 - also want to do a stop as group make
63:22 - sure that spelled right equal to true
63:23 - and a kill as group equal to true and
63:29 - that's just going to help you know if we
63:31 - stop or kill this it's going to help
63:33 - wrap up any child processes now we also
63:36 - want to do some air and log files here
63:39 - so I can say st de r r so standard air
63:46 - underscore log file is equal to and we
63:50 - will create this log file in a second
63:52 - but we will put this in ford slash bar
63:55 - /log ford slash
63:57 - flask blog ford slash let's say we'll
64:00 - just call this flask blog dot e RR dot
64:05 - for our error log and I'm going to just
64:08 - highlight this and copy it so I don't
64:10 - have to type all this out again paste
64:13 - this in and for our standard out I'm
64:15 - just going to call this class blog dot
64:19 - out dot log and back here at the
64:21 - beginning this is going to be the
64:23 - standard out log file okay and that is
64:27 - it and again I'm going to put this on my
64:29 - github repository if you want to check
64:32 - and make sure that all of this looks
64:34 - good if you want to you know look at
64:36 - this on the github page so I will hit
64:38 - control X Y to save and hit enter and
64:41 - now we want to create those log files
64:46 - really quick so in order to do that I'm
64:49 - just going to say sudo make Durer and
64:52 - I'll do a - P a - P will create any
64:56 - directory in the chain if none of them
64:58 - exist so I'll say - bar - log - flask
65:04 - blog and now we called those log files
65:09 - so I'll do a sudo touch we called those
65:11 - that was within port slash var slash log
65:16 - flask blog we called that flask blog dot
65:20 - e RR dot log so I'll run that and I'll
65:24 - hit the up arrow here we also want to do
65:26 - flask blog dot out dot log so I'll run
65:30 - that okay so now that I have all of that
65:32 - in place I'm just going to restart our
65:36 - supervisor so in order to do that I'll
65:38 - just do sudo supervisor CTL reload so if
65:44 - I run that we can see that it restarted
65:47 - supervisor so now if we reload our page
65:51 - in the browser here sometimes it can
65:53 - take a while for a supervisor to start
65:56 - up that process if I run that now we can
65:58 - see that it's already working so now if
66:01 - you wanted to then you could go through
66:02 - and check that make sure all of this you
66:05 - know functionality is working correctly
66:07 - so you know if I go in here and change
66:10 - some pictures and try to update this we
66:13 - can see that that works we can create
66:17 - new posts so if I run that new post we
66:22 - can update and it's always good to check
66:26 - this functionality just to make sure
66:28 - that nothing is off so one thing that
66:32 - you might notice here if I go and change
66:36 - my profile picture now that we're using
66:38 - nginx as a webserver engine X has some
66:41 - defaults that you might not expect so
66:44 - you could get some unexpected things
66:46 - with your application and that's just
66:48 - kind of knowing your webserver so for
66:50 - example if I choose a really large file
66:52 - here so I have a file on my desktop
66:54 - called large JPEG if I open that and I
66:58 - try to update that as my profile picture
67:00 - if I do that you can see it's gonna spin
67:03 - here for a little bit and then it's
67:04 - going to give me an inch and X error and
67:06 - it says four one three requests entity
67:08 - two large now this is an engine X
67:11 - default it won't accept client you know
67:15 - upload sizes over I think it's two
67:17 - megabytes and I think that that to that
67:19 - picture is 2.8 megabytes
67:21 - now if you want to change this you might
67:23 - not even have that need for your
67:24 - application so if you don't have the
67:26 - need then that's completely fine
67:28 - but if you do have the need and you need
67:30 - to change that then here within our
67:32 - server I'm gonna clear the screen here
67:34 - you can update that by going to sudo
67:36 - nano that's in forge /et c ford slash
67:40 - engine x forge slash nginx kampf so
67:45 - within here if we scroll down to HTTP
67:47 - then I am going to just come in here
67:52 - past at the bottom of the basic settings
67:56 - here and you can just set a variable
67:58 - called client underscore max underscore
68:02 - body underscore size and I'm just going
68:05 - to set that to five megabytes so you can
68:09 - set that to whatever you want to set it
68:11 - as if you remember the application that
68:12 - we created in this video automatically
68:15 - resizes large uploads to a smaller
68:18 - upload anyway so I will save that and
68:23 - then you can restart engine X by doing a
68:26 - sudo system CTL
68:30 - restart of nginx so now if I go back to
68:35 - my account page and try to upload that
68:39 - same large file again then we can see
68:43 - that this time it worked and if I open
68:45 - the picture in a new tab then we can see
68:49 - that it's a small picture anyways
68:50 - because our web application that we
68:52 - created takes those large images and
68:55 - resize sizes them down to I think 125
68:58 - pixels is what we chose okay and real
69:00 - quick just to make sure that the
69:02 - password reset is working as well you
69:04 - know that's something that is easy to to
69:07 - not work sometimes so I can go to forgot
69:09 - password type in our email address and
69:12 - request that password reset so if I open
69:15 - up my email address here so I'll go back
69:18 - to my inbox and we can see that we have
69:20 - a password reset and go there and that
69:24 - whoops let me click on that reset link
69:27 - help and I don't think that that worked
69:29 - because I was still logged in here when
69:32 - inside of this browser so if I log out
69:36 - in that browser and then go back using
69:39 - that reset link you can see that now
69:40 - that that works so testing one two three
69:45 - yeah
69:46 - so that seems to work okay so let me go
69:50 - back to our home page here so now that
69:52 - we're using supervisor if I completely
69:55 - log out of my server so I'm back here on
69:57 - the server if I just go to exit and I
70:00 - can just close down my all of my
70:04 - terminals completely if I close all of
70:06 - those down then we can see that I can
70:08 - you know do a hard refresh on my pages
70:11 - here and this is all still working so we
70:15 - have a completely functional website
70:18 - that is working on our IP address that
70:20 - is fully deployed at this point now
70:22 - there's still a lot more that we could
70:23 - do in future videos if you're interested
70:25 - so right now we only have an IP address
70:27 - but if you want then I could also walk
70:30 - through the process of buying a domain
70:32 - name and how to get that domain name to
70:35 - go to this server that we've set up we
70:37 - could also see how to add SSL
70:39 - certificates so that we can have an HTTP
70:43 - domain name
70:44 - that's actually something that I still
70:46 - need to do for my personal website as
70:47 - well I'm still using HTTP now I'm
70:51 - actually going to delete this server
70:53 - after this video so if you go to this IP
70:57 - address here then you're not going to
70:59 - see this website so if you go to this IP
71:02 - address then that's why you won't see
71:03 - this so if we do continue this series
71:06 - then I'll spin this server back up with
71:08 - a different IP address when I record
71:09 - more videos for this series now actually
71:12 - let me go ahead and delete this server
71:14 - on this video so that if you're
71:16 - following along then you can do this as
71:18 - well so that you're not charged for it
71:20 - so let me go back here to my Leno to
71:23 - probably need to log back in no it looks
71:26 - like I'm still logged in here so that's
71:28 - good now if you want to completely
71:30 - delete your server then you can just go
71:34 - to your lenosky R and over here on the
71:37 - right you can click on this settings
71:39 - menu here and you can go down to
71:42 - settings and once you're at settings you
71:45 - can see at the bottom here we have
71:46 - delete the node so you could click on
71:49 - delete and then it's going to ask you
71:51 - are you sure that you want to delete
71:52 - this because it's going to result in
71:54 - permanent day loss everything that we
71:55 - did in the video is going to be done so
71:58 - you can delete by clicking that there I
72:00 - actually think that I'm just going to
72:02 - power this off for now so I'm just going
72:04 - to say power off instead and I will
72:08 - delete that later now like I said at the
72:11 - beginning of the video the node was
72:13 - actually kind enough to sponsor this
72:14 - video and I've used them for many years
72:16 - and have recommended them the people
72:18 - long before I even had any sponsors so
72:21 - if you get a chance I would highly
72:22 - recommend giving them a shot so like we
72:24 - saw earlier in the video they have this
72:26 - new and improved cloud management system
72:28 - that makes spinning up a server fast and
72:31 - easy you can choose from available
72:34 - images and you can even upload your own
72:36 - custom image if you'd like and if you're
72:38 - doing something that's fairly common
72:40 - they even have stacks scripts that allow
72:42 - you to spin up a server with all of the
72:44 - relevant software already installed and
72:47 - ready to go so for example if you're
72:49 - making you know like a WordPress site or
72:51 - something like that then you can simply
72:53 - choose their WordPress stack script that
72:56 - spins up a server with WordPress ready
72:57 - to
72:58 - so if I was to click here on the node
73:00 - and then here at create an image if I
73:03 - instead go to create from stack script
73:05 - and then go to the node stack scripts we
73:08 - can see that their WordPress stack
73:10 - script is the top one here and it says a
73:12 - ready to rock WordPress install using
73:15 - the latest release from wordpress.org so
73:17 - that is pretty neat that they have these
73:21 - images that are just ready to go like
73:23 - that look and it looks like I need to
73:25 - log back in here now they also have nine
73:29 - worldwide data centers so far and they
73:32 - have two more set to open in 2019 so no
73:35 - matter where you are you should be able
73:37 - to spin up a server close to your
73:38 - audience so if you want to check them
73:40 - out then feel free to use my referral
73:42 - link in the description section below
73:43 - and you can get $20 of free credit
73:46 - applied to your account to try them out
73:48 - okay so with that said I think that is
73:50 - going to do it for this video hopefully
73:52 - now you have a good idea of how you can
73:55 - deploy your flask application to your
73:57 - own Linux server like I said before this
74:00 - option takes a little more effort than
74:02 - some of the other options out there but
74:04 - having your own virtual private server
74:06 - gives you so much more flexibility and
74:08 - room to grow with your application and
74:10 - it also provides some terrific knowledge
74:12 - for learning more about back in at Linux
74:14 - systems and that's something that you
74:17 - know employers really look for nowadays
74:19 - and something that would really shine on
74:21 - a resume
74:22 - but if you have any questions about what
74:23 - we covered in this video then feel free
74:26 - to ask in the comment section below and
74:27 - I'll do my best to answer those and if
74:29 - you enjoyed these tutorials and would
74:30 - like to support them then there are
74:32 - several ways you can do that
74:33 - the easiest ways to simply like the
74:34 - video and give it a thumbs up also it's
74:36 - a huge help to share these videos with
74:37 - anyone who you think would find them
74:39 - useful and if you have the means you can
74:40 - contribute through patreon and there's a
74:42 - link to that page in the description
74:43 - section below be sure to subscribe for
74:45 - future videos and thank you all for
74:46 - watching
74:48 - you
74:58 - you

Cleaned transcript:

hey there how's it going everybody in this video we're going to be continuing the flask series and learning how to deploy our flask application to a web server so that anyone with internet access can use it within a browser so so far we've created this application with some good functionality but the site still only lives on our local machine right now this is just running in my browser on my local machine but no one else can access this so the point of building these sites is to deploy them so that they're accessible over the Internet now I'm not gonna lie to you deploying can be a bit tricky it can be overwhelming because there are a lot of different ways to deploy an application and it's hard to know exactly what's best for your specific application so we're gonna look at several deployment options in this series so we're gonna look at how to deploy to our own linux server how to deploy to Heroku and possibly some others so in this video we're going to be learning how to deploy our application to our own linux server using nginx and g unicorn now if you watched my django series then i deployed the django application using apache and mod whiskey but the reason I used Apache and mod whiskey in that video is because it's recommended on Django site but with flask I think it'll be best for us to use engine X and G unicorn so when you deploy to a Linux server you're most likely going to be deploying to a virtual machine that is hosted by a company so that's going to be a company like len么tre or digitalocean or AWS now I personally use 'la node for my own web applications so that's what we'll be using in this video and the node was actually kind enough to sponsor this video as well and has provided me with a link where you all can get 20 dollars of free credit towards an account so if you want to follow along with this video then I'll leave that link in the description section below where you can sign up for an account and get enough credit to follow along I've been using their services for my own personal website for years so I was really happy when they contacted me about sponsoring a video so with that said let's go ahead and get started ok so like I said we're going to be deploying it to a Linux server this method of deployment actually takes the most effort to set up but is also the most flexible in terms of what control you're going to have over your application and web server so in future videos we'll look at deployment options that offer some free tiers but they usually only offer basic services so for example if you want to use your own domain name like you know my flask blog.com or something like that then you'll have to upgrade to a paid service on those free options in order to set that up and even then you won't have the freedom and possibilities that you get when you have your own virtual private server so the way that we're going to do it in this video will give you a lot of freedom and room for your application to grow but it's not as simple as some of the other methods so there definitely are some tradeoffs there so like I said I'm going to be using len么tre ploy this application to a linux server so that's my personal preference but you can do the same deployment with any linux server that you can access via SSH now I already have an account with OneNote so I'm going to pull that up here in the browser so let me reload this page to make sure I'm still logged in now I'm going to show you how to create and set up a Linux server from scratch because that's what a lot of you have requested but if you already have a server ready to go and want to skip directly do the flat specific deployment then I'll put a timestamp in the description section below or you can jump to that part so if you create an account with a node then you should be able to access a page like this that I have in front of me here now this is their new cloud manager at cloud le node calm there's also a len么tre at manage node comm but I think that's older and they are suggesting that people switch over to this so this page gives me access to all of my currently node servers so you can see here that I already have one created for my personal website called core EMS server but we're going to create a new one from scratch to deploy our flask application so let's go ahead and do that now so to do this I can just come up here to create so I'm going to click on create and we're going to click on the node so the node is their names for their linux server you can see here it says highperformance sss state linux servers for all your infrastructure needs so i'm going to click on that and now we choose our image or our operating system so i'm going to use a boon to here a boon 218 and now we need to choose a region i'm just going to choose dallas texas but you can see that they also have regions and europe and asia as well so you probably want to choose a server that is going to be close to your audience so I'm going to choose Dallas Texas because it's a nice midpoint in the United States ok so now we can choose our Linode plan so these are the standard plans here you can see some of the computer specs and the prices so this is $10 a month $20 a month one CPU 50 gigs of storage 2 gigs of RAM they also have something here called an anode now this is a low performance machine but it's also a cheaper option so you can see this is one CPU 25 gigs of storage and one gig of ram but since our application is pretty simple and we're just testing this out and trying to deploy it I'm just going to choose this cheapest option because it's not gonna take a lot of resources okay so now let's choose a label so I'm just going to call this flask server and I'm gonna skip and not add any tags here and now we're gonna add a root password so I'm gonna add a root password of just this is a test with some capitalization in there but you're gonna want a stronger root password obviously for your own server now you're definitely going to want to remember this password as well because this is what you're going to use to first log in to the system now you can see that they have some optional addons here such as backups and private IP I would probably recommend getting a backup if this is going to be your production server so that you don't have to worry about it but I'm not gonna do it for this since we are just testing this deployment so I'm just going to come over here and click on create and now it's going to create this server so we can see here that it's now provisioning the server and after it provisions it then it will boot the server up so I'm going to skip forward to where this is complete so I will resume once this is finished ok so our new server has finished booting up and that only took a couple of minutes so now we can see it here in our list of Leno's if we go to dashboard then we can also see the len么tre listed there as well so now all we need to do is click on this server and then go to the networking tab and once you're in the networking tab you can see here that we have this SSH command so this SSH command is how we're going to first access our machine now you're going to want to write down this IP address because we're going to be using that a lot throughout this video so I'm gonna write mine down right now it is for 5.3 3.1 to 3 dot 2 1 4 so now I'm going to copy this SSH command and now I'm going to paste this into my command line to login to my server now if you're in a Windows machine then you might not have access to the SSH command there are other tools that you can use that allow you to SSH into a server so one of the more popular tools is called putty but personally what I recommend if you're on a newer version of Windows is to simply install the Linux bash shell on Windows and you'll be able to as I say it's through that now I'm not going to show that process in this video but I do have a separate video detailing that whole process and I'll put a link to that in the description section below and also putty here I also have this opened up here in the browser if you do want to download putty that is at putty org so you can find that there and there will be instructions for how to use SSH with putty on that site in their documentation but if you are using Linux bash shell then it will allow you to more easily follow along with all of the commands in this video ok so if you are using bash then we'll want to copy that SSH command from our networking tab in the note and we'll paste that into our command line now I have two different terminal windows opened up here now one of these I'm going to use to run commands on my local machine and what I'm going to use to run commands on our remote Linode server now you don't have to do it this way but if you only have one terminal window open then you'll have to go back and forth between your local machine and your server so I think it's easier to simply have two windows open ok so I'm going to paste that SSH command here into the terminal on my left side and we can see that this does an ssh of our root so that's the root user at this IP address now yours is going to be your IP address for your server and then it's going to ask us if we want to continue the connection it's only going to ask us the first time that we do this so I'll say yes and now it's asking for that root password so this is the root password that we created when we created our node so mine was this is a test and I'm going to delete the server after the video so you can't you know log in to this IP address with this root password or anything like that ok so now we are connected to our load server so this is the machine that we just created now just to get some more room here I'm gonna minimize this terminal here on the right and expand this over to where we have some more room to work with here okay so now we're working with a barebones a boon to server so we're gonna want to do a couple of things to get this set up first so first of all let's upgrade the software and this is going to be like security updates and stuff like that you're gonna want to always do this the first time you log into a Linux system so I'm going to do apt update and then these two ampersands and apt upgrade and that's just going to update and upgrade the software on the system so some of these updates can take a long time so I'm just going to fast forward the video until this is complete and you're occasionally going to be asked if you want to continue and I'm just going to hit yes any time those come up okay so I fast forward to where those updates and upgrades were complete and that took a couple of minutes so now we're gonna want to set our hostname on this machine so I'm gonna clear my screen here and now to set this hostname I'm gonna say a host name CTL set host name and I'm just going to call this flask server so now if I actually type in a host name then it should say flask server there so that's good so now we also need to set this host name and our hosts file so to do that I'm just going to use the program Nano since Nano is an easy editor that a lot of people know how to use so I'm just gonna say Nano ford slash etc' ford slash host and within this host file we're going to want right under our one 2700 dot one we're going to want to put in our IP address of this machine so I said to write that down because you're going to be using it a lot mine was 40 5.30 3.1 to 3.2 1/4 and after that then we're gonna want to hit tab and then put in our host name again so I called mine flask server and now to save this in Nano you hit control X to exit and then it's going to ask you if you want to save so I'm gonna hit Y for a yes and then the file name that you want to write if you just want keep the same file name then you just hit enter so now that saved that host name to our host file okay so now let me clear my screen here now we're going to want to add a limited user to our machine so right now we're logged in as the root user now the root user has unlimited privileges and can execute any command now that might sound nice but it's best practice to add a new user that has limited privileges that you use as your main account and you'll still be able to run admin commands using sudo it's just a lot more safe than running everything as root so to do this we can just say add user and now the username of the user that you want to add I'm gonna add mine as core EMS but you want to add whatever yours is here now again okay so now it's asking us for our password so I'm just going to put in something like this is a test this is a test and now it's asking us to fill in some information about our user now this is optional you can put this in if you'd like so you know full name I'll put in my full name but I'm just going to leave like the room number and all that other stuff blank then it's going to ask you if that's correct and I will just accept the default as yes so let me clear the screen here again now again I did use a boon to as our operating system so if you used something different something like CentOS or red hat or Fedora then these commands are going to be different so just keep that in mind okay so now that we've created that user now we're gonna want to add that user to our sudu group so that they can run those admin commands so I'm going to do add user core EMS and then after that do sudo and that will add them it says here adding query MS to the group su do so that's good okay so now that we've created this new user now we're going to want to log out of the our server and log back in as that user because we don't want to be logged in as root longer than we have to it's just best practice be logged in as a limited user so I'm going to exit out of our server and now I'm back on my local machine so I'm just going to hit the uparrow to run that same SSH command that we ran before but instead of route we are going to log in as the user that we created so I'm going to log in as query MS and it's going to ask us for a password so that was this is a test and now we are logged in as the new user that we created so now I'm going to clear my screen here okay so now that we're logged in with this new user we're going to want to set up SSH key based authentication so that we can login to our server without a password so at this point I know that some of you might be thinking to yourselves like you know why do I have to do all of this stuff I just want to deploy my flask application well the reason that we're doing all of this is because you know a lot of people had requested to set up a linux server from scratch and this is what it's like to deploy a realworld application and to put the proper precautions in place on your web server so that includes best practices like setting up SSH keys and firewalls and you're going to want to do that on any realworld application that you deploy so I may as well include it in this tutorial instead of just showing you the bare minimum so when it comes to these SSH keys by default we're using a password to login to our web server just like we just now did we instead want to used keybased authentication so this is more secure and also more convenient because it uses keys that can't be brute forced and it also uses allows us to log in without putting in our password every time which is great for running remote scripts that connect to your web server now I have a separate video on this ssh authentication as well so i'm not going to go into a lot of detail of these commands but we are going to run through all of the the whole process here so if you want to know more details about what these commands are doing then you can watch that video and i'll put a link to that in the description section below now there's actually an easier way to do this by using a command called ssh copy ID but it's not available on all operating systems so instead we're just going to do this the longer way so on our server here we're going to want to make a dot ssh directory so I'm here in my home folder if I do a PWD you can see that we are within home and then our user so mine is query MS now this tilde here is just an alias for our home directory so that's it one way that you can tell that when we are in our home directory so within our home directory I'm gonna make a dot SSH directory so I'm gonna say m'kay Durer and I'm going to make a directory called dot SSH okay so now I'm going to stay logged in to my server but I'm going to open up the terminal on my local machine so now I'm going to move this over here so now I'm on my local machine not on my server now again I'm doing this in bash but if you're using a program like putty on Windows that we talked about before then you'll have to do this differently to create and copy your SSH keys to your web server and I did find some documentation in the notes guides for putty users on how you can do this through putty and I'll put a link to that in the description section below so that you can follow along with this part so you can use that guide if you need it but if you are using bash then we can simply say SSH key gin and then I'm gonna do a dash B 409 6 and that's just to make it a little more secure so now it says it's generating the public private RSA key pair enter the file in which you wish to save this and it gives a default file here I'm just gonna leave that default file and it says that there's one already there because I already have some SSH keys I'm just going to overwrite that for this tutorial and now it says to enter a passphrase now you can leave an empty passphrase which I'm going to do but if you want to make it more secure than you can use a passphrase for your key ok so now that we've created that it says that your identification has been saved and we got this ID RSA file and we also got this idrs a dot pub that is our public key now we're going to want to move our public key to our server so to do this I'm going to clear my screen here to do this on bash I'm going to use the SCP command which I believe stands for secure copy so I'm going to say s CP and the location of that public key if you use the default location is going to be in your users home folder dot SSH and forge / ID underscore RSA dot pub and we want to copy that public key up to our server so now I'm going to say Corre ms @ and now the IP address so you want to put in your IP address here mine is for 5.30 3.1 to 3.2 1 4 so that is the user and the server to where we want to copy that key now if we want to copy it to an exact location on that server then we can put in a colon here and now specify that exact location so I'm gonna put a tilde for the home directory of this user and so a tilde ford slash dot SSH and I want to save that public key into a file called authorized underscore keys now you don't need file extensions on Linux so this is a valid file name here we can just call it authorized underscore keys so I'm going to run that and this is going to ask us for our password because we haven't set up our SSH keys yet so I'm going to say put in my password here and we can see that it copied that key up so now I'm going to minimize this terminal window here and go back to my server so now in my server I'm going to see if that file is there so I'm going to do an LS on the dot ssh directory and if i do that we can see that we now have this file here called authorized keys and that should be the public key that we copied up ok so now that we've got that copied up now we need to update some permissions and again I can't go into deep detail as to what every command is doing in this video or else it would just run on for a long long time but basically what we're going to be doing here is setting the permissions for the SSH directory to where the owner of the directory has read write and execute permissions on the directory and the owner of the files in that directory will have read and write permissions on the files so to do that I'm going to do a sudo chmod that's how you change permissions and I'm gonna do 700 permissions on the dot SSH directory in my home folder and it's going to ask us for a sudo password this is just gonna ask us this one time every so often we're not gonna have to put that in every time we run a sudo password because it'll remember us for some time so now I'm also going to do a command here where I'm gonna do a sudo chmod 609 to go into deep detail about this here but basically what these permissions are in Linux the first digit here are the permissions for the owner of that file the user who owns that file so we have a seven here which means read write and execute now the second one here we have a zero means no permissions that's for the group of that directory and the last one here is for everyone else and that's a zero as well and here we're saying that we want 600 permissions for the owner zero permissions for the group and zero permissions for everyone else on the files in that directory okay so with those changes in place we should now be able to log in to this server without a password and instead it's going to use our public and private SSH keys so if I exit out of the server here now we're back on our local machine now I'm going to clear my screen I'm just going to hit the up arrow here to where we to run the same SSH command that we did before and if I run that then we can see that I was able to SSH into that machine without a password so that is a good sign that means that we're using our SSH keys okay so we're just about ready to start moving up our flask application but there's just a couple more things that we need to do here so now that we have our SSH keys working we also need to disallow root logins over SSH so now that we're logged in as our user let's do a an update on this SSH config file so I'm going to do a sudo nano and this is within forge slash et Cie forged slash SSH forged slash sshd underscore config so if we run this put in my pseudo password here so this is the ssh configuration file so i'm going to scroll down here and we're going to want to change two values in this configuration file so first we want to scroll down until we see one option here that says permit root login we're going to want to change this to no because we have a limited user now that has pseudo access so there shouldn't be any need for us to log into our machine as root so if a hacker tries to log in as root we're going to know that hey you don't need to be able to do that so with that set now let's also scroll down and we're gonna look for one called password authentication so let's keep scrolling down here and here it is here it's most likely going to be commented out so I'm going to uncomment out this here and I'm gonna change this from yes to no so the reason behind this is that now that we have our SSH keys working sometimes hackers will just you know simply try to bruteforce passwords but since we have our SSH keys we shouldn't have the need to log into our system with a password so I'm going to put password authentication to know so now to save this I'm just going to hit control X and then a Y to save and then enter to keep the same file name and now we want to restart our SSH service so to do that we can say sudo system CTL restart and that's sshd so let's run that and that restarts our SSH service okay so now before we get to the flask deployment we are going to set up a firewall but this is going to be very quick here this is pretty simple so first we want to do an installation so I'm going to say sudo apt install and this is called ufw and this stands for uncomplicated firewall so I'm going to run that and once that's installed we're going to set up a few rules here now this is called uncomplicated firewall because this is a lot easier than some of the other options like IT tables or anything like that so the rules that we're going to set up we're just going to do a pseudo UFW default allow and we're going to allow outgoing traffic so I'm going to run that and now I'm going to hit the up arrow here and do a pseudo ufw default deny incoming traffic so now we want to configure a default deny rule or I'm sorry we're going to want to configure allow rules for certain ports because configuring a default deny rule like we just did can lock you out of your server unless you use explicit allow rules so we want to be sure that we have configured these next allow rules to allow for SSH and HTTP and things like that and any port that we want to access from the outside of our server so I'm gonna say sudo ufw allow SSH now this one is definitely important because if we don't allow SSH then we're not going to be able to SSH into our server so you definitely want to do that one so now let's also allow access to port 5000 for now now port 5000 if you remember from earlier in the series is the port that flask development server runs on so we're going to test this before we actually go live with it on port 80 so let's allow that port 5000 so that we can test that on that port so I'm going to do a sudo ufw allow 5,000 and now let's not allow port 80 or HTTP traffic yet until we're sure that everything's working the way with it we want it to and we will allow that port later in the video so right now I'm going to enable everything that we have just said so I'm going to do a sudo UFW enable and run that and it says that the command may disrupt existing connections hopefully we remembered to allow SSH connection so I'm just going to say yes okay so we're still logged in so that's good now if you want to see the status of the things that you've allowed and disallowed you can go to sudo UFW attis and that'll show you everything that we've allowed so port 22 here is SSH and we also have port 5000 here ok so that is all of the server setup type of stuff so now we're ready to deploy our flask application so first we want to put our application on our web server now there are multiple ways that we can get this application to our web server so if we have it checked into a git repository then we could simply do a git clone here into our server if you're using an FTP client like filezilla then you can just simply copy it over to your server since we're already using the command line in this video I'm just going to use the bash terminal to do this so I'm going to clear my screen here on my server and now let me open up my terminal here on my local machine now before we push our flask application to our server if we're using a virtual environment then we're going to want to create a requirements txt file that captures everything that we need to install for our flash project to work so I am in a virtual environment here on my machine this is the virtual environment that I used throughout the entire series if you're not using a virtual environment then you'll just simply have to pip install everything that you used on the server manually but if we are using a virtual environment then we can see everything that we use in our project by running pip freeze if we run pip freeze then this shows us all of the dependencies for our project that we've installed so you can see here we have bcrypt we have flask obviously we have flask WTF which is the forms Jinja 2 which is the templating pillow which does our images and these also give us the exact versions of those packages as well so that we're sure that everything on our server matches every packaged version in development now if you're on Windows then you can create a requirements txt file and just paste in all of the info from this pip freeze command but if you're on Mac or Linux then we can just create our requirements txt file by saying pip freeze and then we can put the Khan hence of that pip freeze command into requirements that txt okay so now I just created this requirements txt file on my machine and I'm in the home folder of my machine here so I'm gonna open up my file explorer here and open up both of these windows so this is my home folder here and here's that requirements that txt file and here is my flask blog this is our flask project that we've been making throughout this series so I'm just going to drop that requirements txt file into that flask blog okay so now that we have that requirements file now let's put our flask application on to our webserver now since I'm using bash I'm going to use the same SCP command that I used earlier to copy up our keys but if you're not using bash then again you can use something like FileZilla or get to get your project folder onto your server but for me I'm simply going to say SCP R that's for recursive that means that we're going to move over an entire directory so I'm gonna say R and that is what this is on my desktop so on my desktop flask blog I'm just going to move over that entire folder and we're gonna move that to quaerimus at and now the IP address so you're gonna want your user here and now your IP address my IP address is 4 5.3 3.1 to 3.2 1 4 and now we want the colon and the colon we can specify an exact location for on this machine so I'm just going to put it in that users home folder by saying tilde ford slash so let's run that okay and it looks like it copied everything over for us so now let's check that that's there on our server so I'm going to minimize our local machine here and go back to our server so you can see how this is useful having these two windows open because otherwise you'd have to be exiting an SSH edging back into your server and local machine all the time okay so now that we're back on our server here let's run the LS command to see if we have our directory so we do have our flask blog here so that's good so now we have our flask application on our web server so now we're ready to get it running on here so first in order to do this we're going to have to create a virtual environment on our server we don't want to use the default Python that's running on our Linux system we always want to use a virtual environment when running on our server so to do this we're going to want to install a few things so I'm going to say sudo apt install and we want to install Python 3 pip now make sure you have the 3 there for Python 3 otherwise it will install for python 2 so we're gonna do the sudo apt install python 3 pip and once that's finished I'm going to clear my screen here and now I'm going to install sudo so I'll do a sudo apt install and I'm going to install Python 3 ve + V and this will allow us to create virtual environments so let's run that and this should install fairly quickly ok so now that we have those two packages installed now we can create our virtual environment so I'm just going to create this virtual environment inside of our flask project so I'm gonna say Python 3 M V in V and this will create a new virtual environment now we just have to specify where we want that virtual environment so I'm going to put this within flask blog and I'm gonna call this virtual environment ve and V so I will run that command and that should have created that virtual environment so let's check so I'll do a CD in the flask blog and now we do an LS we can see that we have our you know project directory flash blog our requirements file run dot PI but we also have this V env directory so that's our virtual environment so in order to activate that we can simply say source V E and V Forge slash bin forge / activate so I'll run that and now our virtual environment should be activated and a good hint is here at the beginning of our prompt in parentheses here it says V env so our virtual environment is activated so with that activated we can now install all of our requirements for our project so in order to and stop install all of the dependencies from the sort of crime at txt file we can simply say hip install R and after we do the our we put the path to the requirements txt file so it's just here in the same directory so I can just say requirements txt so if I run that then it's going to install everything that we need for our application okay so that should have installed all of the Python packages that we need for our application so now we want to test our website using the development server and make sure that it works using that development server before we install nginx and G unicorn but before we test this there are a couple of variables that we first need to set so if you remember on our local machine we set some environment variables for our secret key our database URL our email user and our email password for our password resets and we're going to need to set those on our server before our application will work properly now on our local machine we used environment variables and we could use environment variables here as well but I think that sometimes environment variables can be a little tricky when working with different web servers so instead let's just create a configuration file with all of our sensitive information and we'll load that into our application instead of our environment variables so first I'm going to go back to my local machine and grab the values of those environment variables so that we can add them to our server so I'm going to clear my screen here on the server and now I'm going to open back up my local machine here now there are a couple of different ways that we can get those environment variables now if your flask environment is activated then you should be able to grab all of those just by using Python so I'm just going to put Python here to open up our Python command line and now I'm going to import OS and now we want to grab our secret key so I'm gonna say Oh s dot environment and we want to get that secret underscore key so that is the secret key that we used for this project so now I'm going to want to do the same thing except I'm also going to want the SQL alchemy underscore database underscore URI so let's run that now if you're wondering what all environment variables you need we set all of these in our flask configuration file so if you look in that flask configuration file you should be able to see where you're using these environment variables it should say oh s dot environment or dot get and then secret key sqlalchemy database URI and etc now we also need to grab our email user so email underscore user and also our email underscore pass so my email user is just my email address now my email password I'm not going to actually hit enter here and show my email password for obvious reasons I don't want people to be able to log in to my email but our offcamera I'm going to grab this email pass value here as well and put this within the configuration on my server okay so now that I have these printed out here I'm going to go back to my server and I'm going to create a config file so I'm going to say sudo touch and touch will create a file I'm going to create this in forge /e TC ford slash config dot JSON now I'm calling it config dot JSON because this is going to be the only flask application that lives on this server if you need to differentiate between multiple flask applications then you could call this you know flask blog config or something like that instead then I'm also using JSON for this file but if you're more comfortable using Gamal or something like that then you can use that as well so I'm going to create that file and now I'm going to edit that file so sudo nano et Cie config dot JSON fig JSON okay and within this file we're going to create JSON here so we need these opening and closing curly braces and first we want to create a value for secret key so the value for our secret key that needs to be in double quotes I'm going to go back to my local machine here I'm just going to grab that value from our local machine and go back to our server and paste that in and then put in a comma here and now I will do the same for I'm actually going to copy this key because it's a long one SQL alchemy database URI let me move this over just a little bit here okay so I will paste that in for the key and the value for that key was let me move this over a little bit here the value for that key was just our simple SQL Lite database so I will paste that in and don't forget your comments here after these key value pairs in your JSON so now we need our email user and our email pass now you're going to put in your email user here and your email pass now I'm not going to put those here in this video because that is sensitive private information for myself but off video I'm going to put those values in so that we can see how the password reset functionality works on our server so I'm just going to save this file so I'll hit ctrl X Y to save and then enter and now I'm going to pause the video and go back in to that config dot JSON and I'm going to put in my email username and my email password so that that functionality works here the server I'm just not gonna show it on video so I will resume the video once I finish with that okay so I went back in that config file and I put my email user and my email pass so now whenever we test this that reset password functionality should work with our email service okay so now that we've created this config dot JSON file now we're going to want to edit our config file in our flask project and set those values so I'm going to do if we do an LS here on our flask blog you can see that this flask blog directory here contains our other project files so I'm gonna do an LS on flash blog and you can see that that is where our config PI file lives so I'm going to edit that file so I'm gonna do a sudo nano flash blog config dot PI and within this file here at the top I'm going to import JSON since we're now using JSON instead of environment variables and also here at the top I'm going to load in those values so I'm going to say with open and we're going to open that file that we just created and so this is the path so as in 4/8 ici ford slash config dot JSON and we will open that as config underscore file and now within here we will say config is equal to json dot load and load in that config file now when you use JSON load on a JSON file what that doesn't Python is it makes this variable here a Python dictionary so now this Python dictionary called config is equal to all of the key value pairs from our JSON config file so now here at the bottom parts of our file let me scroll up here a little bit everywhere that we're using environment get we can now use config dot git since config right here is a dictionary with those configuration values so instead of OS not in firing I'm going to say config dot git so we're doing config dot git on the secret key we're going to do a config dot git on the SQL alchemy database URI and we are going to do a config dot get on the email user and on the email pass okay so once that is done I'm just going to save that file so since I'm using nano that's control X Y to save and then enter okay so now we're ready to actually test our application and see if it works on our server so there are a couple of ways we can test the application let me clear my screen if you remember we can do a if I do an LS here on our project we can see we have this run dot pi if you remember I usually do this Python run PI but if I do a cat on that file and print out the contents of that file then we can see if I run that then it's just going to do an app dot run of debug equal true but I actually want to set our host equal to zero zero zero zero and what that'll do is that will expose it to the outside world so to do that instead of doing python run pi i'm just going to do like we saw earlier in the series and I'm going to use flask run now if you remember in order to use flask run I have to do an export of our flask project so I'm going to do an export and this is just going to create a temporary environment variable so that we can test this so I'll say export flask underscore app is equal to and there's no spaces here so is equal to run dot pi because that is what contains our application so now that we've done that export flask app equals run dot pi now I can simply do flask run now don't hit enter yet instead of doing flask run we also want to set the host so I'm going to set the host equal to 0 0 0 0 and that will allow us to access this development server from the outside so from our browser so I'm going to run that and it should spin up our server so we can see that it's running one our IP address one port 5000 so now if I open my browser here then whoops let me actually open up my other browser here so now I want to go to my IP address at port 5,000 so my IP address you're going to want to use with yours mine was 4 5.3 3.1 to 3.2 one 4 now if we just go to that IP address then we're not going to get anything because port 80 currently isn't open on our firewall so you can see it says the site can't be reached so to go to a specific port we want to put in 5,000 to go to port 5,000 if I run that then you can see that we get what seems to be our application ok so it looks like our application is working but we're always going to want to do a little bit of testing here so to make sure that the functionality is working let's try a couple of things so let's go to login and see if we can log in as a current user so I will try to log in as my Cori em Schaefer user it looks like that worked logout that seems to work let's go to register and try to create a new user so I'm going to create a new user here and just call this deployed user for the email I'll do deployed user at test comm password I'll just do testing password testing signup and that seemed to work so now let's try that so deployed user at test comm testing to log in that seems to work let's try to create a new post deployed post and I will copy that and post that so it looks like that worked see if we can update a post updated deployed post that works let's try to delete a post so if I delete a post that seems to work as well let's see if we can change our profile picture so right now we just have this default profile picture I will try to choose a new picture here just choose one from my desktop update that and that seemed to work okay that's good and let's also test that our email is working so if I go to login forgot password if I say that I forgot my password for my Cory M Schaffer gmail account if I run that then it says an email has been sent with the instructions and reset your password I actually have my gmail opened up here and we can see that I got the password reset request here so if I click on that then we can see that I got my password reset link and I can now change my password so instead I'll change that to testing one two three instead of just testing and if we log in with that new password testing one two three then that seems to work okay so everything all of our functionality for our website seems to be working so that's good but if we go back to our server here we are running a development server on our live production server this is not what you want to do this is great for testing but you don't want to go live with this and send this URL out using a development server it's a development server for a reason it's not meant for you know a lot of performance and to be hit by a lot of people so that's why would you use something like engine X and G unicorn because those applications are you know do allow for high traffic and for good performance so now we're going to want to get our application working with engine X and G unicorn but this is a very good sign that it's currently working in our development server so now I'm going to contain control C and clearing my screen here and now let's install nginx and G unicorn so I'm going to CD back to my home directory just so I have more room here to work with and now I'm going to say sudo apt install and we're going to want to install engine X so let's run that and once engine X is installed then I will clear my screen here and now we want to install G unicorn so we can actually install G unicorn with pip so I can do pip install now you're gonna want to make sure that you are still within your virtual environment here so make sure that you haven't deactivated that because we'd want to install gene unicorn in that virtual environment so I'm going to do a pip install G unicorn so we will run that okay and once that's installed we just need to change a couple of configurations with nginx and with G unicorn and we will be done so first of all we're going to update the configuration file for engine X so the way that engine X and G Unicorn work together is that engine X is going to be our webserver and it's going to handle the requests such as static files and things like that it's not actually going to handle the Python code it's going to use G unicorn to do that so we're going to allow engine X to handle you know like the static information like the CSS files and JavaScript and pictures and things like that but when it comes to handling Python code we're going to pass that off to G unicorn so in order to do this first let me clear my screen here first let's remove the default engine X configuration file so I'm going to say sudo RM and this was was is in ford slash et Cie engine X and sites enabled sites enabled and default so we're just going to remove that default file and now we're going to create a new file so this is going to be sudo nano and we will so this is going to be in /e TC forged slash nginx porch last sites enabled and we will call this flask blog so let's run that this is a new file this doesn't exist yet so it's going to be completely blank so now to create an engine X configuration file we're just going to say server and then in these curly braces here we will say listen on port 80 and you're going to want to remember these semicolons here I know that Python code we're not used to putting in semicolons but here you have to remember that so now we need server underscore name and that is going to be equal to four now it's just going to be our IP address so my IP address you're going to want to put in yours mine is four 5.33 dot one two three two one four semicolon and now we're going to forward all of our static files so our CSS and JavaScript and our pictures and stuff like that we're going to let nginx handle that but we need to tell nginx where those are located so I'm going to say location ford slash static and then another pair of opening and closing curly braces so for location static that is going to be alias so alias to ford slash home and then your user name my user name is corey ms but you want to put yours and then your project flask underscore blog and now the location our static directory so within that flask blog directory I have another directory called flask blog that holds our project files and then there's a static folder within there so you're going to want to put the location to your static folder but it should be something like that if you've been following along with this series okay so having that in place now we're ready to forward all of the other traffic to G unicorn so now we can say location and just do a ford slash and then some opening and closing curly braces here now I am going to put this file this engine X configuration file I am going to put this on github if you're worried about miss typing any of this so I will have this up on github so that you can use that as a reference okay so at this location here at this root location basically this means if we go to our IP address then this is what's going to happen so we're going to do a proxy underscore pass and then we're going to pass this off to G unicorn now by default G unicorn runs on port 8000 so I'm just going to say do a proxy pass HTTP forge / localhost so our localhost is the server in this case on port 8000 so that will forward all that traffic to G unicorn and let that handle the Python code now there's also a couple of other things we're going to want to add in here that just passes some extra variables for that proxy so to do this we're just going to say include and we're going to want to include this file here /e TC flurried / nginx forge / proxy underscore programs and put a semicolon there and then we will also do a proxy underscore redirect off and then a semicolon now there are all kinds of things that nginx can do if you want to know any more details about any of this stuff then I would highly suggest looking at the engine X documentation and it'll explain in more detail what a lot of this stuff is doing but this should be good for our engine X configuration file so I'm going to save this so since I'm using nano I hit ctrl X Y to save and then hit enter okay so in our engine X configuration file we said that we were listening on port 80 so if you remember we haven't actually opened up that port on our firewall yet so let's go ahead and do that now so I'm gonna say sudo UFW our uncomplicated firewall allow and we will allow HTTP TCP traffic so it said that it added those rules and since we are done with our testing we will also disallow any traffic on port 5,000 since that was our testing port so I'm going to say a sudo ufw delete and I will delete the allow of port 5,000 so again I'll make sure that that is enabled so sudo ufw enable and hit Y for yes okay and now we want to restart our engine ax server so I'm going to say sudo systemctl restart engine X okay so that restarted our nginx server so now I'm going to clear my screen so now our engine X server is running but G unicorn is not running so our server is not going to know how to handle that Python code so if I go back to my browser here and I try to reload this page then it's not going to work so if I just let this spin up here it'll give me an engine exair eventually and I'm actually still on port 5000 here so that's not going to work at all and actually instead of using regular Chrome here I'm gonna go back to using my incognito because incognito if you don't know it doesn't cache things like h or CSS and things like that so it's easier for development so if i run that then you can see that we got a 5 i too bad gateway and we can see that this is an engine X error here now that is because it's listening on port 80 so we got in contact with nginx but it doesn't know how to Ford Python code so we have to run G unicorn so the engine X Forge this request to G unicorn and then G unicorn knows how to handle that Python code now we can access our static files so if we try to access like one of our CSS files I can go to forge slash static forward slash main dot CSS that should be working because that is just nginx handling that information so we can see that we can see our CSS code here so that works but we need to run G unicorn in order to get the Python code working so let's go back to our server here and now let's get GE unicorn working now to run G unicorn it's actually a very simple command we can just run G unicorn and then we can also run some workers here so I can say dash W and then the amount of workers so I can say three and then we want to specify the file that has our application so the module that contains our application variable is run dot PI so we can just say run and then a colon and then the variable name of our application so the variable name in our application is app now I'm not going to run this yet because I actually have to change directories here but first of all let me also explain the workers here so a lot of people say ok how many workers do I need to run for my machine well if you look in the G unicorn documentation then they say that the number of workers should be two times the number of cores on your machine plus one so in order to see the number of cores on your machine it's pretty easy to figure that out in Linux one way you can just do an in Prague all and remember we got the Nano done of the node here which is your cheapest version so I just have one core here so that's why I chose three workers because that is two times our number of cores which would be two plus one so that's how you figure that out if you're interested okay so in order to run G unicorn here I'm going to actually CD back into my flask blog and now if I do an LS we can see that we have run PI here now let me cat out the contents of that file and you can see that within run PI we have app equal to our create app and that's what creates our flask application so to run that G unicorn code again again it's G unicorn and I'm going to use three workers and that is within the run module and that variable for our application is app so if I run that then we can see that it says that it's listening on our localhost at port 8000 and that it booted up three workers for three different processes so now if we go back to our browser here and reopen this in our browser you can see that now we are just going to our IP address and nginx is forwarding that traffic to G unicorn and G unicorn is handling this Python code so now our website is working in production okay so I'm not going to go through all the same tests that I did before but we can see if I just you know try to log in we can see that at least that is working so it seems to be working well so far but there is one more thing that we want to do this isn't quite ready for production just yet because if we looked at our server you know this isn't really good the way that this is running here because this is running in the foreground we can't do anything on our server here this has to remain open so if I was to close my server so if I hit control C and stop that then we just killed G unicorn and if I run try to reload the page this isn't working anymore so what we need is something that is constantly monitoring G unicorn and making sure that it's running and will auto start it and auto restart it if it crashes and things like that so in order to do that we're going to use some software called supervisor and this is very easy to use on Linux so to install supervisor I'm just going to say sudo apt install and this is called supervisor so let's run that and install that I'll say yes ok and once that is installed we just need to set up a quick and easy configuration file for supervisor so to do this will say sudo nano and this is going to be in /et see Forge slash supervisor conf dot D and within comp D we're going to create a configuration file so this is going to be flask blog.com sorry that this is running on the other line here I know that that makes it hard to read but I called this flask blog.com so if we run that then now we have a blank configuration file here and I'm gonna put this file up on github as well but to create a supervisor configuration file here first we can just put these square brackets first we want to say program and the name of our program so I'm just going to call this flask blog and now we want to put in a few variables here so I'm gonna say directory so directory is where this is going to run a certain command from so we want to run a command from our flask project so this is in fort slash home slash CMS you're going to want to put your user name there and mine is called flask underscore block and now we to put in the command that we want to run so the command that we want to run from that directory is G unicorn with three workers and then run app now if you remember G unicorn is actually in our virtual environment and we're not going to activate the virtual environment here from within our configuration file so instead you're going to want to put in the full path to G unicorn and that is just within the bin folder of your virtual environment so this is gonna be a little long here but this is within our home directory of our user and that is within flask blog is where I put that virtual environment and that virtual environment is called V E&V and within the bin folder of that virtual environment that is where the G unicorn command lives so we want to run that command with three workers so I'll say W three and remember that is just we want to run that on the run module and app is the name of our application so now a few more things here we'll say user is equal to core EMS we want to do an auto start equal to true that means that the that supervisor will make sure that this auto starts we'll set an auto restart equal to true that is if it crashes for any reason then it's just going to start it right back up now we also want to do a stop as group make sure that spelled right equal to true and a kill as group equal to true and that's just going to help you know if we stop or kill this it's going to help wrap up any child processes now we also want to do some air and log files here so I can say st de r r so standard air underscore log file is equal to and we will create this log file in a second but we will put this in ford slash bar /log ford slash flask blog ford slash let's say we'll just call this flask blog dot e RR dot for our error log and I'm going to just highlight this and copy it so I don't have to type all this out again paste this in and for our standard out I'm just going to call this class blog dot out dot log and back here at the beginning this is going to be the standard out log file okay and that is it and again I'm going to put this on my github repository if you want to check and make sure that all of this looks good if you want to you know look at this on the github page so I will hit control X Y to save and hit enter and now we want to create those log files really quick so in order to do that I'm just going to say sudo make Durer and I'll do a P a P will create any directory in the chain if none of them exist so I'll say bar log flask blog and now we called those log files so I'll do a sudo touch we called those that was within port slash var slash log flask blog we called that flask blog dot e RR dot log so I'll run that and I'll hit the up arrow here we also want to do flask blog dot out dot log so I'll run that okay so now that I have all of that in place I'm just going to restart our supervisor so in order to do that I'll just do sudo supervisor CTL reload so if I run that we can see that it restarted supervisor so now if we reload our page in the browser here sometimes it can take a while for a supervisor to start up that process if I run that now we can see that it's already working so now if you wanted to then you could go through and check that make sure all of this you know functionality is working correctly so you know if I go in here and change some pictures and try to update this we can see that that works we can create new posts so if I run that new post we can update and it's always good to check this functionality just to make sure that nothing is off so one thing that you might notice here if I go and change my profile picture now that we're using nginx as a webserver engine X has some defaults that you might not expect so you could get some unexpected things with your application and that's just kind of knowing your webserver so for example if I choose a really large file here so I have a file on my desktop called large JPEG if I open that and I try to update that as my profile picture if I do that you can see it's gonna spin here for a little bit and then it's going to give me an inch and X error and it says four one three requests entity two large now this is an engine X default it won't accept client you know upload sizes over I think it's two megabytes and I think that that to that picture is 2.8 megabytes now if you want to change this you might not even have that need for your application so if you don't have the need then that's completely fine but if you do have the need and you need to change that then here within our server I'm gonna clear the screen here you can update that by going to sudo nano that's in forge /et c ford slash engine x forge slash nginx kampf so within here if we scroll down to HTTP then I am going to just come in here past at the bottom of the basic settings here and you can just set a variable called client underscore max underscore body underscore size and I'm just going to set that to five megabytes so you can set that to whatever you want to set it as if you remember the application that we created in this video automatically resizes large uploads to a smaller upload anyway so I will save that and then you can restart engine X by doing a sudo system CTL restart of nginx so now if I go back to my account page and try to upload that same large file again then we can see that this time it worked and if I open the picture in a new tab then we can see that it's a small picture anyways because our web application that we created takes those large images and resize sizes them down to I think 125 pixels is what we chose okay and real quick just to make sure that the password reset is working as well you know that's something that is easy to to not work sometimes so I can go to forgot password type in our email address and request that password reset so if I open up my email address here so I'll go back to my inbox and we can see that we have a password reset and go there and that whoops let me click on that reset link help and I don't think that that worked because I was still logged in here when inside of this browser so if I log out in that browser and then go back using that reset link you can see that now that that works so testing one two three yeah so that seems to work okay so let me go back to our home page here so now that we're using supervisor if I completely log out of my server so I'm back here on the server if I just go to exit and I can just close down my all of my terminals completely if I close all of those down then we can see that I can you know do a hard refresh on my pages here and this is all still working so we have a completely functional website that is working on our IP address that is fully deployed at this point now there's still a lot more that we could do in future videos if you're interested so right now we only have an IP address but if you want then I could also walk through the process of buying a domain name and how to get that domain name to go to this server that we've set up we could also see how to add SSL certificates so that we can have an HTTP domain name that's actually something that I still need to do for my personal website as well I'm still using HTTP now I'm actually going to delete this server after this video so if you go to this IP address here then you're not going to see this website so if you go to this IP address then that's why you won't see this so if we do continue this series then I'll spin this server back up with a different IP address when I record more videos for this series now actually let me go ahead and delete this server on this video so that if you're following along then you can do this as well so that you're not charged for it so let me go back here to my Leno to probably need to log back in no it looks like I'm still logged in here so that's good now if you want to completely delete your server then you can just go to your lenosky R and over here on the right you can click on this settings menu here and you can go down to settings and once you're at settings you can see at the bottom here we have delete the node so you could click on delete and then it's going to ask you are you sure that you want to delete this because it's going to result in permanent day loss everything that we did in the video is going to be done so you can delete by clicking that there I actually think that I'm just going to power this off for now so I'm just going to say power off instead and I will delete that later now like I said at the beginning of the video the node was actually kind enough to sponsor this video and I've used them for many years and have recommended them the people long before I even had any sponsors so if you get a chance I would highly recommend giving them a shot so like we saw earlier in the video they have this new and improved cloud management system that makes spinning up a server fast and easy you can choose from available images and you can even upload your own custom image if you'd like and if you're doing something that's fairly common they even have stacks scripts that allow you to spin up a server with all of the relevant software already installed and ready to go so for example if you're making you know like a WordPress site or something like that then you can simply choose their WordPress stack script that spins up a server with WordPress ready to so if I was to click here on the node and then here at create an image if I instead go to create from stack script and then go to the node stack scripts we can see that their WordPress stack script is the top one here and it says a ready to rock WordPress install using the latest release from wordpress.org so that is pretty neat that they have these images that are just ready to go like that look and it looks like I need to log back in here now they also have nine worldwide data centers so far and they have two more set to open in 2019 so no matter where you are you should be able to spin up a server close to your audience so if you want to check them out then feel free to use my referral link in the description section below and you can get $20 of free credit applied to your account to try them out okay so with that said I think that is going to do it for this video hopefully now you have a good idea of how you can deploy your flask application to your own Linux server like I said before this option takes a little more effort than some of the other options out there but having your own virtual private server gives you so much more flexibility and room to grow with your application and it also provides some terrific knowledge for learning more about back in at Linux systems and that's something that you know employers really look for nowadays and something that would really shine on a resume but if you have any questions about what we covered in this video then feel free to ask in the comment section below and I'll do my best to answer those and if you enjoyed these tutorials and would like to support them then there are several ways you can do that the easiest ways to simply like the video and give it a thumbs up also it's a huge help to share these videos with anyone who you think would find them useful and if you have the means you can contribute through patreon and there's a link to that page in the description section below be sure to subscribe for future videos and thank you all for watching you you
