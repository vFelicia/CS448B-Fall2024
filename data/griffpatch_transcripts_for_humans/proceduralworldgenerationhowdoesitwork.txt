With timestamps:

00:02 - hello fellow scratchers i'm griff batch
00:05 - and today we are talking about 2d
00:06 - landscape generation two examples of
00:09 - this that i'm better known for can be
00:10 - found in the game's paper minecraft and
00:13 - terraria stamped
00:14 - both of these games are able to generate
00:16 - seemingly random yet exciting worlds out
00:18 - of tiled blocks and i know a lot of you
00:21 - would love to know just how it was done
00:24 - well this is the first video i've made
00:26 - on the subject and what i want to do
00:28 - today is step you through the process i
00:30 - have used successfully in both of these
00:32 - games to really bring these virtual
00:34 - environments to life let's begin by
00:36 - taking a walk about a paper minecraft
00:38 - world
00:40 - and here we are yes it's paper minecraft
00:43 - instantly recognizable from the classic
00:45 - minecraft textures and the plain sky
00:47 - block size is quite large 40 pixels
00:50 - square if i remember correctly which
00:51 - means we see just 75 full tiles on the
00:55 - screen at once view distance was always
00:57 - rather limited but to counter this i
00:59 - added mouse look around so you can see a
01:01 - bit further ahead
01:03 - so the basic surface of the terrain is
01:05 - made up of dirt blocks
01:07 - topped with a single layer of grass the
01:10 - ground is very flat with just a few ups
01:12 - and downs here and there
01:14 - on the grass grows the odd plant and aha
01:17 - a tree awesome wow there's a lot of
01:19 - animals in this level ha even spawning
01:21 - animals is an interesting subject of its
01:23 - own
01:24 - ah a village i can't tell you how funny
01:26 - it was when i first introduced the
01:28 - village house spawning eggs into paper
01:29 - minecraft being able to pop down a house
01:32 - run away a bit and watch a house pop out
01:34 - of nowhere was such a laugh the level
01:36 - generation just made use of this popping
01:38 - down a number of house eggs and voila a
01:41 - whole village is born okay now so i've
01:43 - already dug a hole down here to show you
01:45 - the basic underground cave
01:47 - falling down past some coal oh zombie
01:51 - and we're down and right away we have
01:53 - some lava that's cool
01:55 - i'm in creative mode so i can safely
01:58 - explore
01:59 - this is a naturally formed cave typical
02:02 - in paper minecraft deep caves tend to
02:04 - have lava flows from the ceiling the
02:06 - height of the cave is between two and
02:07 - four blocks and it runs in any direction
02:10 - even vertically for short periods okay
02:13 - oh wow we've stumbled upon a hidden
02:15 - dungeon area with its chaser test an
02:18 - unexpected treat for us oh go on let's
02:20 - snag the crown yeah i rule
02:23 - okay then so i'm thinking this is where
02:26 - the cave system ends right time to turn
02:28 - on x-ray mode that makes everything
02:30 - visible to us now and oh wow the cave
02:33 - does actually continue on
02:35 - but not for long we hit bedrock
02:38 - so what i want you to notice is just how
02:40 - simple the level design underground is
02:43 - it's mostly rock scattered with patches
02:45 - of oars and cut up here and there by
02:48 - wiggling cave systems added to this we
02:50 - have the water and lava flows a
02:53 - splattering of special level features
02:55 - surface grass and trees
02:57 - but mainly what the main craft level is
02:59 - made up of is loads and loads of
03:02 - featureless rock as we speed through we
03:05 - find patches of ores and these tend to
03:06 - be rough circles of various sizes they
03:09 - can look a little odd when seen in x-ray
03:11 - mode but as soon as the lighting engine
03:13 - comes on they look quite natural
03:15 - right so minecraft levels don't have a
03:17 - lot more to them than this sure it has
03:20 - biomes and a few more surface minibiomes
03:23 - like lakes and sand but there's not a
03:25 - lot more to it
03:27 - so
03:28 - let's stop there and take a look at the
03:30 - more ambitious project terraria stamped
03:34 - just like with paper minecraft the game
03:36 - begins with a world generation phase and
03:39 - the levels are generated in much the
03:40 - same way however the scale of the world
03:43 - is far more detailed you can see right
03:46 - away that the tile size is so much
03:49 - smaller these tiles are just 8 by 8
03:51 - pixels you could fit 25 of these inside
03:54 - a single paper minecraft block
03:57 - what's more there are actually five
03:59 - layers of tiles a background a wall a
04:02 - liquid tile a foreground tile and a
04:04 - brightness tile this leads us to having
04:06 - to draw almost 3 000 tiles for every
04:10 - screen
04:10 - remember in paper minecraft we only
04:12 - needed 75 to do the same job
04:14 - so yeah this is way
04:16 - way more demanding and that is why
04:19 - tavares stamped could not be a scrolling
04:21 - game
04:22 - but this extra detail means we get to
04:24 - see the level generation in far more
04:26 - detail which is why i wanted to focus on
04:28 - this engine as i describe how everything
04:30 - works
04:31 - as you can see we again have a mainly
04:34 - dirt based ground layer but due to the
04:36 - smaller block size the slope or curve of
04:38 - the ground is more pronounced
04:41 - grass is growing on the edges of dirt
04:43 - but isn't limited to the top blocks like
04:45 - in minecraft it also grows on the edges
04:47 - and bottoms of tiles too what does grow
04:50 - on the top are the extra grass shoots
04:52 - and flowers and also these marvelous
04:54 - trees
04:58 - talking of which i want to show you the
05:00 - exciting cave that i can see here below
05:02 - me so i need some wood to make a torch
05:05 - let's chop down a tree
05:08 - okay i'll craft a few torches
05:11 - and off we go
05:14 - place a torch and look at how the light
05:16 - spreads outwards i love that have you
05:19 - watched my pathfinding tutorial there's
05:21 - a link under this video because the
05:22 - spread of light here follows exactly the
05:24 - same rules as the pathfinding scripts so
05:27 - you might want to watch that again and
05:29 - see if you can see why this might be
05:32 - now do you see how we have vines growing
05:34 - down from the roof of caves that is so
05:36 - cool right and also we have wall tiles
05:39 - underground behind me hiding the sky
05:42 - this makes the underworld much more
05:44 - atmospheric
05:45 - the cave wiggling walls are well defined
05:48 - here and ah you can see some stone
05:51 - showing through too
05:52 - ah okay before we get deeper into this
05:54 - cave let me just take you back to the
05:56 - surface and finish exploring that we
05:58 - should find a small lake each level has
06:01 - a lake and a cave to be found
06:03 - yeah here it
06:04 - is and oh wow i can see an awesome cave
06:08 - just under the surface too
06:13 - and yeah this is as far as the level
06:15 - goes sadly unlike with paper minecraft
06:17 - we can't skip off to another biome by
06:19 - walking off the edge of the level
06:21 - gosh this is just too tempting i am
06:23 - going to break through the floor of this
06:25 - lake
06:26 - i love these sandbox simulations
06:29 - [Music]
06:35 - oh no oh the fishy help them i don't
06:38 - have a net to catch them with
06:43 - of you it's okay he's safe panic over
06:46 - right now that we have seen the surface
06:48 - let's pull up our terraria map yes we
06:52 - have a map introvert just press f and
06:54 - there we go the cross marks where we are
06:57 - right now okay this is really useful as
06:59 - we can see the shape of the terrain do
07:02 - you see the undulating curves of the
07:04 - grass what remains of the dugout lake
07:06 - oops and the beginnings of the cave
07:08 - system to the right
07:09 - even the tree stumps are nicely visible
07:12 - now if i switch into creative mode and
07:15 - bring back the map
07:16 - and this this is why i wanted to use the
07:19 - project to explain level generation now
07:22 - we can see everything every pixel on
07:25 - this screen is a tile in the game world
07:27 - that is a lot of tiles yes over one
07:30 - hundred thousand of them
07:32 - so what are the main components that
07:35 - make up etiva map
07:37 - we have solid land and sky
07:40 - the land has a peaceful up and down
07:41 - curve going on but then here and there
07:44 - are small bites taken out of it for
07:45 - interest a larger bite on the surface is
07:48 - filled with water or at least it was
07:50 - before i drained it
07:52 - ignoring the caves for a moment and
07:54 - looking behind them you'll see the top
07:56 - third of the ground is mostly dirt with
07:58 - a splattering of large stone blobs
08:00 - but from two-thirds down it reverses and
08:03 - the ground is stone with splashes and
08:05 - streaks of dirt
08:07 - breaking all of this up we have the
08:09 - capes and notice the crazy shapes they
08:12 - appear in like blobs slashes zigzags
08:15 - vertical and horizontal and all over the
08:17 - place some wide some narrow it looks
08:19 - crazy but this is what makes exploring
08:21 - the game so exciting you just can't
08:24 - predict it
08:25 - after this all that remains are the
08:27 - mainly smaller dots of oars and gems the
08:30 - areas of water how can i forget these
08:32 - and these quite exciting underground
08:34 - abandoned houses for you to stumble
08:37 - across deeper underground
08:40 - okay come on before i let you in on the
08:43 - secret of how this was generated let's
08:45 - just check out what it looks like deeper
08:47 - down underground back into the cave and
08:50 - now in creative mode i can dig really
08:53 - fast let's go straight down
08:55 - [Music]
08:59 - it's getting dark so i'll place a torch
09:04 - the light leaks through quite a few
09:06 - layers of dirt before it fades out
09:09 - oh cool we've broken through into a cave
09:12 - yeah look here we are on the map see my
09:15 - new tunnel
09:16 - looks like this isn't a very big cave
09:18 - but it's a cute little ecosystem with
09:21 - water and a squibble
09:23 - right back up we go
09:26 - exploring these caves is quite dangerous
09:28 - when you start out in terraria it's
09:30 - better to build yourself a safe house to
09:32 - begin with on the surface die slime
09:35 - [Music]
09:39 - ah nice an underground chest these
09:42 - contain cool booty i'll take that
09:44 - boomerang
09:45 - notice we've reached a depth in the
09:47 - level where the background wall has been
09:49 - replaced by an underground theme we can
09:51 - no longer place torches on this which
09:53 - makes things a bit harder
09:56 - yeah these larger vertical drops are
09:58 - very difficult to climb back up when we
10:01 - start out in survival mode
10:03 - do you see how exciting the cave system
10:04 - is i think it's far more fun to explore
10:07 - than the more simple minecraft caves but
10:10 - as far as world generation they are
10:12 - actually done very similarly
10:14 - this is just on a grander scale
10:17 - now at this depth the green vines stop
10:19 - growing and we will see no more grass
10:22 - but ores become more common we do have
10:24 - to watch out for more difficult mobs too
10:27 - though and it's a lot further to get
10:29 - back up to the surface if anything goes
10:30 - wrong hey just look at the shape of this
10:33 - cave isn't it complicated and cool
10:35 - looking can you even imagine how this
10:38 - could be generated randomly and
10:40 - automatically it's hard to believe but
10:42 - it wasn't actually as difficult as you
10:44 - may think now watch this let me turn on
10:47 - x-ray mode
10:49 - wow and everything is revealed now the
10:52 - interesting thing here is how flat
10:54 - everything suddenly looks and although
10:56 - the cave is still pretty awesome in
10:58 - detail it no longer looks quite so
11:01 - impressive
11:02 - here let me toggle back and forward a
11:03 - few times
11:07 - do you see how much the lighting
11:09 - transforms a game like this
11:11 - and look flying over here you can
11:13 - vividly see the horizontal line that
11:15 - separates the dirt biome from the lower
11:17 - stone biome
11:19 - and look how circular these stone areas
11:21 - are and this small cave too very
11:24 - circular
11:25 - just remember that for now
11:27 - okay the map continues down this way
11:30 - let's go deeper
11:32 - rushing down now oh man these cobwebs
11:34 - even slow me down in creative i should
11:37 - get out my sword
11:38 - okay we've hit some big water now
11:41 - calculating water levels in terraria is
11:43 - a lot more intensive than in paper
11:45 - minecraft but also a lot more fun don't
11:48 - ask me to teach you that for a while
11:49 - okay
11:51 - right i think we are at the bottom of
11:53 - the major cave system now we need to
11:55 - make our own way deeper underground
11:58 - let's go over and see one of those
12:00 - abandoned houses
12:02 - yeah i love that as we dig out this
12:04 - stone the water level behind us drops
12:07 - it's so cool
12:08 - and here we go
12:11 - my what a boring little abode just a
12:14 - barrel inside often they have a bit more
12:16 - than this can we find another
12:20 - this one perhaps
12:30 - of course in the real game in survival
12:32 - mode finding these places can be really
12:34 - tricky and very fun indeed look we have
12:38 - a clock
12:39 - two anvils and a dresser these would be
12:42 - very useful for decorating your own
12:43 - homes upon the surface notice these
12:45 - houses are complete with back walls too
12:47 - these need to be removed using the
12:49 - hammer tool
12:50 - okay before i conclude my little tour
12:52 - just take a look again at the shapes of
12:55 - the oars and caves and pretty much
12:57 - everything we come across
12:58 - do you see it
13:00 - circles circles everywhere just of
13:02 - different sizes and randomness
13:06 - so i keep pointing out circles why is
13:08 - that you'll soon see because it's time
13:11 - to learn how we generate these awesome
13:13 - worlds
13:15 - well to explain the basic idea i'm going
13:17 - to load up the terraria world map into
13:19 - my handy paint package
13:21 - if i zoom right in you can see that each
13:23 - coloured pixel here represents one tile
13:25 - of the game be it a brown dirt tile or a
13:28 - grey stone tile
13:30 - this tile data as you might have guessed
13:32 - is stored in our scratch game in a grid
13:34 - list look up my tutorial on grid lists
13:37 - if you want to know more there's a link
13:39 - under the video
13:40 - what you should realize though is how
13:42 - creating a map is much like painting a
13:44 - picture we just need to know the steps
13:46 - to take and the order to do them in
13:49 - so although in this tutorial i'm not
13:51 - going to teach the scratch coding today
13:53 - we will be looking at all the steps
13:55 - after all to code something up first you
13:58 - have to understand exactly what you are
14:00 - trying to code once you can do the
14:02 - drawing by hand then you can reproduce
14:04 - the same actions using scripts and
14:06 - automation
14:08 - we can start by filling the entire world
14:10 - with dirt and stone like so
14:13 - this would just require us to fill a
14:15 - scratch list with ones and zeros say
14:18 - that was the easy bit
14:19 - now you might think the next step would
14:21 - be to draw the sky but actually it's
14:24 - better to keep that until much later
14:26 - instead we address the fact that these
14:28 - blocks of color are looking a bit too
14:30 - perfect
14:31 - if we reference our original map we can
14:33 - see that the dirt biome still has many
14:36 - smaller stone areas
14:38 - and the lower stone biomes also have
14:40 - longer veins of dirt
14:43 - so how do we generate these organic
14:45 - patterns
14:46 - now you may be thinking purlin noise or
14:49 - some other clever mathematical technique
14:51 - would be the answer and wow yes we could
14:53 - do that and it would be awesome however
14:56 - if there is a way of getting close to
14:58 - the same results in a simpler way then
15:01 - i'm all for trying that out and what
15:04 - i've actually done is much simpler to
15:06 - understand than all that math wizardry
15:08 - let's zoom in and take a look at the
15:10 - lower region first and hone in on that
15:13 - dirt that appears within the stone
15:16 - do you see how it forms thin wiggly
15:18 - patterns
15:19 - i can take a small circular pen in my
15:22 - paint package and starting at one end
15:24 - trace a zigzagging line
15:26 - yes can you see how i can reproduce a
15:29 - very similar pattern
15:30 - remember how i kept drawing your
15:32 - attention to the circular nature of some
15:34 - of these ore veins well this is why this
15:37 - is the secret to my world generation
15:40 - drawing scribbles using a circular pen
15:43 - just in a controlled and yet random
15:45 - fashion here let me demonstrate using
15:48 - the dirt color i pick a pen size this
15:51 - round pen and then picking a random
15:53 - start position i draw a zigzagging
15:55 - scribble adjusting my pen size two if i
15:57 - want to as i go
15:59 - once we have enough dirt veins we stop
16:02 - ta-dah
16:03 - of course the question you may be
16:04 - wondering is how in scratch do we draw a
16:07 - thick line into a grid list hmm
16:10 - i think best not to worry too much about
16:13 - that right now but if you can figure out
16:16 - how to paint a filled circle of tiles
16:18 - pythagoras is your friend here and then
16:20 - do this over and over again down a set
16:23 - path then you'll be well on your way
16:26 - so what about the upper dirt layer well
16:29 - this one has scribbles of stone only the
16:32 - ones towards the surface are really
16:34 - small and short and the ones lower down
16:36 - well they become longer and much more
16:39 - bunched up like they are scribbled all
16:41 - over themselves
16:43 - let's draw those in next
16:45 - now the variety of scribble styles makes
16:47 - things feel a lot more natural as
16:49 - finally there are scattering of stone
16:51 - blobs using a smaller pen size but these
16:54 - don't follow any longer paths but remain
16:56 - small even at lower depths
17:00 - so we continued the theme by adding in
17:03 - the various oars these come in varying
17:06 - amounts at different depths but are
17:08 - almost always just small smudged circles
17:11 - of color that we splatter around in
17:13 - bands around the map
17:19 - right next up we are creating the caves
17:24 - and once more it's going to be a matter
17:26 - of creating some epic scribbles only
17:29 - this time using an eraser rather than a
17:32 - pen to allow us to remove the areas of
17:34 - solid rock and ore
17:36 - so draw with the empty tile our
17:38 - scribbles are diverse at times much
17:41 - thicker than before but also changing
17:44 - size frequently they also zigzag quite
17:47 - violently at times and even move up and
17:50 - down as they go just mainly downwards as
17:53 - a rule
17:54 - it's worth noting that these cave roots
17:56 - often cross over each other forming much
17:59 - more exciting caving patterns than the
18:02 - single zigzags could on their own
18:05 - then as a rule each level adds one far
18:08 - larger cave that begins at the top of
18:10 - the world breaking the surface and
18:13 - travels downwards again in a zigzagging
18:15 - pattern but we ensure it runs deep and
18:19 - very long this adds a lot of excitement
18:21 - to the level as the player has the
18:23 - option to adventure deep into the game
18:25 - perhaps even before they are ready to do
18:28 - so but
18:29 - the choice remains theirs
18:32 - now wow we are almost there so it's
18:35 - definitely time to draw in the sky the
18:37 - majority of this is easy we just remove
18:39 - a large rectangle of the upper dirt
18:43 - but well that leaves the surface too
18:45 - straight we want this biome to contain
18:47 - that pleasant undulating hills that we
18:49 - are so used to walking upon at spawn for
18:52 - this we will borrow a simple
18:53 - mathematical sine curve
18:55 - only to avoid being bored to death we
18:58 - can combine a couple of curves together
19:00 - to make something a bit more interesting
19:02 - this ends up cutting a nice shape
19:05 - something like this across our landscape
19:08 - cool
19:09 - can you see now why we did this last
19:11 - because this way it allows us to easily
19:13 - cut across any of our painted ore
19:15 - patterns cleanly
19:17 - if we'd done this first all these extra
19:20 - oars would have stuck out above the
19:21 - surface so we are on the home stretch
19:24 - now at this point we want to add in the
19:26 - more scripted structures like
19:27 - underground abandoned houses or in
19:29 - minecraft that dungeon the trick here is
19:32 - to be able to scan the map for cave
19:34 - areas of sufficient size to contain the
19:36 - structures and then just to place it
19:38 - there and make the required adjustments
19:40 - to meld it into the surroundings
19:42 - next we transform any dirt tiles that
19:44 - were on the surface into grass it's at
19:47 - this point that the drawing with a paint
19:48 - package reaches the limit of its
19:50 - usefulness so sticking with the map we
19:52 - see that further to just planting grass
19:54 - on the surface we then need to cycle our
19:57 - grass growing code to extend the grass
19:59 - around connecting tiles
20:01 - i love this code so much because if you
20:04 - watch it sped up it also causes grass on
20:07 - the underside of the tiles to sprout
20:09 - vines and these in turn drop down new
20:12 - grass onto the tiles below oh it's so
20:14 - cool in this way the whole upper biome
20:17 - can seem to spring into life oh yeah and
20:21 - we also grow a few trees on the grassy
20:23 - surface
20:24 - then we have the reskin step
20:27 - this step doesn't exist in paper
20:29 - minecraft but in terraria it makes a
20:32 - huge difference without this our level
20:34 - looks like oh this
20:37 - the small tiles need their costumes
20:39 - switching around to make them all
20:41 - connect together the right way if you
20:43 - have watched my mario tile scrolling
20:45 - tutorials on automatic tile arranging
20:47 - then that pretty much explains how this
20:49 - process works
20:51 - yeah i'll leave a link under the video
20:53 - and then just when you thought the hard
20:56 - work was done along comes water
20:59 - oh gosh i love water it's just so fun to
21:03 - simulate and play around with but oh man
21:05 - we are not even going to touch this
21:07 - today let's just check out the map and
21:09 - see how the water sits
21:12 - i hope it's enough to say that we just
21:14 - need to pick a number of random areas on
21:16 - the map and programmatically pour a
21:19 - volume of water from each point
21:21 - flowing it downwards until it reaches a
21:23 - local minima that is it can't flow down
21:25 - any further and then begin the process
21:28 - of filling and flowing until the water
21:30 - is all accounted for
21:32 - what you want to end up with is a number
21:34 - of distributed natural looking flat
21:37 - topped pools of water
21:39 - and with that apart from adding a
21:42 - splattering of chests and other loot the
21:44 - level generation is complete all that
21:46 - remains is for us to illuminate the sky
21:48 - and run the light flow algorithm to
21:51 - pretty the whole thing up
21:52 - just remember that a level can contain
21:54 - over 100 000 tiles so be prepared for
21:58 - some epic computation time
22:00 - and there we go that covers the entire
22:03 - manual level generation
22:05 - now the next step would be to work our
22:07 - way through each of these phases of
22:09 - generation and make scripts that do just
22:12 - the same thing
22:14 - in a lot of ways it was the scale of the
22:16 - terraria game that made it an immensely
22:18 - fun challenge to tackle in scratch and i
22:20 - enjoyed the challenge thoroughly
22:22 - generating the minecraft worlds turns
22:24 - out to be a lot easier but nearly all
22:26 - the main strategies remain the same
22:29 - if you want to make the surface biomes
22:31 - more exciting then perhaps we might
22:33 - consider investing more time in
22:34 - implementing the mathematics of purlin
22:36 - noise but for our needs this far simpler
22:39 - approach does us very well
22:41 - sometimes simple is better when coding
22:43 - with blocks
22:45 - overall i think the similarity of the
22:46 - terraria's stamp level with the original
22:48 - torii game is testament to the
22:50 - effectiveness of these techniques
22:53 - so i do hope you've enjoyed this video
22:56 - and that you might have learned
22:57 - something useful along the way this has
22:59 - been a very different video since we've
23:01 - not even placed a single block of code
23:03 - even so please do smash that like button
23:06 - and subscribe to the channel to catch
23:07 - the next exciting and informative video
23:10 - next week we'll do some real scratching
23:12 - but not on level generation i suspect if
23:15 - we do tackle this you can tell it will
23:17 - need a lot of episodes and i'm not even
23:19 - sure i'm quite ready to tackle that
23:21 - myself
23:22 - so until next time have a very pleasant
23:26 - week ahead and scratch on guys
23:29 - [Music]

Cleaned transcript:

hello fellow scratchers i'm griff batch and today we are talking about 2d landscape generation two examples of this that i'm better known for can be found in the game's paper minecraft and terraria stamped both of these games are able to generate seemingly random yet exciting worlds out of tiled blocks and i know a lot of you would love to know just how it was done well this is the first video i've made on the subject and what i want to do today is step you through the process i have used successfully in both of these games to really bring these virtual environments to life let's begin by taking a walk about a paper minecraft world and here we are yes it's paper minecraft instantly recognizable from the classic minecraft textures and the plain sky block size is quite large 40 pixels square if i remember correctly which means we see just 75 full tiles on the screen at once view distance was always rather limited but to counter this i added mouse look around so you can see a bit further ahead so the basic surface of the terrain is made up of dirt blocks topped with a single layer of grass the ground is very flat with just a few ups and downs here and there on the grass grows the odd plant and aha a tree awesome wow there's a lot of animals in this level ha even spawning animals is an interesting subject of its own ah a village i can't tell you how funny it was when i first introduced the village house spawning eggs into paper minecraft being able to pop down a house run away a bit and watch a house pop out of nowhere was such a laugh the level generation just made use of this popping down a number of house eggs and voila a whole village is born okay now so i've already dug a hole down here to show you the basic underground cave falling down past some coal oh zombie and we're down and right away we have some lava that's cool i'm in creative mode so i can safely explore this is a naturally formed cave typical in paper minecraft deep caves tend to have lava flows from the ceiling the height of the cave is between two and four blocks and it runs in any direction even vertically for short periods okay oh wow we've stumbled upon a hidden dungeon area with its chaser test an unexpected treat for us oh go on let's snag the crown yeah i rule okay then so i'm thinking this is where the cave system ends right time to turn on xray mode that makes everything visible to us now and oh wow the cave does actually continue on but not for long we hit bedrock so what i want you to notice is just how simple the level design underground is it's mostly rock scattered with patches of oars and cut up here and there by wiggling cave systems added to this we have the water and lava flows a splattering of special level features surface grass and trees but mainly what the main craft level is made up of is loads and loads of featureless rock as we speed through we find patches of ores and these tend to be rough circles of various sizes they can look a little odd when seen in xray mode but as soon as the lighting engine comes on they look quite natural right so minecraft levels don't have a lot more to them than this sure it has biomes and a few more surface minibiomes like lakes and sand but there's not a lot more to it so let's stop there and take a look at the more ambitious project terraria stamped just like with paper minecraft the game begins with a world generation phase and the levels are generated in much the same way however the scale of the world is far more detailed you can see right away that the tile size is so much smaller these tiles are just 8 by 8 pixels you could fit 25 of these inside a single paper minecraft block what's more there are actually five layers of tiles a background a wall a liquid tile a foreground tile and a brightness tile this leads us to having to draw almost 3 000 tiles for every screen remember in paper minecraft we only needed 75 to do the same job so yeah this is way way more demanding and that is why tavares stamped could not be a scrolling game but this extra detail means we get to see the level generation in far more detail which is why i wanted to focus on this engine as i describe how everything works as you can see we again have a mainly dirt based ground layer but due to the smaller block size the slope or curve of the ground is more pronounced grass is growing on the edges of dirt but isn't limited to the top blocks like in minecraft it also grows on the edges and bottoms of tiles too what does grow on the top are the extra grass shoots and flowers and also these marvelous trees talking of which i want to show you the exciting cave that i can see here below me so i need some wood to make a torch let's chop down a tree okay i'll craft a few torches and off we go place a torch and look at how the light spreads outwards i love that have you watched my pathfinding tutorial there's a link under this video because the spread of light here follows exactly the same rules as the pathfinding scripts so you might want to watch that again and see if you can see why this might be now do you see how we have vines growing down from the roof of caves that is so cool right and also we have wall tiles underground behind me hiding the sky this makes the underworld much more atmospheric the cave wiggling walls are well defined here and ah you can see some stone showing through too ah okay before we get deeper into this cave let me just take you back to the surface and finish exploring that we should find a small lake each level has a lake and a cave to be found yeah here it is and oh wow i can see an awesome cave just under the surface too and yeah this is as far as the level goes sadly unlike with paper minecraft we can't skip off to another biome by walking off the edge of the level gosh this is just too tempting i am going to break through the floor of this lake i love these sandbox simulations oh no oh the fishy help them i don't have a net to catch them with of you it's okay he's safe panic over right now that we have seen the surface let's pull up our terraria map yes we have a map introvert just press f and there we go the cross marks where we are right now okay this is really useful as we can see the shape of the terrain do you see the undulating curves of the grass what remains of the dugout lake oops and the beginnings of the cave system to the right even the tree stumps are nicely visible now if i switch into creative mode and bring back the map and this this is why i wanted to use the project to explain level generation now we can see everything every pixel on this screen is a tile in the game world that is a lot of tiles yes over one hundred thousand of them so what are the main components that make up etiva map we have solid land and sky the land has a peaceful up and down curve going on but then here and there are small bites taken out of it for interest a larger bite on the surface is filled with water or at least it was before i drained it ignoring the caves for a moment and looking behind them you'll see the top third of the ground is mostly dirt with a splattering of large stone blobs but from twothirds down it reverses and the ground is stone with splashes and streaks of dirt breaking all of this up we have the capes and notice the crazy shapes they appear in like blobs slashes zigzags vertical and horizontal and all over the place some wide some narrow it looks crazy but this is what makes exploring the game so exciting you just can't predict it after this all that remains are the mainly smaller dots of oars and gems the areas of water how can i forget these and these quite exciting underground abandoned houses for you to stumble across deeper underground okay come on before i let you in on the secret of how this was generated let's just check out what it looks like deeper down underground back into the cave and now in creative mode i can dig really fast let's go straight down it's getting dark so i'll place a torch the light leaks through quite a few layers of dirt before it fades out oh cool we've broken through into a cave yeah look here we are on the map see my new tunnel looks like this isn't a very big cave but it's a cute little ecosystem with water and a squibble right back up we go exploring these caves is quite dangerous when you start out in terraria it's better to build yourself a safe house to begin with on the surface die slime ah nice an underground chest these contain cool booty i'll take that boomerang notice we've reached a depth in the level where the background wall has been replaced by an underground theme we can no longer place torches on this which makes things a bit harder yeah these larger vertical drops are very difficult to climb back up when we start out in survival mode do you see how exciting the cave system is i think it's far more fun to explore than the more simple minecraft caves but as far as world generation they are actually done very similarly this is just on a grander scale now at this depth the green vines stop growing and we will see no more grass but ores become more common we do have to watch out for more difficult mobs too though and it's a lot further to get back up to the surface if anything goes wrong hey just look at the shape of this cave isn't it complicated and cool looking can you even imagine how this could be generated randomly and automatically it's hard to believe but it wasn't actually as difficult as you may think now watch this let me turn on xray mode wow and everything is revealed now the interesting thing here is how flat everything suddenly looks and although the cave is still pretty awesome in detail it no longer looks quite so impressive here let me toggle back and forward a few times do you see how much the lighting transforms a game like this and look flying over here you can vividly see the horizontal line that separates the dirt biome from the lower stone biome and look how circular these stone areas are and this small cave too very circular just remember that for now okay the map continues down this way let's go deeper rushing down now oh man these cobwebs even slow me down in creative i should get out my sword okay we've hit some big water now calculating water levels in terraria is a lot more intensive than in paper minecraft but also a lot more fun don't ask me to teach you that for a while okay right i think we are at the bottom of the major cave system now we need to make our own way deeper underground let's go over and see one of those abandoned houses yeah i love that as we dig out this stone the water level behind us drops it's so cool and here we go my what a boring little abode just a barrel inside often they have a bit more than this can we find another this one perhaps of course in the real game in survival mode finding these places can be really tricky and very fun indeed look we have a clock two anvils and a dresser these would be very useful for decorating your own homes upon the surface notice these houses are complete with back walls too these need to be removed using the hammer tool okay before i conclude my little tour just take a look again at the shapes of the oars and caves and pretty much everything we come across do you see it circles circles everywhere just of different sizes and randomness so i keep pointing out circles why is that you'll soon see because it's time to learn how we generate these awesome worlds well to explain the basic idea i'm going to load up the terraria world map into my handy paint package if i zoom right in you can see that each coloured pixel here represents one tile of the game be it a brown dirt tile or a grey stone tile this tile data as you might have guessed is stored in our scratch game in a grid list look up my tutorial on grid lists if you want to know more there's a link under the video what you should realize though is how creating a map is much like painting a picture we just need to know the steps to take and the order to do them in so although in this tutorial i'm not going to teach the scratch coding today we will be looking at all the steps after all to code something up first you have to understand exactly what you are trying to code once you can do the drawing by hand then you can reproduce the same actions using scripts and automation we can start by filling the entire world with dirt and stone like so this would just require us to fill a scratch list with ones and zeros say that was the easy bit now you might think the next step would be to draw the sky but actually it's better to keep that until much later instead we address the fact that these blocks of color are looking a bit too perfect if we reference our original map we can see that the dirt biome still has many smaller stone areas and the lower stone biomes also have longer veins of dirt so how do we generate these organic patterns now you may be thinking purlin noise or some other clever mathematical technique would be the answer and wow yes we could do that and it would be awesome however if there is a way of getting close to the same results in a simpler way then i'm all for trying that out and what i've actually done is much simpler to understand than all that math wizardry let's zoom in and take a look at the lower region first and hone in on that dirt that appears within the stone do you see how it forms thin wiggly patterns i can take a small circular pen in my paint package and starting at one end trace a zigzagging line yes can you see how i can reproduce a very similar pattern remember how i kept drawing your attention to the circular nature of some of these ore veins well this is why this is the secret to my world generation drawing scribbles using a circular pen just in a controlled and yet random fashion here let me demonstrate using the dirt color i pick a pen size this round pen and then picking a random start position i draw a zigzagging scribble adjusting my pen size two if i want to as i go once we have enough dirt veins we stop tadah of course the question you may be wondering is how in scratch do we draw a thick line into a grid list hmm i think best not to worry too much about that right now but if you can figure out how to paint a filled circle of tiles pythagoras is your friend here and then do this over and over again down a set path then you'll be well on your way so what about the upper dirt layer well this one has scribbles of stone only the ones towards the surface are really small and short and the ones lower down well they become longer and much more bunched up like they are scribbled all over themselves let's draw those in next now the variety of scribble styles makes things feel a lot more natural as finally there are scattering of stone blobs using a smaller pen size but these don't follow any longer paths but remain small even at lower depths so we continued the theme by adding in the various oars these come in varying amounts at different depths but are almost always just small smudged circles of color that we splatter around in bands around the map right next up we are creating the caves and once more it's going to be a matter of creating some epic scribbles only this time using an eraser rather than a pen to allow us to remove the areas of solid rock and ore so draw with the empty tile our scribbles are diverse at times much thicker than before but also changing size frequently they also zigzag quite violently at times and even move up and down as they go just mainly downwards as a rule it's worth noting that these cave roots often cross over each other forming much more exciting caving patterns than the single zigzags could on their own then as a rule each level adds one far larger cave that begins at the top of the world breaking the surface and travels downwards again in a zigzagging pattern but we ensure it runs deep and very long this adds a lot of excitement to the level as the player has the option to adventure deep into the game perhaps even before they are ready to do so but the choice remains theirs now wow we are almost there so it's definitely time to draw in the sky the majority of this is easy we just remove a large rectangle of the upper dirt but well that leaves the surface too straight we want this biome to contain that pleasant undulating hills that we are so used to walking upon at spawn for this we will borrow a simple mathematical sine curve only to avoid being bored to death we can combine a couple of curves together to make something a bit more interesting this ends up cutting a nice shape something like this across our landscape cool can you see now why we did this last because this way it allows us to easily cut across any of our painted ore patterns cleanly if we'd done this first all these extra oars would have stuck out above the surface so we are on the home stretch now at this point we want to add in the more scripted structures like underground abandoned houses or in minecraft that dungeon the trick here is to be able to scan the map for cave areas of sufficient size to contain the structures and then just to place it there and make the required adjustments to meld it into the surroundings next we transform any dirt tiles that were on the surface into grass it's at this point that the drawing with a paint package reaches the limit of its usefulness so sticking with the map we see that further to just planting grass on the surface we then need to cycle our grass growing code to extend the grass around connecting tiles i love this code so much because if you watch it sped up it also causes grass on the underside of the tiles to sprout vines and these in turn drop down new grass onto the tiles below oh it's so cool in this way the whole upper biome can seem to spring into life oh yeah and we also grow a few trees on the grassy surface then we have the reskin step this step doesn't exist in paper minecraft but in terraria it makes a huge difference without this our level looks like oh this the small tiles need their costumes switching around to make them all connect together the right way if you have watched my mario tile scrolling tutorials on automatic tile arranging then that pretty much explains how this process works yeah i'll leave a link under the video and then just when you thought the hard work was done along comes water oh gosh i love water it's just so fun to simulate and play around with but oh man we are not even going to touch this today let's just check out the map and see how the water sits i hope it's enough to say that we just need to pick a number of random areas on the map and programmatically pour a volume of water from each point flowing it downwards until it reaches a local minima that is it can't flow down any further and then begin the process of filling and flowing until the water is all accounted for what you want to end up with is a number of distributed natural looking flat topped pools of water and with that apart from adding a splattering of chests and other loot the level generation is complete all that remains is for us to illuminate the sky and run the light flow algorithm to pretty the whole thing up just remember that a level can contain over 100 000 tiles so be prepared for some epic computation time and there we go that covers the entire manual level generation now the next step would be to work our way through each of these phases of generation and make scripts that do just the same thing in a lot of ways it was the scale of the terraria game that made it an immensely fun challenge to tackle in scratch and i enjoyed the challenge thoroughly generating the minecraft worlds turns out to be a lot easier but nearly all the main strategies remain the same if you want to make the surface biomes more exciting then perhaps we might consider investing more time in implementing the mathematics of purlin noise but for our needs this far simpler approach does us very well sometimes simple is better when coding with blocks overall i think the similarity of the terraria's stamp level with the original torii game is testament to the effectiveness of these techniques so i do hope you've enjoyed this video and that you might have learned something useful along the way this has been a very different video since we've not even placed a single block of code even so please do smash that like button and subscribe to the channel to catch the next exciting and informative video next week we'll do some real scratching but not on level generation i suspect if we do tackle this you can tell it will need a lot of episodes and i'm not even sure i'm quite ready to tackle that myself so until next time have a very pleasant week ahead and scratch on guys
