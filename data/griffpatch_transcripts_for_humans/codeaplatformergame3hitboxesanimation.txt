With timestamps:

00:00 - [Music]
00:02 - hello fellow scratchers i'm grif patch
00:05 - and this is part three of our classic
00:06 - scratch platformer tutorial today we are
00:09 - going to learn about player animation
00:11 - and hitboxes have you heard of the term
00:14 - hitboxes before up until now our player
00:16 - has been a square today we are switching
00:19 - to using a cat-shaped costume sprite
00:21 - collisions suddenly become more
00:23 - problematic this is where hitboxes come
00:26 - in super useful solving many of our
00:28 - collision woes stay tuned to learn why
00:31 - this is a fun episode that will
00:33 - transform the look and feel of our game
00:35 - and the animation will really bring
00:37 - things to life
00:39 - we'll begin where we left off in episode
00:41 - 2. make sure to save the project as a
00:43 - copy from the file menu this is now
00:45 - episode three
00:47 - okay guys let's get scratching
00:51 - to teach about player animation and
00:52 - hitboxes we are going to be switching to
00:55 - using the scratch cat costumes these
00:57 - were included in the original resource
00:59 - project that many of you will have
01:00 - remixed from episode 1.
01:02 - if you want to use your own costumes
01:04 - that's no problem at all but you will
01:06 - have to adapt the tutorial a little to
01:08 - make it work but i hope it'll be clear
01:11 - enough where
01:12 - so scroll down to costume28 it's named
01:15 - stand
01:16 - here is scratch cat in his idle standing
01:19 - pose it's worth noting especially if you
01:21 - want to use your own costumes in the
01:23 - platformer how a costume is positioned
01:25 - on the editing canvas this is really
01:27 - important and shouldn't be overlooked
01:30 - this is the center of the costume canvas
01:33 - and when you place or draw a player
01:35 - costume you want this point to be the
01:37 - middle of the player costume 2.
01:40 - the reason that this is important is
01:42 - that as a sprite is rotated or flipped
01:44 - left and right in your game this is the
01:46 - position they are rotated and flipped
01:49 - around
01:50 - an off-center costume leads to an
01:52 - off-center movement like this
01:54 - a correctly centered one looks much more
01:56 - professional right
01:58 - good don't forget scratch provides a
02:00 - helpful way to make things centered as
02:03 - you move a shape around it will snap to
02:05 - the center of the canvas as you draw
02:07 - close enough to it this allows you to
02:09 - keep things all nicely lined up
02:12 - okay lesson over with our standing
02:14 - sprite selected i'm going to run the
02:16 - project
02:18 - wowzers that is one large scratch cat
02:21 - this level was really designed for a
02:23 - much smaller player but anyway it's kind
02:26 - of fun since we will be able to check
02:28 - out his animations easier this way
02:30 - so to compensate for his size open the
02:32 - code tab and we'll set the jump force to
02:35 - say 17 or 18.
02:37 - running that again right
02:40 - now i can reach the first platform in a
02:42 - single leap
02:44 - so things seem to be working okay
02:46 - what's all the fuss about needing
02:47 - hitboxes then
02:49 - ah look at this
02:51 - if i edge off this platform
02:54 - my face catches on the side and i'm able
02:56 - to continue walking even on my whiskers
02:59 - that's rather unnatural right i can even
03:02 - still jump
03:03 - yeah these whiskers can be useful
03:05 - climbing tools apparently it's
03:07 - surprising that they are so robust
03:10 - so why didn't we see this happening with
03:12 - our cute guy character
03:14 - the answer is quite straightforward they
03:16 - were a perfect square with no sticking
03:18 - out features that could get caught on
03:20 - the level luckily for us with a little
03:22 - work we can have the best of both worlds
03:25 - we just need to use you guessed it
03:28 - hit boxes
03:29 - to demonstrate this click back into the
03:31 - costume editor and find costume 28.
03:35 - here it is so to create a hitbox costume
03:38 - of my own start by duplicating costume
03:40 - 28
03:42 - then select the entire costume on the
03:44 - canvas we can then group the whole
03:46 - costume together using the group button
03:48 - this will make our lives easier as we
03:50 - draw the hitbox
03:52 - next with the rectangle tool draw a
03:54 - bounding rectangle around scratch cat
03:57 - it should only just cover them don't
03:59 - make it too big now
04:01 - important thing is that there are no
04:03 - parts of the cat sticking out past the
04:04 - rectangle
04:06 - excellent let's run the project
04:08 - this is really quite funny to see it's
04:10 - scratch cat like you've never seen him
04:12 - before the scratch cat in a box
04:14 - platformer hey
04:16 - but here's the thing did you notice that
04:18 - the box around our player is actually
04:20 - stopping us getting trapped on the edge
04:22 - of platforms this is good news
04:25 - okay then so if you are still following
04:28 - along then i just need to report that
04:30 - this large sprite will get stuck trying
04:33 - to move on to scene 2. this is because
04:35 - the level wasn't designed for such a big
04:37 - character
04:38 - we'll not worry about that now but it
04:41 - does make me realize that it's not so
04:42 - easy for you watching this video to see
04:44 - when my player does get stuck
04:47 - for all you know i may just not be
04:49 - pressing any keys so
04:50 - how about i make the background change
04:52 - to bright red when we get stuck
04:55 - oh before we do any coding
04:57 - ensure we name this costume big hitbox
05:02 - okay sweet come into the code and find
05:05 - the when i receive tick player script
05:08 - we should simply never be touching the
05:10 - ground at the start of a tick player
05:13 - so if we are touching level then we are
05:16 - stuck
05:17 - to switch the backdrop color we can
05:18 - simply switch back drop two
05:21 - and this is the clever bit the touching
05:23 - level block
05:24 - wow that's weird isn't it
05:27 - this will change the backdrop costume to
05:29 - a costume named
05:30 - true
05:31 - or false
05:33 - true if we're touching the level and
05:35 - false if we are not
05:37 - okay we can work with that click into
05:40 - the stage backdrop and make sure we have
05:42 - two free backdrop costumes i'm creating
05:45 - a new second one
05:46 - name the first one
05:48 - false
05:49 - and the second one
05:51 - true
05:52 - so remembering that we change the
05:53 - backdrop to true if we are touching the
05:55 - level we therefore want this costume to
05:57 - be bright red
05:59 - nice
06:00 - did you know that red was my favorite
06:01 - color
06:02 - we'll leave the false costume blank and
06:05 - give things a test
06:07 - by staying in the project view we can
06:09 - just drag scratch cat and drop them
06:11 - overlapping the level boom look at all
06:13 - that redness we must be colliding good
06:16 - job i can also test it by walking off
06:19 - the right yeah now it's clear we are
06:21 - stuck
06:22 - i can now use this to better explain why
06:25 - even when using hitbox costumes we can
06:28 - still have issues with sprite collisions
06:30 - for this we need to talk about sprite
06:33 - rotation and sprite rotation styles
06:37 - our guy sprite was designed for
06:39 - simplicity and he only ever faced one
06:42 - direction
06:43 - scratch cat on the other hand wants to
06:44 - face in the direction they are moving in
06:46 - and herein lies our problem let me
06:49 - demonstrate click into the player's
06:51 - direction box here up pops the direction
06:53 - dialog do you see these three icons
06:56 - across the bottom
06:57 - using these we can choose between three
06:59 - possible rotation styles for each sprite
07:02 - click on the first one this is the
07:04 - all-around rotation style and is the
07:07 - default for all new sprites
07:09 - in this style i can rotate the sprite
07:11 - freely this is really great for say a
07:14 - space shooter or any top-down style game
07:16 - but not so great for a platformer it
07:20 - does highlight though that rotation must
07:22 - be considered when thinking of
07:24 - collisions you see how changing the
07:26 - direction is causing the sprite to
07:27 - collide with the level even though its
07:29 - position is not changed
07:32 - okay so next up we have the left right
07:34 - rotation style the middle option
07:36 - this is the style used by the default
07:38 - scratch cat
07:39 - where changing the sprite direction no
07:41 - longer causes them to rotate but instead
07:43 - they turn to face the left or right well
07:46 - that's cool behaving as you would expect
07:48 - in a platformer game also look no bright
07:51 - red backdrop as we turn so this mode
07:54 - seems better suited to hitboxes as the
07:56 - costume is not coming into contact with
07:58 - the level as the costume is flipped left
08:00 - or right
08:01 - but there is still potential for
08:03 - problems if i walk flush up against the
08:06 - wall to the left and then change
08:08 - direction
08:09 - did you see we appeared to move further
08:11 - away from the wall
08:13 - okay then walk up closer and turn around
08:16 - again
08:18 - boom again we are stuck in the wall yes
08:22 - even tiny differences caused by flipping
08:24 - the hitbox can cause our sprite to get
08:26 - stuck
08:27 - this is possibly one of the most common
08:29 - bugs that i've seen in scratch's
08:31 - platforming games
08:32 - luckily there is a simple solution
08:35 - the final rotation style is the do not
08:38 - rotate style as the name suggests with
08:41 - this enabled the sprite doesn't follow
08:43 - the direction value at all i can wiggle
08:45 - it all i like and the sprite doesn't
08:47 - budge an inch
08:48 - fantastic for ensuring our hitbox works
08:51 - glitch-free
08:53 - right then so we know what rotation
08:55 - style we are going to use for collisions
08:57 - so let's try to put this together in the
08:59 - game
09:00 - begin by finding the when i receive game
09:03 - loop
09:04 - introduce a broadcast before all the
09:06 - others with a new message of tick first
09:11 - this will be the first thing to run
09:12 - before the others platforming scripts so
09:14 - it is a good place to switch to the
09:16 - hitbox costume so add a when i receive
09:19 - tick first tap lock
09:22 - and switch the costume to
09:25 - big hitbox
09:28 - then from the motion category scroll
09:30 - down and find the elusive set rotation
09:33 - style block not a commonly used block
09:35 - but it allows us to switch rotation
09:37 - style to don't rotate right here in our
09:40 - code
09:40 - very useful
09:42 - next we want to ensure we switch back to
09:44 - the real cat costume after the player's
09:46 - finished moving this game tick the best
09:49 - place for that will be at the end of the
09:51 - when i receive tick player script
09:54 - however it will serve us well to make a
09:57 - new custom block to accomplish this name
09:59 - it set costume and run without screen
10:02 - refresh
10:03 - do pop the set costumes block at the
10:05 - bottom of the tick player script ready
10:07 - to run after all the movement and
10:08 - collisions are done
10:11 - so back in the set costume script for
10:13 - now we'll keep this simple we use the
10:16 - set rotation style block again returning
10:18 - us to the left right style then switch
10:21 - costume to
10:23 - stand
10:24 - cool later on we'll come back and add
10:26 - support for player animations but for
10:28 - now run the project
10:30 - brilliant do you notice the difference
10:32 - yep the hitbox has gone we're only
10:35 - seeing the cat now yay
10:37 - we can move around and if i rotate my
10:39 - cat we see the left right style is
10:41 - working but importantly i am not getting
10:44 - stuck when turning against the wall if i
10:47 - was then the backdrop would still flash
10:49 - red excellent
10:51 - the other important thing to note is
10:53 - that my cat is still obeying the hitbox
10:54 - rules i can jump up but there's no way i
10:57 - can get stuck on his whiskers anymore
10:59 - but hold on a moment do you see what i
11:02 - see
11:03 - boy do we have a problem here our player
11:06 - can now apparently walk in mid-air this
11:09 - looks really bad news and it's obvious
11:11 - enough why it's happening let's
11:13 - temporarily remove the last switch
11:14 - costume yeah look we aren't standing in
11:17 - midair at all no the corner of our
11:19 - previously invisible hitbox is resting
11:22 - on the edge of the platform
11:23 - pop the switch costume back
11:26 - well we know why it's happening but what
11:28 - can we do about it
11:31 - click back into the player's costume tab
11:34 - to ensure our player cannot stand on
11:35 - things to the side of their feet we need
11:37 - to shrink the hitbox width to be no
11:40 - wider than our player's feet
11:43 - also while we're at it we can bring the
11:45 - bottom of the hitbox up a little to help
11:47 - prevent our player's feet hovering above
11:49 - the ground and lastly bring down the top
11:52 - edge say to just above his eyes this
11:55 - allows us to fit through slightly
11:56 - smaller gaps great select the cat we
12:00 - grouped it earlier making this task
12:02 - easier and delete it
12:04 - sorry scratchcat
12:06 - this leaves us with a smaller and
12:08 - simpler hitbox
12:09 - i'm excited to give this a test click
12:11 - the green flag
12:13 - okay yes notice right off at our
12:15 - player's feet are well embedded in the
12:17 - floor you may like this look or you may
12:19 - want to make some adjustments
12:21 - let's see if i can still walk in the air
12:24 - oh yeah supad this problem is gone and i
12:26 - fall right down as i might expect
12:29 - and i can collide my head with the
12:31 - platform from underneath
12:32 - last check walk over to the left and you
12:35 - can see that my head can overlap the
12:37 - walls quite a bit now
12:39 - this is just how things are going to
12:41 - work for the time being and you may
12:43 - actually quite like how it looks in a
12:45 - later episode we will see some advanced
12:47 - hitbox tricks that will improve things
12:49 - further and i'm dead excited to get on
12:51 - to that so let's press on coming back to
12:54 - our players feet then we can now tweak
12:56 - the bottom of the hitbox to change how
12:58 - far from or into the ground our player's
13:01 - costume appears
13:03 - check that out
13:04 - yeah cool our feet are nicely placed on
13:07 - the ground but jump up here
13:10 - ah this is why we needed to check up
13:12 - here we seem to be hovering slightly
13:14 - above the ground still
13:16 - so just in case you had any trouble
13:18 - drawing a good hitbox you'll find i made
13:21 - one for you it's at costume 20 and is
13:23 - named hitbox you'll also notice that
13:26 - there are a number of other interesting
13:28 - hitboxes in here but you'll have to just
13:30 - hold yourselves in anticipation because
13:32 - they are not for this episode
13:35 - we can switch to using this preset
13:37 - hitbox so i'll delete my big hitbox
13:40 - costume and then in the code find the
13:42 - when i receive tick first script
13:46 - switching to the costume hitbox
13:50 - excellent
13:52 - well all this talk of direction and
13:54 - rotation and yet our platformer has
13:56 - neither yet it's so easy well i just
14:00 - wanted to put it off until we had the
14:02 - rotation styles fixed in place
14:04 - so find the define controls left and
14:07 - right and when the left arrow is pressed
14:10 - drop in a point in direction negative
14:12 - 90.
14:14 - and of course for the if right arrow
14:16 - pressed we point in direction 90.
14:23 - click the green flag
14:25 - we are on to a winner this is really
14:28 - looking smart being able to change
14:30 - direction at last we can run jump all
14:32 - over the place with confidence that our
14:34 - hitbox is in place
14:36 - and so
14:37 - finally we are in a good place to begin
14:40 - animating our player 2. we'll begin with
14:42 - scratch cat's run cycle
14:44 - here they are in the costume editor to
14:47 - keep track of the animation i like to
14:49 - make a new variable named frame for this
14:52 - sprite only
14:53 - this will hold the animation frame
14:55 - number
14:56 - we want to animate only while actively
14:58 - walking so i'll drop a change frame by
15:01 - one into both the if key left pressed
15:04 - and right press scripts like so
15:07 - both of them want to add one this time a
15:10 - negative number would actually play the
15:11 - animation backwards
15:14 - now come back to the define set costume
15:16 - script remember i said we'd use this for
15:18 - the animations well now is the time we
15:21 - want to switch the costume to the
15:22 - correct ones for our run cycle
15:25 - let's take a look again at which ones
15:27 - they are
15:28 - the run cycle begins at costume one then
15:31 - in order goes through two three four and
15:34 - ends all the way down at costume 16. yep
15:38 - costume 17 is a jump costume
15:40 - so that's 16 costumes beginning at
15:43 - costume one we'll need those numbers
15:46 - back to the code
15:47 - we begin by switching costume to the
15:49 - first costume in the run cycle costume
15:52 - one and we'll be adding to this to
15:54 - create the animation so for now put in
15:56 - the variable frame
16:00 - running the project reveals the
16:02 - beginning of the animation this is
16:04 - promising but as expected our frame
16:06 - variable just keeps going up and after
16:08 - costume 16 it starts showing costumes
16:11 - that we do not want to show
16:14 - luckily there is a simple scratch maths
16:16 - operator block to fix the problem and
16:18 - it's called mod
16:20 - this is one of my all-time favorite
16:22 - blocks
16:23 - on the right we put the number 16 that's
16:26 - the number of costumes in our animation
16:28 - and on the left the frame variable
16:31 - what this does is prevent the value ever
16:33 - reaching the number 16. instead looping
16:36 - back down to zero again
16:38 - and again in a cycle perfect for
16:41 - creating a looping animation and test
16:44 - again
16:45 - and this is much improved are you
16:47 - getting that happy vibe i certainly am
16:50 - the frame variable is increasing all the
16:52 - time as i move but the animation is kept
16:54 - cycling around playing like a dream
16:57 - so now might be a good time to consider
16:59 - animation speeds depending on the number
17:02 - of costumes in your animation and the
17:04 - size of the sprite and the speed they
17:05 - are traveling at you may want to
17:07 - decrease the speed at which the
17:09 - animation is playing back let me show
17:11 - you first how not to do this
17:14 - if the animation was being handled in
17:15 - its own forever loop we might simply add
17:17 - a weight for say 0.1 seconds after the
17:20 - switching costumes you'll have seen this
17:22 - sort of thing before well you might
17:25 - think that this would work here but
17:27 - whoa
17:28 - whoa this is so broken that simple
17:31 - little weight has trashed our game
17:34 - take it out
17:35 - ah and we are back so why can't we add a
17:38 - weight here okay let me show you where a
17:42 - weight does work
17:44 - we need a separate forever loop that
17:46 - updates the frame variable
17:49 - and then we could update the costume
17:52 - and wait
17:54 - and if we run just that
17:56 - you can see this produces the slowdown
17:58 - animation we were after
18:00 - but in our platformer the frame is being
18:02 - updated in a main game loop within a
18:05 - tick broadcast and a tick broadcast like
18:08 - the tick of a clock must run very
18:10 - quickly any waiting in here is therefore
18:13 - not allowed
18:14 - so we must find another way to slow down
18:17 - our player's animations
18:19 - okay no problem we could instead slow it
18:22 - down by changing the frame by a smaller
18:24 - increment
18:25 - let's try 0.25 for quarter speed
18:29 - oh gosh there's a problem at every turn
18:32 - this does slow the animation down
18:34 - without the need for a weight but has
18:36 - revealed a small glitch in the run cycle
18:39 - i'm glad we saw this now though so we
18:41 - can fix it quickly
18:42 - when we switch a costume to say number
18:44 - 16 it's obvious that we get costume 16
18:48 - on the stage
18:49 - but what if we set it to costume 16 and
18:52 - a half
18:53 - scratch in its wisdom rounds the number
18:55 - to the nearest whole number
18:57 - and that would round it up to 17.
19:01 - so that's where the glitch costume comes
19:04 - from to fix it we just need to always
19:07 - round the number down instead so we do
19:10 - this with a floor operator
19:13 - wrapping around the frame or the mod
19:16 - like so
19:18 - and yeah we now have a stable slow
19:22 - animation we can adjust its speed by
19:24 - setting the size of the increments in
19:26 - the change frame block
19:28 - excellent
19:30 - okay enough of that throw away that
19:31 - forever loop
19:33 - what i want to do next is bring back the
19:35 - player's idle pose so that we can stand
19:37 - still once the left and right keys are
19:39 - released we could possibly look at speed
19:42 - x and switch to standing when it's close
19:44 - to zero
19:46 - but this would also introduce glitches
19:48 - as we change direction
19:50 - instead we will make a change such that
19:52 - frame is set to zero when we finished
19:55 - moving
19:56 - in that case let's use an if else
19:58 - checking that frame is greater than zero
20:01 - if so then we use the run animation but
20:04 - otherwise simply switch costume to stand
20:09 - next find the define controls left right
20:12 - script
20:13 - there's a few ways we could get frame to
20:15 - zero when all the keys are released but
20:17 - to avoid repetition of code i'd like us
20:20 - to make a new variable key x for all
20:23 - sprites sometimes i call this joystick x
20:27 - then at the top of the script we set key
20:28 - x to
20:29 - key right arrow pressed
20:32 - subtract
20:33 - key left arrow pressed
20:36 - key right arrow pressed subtract key
20:39 - left arrow pressed
20:41 - if i run the project you can see that
20:43 - when i press the right arrow key the
20:45 - variable key x becomes one when the left
20:48 - key is pressed it becomes negative one
20:52 - and when no key is pressed it remains at
20:54 - zero this is crazy useful way of storing
20:56 - the key presses because now we can code
20:59 - like this
21:01 - add an if else
21:03 - and when key x is equal to zero
21:10 - this means neither the left or right key
21:12 - is pressed
21:13 - so we can set frame to zero
21:16 - yay that was our goal to set frame to
21:18 - zero when no key was pressed excellent
21:21 - next in the else
21:23 - either the left or right key has been
21:25 - pressed so we can borrow one of the
21:28 - existing key press scripts from before
21:30 - all we need to do is flip the direction
21:32 - of travel based on key x
21:35 - since key x is one for right and minus
21:37 - one for left we just multiply
21:40 - acceleration by key x
21:44 - and do the same for direction
21:53 - please don't forget though to restore
21:55 - the set speed x here back to the bottom
21:57 - of the new script before we find and
21:59 - delete this old script
22:03 - and now let's give that a test
22:06 - okay what do we see
22:08 - scratch cat is once more standing
22:10 - upright that's great news and his
22:12 - running animation nicely starts up as we
22:14 - run around
22:16 - what i don't particularly like is that
22:18 - when i release a key the player stops
22:20 - animating
22:21 - but continues to slide across the floor
22:24 - this makes things look uber slippery an
22:26 - effect that may suit some games but i'd
22:28 - prefer to make this better
22:30 - we'll start by taking a cue from the
22:32 - real world physics stopping the player
22:34 - dead when they slow down enough
22:37 - when no key is pressed add in a new if
22:40 - else block
22:41 - check that the absolute
22:44 - abs value of speed x
22:48 - is less than one
22:50 - this means that speed x is between
22:52 - negative one and one that's really quite
22:55 - slow at this point and since no key is
22:57 - pressed we are going to bring the player
22:59 - to a sharp stop by setting the speed x
23:01 - to zero
23:03 - let's see if that worked
23:05 - oh what
23:07 - oh gosh something is so wrong i cannot
23:10 - move at all well bother
23:12 - i'm sure the scripts were right
23:14 - oh yes i know just click the green flag
23:17 - again
23:19 - there's nothing wrong here it's just
23:21 - that editing the scripts with my project
23:23 - still running caused speedx to get set
23:25 - to an invalid value restarting things
23:28 - set it back to zero and from then on it
23:30 - was fixed phew what a relief
23:32 - so looking at scratchy's motion things
23:35 - are improving the sliding is a little
23:37 - less severe but only just the pose while
23:40 - we slide is also no longer the idle one
23:43 - but we're not quite finished with that
23:45 - yet how about we give them a slight walk
23:47 - animation while they slow down in the
23:50 - empty else change frame by 0.5 that will
23:55 - give them a half walk speed while they
23:57 - are sliding to a stop
23:59 - and let's see
24:02 - oh yes look at that it's beautiful isn't
24:05 - it crazy that even though the movement
24:07 - is just the same as before a little bit
24:09 - of animation has transformed it from
24:11 - looking slippery to being quite natural
24:14 - amazing i love it things are coming
24:17 - along great
24:19 - the final touch is to address our
24:21 - players jumping and falling actions at
24:23 - present you can see the player continues
24:25 - to play his run cycle while in the air
24:28 - this is not hugely realistic and we can
24:30 - do better scroll up to the define set
24:33 - costume script once more now while
24:36 - jumping the jumping costumes should
24:38 - overrule all the other animation effects
24:40 - so make a space for the new scripts
24:43 - right after the set rotation style
24:46 - detector jumping using if falling is
24:49 - greater than one and then simply switch
24:51 - the costume to let's see uh jump01
24:55 - we attach the other scripts below
24:57 - lastly put in a stop this script after
25:01 - setting the jump costume this prevents
25:03 - the other scripts running while we are
25:05 - jumping
25:06 - can we test this sure we can well that
25:09 - was easy boing boing notice that not
25:12 - only does the jump costume show when we
25:14 - jump but also when we walk off a
25:17 - platform
25:18 - if we look in the costume editor
25:21 - we actually have a second costume that
25:23 - may be better suited for the downward
25:25 - phase of a jump its name is run
25:27 - underscore j2
25:29 - catchy name
25:31 - using another if else
25:33 - we'll check for speed y being greater
25:35 - than zero
25:41 - that means we are traveling upwards
25:44 - the stop script can move to under this
25:46 - if else and while moving up we can now
25:48 - switch the costume to jump
25:50 - the whole script can be returned in here
25:53 - and then lastly set the costume to that
25:56 - run j2 in the else for when we are
25:59 - falling down
26:01 - great i am feeling really good about
26:03 - this run the project
26:05 - jumping has never looked so good we
26:07 - often spend a lot of time in the air in
26:09 - a platformer so the extra falling
26:11 - costume helps to make things look more
26:13 - dynamic
26:15 - well we are almost done for this episode
26:18 - but there's one crucial bug that we
26:20 - still need to fix that you've yet to see
26:22 - before i can show it to you though we
26:25 - need to rebalance our game by shrinking
26:27 - down the scratch cat to a reasonable
26:28 - size
26:30 - you can choose to make him any size you
26:32 - like but in my game he was supposed to
26:34 - be a lot smaller so click into the size
26:36 - input box and enter a size of 40.
26:39 - great wow so much smaller but that's
26:42 - okay i like it i just need to tweak a
26:44 - few of the variable values under the
26:46 - green flag
26:48 - setting jump force back to 12
26:50 - and acceleration to
26:52 - 1.5 this setup will allow for much more
26:55 - interesting level designs as it gives us
26:57 - more space to run and jump around in i'm
26:59 - glad to say that we can now also get
27:01 - back onto scene 2.
27:05 - without getting stuck
27:07 - but not everything is rosy let's see if
27:09 - i can show you the problem
27:11 - i just need to run back and forth here
27:14 - hmm
27:15 - okay obviously more than i thought
27:18 - hold on it's going to happen
27:21 - there finally it did and we got stuck
27:24 - how is this possible and why does it
27:27 - only happen now and then
27:28 - these are very good questions since we
27:31 - were so careful in the last episode to
27:32 - fix this very problem
27:34 - all that we change are sprite costumes
27:37 - that means this must be costume related
27:40 - let's see
27:41 - things begin in the when i receive game
27:43 - loop our player's costume is set to the
27:45 - hitbox within the tick first broadcast
27:48 - next in the tick player broadcast the
27:49 - player is moved and the costume gets
27:52 - returned to the cat costume
27:54 - ah but then lastly the tick lasts his
27:56 - broadcast
27:57 - right the tick last is responsible for
27:59 - detecting the player moving off the
28:01 - screen
28:02 - and it uses the begin scene script
28:05 - and here it is this is where we are
28:07 - having the problem we are using the
28:09 - fixed collision in direction to get us
28:11 - out of any collisions after switching
28:13 - scenes
28:14 - which used to work fine
28:16 - but
28:17 - back then we were using a square costume
28:20 - now we would hope to be using the hitbox
28:23 - but no we just mentioned that by this
28:25 - point we have been returned to the cat
28:27 - costume as such depending on which
28:29 - animation frame we are on the fix
28:31 - collision script may not push us far
28:34 - enough out of the ground as it needs to
28:36 - as such when we appear on the new scene
28:38 - we are still stuck in the ground
28:41 - luckily that means it's a quick fix
28:45 - switch back to the hitbox costume
28:51 - and ensure to set rotation style to
28:54 - don't rotate
28:56 - move both of these in just before the
28:58 - fix collision in direction block
29:00 - afterwards we can use the set costume
29:02 - block to return the costume back to the
29:04 - correct costume once more
29:07 - so if all goes to plan that should have
29:09 - fixed our little problem we can test it
29:12 - by trying our best to cause the issue to
29:13 - happen again running back and forward
29:15 - back and forward like a crazy cat
29:17 - between scenes yep i think we're good
29:20 - fury that is a relief
29:23 - and on that bombshell i am going to
29:26 - leave you but i'm so stoked for the next
29:28 - video because it surely will contain
29:30 - some amazing new content but what will
29:32 - it be
29:34 - so many possibilities well you've all
29:36 - seen what we have in store
29:38 - i do hope you've enjoyed this episode
29:40 - please smash the like button and don't
29:41 - forget to subscribe to my channel to
29:43 - catch the latest videos we also have a
29:45 - channel membership for those most loyal
29:47 - fans to enjoy thank you members i've
29:50 - seen quite a number of those cool yellow
29:52 - badges appearing in the comments showing
29:54 - you've been with me for over two months
29:56 - wow how exciting
29:58 - so thank you for watching have a great
30:00 - week ahead and scratch on guys
30:05 - [Music]

Cleaned transcript:

hello fellow scratchers i'm grif patch and this is part three of our classic scratch platformer tutorial today we are going to learn about player animation and hitboxes have you heard of the term hitboxes before up until now our player has been a square today we are switching to using a catshaped costume sprite collisions suddenly become more problematic this is where hitboxes come in super useful solving many of our collision woes stay tuned to learn why this is a fun episode that will transform the look and feel of our game and the animation will really bring things to life we'll begin where we left off in episode 2. make sure to save the project as a copy from the file menu this is now episode three okay guys let's get scratching to teach about player animation and hitboxes we are going to be switching to using the scratch cat costumes these were included in the original resource project that many of you will have remixed from episode 1. if you want to use your own costumes that's no problem at all but you will have to adapt the tutorial a little to make it work but i hope it'll be clear enough where so scroll down to costume28 it's named stand here is scratch cat in his idle standing pose it's worth noting especially if you want to use your own costumes in the platformer how a costume is positioned on the editing canvas this is really important and shouldn't be overlooked this is the center of the costume canvas and when you place or draw a player costume you want this point to be the middle of the player costume 2. the reason that this is important is that as a sprite is rotated or flipped left and right in your game this is the position they are rotated and flipped around an offcenter costume leads to an offcenter movement like this a correctly centered one looks much more professional right good don't forget scratch provides a helpful way to make things centered as you move a shape around it will snap to the center of the canvas as you draw close enough to it this allows you to keep things all nicely lined up okay lesson over with our standing sprite selected i'm going to run the project wowzers that is one large scratch cat this level was really designed for a much smaller player but anyway it's kind of fun since we will be able to check out his animations easier this way so to compensate for his size open the code tab and we'll set the jump force to say 17 or 18. running that again right now i can reach the first platform in a single leap so things seem to be working okay what's all the fuss about needing hitboxes then ah look at this if i edge off this platform my face catches on the side and i'm able to continue walking even on my whiskers that's rather unnatural right i can even still jump yeah these whiskers can be useful climbing tools apparently it's surprising that they are so robust so why didn't we see this happening with our cute guy character the answer is quite straightforward they were a perfect square with no sticking out features that could get caught on the level luckily for us with a little work we can have the best of both worlds we just need to use you guessed it hit boxes to demonstrate this click back into the costume editor and find costume 28. here it is so to create a hitbox costume of my own start by duplicating costume 28 then select the entire costume on the canvas we can then group the whole costume together using the group button this will make our lives easier as we draw the hitbox next with the rectangle tool draw a bounding rectangle around scratch cat it should only just cover them don't make it too big now important thing is that there are no parts of the cat sticking out past the rectangle excellent let's run the project this is really quite funny to see it's scratch cat like you've never seen him before the scratch cat in a box platformer hey but here's the thing did you notice that the box around our player is actually stopping us getting trapped on the edge of platforms this is good news okay then so if you are still following along then i just need to report that this large sprite will get stuck trying to move on to scene 2. this is because the level wasn't designed for such a big character we'll not worry about that now but it does make me realize that it's not so easy for you watching this video to see when my player does get stuck for all you know i may just not be pressing any keys so how about i make the background change to bright red when we get stuck oh before we do any coding ensure we name this costume big hitbox okay sweet come into the code and find the when i receive tick player script we should simply never be touching the ground at the start of a tick player so if we are touching level then we are stuck to switch the backdrop color we can simply switch back drop two and this is the clever bit the touching level block wow that's weird isn't it this will change the backdrop costume to a costume named true or false true if we're touching the level and false if we are not okay we can work with that click into the stage backdrop and make sure we have two free backdrop costumes i'm creating a new second one name the first one false and the second one true so remembering that we change the backdrop to true if we are touching the level we therefore want this costume to be bright red nice did you know that red was my favorite color we'll leave the false costume blank and give things a test by staying in the project view we can just drag scratch cat and drop them overlapping the level boom look at all that redness we must be colliding good job i can also test it by walking off the right yeah now it's clear we are stuck i can now use this to better explain why even when using hitbox costumes we can still have issues with sprite collisions for this we need to talk about sprite rotation and sprite rotation styles our guy sprite was designed for simplicity and he only ever faced one direction scratch cat on the other hand wants to face in the direction they are moving in and herein lies our problem let me demonstrate click into the player's direction box here up pops the direction dialog do you see these three icons across the bottom using these we can choose between three possible rotation styles for each sprite click on the first one this is the allaround rotation style and is the default for all new sprites in this style i can rotate the sprite freely this is really great for say a space shooter or any topdown style game but not so great for a platformer it does highlight though that rotation must be considered when thinking of collisions you see how changing the direction is causing the sprite to collide with the level even though its position is not changed okay so next up we have the left right rotation style the middle option this is the style used by the default scratch cat where changing the sprite direction no longer causes them to rotate but instead they turn to face the left or right well that's cool behaving as you would expect in a platformer game also look no bright red backdrop as we turn so this mode seems better suited to hitboxes as the costume is not coming into contact with the level as the costume is flipped left or right but there is still potential for problems if i walk flush up against the wall to the left and then change direction did you see we appeared to move further away from the wall okay then walk up closer and turn around again boom again we are stuck in the wall yes even tiny differences caused by flipping the hitbox can cause our sprite to get stuck this is possibly one of the most common bugs that i've seen in scratch's platforming games luckily there is a simple solution the final rotation style is the do not rotate style as the name suggests with this enabled the sprite doesn't follow the direction value at all i can wiggle it all i like and the sprite doesn't budge an inch fantastic for ensuring our hitbox works glitchfree right then so we know what rotation style we are going to use for collisions so let's try to put this together in the game begin by finding the when i receive game loop introduce a broadcast before all the others with a new message of tick first this will be the first thing to run before the others platforming scripts so it is a good place to switch to the hitbox costume so add a when i receive tick first tap lock and switch the costume to big hitbox then from the motion category scroll down and find the elusive set rotation style block not a commonly used block but it allows us to switch rotation style to don't rotate right here in our code very useful next we want to ensure we switch back to the real cat costume after the player's finished moving this game tick the best place for that will be at the end of the when i receive tick player script however it will serve us well to make a new custom block to accomplish this name it set costume and run without screen refresh do pop the set costumes block at the bottom of the tick player script ready to run after all the movement and collisions are done so back in the set costume script for now we'll keep this simple we use the set rotation style block again returning us to the left right style then switch costume to stand cool later on we'll come back and add support for player animations but for now run the project brilliant do you notice the difference yep the hitbox has gone we're only seeing the cat now yay we can move around and if i rotate my cat we see the left right style is working but importantly i am not getting stuck when turning against the wall if i was then the backdrop would still flash red excellent the other important thing to note is that my cat is still obeying the hitbox rules i can jump up but there's no way i can get stuck on his whiskers anymore but hold on a moment do you see what i see boy do we have a problem here our player can now apparently walk in midair this looks really bad news and it's obvious enough why it's happening let's temporarily remove the last switch costume yeah look we aren't standing in midair at all no the corner of our previously invisible hitbox is resting on the edge of the platform pop the switch costume back well we know why it's happening but what can we do about it click back into the player's costume tab to ensure our player cannot stand on things to the side of their feet we need to shrink the hitbox width to be no wider than our player's feet also while we're at it we can bring the bottom of the hitbox up a little to help prevent our player's feet hovering above the ground and lastly bring down the top edge say to just above his eyes this allows us to fit through slightly smaller gaps great select the cat we grouped it earlier making this task easier and delete it sorry scratchcat this leaves us with a smaller and simpler hitbox i'm excited to give this a test click the green flag okay yes notice right off at our player's feet are well embedded in the floor you may like this look or you may want to make some adjustments let's see if i can still walk in the air oh yeah supad this problem is gone and i fall right down as i might expect and i can collide my head with the platform from underneath last check walk over to the left and you can see that my head can overlap the walls quite a bit now this is just how things are going to work for the time being and you may actually quite like how it looks in a later episode we will see some advanced hitbox tricks that will improve things further and i'm dead excited to get on to that so let's press on coming back to our players feet then we can now tweak the bottom of the hitbox to change how far from or into the ground our player's costume appears check that out yeah cool our feet are nicely placed on the ground but jump up here ah this is why we needed to check up here we seem to be hovering slightly above the ground still so just in case you had any trouble drawing a good hitbox you'll find i made one for you it's at costume 20 and is named hitbox you'll also notice that there are a number of other interesting hitboxes in here but you'll have to just hold yourselves in anticipation because they are not for this episode we can switch to using this preset hitbox so i'll delete my big hitbox costume and then in the code find the when i receive tick first script switching to the costume hitbox excellent well all this talk of direction and rotation and yet our platformer has neither yet it's so easy well i just wanted to put it off until we had the rotation styles fixed in place so find the define controls left and right and when the left arrow is pressed drop in a point in direction negative 90. and of course for the if right arrow pressed we point in direction 90. click the green flag we are on to a winner this is really looking smart being able to change direction at last we can run jump all over the place with confidence that our hitbox is in place and so finally we are in a good place to begin animating our player 2. we'll begin with scratch cat's run cycle here they are in the costume editor to keep track of the animation i like to make a new variable named frame for this sprite only this will hold the animation frame number we want to animate only while actively walking so i'll drop a change frame by one into both the if key left pressed and right press scripts like so both of them want to add one this time a negative number would actually play the animation backwards now come back to the define set costume script remember i said we'd use this for the animations well now is the time we want to switch the costume to the correct ones for our run cycle let's take a look again at which ones they are the run cycle begins at costume one then in order goes through two three four and ends all the way down at costume 16. yep costume 17 is a jump costume so that's 16 costumes beginning at costume one we'll need those numbers back to the code we begin by switching costume to the first costume in the run cycle costume one and we'll be adding to this to create the animation so for now put in the variable frame running the project reveals the beginning of the animation this is promising but as expected our frame variable just keeps going up and after costume 16 it starts showing costumes that we do not want to show luckily there is a simple scratch maths operator block to fix the problem and it's called mod this is one of my alltime favorite blocks on the right we put the number 16 that's the number of costumes in our animation and on the left the frame variable what this does is prevent the value ever reaching the number 16. instead looping back down to zero again and again in a cycle perfect for creating a looping animation and test again and this is much improved are you getting that happy vibe i certainly am the frame variable is increasing all the time as i move but the animation is kept cycling around playing like a dream so now might be a good time to consider animation speeds depending on the number of costumes in your animation and the size of the sprite and the speed they are traveling at you may want to decrease the speed at which the animation is playing back let me show you first how not to do this if the animation was being handled in its own forever loop we might simply add a weight for say 0.1 seconds after the switching costumes you'll have seen this sort of thing before well you might think that this would work here but whoa whoa this is so broken that simple little weight has trashed our game take it out ah and we are back so why can't we add a weight here okay let me show you where a weight does work we need a separate forever loop that updates the frame variable and then we could update the costume and wait and if we run just that you can see this produces the slowdown animation we were after but in our platformer the frame is being updated in a main game loop within a tick broadcast and a tick broadcast like the tick of a clock must run very quickly any waiting in here is therefore not allowed so we must find another way to slow down our player's animations okay no problem we could instead slow it down by changing the frame by a smaller increment let's try 0.25 for quarter speed oh gosh there's a problem at every turn this does slow the animation down without the need for a weight but has revealed a small glitch in the run cycle i'm glad we saw this now though so we can fix it quickly when we switch a costume to say number 16 it's obvious that we get costume 16 on the stage but what if we set it to costume 16 and a half scratch in its wisdom rounds the number to the nearest whole number and that would round it up to 17. so that's where the glitch costume comes from to fix it we just need to always round the number down instead so we do this with a floor operator wrapping around the frame or the mod like so and yeah we now have a stable slow animation we can adjust its speed by setting the size of the increments in the change frame block excellent okay enough of that throw away that forever loop what i want to do next is bring back the player's idle pose so that we can stand still once the left and right keys are released we could possibly look at speed x and switch to standing when it's close to zero but this would also introduce glitches as we change direction instead we will make a change such that frame is set to zero when we finished moving in that case let's use an if else checking that frame is greater than zero if so then we use the run animation but otherwise simply switch costume to stand next find the define controls left right script there's a few ways we could get frame to zero when all the keys are released but to avoid repetition of code i'd like us to make a new variable key x for all sprites sometimes i call this joystick x then at the top of the script we set key x to key right arrow pressed subtract key left arrow pressed key right arrow pressed subtract key left arrow pressed if i run the project you can see that when i press the right arrow key the variable key x becomes one when the left key is pressed it becomes negative one and when no key is pressed it remains at zero this is crazy useful way of storing the key presses because now we can code like this add an if else and when key x is equal to zero this means neither the left or right key is pressed so we can set frame to zero yay that was our goal to set frame to zero when no key was pressed excellent next in the else either the left or right key has been pressed so we can borrow one of the existing key press scripts from before all we need to do is flip the direction of travel based on key x since key x is one for right and minus one for left we just multiply acceleration by key x and do the same for direction please don't forget though to restore the set speed x here back to the bottom of the new script before we find and delete this old script and now let's give that a test okay what do we see scratch cat is once more standing upright that's great news and his running animation nicely starts up as we run around what i don't particularly like is that when i release a key the player stops animating but continues to slide across the floor this makes things look uber slippery an effect that may suit some games but i'd prefer to make this better we'll start by taking a cue from the real world physics stopping the player dead when they slow down enough when no key is pressed add in a new if else block check that the absolute abs value of speed x is less than one this means that speed x is between negative one and one that's really quite slow at this point and since no key is pressed we are going to bring the player to a sharp stop by setting the speed x to zero let's see if that worked oh what oh gosh something is so wrong i cannot move at all well bother i'm sure the scripts were right oh yes i know just click the green flag again there's nothing wrong here it's just that editing the scripts with my project still running caused speedx to get set to an invalid value restarting things set it back to zero and from then on it was fixed phew what a relief so looking at scratchy's motion things are improving the sliding is a little less severe but only just the pose while we slide is also no longer the idle one but we're not quite finished with that yet how about we give them a slight walk animation while they slow down in the empty else change frame by 0.5 that will give them a half walk speed while they are sliding to a stop and let's see oh yes look at that it's beautiful isn't it crazy that even though the movement is just the same as before a little bit of animation has transformed it from looking slippery to being quite natural amazing i love it things are coming along great the final touch is to address our players jumping and falling actions at present you can see the player continues to play his run cycle while in the air this is not hugely realistic and we can do better scroll up to the define set costume script once more now while jumping the jumping costumes should overrule all the other animation effects so make a space for the new scripts right after the set rotation style detector jumping using if falling is greater than one and then simply switch the costume to let's see uh jump01 we attach the other scripts below lastly put in a stop this script after setting the jump costume this prevents the other scripts running while we are jumping can we test this sure we can well that was easy boing boing notice that not only does the jump costume show when we jump but also when we walk off a platform if we look in the costume editor we actually have a second costume that may be better suited for the downward phase of a jump its name is run underscore j2 catchy name using another if else we'll check for speed y being greater than zero that means we are traveling upwards the stop script can move to under this if else and while moving up we can now switch the costume to jump the whole script can be returned in here and then lastly set the costume to that run j2 in the else for when we are falling down great i am feeling really good about this run the project jumping has never looked so good we often spend a lot of time in the air in a platformer so the extra falling costume helps to make things look more dynamic well we are almost done for this episode but there's one crucial bug that we still need to fix that you've yet to see before i can show it to you though we need to rebalance our game by shrinking down the scratch cat to a reasonable size you can choose to make him any size you like but in my game he was supposed to be a lot smaller so click into the size input box and enter a size of 40. great wow so much smaller but that's okay i like it i just need to tweak a few of the variable values under the green flag setting jump force back to 12 and acceleration to 1.5 this setup will allow for much more interesting level designs as it gives us more space to run and jump around in i'm glad to say that we can now also get back onto scene 2. without getting stuck but not everything is rosy let's see if i can show you the problem i just need to run back and forth here hmm okay obviously more than i thought hold on it's going to happen there finally it did and we got stuck how is this possible and why does it only happen now and then these are very good questions since we were so careful in the last episode to fix this very problem all that we change are sprite costumes that means this must be costume related let's see things begin in the when i receive game loop our player's costume is set to the hitbox within the tick first broadcast next in the tick player broadcast the player is moved and the costume gets returned to the cat costume ah but then lastly the tick lasts his broadcast right the tick last is responsible for detecting the player moving off the screen and it uses the begin scene script and here it is this is where we are having the problem we are using the fixed collision in direction to get us out of any collisions after switching scenes which used to work fine but back then we were using a square costume now we would hope to be using the hitbox but no we just mentioned that by this point we have been returned to the cat costume as such depending on which animation frame we are on the fix collision script may not push us far enough out of the ground as it needs to as such when we appear on the new scene we are still stuck in the ground luckily that means it's a quick fix switch back to the hitbox costume and ensure to set rotation style to don't rotate move both of these in just before the fix collision in direction block afterwards we can use the set costume block to return the costume back to the correct costume once more so if all goes to plan that should have fixed our little problem we can test it by trying our best to cause the issue to happen again running back and forward back and forward like a crazy cat between scenes yep i think we're good fury that is a relief and on that bombshell i am going to leave you but i'm so stoked for the next video because it surely will contain some amazing new content but what will it be so many possibilities well you've all seen what we have in store i do hope you've enjoyed this episode please smash the like button and don't forget to subscribe to my channel to catch the latest videos we also have a channel membership for those most loyal fans to enjoy thank you members i've seen quite a number of those cool yellow badges appearing in the comments showing you've been with me for over two months wow how exciting so thank you for watching have a great week ahead and scratch on guys
