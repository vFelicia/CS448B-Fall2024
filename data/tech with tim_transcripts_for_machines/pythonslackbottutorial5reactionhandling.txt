hello everybody and welcome back another slack python bot tutorial so in today's video this one's going to be a lot shorter than the previous ones or fingers crossed we'll see how many mistakes i make what we're going to be doing is handling reactions so essentially when someone reacts to a message how can we handle that and then how can we update that welcome message that we sent previously so let's go ahead and do that the first thing we need to do is go over to our console here so our slack you know api whatever and just add the reactions read permission to our bot scope now i think i showed you how to do this in the last video we added the i am right and the reaction read just make sure you add that in here you may have to reinstall the app again once you add that all right so now that we have that what we're going to do is set up a very similar thing to what we did previously with this message so we're going to say at slack underscore event underscore adapter dot on now you can guess what this one is going to be i'm going to trick to you it's going to be reaction underscore added so this means that we added a reaction now we also need to go back sorry i forgot about this to the slack api and we need to now subscribe to that specific event which i think i actually already did but i'll show you how we change that so let's go subscribe to bot events and yes i already added that but you guys can just say add bot user event and then add reaction added like that we could also add reaction removed if we wanted to i'm not going to do that right now we'll just add reaction at it okay so let's go back now and let's go inside of here let's say define reaction you can call this whatever you want inside of here we're going to take a payload and we're literally just going to copy the first few things we have up here so the event the channel id and the user id all right so event channel id and user id now that we have these things what we're going to do is we're going to say if channel under score id not in and you can guess what this is going to be but it's going to be welcome messages we're going to return so just make sure that when we add this reaction we're actually uh checking to see if it is not if the reaction that we added was in the channel that wasn't where the welcome message was sent then we're not going to actually update the welcome message right and this actually reminds me the payload that's sent here is a little bit different than what was sent previously inside of onmessage so what we're going to have to do inside of here is just changes a tiny bit so rather than having channel id event.getch it seems a little bit weird but we're going to say event.get and inside of here we're going to say item comma empty dictionary and then dot get channel now the reason for this is just because again this payload that's sent back looks a little bit different than the one that's up here so this is just how we can handle that if you want to have a look at the payload you can just print it out and you'll see why i'm doing this but event.getitem the item is the item that we added the reaction on right and then we're getting the channel that that item was in so that's the only major change here but that still is equal to channel id then after this we're going to say welcome equals welcome underscore messages channel and then inside of here we're going to go user underscore id now we might need to change this actually but we'll look at it for right now and sorry this isn't channel my bad we do need to change this to channel id okay so now that we have the welcome message what we're going to do is we're going to say welcome dot completed equals true uh come on completed equals through give me the autocompletion there because once we reacted to the message well now our task is complete right and that will update the message automatically inside of the class if you have a look here where we have the check mark right that will change it now so it actually is a check mark and it's not the white large square all right anyways moving on what we'll do now is we will resend or update this message so to do that we're going to say message equals welcome dot and then get message like that this will give us the updated message that now has the check mark instead of that box what we will do after that is we'll say updated underscore message equals client dot chat underscore update and i don't think it's update message i think it's just update and then inside of here we're gonna go asterix asterix and message all right and then finally we will go welcome dot timestamp equals and we'll change that to be updated message ts all right so let's have a quick look here let's go to slack and oops not there let's go into our channel let's go into test let's send start and let's see if we get the thing popping up what is going on what's wrong well it would help if i ran the server i guess it crashed for some reason okay let's run the server let's go back to slack let's type start we see that we get this dm okay great now let's react to this message so let's give it a reaction boom and give it a second and something went wrong what ran wrong let's see here come on it's not working okay so i just messed around with this for a second and i realized what the problem is here so i've just been printing out and having a look at what the user id is and what the channel id is now the problem here is that what we are actually getting when we get the channel id is different from them what we've stored inside of these welcome messages right so again the reason for that is because what we stored inside the welcome message was simply this f string right which is the at and then the user id now that is different than the channel id now technically they represent the same thing and they'll point us to the same location which is the user's direct message inbox but since they are different i cannot simply check if the channel id is inside of welcome messages so what i can do here is kind of a hacky solution where i do a try catch so i can try to send this message and if it doesn't work just catch it and like cleanly return that would potentially work i also can just check if the at user id is inside of welcome messages so what i could do instead is do something like this if the f string of at and then user id is inside of welcome messages then we can go ahead and do that so let's see if this works first of all because i'm not actually 100 confident that's going to work just based on what's being returned to us here but let's try this so let's go and go do test let's type start let's see the dm come in and let's react to this message i just need to move this more on the screen so reaction let's add that and let's see if this changes no that does not change and let's have a look here what are we getting the problem here we get key error this uh so essentially what is this saying okay so i see the problem here i changed this but i didn't change this which is a big problem so let me just copy this string right here and just paste that inside of here and now this should work so this actually did work that's why it actually gave me that error because we advanced past the return statement so it did find that this user uh like the at user was stored inside of the uh what are we calling here welcome messages so now we can reference it from there and we should be good to go i will go over this after but i just want to make sure this is working before i mislead anyone anymore so let's go start all right let's go back here and let's give a reaction to this message and give it a second and of course it's not working all right so the error i just got there was telling me that the channel id was not found so i'm trying to send back into f at user id and this is not working for some reason there's something wrong with this slack api you know i hate to always blame the api but there's definitely something wrong here with this referencing so what i'm going to have to do is kind of implement some kind of hacky solution to fix this now what i'm going to do is just say welcome dot channel equals and i'm going to make this equal to the channel id before i get the new message what this will do is change the channel for a welcome message to be equal to the actual channel that this dm was sent in that's an id rather than this like at tag that we used before that should hopefully prevent the error that we had previously where we tried again to use this at user id to send the direct message or update the direct message again i don't know why that's not working but this should fix it now a lot of you might be asking well if we do that then we get to this point won't this always skip because we would have changed the channel to not be the at user id now it's equal to channel id well you're correct in that situation but it doesn't matter because we've already reacted and edited the message so it shouldn't matter if we skip over this in fact it's almost better to just not have that key in the welcome message anymore so that we continue to skip over it hopefully that's making sense i really apologize if i'm confusing you guys but there's not really much i can do when this just isn't working let's go to test let's go to start let's type that in hopefully we get our dm well it would be helpful if i ran the server of course i'm just running into all kinds of bugs today so let's go back let's type start see our dm come in now let's react to this message so go react add the cool smiley face give it a second and finally we get to the white check mark popping up so that was definitely very frustrating again i don't know why that was happening but now you can see we edited this message and the time stamp of the message would have been updated in fact if i try to rereact to it you'll notice that nothing's going to happen the time stamp won't change just because again what would happen here is we're going to skip over this because we'll hit this block but no longer will the f user id be stored inside of welcome messages so we won't bother doing the rest of this anyways that has been it for handling reactions now there's more that you can do here but this is how you set up the event and this is how we can modify a message again apologize about the confusion this stuff happens i am human just like all of you and let me know what you guys want to see for the next videos i do not yet have them all planned out as always if you enjoyed make sure to leave a like subscribe to the channel and i will see you in another youtube video you