With timestamps:

00:00 - - (whistle sound) Hello and
welcome to a very special
00:03 - coding train coding video.
00:05 - What you are about to
watch is an edited version
00:08 - of what was a live stream
just a few days ago.
00:10 - And this video is sponsored by Spell.
00:13 - Spell is a cloud computing
service where you can train
00:16 - machine-learning models and that's exactly
00:18 - what's going to happen in this video.
00:19 - If you want to sign up
with Spell to follow along,
00:21 - go to spell dot run slash codingtrain.
00:23 - Okay, so in a moment,
I'm going to disappear
00:25 - and Yining Shi will be here.
00:27 - Yining Shi was a guest
for the live stream.
00:29 - She has previously been
on the coding train.
00:31 - She made a brick breaker
tutorial which I will
00:33 - link to in the video subscription.
00:35 - She's an artist, a researcher.
00:36 - Check out all of her
wonderful work at her website,
00:39 - also in the video description.
00:40 - Now, there are a couple of prerequisites
00:42 - before you watch the rest of this video.
00:45 - But you can just watch it anyway.
00:47 - But I made an intro to
Spell, the platform video.
00:50 - You can go back and watch that
which will get you started
00:52 - in signing up and getting
yourself configured.
00:55 - You might need to have,
you do need to have
00:58 - a Python environment running
on your local computer.
01:02 - The one on the Spell cloud
computer will be set up
01:05 - for you if you watch the tutorial.
01:07 - And I am, I have made,
well I haven't made it yet
01:10 - but I will make a Python
environment tutorial
01:13 - that you can watch as well.
01:14 - Finally, if you don't know
what style transfer is,
01:16 - this is the whole thing.
01:17 - This is all about, this
video and the next video
01:20 - is going to show you the entire process
01:22 - for training a style transfer
model and then running
01:25 - that model in the browser to style images.
01:27 - Style transfer is the
process of taking the content
01:30 - of one image like this one
with the style of another image
01:32 - like this one and taking that
style out, applying to this
01:35 - content and getting a new one.
01:36 - So, hashtag this.style,
after you watch these videos,
01:40 - train your own style transfer model.
01:42 - Style it off your webcam.
01:44 - Style your face from your
webcam and upload those images
01:47 - and share them with me.
01:48 - And so without further
ado, her comes Yining.
01:51 - She's going to show you
how to train your own model
01:54 - using Spell.
01:55 - - Finally, we're going to
train our style transfer model
01:59 - with Spell.
02:00 - There are four steps so at
first, we're going to prepare
02:05 - our environment.
02:06 - We're going to download to the dataset.
02:09 - Because we use the vgg
model and the coco dataset;
02:14 - the coco dataset is large
so it might take one hour
02:17 - to finish this one and then
we're going to run this
02:23 - style Python script to train the model.
02:27 - I think it will take about
two hours and six minutes.
02:33 - And then in the end, we're
going to convert this
02:36 - TensorFlow saved model
into a format that we
02:40 - can use in TensorFlow js and in M15js.
02:44 - And here is a detailed instruction here.
02:50 - If you are curious, you can go there
02:51 - and read the read me there.
02:53 - And for step one to three you
can also check out Spell's
02:58 - transferring style transfer tutorial.
03:03 - And you can also set
notifications on Spell
03:06 - to tell you if the run takes a long time
03:11 - but I will talk about this later.
03:13 - And you can also customize
the environment on Spell too
03:18 - but I will also talk about that later.
03:20 - Yes so the first step is
to set up the environment.
03:30 - So we are going to go to our terminal.
03:32 - And we can go to one of the directories.
03:36 - We can find a folder.
03:38 - So on my computer I would just go to
03:40 - cd dev/livestream
03:45 - and it's an empty folder.
03:46 - There's nothing there yet.
03:49 - And at first I need to install Spell.
03:54 - Before I install Spell I need to install
03:57 - the pip package management for Python.
04:01 - It's kind of like MPM for Javascript
04:05 - the note package management.
04:07 - So if you don't have pip installed
04:10 - we need to do that.
04:12 - We can do it together.
04:13 - But I think I already did it
so it might be faster for me.
04:16 - So I'm just going to switch to this page
04:20 - to see all those steps.
04:22 - So at first to install the pip,
04:25 - we are going to download this get pip.
04:30 - I will make this bigger to you.
04:33 - We are going to download
this get pip Python script.
04:38 - So in my terminal I'm going to
04:43 - I have dots at the end.
04:46 - So this, we download this
get pip Python script.
04:52 - And now if I take a look at my folder
04:55 - there is again pip Python script.
04:59 - And then I'm just going to run my script.
05:05 - Python get pip.py.
05:08 - If you're using Python three
you can do Python three
05:12 - get pip.pie.
05:14 - And I guess because I
already installed pip
05:18 - so it doesn't take too long.
05:21 - But if this is your first
time that you install pip
05:24 - it might take one minute I guess.
05:27 - And after this is successfully installed
05:30 - we are going to pip install spell.
05:34 - I also have done this so
it might be faster for me.
05:42 - So here it said all requirement
are already satisfied.
05:44 - Because I already did it once.
05:46 - So now we have Spell installed.
05:48 - So if I type in Spell,
I should be able to see
05:52 - a set of commands that I can do.
05:56 - I can do Spell cp to copy a file.
06:01 - Or I can do Spell run
06:03 - to start a new run.
06:08 - And I also can do Spell login.
06:11 - To log into spell from my local computer.
06:16 - My Spell username is yining.
06:19 - My password is this. (laughs)
06:24 - And now I can say hello Yining Shi!
06:27 - So I'm successfully logged into the Spell.
06:30 - And I also can do spell who am I
06:34 - to check who is logged into Spell.
06:37 - And it says username yining
and this is my email.
06:40 - Created August 13th.
06:45 - And now we have successfully set up Spell.
06:50 - And then we can do
prepare our environment.
06:55 - As I mentioned before
we are going to use this
06:58 - TensorFlow implementation
of fast style transfer
07:01 - made by Logan.
07:03 - So now I'm just going to go ahead
to clone his data repository
07:10 - so I'm going to do get clone.
07:16 - Cool.
07:17 - And then I'm going to go to his folder.
07:22 - Cd fast style transfer.
07:25 - And now I'm here.
07:28 - The next step is to create some folders.
07:31 - And then put in our style image.
07:34 - So at first I'm going to create a folder
07:37 - that is called ckpt checkpoint.
07:41 - And I'm going to create a gitignore file
07:45 - inside of ckpt folder.
07:49 - And I'm also going to
create a folder card images.
07:55 - Here.
07:58 - And I'm also going to
create another folder
08:01 - inside of the images card style.
08:05 - This is the folder where our
style image will live in.
08:11 - Okay.
08:12 - So now if I take a look at this (mumbles)
08:18 - I can see this is the new
folder that we just created.
08:22 - And this is also the new
folder that we created images.
08:27 - And the next step is to find a style image
08:31 - that can be trained down.
08:35 - And when we are choosing style images,
08:37 - we need to make sure that
we could use this artwork
08:43 - and also we can use that image.
08:46 - And we need to give
credit to those images.
08:50 - Because we don't want to run
into any copyright problem.
08:56 - I have one image here.
09:01 - This is an ancient Chinese painting
09:06 - called Fuchun Shan Jitu.
09:09 - And I got this image from Wikipedia.
09:13 - So I can use this image.
09:16 - What I'm going to do is to put this image
09:19 - into images/style.
09:24 - So I'm going to go to the folder.
09:28 - I will just quickly put that style image
09:33 - into images style.
09:37 - I'm going to copy this image.
09:39 - This image is called fuchun.jpg.
09:44 - And I just copied this image here.
09:50 - So now we got our style image.
09:53 - The one thing that we need to do
09:54 - is to get at those two folders.
09:58 - And also commit these
changes to let Spell know
10:02 - that we made all those changes.
10:05 - So here I'm going to do git add images
10:09 - and also add in our folder checkpoint.
10:13 - And then I'm going to
commit these changes.
10:22 - Cool.
10:22 - So now we have prepared our environment.
10:26 - This is done.
10:27 - We can move to the next step.
10:30 - We need to download the dataset.
10:34 - So in order to train this model,
10:36 - we need some required dataset
for fast style transfer.
10:41 - Everything is in the set up script.
10:45 - So we can actually open
the fast style transfer
10:50 - data ripple here.
10:52 - So next we are going to run this script.
10:58 - Set up.
11:01 - As you can see in this set up
11:03 - we are going to create
a folder called data.
11:06 - And then go into that data folder.
11:11 - And then get this vgg model.
11:15 - Convolutional neural network model back.
11:19 - And then also make a folder called bin
11:23 - and then download this coco dataset.
11:27 - Then unzip this coco dataset.
11:29 - So do you remember, before we
had talked about the vgg here?
11:38 - This is the Convolutional neural network
11:40 - that is trained for object recognition.
11:44 - It can get the internal
representation of the image for us.
11:50 - That's why we are going
to use this vgg model.
11:54 - And also fast style transfer
uses this coco dataset.
11:59 - It is trained on a large batch of images.
12:06 - This coco dataset is an
object recognition dataset
12:10 - of 80000 images.
12:13 - So we also need this.
12:14 - Because this coco dataset is huge.
12:17 - So it might take a while.
12:19 - But we are just going to do it.
12:23 - So this is what it look
like in the setup script.
12:27 - And next we are just
going to run this setup.
12:30 - So next we are going to
run this setup script.
12:38 - And we are going to use Spell to run this.
12:40 - So in our terminal we are
going to do Spell run.
12:46 - And this is the script
that we are going to run.
12:50 - But here we can also
specify the machine type
12:55 - by using this flag --machine type CPU.
12:59 - A CPU is free to use.
13:01 - So we're just going to run this script.
13:13 - And then you can see this
emoji casting spell 15.
13:19 - Number 15.
13:20 - This number is really important to us
13:22 - because later we are going
to use the output of this one
13:26 - to do our next training run.
13:29 - So it's my, oh
13:32 - see it's downloading this vgg model.
13:37 - Let me make it a little bit smaller.
13:41 - And I think after
downloading the vgg model,
13:46 - oh it's so long. (audience laughs)
13:50 - It's also going to
download the coco dataset.
13:53 - But here I'm just going
to do control c to exit.
13:58 - It wouldn't stop this run,
13:59 - it would just stop the
printing of those logs.
14:04 - I tried to run this run on Spell
14:07 - and it takes me one hour
and 30 minutes to finish it.
14:13 - I can also login onto Spell
14:15 - to see more detailed
information about each run
14:19 - but also in the terminal
we can do Spell ps.
14:24 - It will list all those runs
that I have done before.
14:29 - So I have 15 runs and
the last one is running.
14:36 - And this is the command that I put.
14:40 - And this is the machine type.
14:41 - We are just using CPU.
14:44 - But we can also log
into the Spell website.
14:49 - And here I can click on this run.
14:52 - And I can see all those,
14:56 - all the informations about each run.
15:00 - This is the run that we just did, run 15.
15:05 - And it will output a folder called data.
15:08 - And this is all the logs.
15:11 - And this is the CPU usage.
15:14 - CPU memory.
15:19 - So this run will take about 1.5 hours.
15:25 - But luckily we have another complete run.
15:29 - I think it's run 13.
15:32 - So on run 13, I also ran
the same command to setup.
15:39 - Here.
15:40 - And it's already completed.
15:42 - And it output a folder called data.
15:46 - And we can click on this data
15:47 - to see what kind of output did we get.
15:51 - See we got this, let me make it bigger.
15:56 - We got this vgg model.
16:00 - We also got the coco dataset.
16:04 - Here it's called train2014.
16:07 - So next we are going to use
the output from this run
16:13 - to train our model.
16:16 - Okay so we finished this second step,
16:20 - downloading the dataset.
16:21 - And we are going to move to the next step.
16:25 - Training with style.
16:28 - Our script.
16:29 - And this is the whole command
that we are going to run.
16:34 - But let's talk about this command
before we actually run it.
16:39 - This command starts a new run.
16:42 - And it used this --mount
flag to mount the output
16:48 - of our previous run which is run 13.
16:53 - For run 13, the output
is a folder called data.
16:57 - And we are going to use this mount flag
17:01 - to copy this data folder
17:05 - into the file system of our next run.
17:08 - And we are going to call
that folder datasets
17:12 - instead of data.
17:13 - So this is the mount command.
17:16 - We can see more information
on Spell's documentation.
17:20 - And then we are going to
specify the machine type.
17:24 - I used the V100 machine.
17:29 - We can check more detailed
machine type here.
17:35 - On the Spell run/docs/core concepts
17:40 - here it talks about all
those available machine types
17:44 - that you can use.
17:45 - And here there is a pricing table.
17:49 - Then this is all the
machine style we can use.
17:53 - The one that I used
yesterday is called V100.
17:59 - And normally it will
take 12 hours to train
18:03 - on this K80 machine and
it will take four hours
18:07 - to train on this V100 machine.
18:12 - But I tried it four times,
it only took me two hours
18:17 - to train on this V100 machine.
18:20 - So this is the machine type.
18:24 - And next command we specify
the framework is TensorFlow.
18:30 - And also we are going to
get some actual package
18:34 - for those are two extra packages
18:38 - there for radio transfer.
18:40 - And you can use --apt --pip
to get all those packages.
18:48 - And this is the actual Python command
18:51 - that we are going to run.
18:52 - We are going to run
the style Python script
18:55 - and we are going to this
script that we want the output
19:02 - to be at a folder called ckpt checkpoint.
19:06 - And we are also going to tell the script
19:08 - that this is the path to our style image.
19:15 - And this is the style weight.
19:17 - This is the style (mumbles) of that model.
19:23 - Which is 150.
19:24 - But you can read more about it
19:27 - at Logan's (mumbles) poll about how those,
19:32 - about the default style
width and other information.
19:37 - And we also need to
specify the train path.
19:40 - This is the path to our coco dataset.
19:43 - And this is the vgg path,
the path to our vgg model.
19:48 - And we don't need to change any of this.
19:51 - The only thing that we need to change
19:53 - is our run number which would be 13
19:59 - because 13 run downloaded
all those dataset.
20:02 - And we are also going to
change the style image link
20:06 - to our own image name which is fuchun.jpg.
20:14 - Okay let's do this.
20:19 - So I copy paste this command.
20:27 - And
20:30 - here.
20:36 - I'm just going to replace
20:39 - I will just go to a code editor first.
20:44 - I'm going to replace this
with my real style transfer
20:51 - style image.
20:52 - Which is fuchun.jpg.
20:55 - And also I'm going to replace this
20:57 - the run number of my set up run to 13.
21:00 - Because that is the run that we use.
21:03 - And that's it.
21:05 - So now we should be able
to copy paste this command
21:10 - and run it in our Spell.
21:13 - And by running this we are
going to start a new run
21:15 - to train the model.
21:20 - Let's just do it.
21:24 - And this says casting spell.
21:28 - Machine requested, done.
21:32 - Run is running.
21:34 - Mounting is done.
21:35 - We mount the data folder to this run.
21:42 - And it says Tesla V100.
21:45 - This is the machine type.
21:48 - I think it will give more information.
21:52 - I'm just going to do control c
21:54 - to let it stop logging all those logs.
22:01 - And we can also do
spell ps to see our run.
22:05 - So now I actually have two runs running.
22:10 - The first one is the set up.
22:11 - I'm still waiting for that to finish.
22:14 - And then this is the training script.
22:19 - On this V100 machine.
22:22 - Oh and the one thing
that I forgot to mention
22:24 - is because it takes
awhile to finish this run
22:28 - on Spell there is a place
that we can set notifications.
22:33 - So it will send us emails
when this run takes too long
22:37 - and will cost too much money.
22:39 - So on my Spell account if I go to settings
22:45 - and the notifications here,
22:47 - I can set some like email notifications
22:52 - saying email me if the run exceeds $20,
22:58 - things like this.
23:00 - In case the run takes too long.
23:04 - So we can do this.
23:07 - And also if you're curious
about the versions of packages
23:13 - and frameworks that we have
in this Spell environment,
23:17 - one thing that we can do is
to do Spell run pip freeze.
23:28 - It will log out all those
installed packages for us.
23:34 - So this is a new run too.
23:37 - Casting spell 17.
23:51 - And this is finished.
23:52 - The total run time is 10 seconds.
23:54 - And we can see all those
installed packages.
23:57 - TensorFlow 1.10.1 things like this.
24:01 - If you're curious about the
versions of the frameworks.
24:09 - Yeah so let's go back
to see how did our run,
24:16 - runs doing.
24:17 - So this is the run that I
just started for training.
24:22 - It has been running for three minutes.
24:25 - And it's still running.
24:29 - It will take about two hours to finish.
24:33 - But I have a complete run.
24:38 - Which is run 14.
24:40 - Run 14 also takes like two
hours and six minutes to finish.
24:46 - But here I trained another style image.
24:53 - See I had this exactly the same run.
24:58 - But I trained this model
on this lotus image.
25:04 - And this is the output of this run.
25:08 - So when we are waiting
for our run 16 to finish
25:16 - we can use this run 14.
25:18 - This run 14 output a new
folder called ckpt checkpoint.
25:24 - And if we open this folder,
we can see there are
25:28 - let me make this bigger.
25:32 - If we open this ckpd folder
25:35 - if everything goes well
25:37 - we should be able to see
four files in this folder.
25:42 - The checkpoint, dot data,
dot index, dot meta.
25:50 - This is a format of
TensorFlow's saved model.
25:55 - This dot meta stores the graph information
26:01 - and this dot data file
here, it stores the values
26:07 - of each variable in that graph
26:09 - and this dot index
identifies the checkpoint.
26:14 - And this checkpoint file
actually only tells us
26:19 - the model path.
26:21 - But for next step we are
going to copy those folders
26:26 - back to our local computer.
26:29 - We can use Spell ls to list
all those output for us
26:34 - for one run.
26:36 - So I'm going to do this Spell ls runs.
26:41 - And the run number is 14.
26:45 - The completed training run.
26:49 - So if we do this, Spell will tell us,
26:52 - oh the output is a folder called ckpt.
26:56 - So I also want to see
what is inside of ckpt.
27:00 - So I can do Spell ls runs/14/ckpt.
27:07 - And then it lists all those four files
27:10 - that we saw on the Spell website.
27:13 - And what we're going to do is
27:15 - we want to copy paste, to
copy all those files back.
27:19 - So I'm going to create a new folder
27:26 - called spell model.
27:32 - And then I'm going to
go inside to that model.
27:38 - And then here I'm going to
copy all those four files.
27:47 - And the run number again is 14.
27:54 - So we hit enter.
27:58 - And it will say copying this file.
28:02 - This is finished,
28:03 - we successfully copied
all those four files.
28:07 - Which is the model, which
is a TensorFlow save model.
28:11 - Back to our local computer.
28:13 - So, oh, I created a wrong
folder inside of this
28:21 - (mumbles) but it's fine.
28:25 - So now if we list out all those files
28:32 - we can see all those four
files are on our local machine.
28:38 - So this is how we can get
the trained model back
28:41 - from Spell's remote machine.
28:47 - Actually we can open that to
see what do they look like.
28:55 - I'm going to that directory.
29:01 - I just created this new
folder called Spell model.
29:05 - I'm just going to drag this
model out to the desktop.
29:12 - And as we can see we have four files.
29:18 - This is the format of the
TensorFlow save model.
29:21 - And if we open this checkpoint
29:28 - file, there's only two lines in this file.
29:31 - It tells us the model checkpoint path
29:34 - is fns.ckpt.
29:38 - This is an important information
29:41 - because we are going to use
this path for our next step.
29:45 - So just remember the model
checkpoint path is this.
29:50 - Okay so.
29:54 - So far we set up the environment.
29:57 - We download the dataset.
29:59 - We trained the model with
the style Python script.
30:05 - We copied our trained model
back to our local computer.
30:10 - And then last step is to
convert the model to a format
30:15 - that we can use in
TensorFlow js and ml5 js.
30:19 - - Alright thank you Yining
for that wonderful tutorial
30:22 - about how to train your
own style transfer model
30:25 - using Spell.
30:26 - Okay now, the next step,
ooh this is exciting.
30:28 - Once you've trained your model
30:29 - and maybe it took you
like a long time to do it.
30:32 - Well once you've got those model files
30:33 - you can now bring them into the browser.
30:36 - Loading them with the ml5 js library
30:38 - which is built on top of TensorFlow.js
30:40 - and style real time live
images coming from the webcam.
30:44 - And that's what Yining
30:45 - is going to show you in
the next video, okay.
30:47 - So see you there.
30:48 - (upbeat music)

Cleaned transcript:

(whistle sound) Hello and welcome to a very special coding train coding video. What you are about to watch is an edited version of what was a live stream just a few days ago. And this video is sponsored by Spell. Spell is a cloud computing service where you can train machinelearning models and that's exactly what's going to happen in this video. If you want to sign up with Spell to follow along, go to spell dot run slash codingtrain. Okay, so in a moment, I'm going to disappear and Yining Shi will be here. Yining Shi was a guest for the live stream. She has previously been on the coding train. She made a brick breaker tutorial which I will link to in the video subscription. She's an artist, a researcher. Check out all of her wonderful work at her website, also in the video description. Now, there are a couple of prerequisites before you watch the rest of this video. But you can just watch it anyway. But I made an intro to Spell, the platform video. You can go back and watch that which will get you started in signing up and getting yourself configured. You might need to have, you do need to have a Python environment running on your local computer. The one on the Spell cloud computer will be set up for you if you watch the tutorial. And I am, I have made, well I haven't made it yet but I will make a Python environment tutorial that you can watch as well. Finally, if you don't know what style transfer is, this is the whole thing. This is all about, this video and the next video is going to show you the entire process for training a style transfer model and then running that model in the browser to style images. Style transfer is the process of taking the content of one image like this one with the style of another image like this one and taking that style out, applying to this content and getting a new one. So, hashtag this.style, after you watch these videos, train your own style transfer model. Style it off your webcam. Style your face from your webcam and upload those images and share them with me. And so without further ado, her comes Yining. She's going to show you how to train your own model using Spell. Finally, we're going to train our style transfer model with Spell. There are four steps so at first, we're going to prepare our environment. We're going to download to the dataset. Because we use the vgg model and the coco dataset; the coco dataset is large so it might take one hour to finish this one and then we're going to run this style Python script to train the model. I think it will take about two hours and six minutes. And then in the end, we're going to convert this TensorFlow saved model into a format that we can use in TensorFlow js and in M15js. And here is a detailed instruction here. If you are curious, you can go there and read the read me there. And for step one to three you can also check out Spell's transferring style transfer tutorial. And you can also set notifications on Spell to tell you if the run takes a long time but I will talk about this later. And you can also customize the environment on Spell too but I will also talk about that later. Yes so the first step is to set up the environment. So we are going to go to our terminal. And we can go to one of the directories. We can find a folder. So on my computer I would just go to cd dev/livestream and it's an empty folder. There's nothing there yet. And at first I need to install Spell. Before I install Spell I need to install the pip package management for Python. It's kind of like MPM for Javascript the note package management. So if you don't have pip installed we need to do that. We can do it together. But I think I already did it so it might be faster for me. So I'm just going to switch to this page to see all those steps. So at first to install the pip, we are going to download this get pip. I will make this bigger to you. We are going to download this get pip Python script. So in my terminal I'm going to I have dots at the end. So this, we download this get pip Python script. And now if I take a look at my folder there is again pip Python script. And then I'm just going to run my script. Python get pip.py. If you're using Python three you can do Python three get pip.pie. And I guess because I already installed pip so it doesn't take too long. But if this is your first time that you install pip it might take one minute I guess. And after this is successfully installed we are going to pip install spell. I also have done this so it might be faster for me. So here it said all requirement are already satisfied. Because I already did it once. So now we have Spell installed. So if I type in Spell, I should be able to see a set of commands that I can do. I can do Spell cp to copy a file. Or I can do Spell run to start a new run. And I also can do Spell login. To log into spell from my local computer. My Spell username is yining. My password is this. (laughs) And now I can say hello Yining Shi! So I'm successfully logged into the Spell. And I also can do spell who am I to check who is logged into Spell. And it says username yining and this is my email. Created August 13th. And now we have successfully set up Spell. And then we can do prepare our environment. As I mentioned before we are going to use this TensorFlow implementation of fast style transfer made by Logan. So now I'm just going to go ahead to clone his data repository so I'm going to do get clone. Cool. And then I'm going to go to his folder. Cd fast style transfer. And now I'm here. The next step is to create some folders. And then put in our style image. So at first I'm going to create a folder that is called ckpt checkpoint. And I'm going to create a gitignore file inside of ckpt folder. And I'm also going to create a folder card images. Here. And I'm also going to create another folder inside of the images card style. This is the folder where our style image will live in. Okay. So now if I take a look at this (mumbles) I can see this is the new folder that we just created. And this is also the new folder that we created images. And the next step is to find a style image that can be trained down. And when we are choosing style images, we need to make sure that we could use this artwork and also we can use that image. And we need to give credit to those images. Because we don't want to run into any copyright problem. I have one image here. This is an ancient Chinese painting called Fuchun Shan Jitu. And I got this image from Wikipedia. So I can use this image. What I'm going to do is to put this image into images/style. So I'm going to go to the folder. I will just quickly put that style image into images style. I'm going to copy this image. This image is called fuchun.jpg. And I just copied this image here. So now we got our style image. The one thing that we need to do is to get at those two folders. And also commit these changes to let Spell know that we made all those changes. So here I'm going to do git add images and also add in our folder checkpoint. And then I'm going to commit these changes. Cool. So now we have prepared our environment. This is done. We can move to the next step. We need to download the dataset. So in order to train this model, we need some required dataset for fast style transfer. Everything is in the set up script. So we can actually open the fast style transfer data ripple here. So next we are going to run this script. Set up. As you can see in this set up we are going to create a folder called data. And then go into that data folder. And then get this vgg model. Convolutional neural network model back. And then also make a folder called bin and then download this coco dataset. Then unzip this coco dataset. So do you remember, before we had talked about the vgg here? This is the Convolutional neural network that is trained for object recognition. It can get the internal representation of the image for us. That's why we are going to use this vgg model. And also fast style transfer uses this coco dataset. It is trained on a large batch of images. This coco dataset is an object recognition dataset of 80000 images. So we also need this. Because this coco dataset is huge. So it might take a while. But we are just going to do it. So this is what it look like in the setup script. And next we are just going to run this setup. So next we are going to run this setup script. And we are going to use Spell to run this. So in our terminal we are going to do Spell run. And this is the script that we are going to run. But here we can also specify the machine type by using this flag machine type CPU. A CPU is free to use. So we're just going to run this script. And then you can see this emoji casting spell 15. Number 15. This number is really important to us because later we are going to use the output of this one to do our next training run. So it's my, oh see it's downloading this vgg model. Let me make it a little bit smaller. And I think after downloading the vgg model, oh it's so long. (audience laughs) It's also going to download the coco dataset. But here I'm just going to do control c to exit. It wouldn't stop this run, it would just stop the printing of those logs. I tried to run this run on Spell and it takes me one hour and 30 minutes to finish it. I can also login onto Spell to see more detailed information about each run but also in the terminal we can do Spell ps. It will list all those runs that I have done before. So I have 15 runs and the last one is running. And this is the command that I put. And this is the machine type. We are just using CPU. But we can also log into the Spell website. And here I can click on this run. And I can see all those, all the informations about each run. This is the run that we just did, run 15. And it will output a folder called data. And this is all the logs. And this is the CPU usage. CPU memory. So this run will take about 1.5 hours. But luckily we have another complete run. I think it's run 13. So on run 13, I also ran the same command to setup. Here. And it's already completed. And it output a folder called data. And we can click on this data to see what kind of output did we get. See we got this, let me make it bigger. We got this vgg model. We also got the coco dataset. Here it's called train2014. So next we are going to use the output from this run to train our model. Okay so we finished this second step, downloading the dataset. And we are going to move to the next step. Training with style. Our script. And this is the whole command that we are going to run. But let's talk about this command before we actually run it. This command starts a new run. And it used this mount flag to mount the output of our previous run which is run 13. For run 13, the output is a folder called data. And we are going to use this mount flag to copy this data folder into the file system of our next run. And we are going to call that folder datasets instead of data. So this is the mount command. We can see more information on Spell's documentation. And then we are going to specify the machine type. I used the V100 machine. We can check more detailed machine type here. On the Spell run/docs/core concepts here it talks about all those available machine types that you can use. And here there is a pricing table. Then this is all the machine style we can use. The one that I used yesterday is called V100. And normally it will take 12 hours to train on this K80 machine and it will take four hours to train on this V100 machine. But I tried it four times, it only took me two hours to train on this V100 machine. So this is the machine type. And next command we specify the framework is TensorFlow. And also we are going to get some actual package for those are two extra packages there for radio transfer. And you can use apt pip to get all those packages. And this is the actual Python command that we are going to run. We are going to run the style Python script and we are going to this script that we want the output to be at a folder called ckpt checkpoint. And we are also going to tell the script that this is the path to our style image. And this is the style weight. This is the style (mumbles) of that model. Which is 150. But you can read more about it at Logan's (mumbles) poll about how those, about the default style width and other information. And we also need to specify the train path. This is the path to our coco dataset. And this is the vgg path, the path to our vgg model. And we don't need to change any of this. The only thing that we need to change is our run number which would be 13 because 13 run downloaded all those dataset. And we are also going to change the style image link to our own image name which is fuchun.jpg. Okay let's do this. So I copy paste this command. And here. I'm just going to replace I will just go to a code editor first. I'm going to replace this with my real style transfer style image. Which is fuchun.jpg. And also I'm going to replace this the run number of my set up run to 13. Because that is the run that we use. And that's it. So now we should be able to copy paste this command and run it in our Spell. And by running this we are going to start a new run to train the model. Let's just do it. And this says casting spell. Machine requested, done. Run is running. Mounting is done. We mount the data folder to this run. And it says Tesla V100. This is the machine type. I think it will give more information. I'm just going to do control c to let it stop logging all those logs. And we can also do spell ps to see our run. So now I actually have two runs running. The first one is the set up. I'm still waiting for that to finish. And then this is the training script. On this V100 machine. Oh and the one thing that I forgot to mention is because it takes awhile to finish this run on Spell there is a place that we can set notifications. So it will send us emails when this run takes too long and will cost too much money. So on my Spell account if I go to settings and the notifications here, I can set some like email notifications saying email me if the run exceeds $20, things like this. In case the run takes too long. So we can do this. And also if you're curious about the versions of packages and frameworks that we have in this Spell environment, one thing that we can do is to do Spell run pip freeze. It will log out all those installed packages for us. So this is a new run too. Casting spell 17. And this is finished. The total run time is 10 seconds. And we can see all those installed packages. TensorFlow 1.10.1 things like this. If you're curious about the versions of the frameworks. Yeah so let's go back to see how did our run, runs doing. So this is the run that I just started for training. It has been running for three minutes. And it's still running. It will take about two hours to finish. But I have a complete run. Which is run 14. Run 14 also takes like two hours and six minutes to finish. But here I trained another style image. See I had this exactly the same run. But I trained this model on this lotus image. And this is the output of this run. So when we are waiting for our run 16 to finish we can use this run 14. This run 14 output a new folder called ckpt checkpoint. And if we open this folder, we can see there are let me make this bigger. If we open this ckpd folder if everything goes well we should be able to see four files in this folder. The checkpoint, dot data, dot index, dot meta. This is a format of TensorFlow's saved model. This dot meta stores the graph information and this dot data file here, it stores the values of each variable in that graph and this dot index identifies the checkpoint. And this checkpoint file actually only tells us the model path. But for next step we are going to copy those folders back to our local computer. We can use Spell ls to list all those output for us for one run. So I'm going to do this Spell ls runs. And the run number is 14. The completed training run. So if we do this, Spell will tell us, oh the output is a folder called ckpt. So I also want to see what is inside of ckpt. So I can do Spell ls runs/14/ckpt. And then it lists all those four files that we saw on the Spell website. And what we're going to do is we want to copy paste, to copy all those files back. So I'm going to create a new folder called spell model. And then I'm going to go inside to that model. And then here I'm going to copy all those four files. And the run number again is 14. So we hit enter. And it will say copying this file. This is finished, we successfully copied all those four files. Which is the model, which is a TensorFlow save model. Back to our local computer. So, oh, I created a wrong folder inside of this (mumbles) but it's fine. So now if we list out all those files we can see all those four files are on our local machine. So this is how we can get the trained model back from Spell's remote machine. Actually we can open that to see what do they look like. I'm going to that directory. I just created this new folder called Spell model. I'm just going to drag this model out to the desktop. And as we can see we have four files. This is the format of the TensorFlow save model. And if we open this checkpoint file, there's only two lines in this file. It tells us the model checkpoint path is fns.ckpt. This is an important information because we are going to use this path for our next step. So just remember the model checkpoint path is this. Okay so. So far we set up the environment. We download the dataset. We trained the model with the style Python script. We copied our trained model back to our local computer. And then last step is to convert the model to a format that we can use in TensorFlow js and ml5 js. Alright thank you Yining for that wonderful tutorial about how to train your own style transfer model using Spell. Okay now, the next step, ooh this is exciting. Once you've trained your model and maybe it took you like a long time to do it. Well once you've got those model files you can now bring them into the browser. Loading them with the ml5 js library which is built on top of TensorFlow.js and style real time live images coming from the webcam. And that's what Yining is going to show you in the next video, okay. So see you there. (upbeat music)
