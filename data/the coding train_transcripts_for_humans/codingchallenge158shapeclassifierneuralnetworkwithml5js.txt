With timestamps:

00:00 - [BLOWS TRAIN WHISTLE]
00:01 - Hello, and welcome to
a 2020 substitute train
00:05 - whistle Coding Train Coding.
00:08 - I am so excited for
you to watch this one.
00:10 - I just finished making it.
00:11 - So I'm just recording
a little intro here
00:14 - to show you the end result,
because this one might
00:16 - be kind of long.
00:17 - So you can see,
ultimately, where I get to.
00:19 - I have a p5.js sketch that
is loading a neural network,
00:23 - a convolutional
neural network, model
00:25 - that I trained myself in
this video with my own data
00:28 - to recognize shapes.
00:30 - It only knows about circles,
squares, and triangles.
00:33 - But I have this document
camera here live and running.
00:36 - You see my hand there.
00:37 - I just drew that
circle, and it is
00:39 - guessing with a 75% confidence
that it is a circle.
00:42 - Let's now see some other shapes.
00:44 - Here is a triangle--
00:47 - 76%.
00:48 - And I can switch this over,
and I can look at this square.
00:51 - And boy, is it confident
that that's a square.
00:53 - I can even kind of
turn it sideways.
00:56 - Oh, it thinks it's a circle now.
00:58 - So there are some flaws.
00:59 - And you will see why
those flaws might be there
01:02 - as you watch this video.
01:05 - So what do you need
before you get started?
01:08 - I used Processing.
01:09 - You can download that
at Processing.org.
01:12 - I used p5.js you can get through
Web Editor at editor.p5.js.org.
01:17 - And I am also working
with p5.js locally
01:20 - on my computer,
which is something
01:22 - you might want to check
out my workflow series
01:24 - if that's unfamiliar to you.
01:25 - See you at the
end of this video.
01:26 - I-- no, I won't
see you at the end.
01:28 - I mean, I don't see you anyway.
01:29 - I don't know what's going on.
01:30 - Enjoy.
01:31 - Enjoy this Coding Challenge.
01:33 - The first step in this project
is collecting a data set.
01:35 - I could certainly
draw shapes myself
01:38 - and take pictures of them.
01:39 - But a quick way I can generate
a data set for training
01:41 - is just generating it with code.
01:43 - So in this case, I'm
going to use Processing,
01:45 - a Java-based programming
environment that I
01:47 - use in a lot of my videos.
01:49 - And I have a 128 by 128 window.
01:52 - And I just want to put a
circle in the middle of it.
01:54 - So I'm going to
say circle, width
01:56 - divided by 2, height divided by
2, and with a diameter of 100.
02:02 - Let's see what I get.
02:04 - There we go.
02:04 - There's a generated circle.
02:06 - Let's make the line thickness
a little bit thicker.
02:10 - And then let me make all sorts
of properties of that circle
02:14 - random--
02:15 - its position, its size,
and its color even.
02:18 - [MUSIC PLAYING]
02:25 - Two things I want
to change here--
02:26 - one is I want to make sure
the circle doesn't bleed off
02:29 - of the edges of
the canvas itself.
02:32 - So I can adjust it's x, y
position based on its size.
02:34 - And I want them
to be darker just
02:36 - to make them sort of higher
contrast for my training data
02:38 - set.
02:40 - Great.
02:40 - Generating lots of circles--
02:42 - then I just need to save
them to the hard drive.
02:47 - The saveFrame function will save
me a bunch of png's to a folder
02:50 - that I'm calling Data.
02:52 - And then I can use
these pound symbols.
02:54 - [LAUGHS] Is that what you
call them, or am I just, like,
02:58 - back living in the 1970s?
03:00 - These hashtags simple, you can--
03:03 - it'll auto-number them.
03:05 - And I just want to-- let's
just get 100 of them.
03:08 - So I'm going to say a
frameCount equals 100, exit.
03:16 - And here's all the circles that
I've saved at the data set.
03:19 - So now I just need
to do the same thing
03:21 - with squares and triangles.
03:23 - I could certainly try to
use a lot more shapes,
03:26 - but I think I just
want to get to work
03:27 - with three possible shapes--
03:29 - circles, squares, triangles.
03:31 - I was about to just
change my code,
03:33 - but I think I might do something
a little bit fancy here
03:36 - and write a for
loop that'll just
03:37 - do each of these three times.
03:39 - So based off of i is 0,
1, or 2, draw a circle,
03:43 - a rectangle, or a triangle.
03:47 - [MUSIC PLAYING]
03:55 - Something else I want
to do is use translate,
03:58 - because I want to actually
rotate them slightly, I think,
04:01 - the squares and the
triangles, in order
04:02 - to have a data set where they're
not all perfectly aligned
04:06 - vertically.
04:06 - [MUSIC PLAYING]
04:20 - So I could draw a triangle
any number of ways.
04:22 - I could pick random points.
04:25 - I could draw a perfectly
equilateral triangle.
04:27 - I just kind of arbitrarily set
the points to draw a triangle.
04:30 - Oh, I think I drew
it upside down
04:32 - from what I wanted it to be.
04:33 - Let's see what it looks like.
04:34 - Oh, first of all, I'm
[LAUGHS] drawing them
04:37 - all on top of each other.
04:40 - So the background should be
drawn with every for loop.
04:44 - And we could see the
triangles now, but--
04:46 - [LAUGHS] this is
silly, but I'm going
04:48 - to make this work
that I could only draw
04:50 - a triangle in one direction.
04:52 - And of course, as an
exercise, when you do this--
04:54 - if you do this yourself
and maybe afterwards,
04:56 - I'll even try to make my
data set more sophisticated.
05:03 - Oh, boy, I forgot
something-- rectMode center.
05:07 - So the circles-- the squares
are being drawn with the center
05:10 - point, so let me fix that.
05:13 - Also, I don't want to
have circles and squares
05:15 - and triangles that are going
all the way up to the edge,
05:18 - because I've got a feeling when
I start drawing these shapes,
05:21 - I'm going to be
drawing them smaller
05:23 - than the sort of camera view.
05:29 - Here's a bunch of
circles, bunch of squares.
05:33 - Wait, where are my
triangles? (LOUDLY)
05:34 - Where are my triangles?
05:36 - I forgot to include
saveFrame triangle.
05:38 - [LAUGHS] And here are
a bunch of triangles.
05:45 - Awesome.
05:46 - I've collected my data.
05:47 - How long did that take?
05:48 - Not too long, not too long--
05:49 - I'm ready to start
training the model.
05:51 - Now I have two projects.
05:54 - I have this processing sketch
that generated a lot of shapes
05:57 - and put them in a data folder.
05:58 - I now have a blank,
empty p5.js sketch
06:01 - that's just creating a canvas.
06:04 - And a really important
thing about that sketch
06:06 - is that index.html
is importing, also,
06:09 - the ml5 library at
least version 0.6.0.
06:12 - I'll note here that I'm
working in Visual Studio Code.
06:15 - I'm not working in the p5
Web Editor, which I normally
06:17 - would do.
06:18 - When I get to the part of
me doing my own drawings
06:20 - and trying to
classify them, I'll
06:22 - move them to the Web Editor.
06:23 - But right now, because I have
a directory of 300 images,
06:26 - even though I could upload them
to the p5 Web Editor probably,
06:28 - it's going to be
kind of inconvenient.
06:30 - So I want to work
with my data locally.
06:32 - So I'm going to develop locally,
and I've got a whole workflow
06:35 - [LAUGHS] series of
videos that kind of
06:37 - goes through how to do that
if that's unfamiliar to you.
06:39 - First things first-- let
me copy my Data folder over
06:42 - to my p5.js sketch.
06:45 - Then I'll add the
preload function
06:47 - to load all of the images.
06:49 - [MUSIC PLAYING]
06:59 - Ultimately, I don't love
what I just did here.
07:01 - I'm loading 300
images in preload
07:04 - to make sure
everything is loaded
07:05 - before the sketch begins.
07:06 - If I were doing this
in a different context,
07:08 - I might want to create
a loading animation
07:10 - and use callbacks and
asynchronous JavaScript.
07:12 - But this is the easiest
way to get it going.
07:15 - Ah, but this is incorrect.
07:17 - i is 0, 1, 2, and the actual
images, if I look at them,
07:22 - they start, first
of all, at number 1,
07:25 - and they have leading
0's, always four digits.
07:27 - So I can use the number format
function nf to deal with that.
07:33 - Take i-- always render it with
four digits, no decimal places.
07:38 - And then I'll call that index.
07:41 - Oh, and I'm taking i plus 1.
07:44 - And let's just draw
one of those images
07:45 - to make sure it's working.
07:49 - And how am I going to look
at this code in the browser?
07:52 - I need to run a
local web server.
07:55 - I'm using a global node
module HTTP server to do that.
07:59 - But Visual Studio
Code has Live Server
08:01 - plug-in-- so many different
ways you could do this.
08:03 - [LAUGHS]
08:04 - Let's take a look at it.
08:06 - And there we go.
08:07 - It looks a little pixelated.
08:08 - That's because, remember,
the data set I collected
08:10 - was very low-resolution
images, 128 by 128.
08:14 - Ultimately, to train the machine
learning model in this context,
08:17 - I want to use
low-resolution images
08:19 - to have less data
storage, faster results.
08:22 - And ultimately, the detail
of a high-resolution circle
08:25 - is not super meaningful here.
08:27 - Just taking a peek
at a square, also--
08:30 - there we go.
08:31 - There's one of my squares.
08:32 - All right, I think we're
in pretty good shape.
08:34 - Next step-- create a neural
network, an ml5 neural network.
08:38 - Let's call it shapeClassifier.
08:45 - Creating the neural
network is as
08:46 - easy as calling
ml5.neuralNetwork and passing
08:49 - it some options.
08:50 - So I have to figure out what are
the things I need to pass it.
08:52 - It's a JavaScript object
with some properties
08:55 - set about the neural network.
08:58 - Probably the most
important property here
09:01 - is the shape of the input data.
09:03 - What do I mean by shape?
09:04 - [DING] Well, in this case, for
doing an image classification
09:11 - problem with a convolutional
neural network,
09:14 - the dimensions of the image
are fundamental to how
09:17 - the neural network
deals with the data.
09:18 - What is the width of the image?
09:20 - What is the height?
09:21 - This is easy here.
09:21 - I know what it is.
09:22 - I made this data.
09:23 - It's 128 by 128.
09:26 - Also, however, there is
a third dimension here.
09:29 - It's not that this
is a 3D image.
09:31 - But each image, each
pixel of an image,
09:34 - has multiple numbers
associated with it--
09:37 - a red value, a green
value, a blue value,
09:39 - and an alpha value--
09:40 - so the channels of the image.
09:42 - And I probably could do this
whole project right here
09:45 - with just one channel grayscale.
09:47 - And certainly the
fourth channel, alpha,
09:48 - is irrelevant, because
the alpha value
09:50 - is 255 for every single
one of my pixels.
09:53 - But just because the data
is being loaded in this way,
09:55 - I'm going to leave it at 4
and hope to get this to work.
09:58 - And if you want
to, as an exercise,
09:59 - make this more efficient or
do it in a different way,
10:02 - I encourage you to do so.
10:03 - I also need to specify the task.
10:05 - In most of my ml5
tutorials, I just
10:07 - do the tasks classification
or regression.
10:10 - This is a special
case, where I want
10:12 - ml5 to configure a convolutional
neural network for me.
10:15 - So I'm going to indicate
image classification.
10:18 - And I could be really
detailed about how
10:21 - I configure that
convolutional neural network.
10:23 - And my convolutional neural
network videos kind of
10:25 - go through that a bit more.
10:27 - But I'm just going to use
the default ml5 settings
10:29 - and see if they work OK.
10:32 - Finally, I want to
set debug to true.
10:34 - That will trigger an automatic
visualization of the loss
10:37 - function as its training.
10:39 - What is the loss function?
10:41 - I will get to that once we
see it graphed on screen.
10:44 - I almost thought
it was done, right?
10:46 - configured my neural network.
10:47 - Here's the shape of the data.
10:49 - Here's the task I want to do.
10:50 - And make sure you
show me how it's
10:51 - going while you're running.
10:52 - But I have to add the data.
10:55 - I have to tell the neural
network, this is the data,
10:58 - you should be working with when
you run your training process.
11:00 - Luckily for me,
there's a function
11:02 - in ml5 called add data.
11:04 - And what do I add?
11:05 - I add the image and
its associated label.
11:08 - Let's look at how that works.
11:09 - [MUSIC PLAYING]
11:16 - The training data set
should include the input
11:18 - associated with its target,
the image associated
11:21 - with its label.
11:22 - So I can configure an object
with an image property that
11:25 - is this actual circle image.
11:26 - ml5 knows about p5 images.
11:28 - I could-- ml5 can work
with raw pixel data,
11:31 - but this is super
convenient here,
11:33 - that I can just give it
the p5 image I loaded.
11:35 - And then the label, of
course, is a string.
11:40 - I wanted to show it to you
written out like this just
11:42 - to be clear about
exactly what's going on.
11:45 - But I can kind of reduce this.
11:46 - There's no reason why I
need separate variables.
11:48 - I can just put these JavaScript
objects right into the add data
11:51 - function itself.
11:55 - And once I've done that,
what's super convenient is,
11:57 - because I'm having squares
and triangles also,
12:01 - I can just duplicate that.
12:05 - (DRAMATIC VOICE) Oh,
triangle, why do you
12:07 - have to have a different
number of characters
12:09 - than circles and squares?
12:10 - Another really
important step here
12:12 - is to call normalized data.
12:15 - This is one of the ultimate
conveniences of working
12:17 - with the ml5 library.
12:18 - It will analyze your data, look
at the minimums and maximum
12:22 - ranges of pixel values, and
then normalize all the inputs
12:26 - to numbers between 0 and 1.
12:28 - Certainly we could
do this manually.
12:30 - I've demonstrated
that in other videos.
12:32 - But it's a nice convenience
that ml5 offers to you.
12:36 - Call normalized data,
and then guess what?
12:39 - Now we really are done
with training code.
12:41 - Look, this is all the
code for training an image
12:43 - classification model
in ml5 besides writing
12:46 - shapeClassifier.train.
12:50 - Now, the train function
does-- choo-choo [LAUGHS]----
12:53 - require two arguments.
12:56 - Well, what a nice
confluence of events--
12:58 - The Coding Train
trains the model.
13:01 - The arguments that I need
are any training options.
13:04 - So there's lots of
properties and parameters
13:06 - I can set during training.
13:07 - Those are covered in more
detail in other ml5 videos
13:10 - that I have.
13:11 - In this case, the only one
I really want to specify
13:13 - is epochs.
13:16 - And I'm going to say 50.
13:18 - 50 means I want to send
all of the data all
13:21 - 300 images in through the
neural network 50 times.
13:24 - And you might be
wondering, does the order
13:26 - of the data as I'm
adding it matter?
13:28 - In fact, it does.
13:29 - But luckily for
us, ml5 does a lot
13:32 - of smart things
behind the scenes.
13:33 - And it's going to shuffle
the order of the data.
13:35 - You want the data to
be in random order,
13:37 - in different order,
every training pass.
13:40 - And then I need a callback to
let me know when it's done,
13:43 - so I'll say finishedTraining.
13:45 - And let me write that function.
13:50 - And all I'm going to do is
console.log that it's finished.
13:53 - For testing purposes,
[LAUGHS] I think
13:55 - it would be advisable for
me to actually run this once
13:58 - with many fewer images.
13:59 - So I'm want to switch this 100
to 10 just have it load 10--
14:03 - 30 images in total.
14:04 - I don't know if we'll get
meaningful results with just 30
14:07 - images, but let's see.
14:08 - I hit Refresh.
14:10 - Why, why, why is
nothing happening?
14:12 - Oh, failed to load-- no.
14:13 - Finished training--
stop one second.
14:16 - I just lost like a half
an hour of my life.
14:18 - [LAUGHS] I can't even tell
you what just happened.
14:22 - But this debug true--
14:25 - the true shouldn't be in quotes.
14:27 - I need to actually give it
the Boolean value true itself.
14:30 - In truth, I think
this is a bug in ml5,
14:32 - and this can be
fixed, that ml5 will
14:34 - work whether you give
true as a string or just
14:37 - the Boolean value true.
14:38 - But just-- [LAUGHS]
it wasn't working.
14:41 - So now that I've found
that and fixed that,
14:44 - I am now going to go back
and refresh this page
14:48 - and see if it will train
with just those 30 images.
14:54 - And there we go.
14:55 - So here I see the configuration
of the convolutional neural
14:59 - network.
14:59 - A lot of these terms might be
sort of scary and unfamiliar
15:02 - to you.
15:02 - You can go back to my
convolutional neural network
15:04 - video series to learn more.
15:06 - And then look at this.
15:07 - Over 50 epochs were
getting this loss,
15:10 - a measure of the error
during the training process.
15:13 - How close is the model matching,
fitting that training data
15:17 - all the way down to 0?
15:19 - So this is a very good sign,
that this graph is going down.
15:22 - I'm going to add one
more line of code,
15:24 - because what I want to do when
it finishes training is I also
15:27 - want to save the model so that
I don't have to run the training
15:30 - process again.
15:31 - I'm going to freeze that model.
15:35 - I'm going to put it
back to 100 images
15:38 - and run that training process
again and maybe take a break
15:41 - and do some meditative deep
breathing for a little while.
15:47 - Notice how long it takes even to
load all 300 of those images--
15:50 - not a very elegant
loading progress bar
15:53 - that I've got going on here.
15:57 - I'll let this run.
15:58 - I'll be back in a few minutes.
15:59 - [MUSIC PLAYING]
16:05 - So this is the
result I'm getting,
16:07 - which is a little bit odd.
16:08 - First of all, it's
running incredibly slow.
16:11 - And oh, now that
loss is going down.
16:13 - I'm feeling like I think I might
have pushed it a little bit too
16:17 - much with my 128 by 128 images.
16:21 - And I think maybe reducing
the resolution to 64 by 64
16:24 - will give me the same accuracy
in my ultimate results
16:27 - but will allow me to sort of
train the model much faster.
16:30 - But I'm not exactly sure why
it's having such difficulty
16:33 - learning here.
16:35 - And the loss is kind of
fluctuating quite a bit.
16:38 - And at 50 epochs,
we didn't really
16:40 - get all the way down to the
bottom sort of threshold
16:43 - that I'm used to seeing.
16:44 - I'm going to return back
to my processing code.
16:47 - I'm going to lower the
resolution to 64 by 64.
16:51 - In a way, I want to make
the stroke weight thicker.
16:53 - But I think,
actually, by lowering
16:55 - the resolution, the
stroke weight itself
16:57 - will be relatively thicker.
16:58 - And I think that will make the
images a bit more bold and more
17:01 - clear to the neural
network, perhaps.
17:05 - And then, also, I don't want
them to bleed off the edge.
17:09 - So I am going to make r a
random value between 8 and 24.
17:17 - Let's run this.
17:21 - I'm going to delete my old data.
17:24 - I'm going to copy the new data
in, go back to my p5 code,
17:29 - change the inputs to 64 by 64.
17:33 - And this is reducing the
number of pixels by 4.
17:37 - It's exponential here.
17:38 - Looking through everything, and
let me try running it again.
17:45 - At a minimum, it should
train much faster now,
17:48 - with the data size
being much smaller.
17:52 - And looks like the
loss is going down.
17:53 - I'm going to go
take a little break
17:55 - and come back in a minute.
17:58 - Ah.
17:59 - So I don't know
really if I just got
18:01 - kind of unlucky with that
initial data set, but certainly
18:05 - having it run faster would allow
me to experiment a bit more.
18:08 - And the ultimate goal
of what I'm doing here
18:10 - is not to train the perfect
shapeClassifier but to show
18:13 - you the steps and
tools along the way
18:15 - for you to experiment with
different kinds of data
18:17 - and different ways
of doing this.
18:19 - Great.
18:20 - So my model now, because
I had the save function,
18:22 - has saved to the
Downloads folder
18:25 - of the-- the default Downloads
folder of the browser.
18:28 - Looking at the
Downloads folder, you'll
18:29 - see there's lots of
model files, because I'm
18:32 - doing this constantly in lots
of different experiments.
18:34 - But I think the most
recent ones at 10:34 am
18:37 - are the ones that I want.
18:39 - Let me grab that.
18:40 - I'm just going to go back
to my shapeClassifier
18:42 - I'm going to make a
folder called model.
18:45 - I'm going to paste it in here.
18:47 - And then I'm going to rename
these without the numbering.
18:50 - What is in those files?
18:51 - All of the information
around the architecture
18:54 - of the neural network and the
weights of the neural network.
18:57 - And this is topics that I've
covered in much more detail
18:59 - in my ml5 series.
19:01 - So if I wanted to
now, I could start
19:03 - to add the prediction code
to this example I could even
19:07 - have training and
prediction all happening
19:09 - in the same web application.
19:11 - But I want to separate
those two things.
19:13 - I want to take the
frozen saved model that's
19:15 - now completely
divorced from the data,
19:18 - and I want to upload that
to a p5 Web Editor sketch.
19:20 - The nice thing about this
is I could ultimately
19:22 - keep my train--
19:23 - doesn't matter so
much in this case,
19:25 - but I can keep my
training data private.
19:27 - There's ultimately no way to
reverse-engineer the training
19:30 - data from the trained
neural network itself.
19:32 - So that's something that I could
be sort of happy about if I
19:35 - was worried about that data
uploading to a public web
19:38 - application.
19:39 - So here I am in
the p5 Web Editor.
19:41 - First thing I want to
do is upload the model.
19:44 - Create a folder called Model--
19:47 - Upload File.
19:49 - Grab these three
files, drag them in.
19:52 - I also want to make sure that
I'm importing the ml5 library
19:54 - itself.
19:55 - So I can just copy that
from where I did it before.
19:58 - I need this CDN URL.
20:01 - Paste it in right here.
20:03 - Create the Shape Classifier.
20:06 - I can actually grab
the exact same code
20:08 - I had before to initialize
the Shape Classifier variable.
20:12 - I don't need debug
to be true anymore.
20:14 - I'm not doing any training here.
20:16 - And I also don't
need to add any data
20:20 - or call the train function.
20:21 - I could just load the
pre-trained model.
20:25 - Now, remember the
model data itself is
20:27 - saved in three separate files.
20:28 - And I need to give ml5 the
names of all of those files.
20:32 - I can never remember
[LAUGHS] what
20:34 - the code is for doing this.
20:35 - The easiest place to find out is
right in the ml5 documentation
20:39 - under Neural Network, under
Loading a pre-trained Model.
20:43 - And here we go-- model details,
model, metadata, weights.
20:48 - The file names happen
to be the same,
20:49 - so I could just put model
details right in here.
20:52 - And then I also need
a variable model--
20:54 - not a variable, sorry--
a callback, a variable
20:57 - to define the callback,
model loaded for when
21:01 - the model has been loaded.
21:05 - So let's run this,
which all it's doing
21:06 - is loading the model.
21:07 - See if I get it to
say model loaded
21:09 - in the console with no errors.
21:11 - Excellent.
21:12 - Now I want to pass it in image.
21:15 - So just as a first test,
let me draw a shape
21:18 - into the p5 canvas.
21:20 - This is not one that was
in the training data set.
21:23 - I'm going to draw
my own, and then
21:24 - give it to the neural
network and see
21:26 - what results I get
back. (DRAMATIC VOICE)
21:28 - And I'm going to have to say my
little model prediction prayer
21:31 - and hope that it works.
21:33 - [MUSIC PLAYING]
21:37 - So I've hard-coded
[LAUGHS] in a circle
21:40 - right there in the center.
21:41 - This should be a
pretty reasonable one
21:43 - for me to get the correct
result from the neural network
21:46 - if the training worked well.
21:49 - I'm going to ask
it for a prediction
21:52 - when I click the mouse.
21:53 - So I'll say
shapeClassifier, classify.
21:57 - And then what I'm giving
it now is the canvas.
22:02 - And then I'm going to have
another callback for when
22:06 - it's got results back
for its classification.
22:09 - Oh, and by the way,
canvas-- it's not
22:10 - going to know what canvas is.
22:12 - I need to make canvas a
variable and save createCanvas
22:17 - in that variable that's
a reference to the canvas
22:19 - that I'm drawing that
I can pass to ml5.
22:21 - I've got a resolution
issue here.
22:23 - Oh, and by the way,
this should be 64, 64.
22:26 - I accidentally somehow
didn't have the right code
22:29 - when I copied it over.
22:30 - But I remember now that the
training data was 64 by 64.
22:33 - It's got to match here.
22:35 - [MUSIC PLAYING]
22:40 - So this is some
standard boilerplate
22:42 - for the results callback.
22:44 - If there was an error,
console.log that error
22:47 - and then jump out of here.
22:48 - Otherwise, let's just look
at what the results are.
22:51 - Now, I think I'm
going to get an error,
22:52 - because my canvas
resolution does not
22:54 - match what the neural
network's expecting.
22:56 - So let's just see
what that looks like.
22:59 - And I'll click the mouse.
23:00 - Great.
23:01 - Ah.
23:01 - Based on the provided
shape, 1, 64, 64,
23:04 - the tensor should have blah,
blah, blah, blah, blah, blah,
23:06 - blah, blah, blah,
blah, blah, blah, blah.
23:07 - Look at this.
23:08 - It's an actual confusing,
weird, esoteric, machine
23:11 - learning error message that
we can understand, [LAUGHS]
23:14 - because you're going to get
these kind of error messages
23:15 - all the time.
23:16 - And sometimes you're
going to be like, why?
23:17 - What's going on?
23:18 - But underneath the hood,
the tensorflow.js library
23:21 - which drives ml5 is looking
for one image, which
23:25 - is 64 by 64 by 4.
23:28 - And it got something else with
640,000 data points in it.
23:32 - And that's just wrong.
23:33 - So [LAUGHS] I need to get this
image into a low resolution.
23:36 - The quickest way for me
to do this, to be honest,
23:38 - just for testing purposes, would
be for me to change this to 64
23:41 - by 64, [LAUGHS] if you will
indulge me for a second.
23:46 - I'll make the stroke weight a
little bit less and, obviously,
23:49 - not as large.
23:54 - Oh, wait.
23:54 - Oh, nope.
23:55 - Also, [LAUGHS] it's
drawn in the wrong place.
24:01 - (HIGH-PITCHED VOICE) There's
my tiny little circle.
24:03 - Let's see what the model says.
24:05 - We got some results back.
24:08 - Drum roll, please.
24:09 - [DRUM ROLL]
24:12 - Ha!
24:12 - It knew it's a circle--
24:14 - 99%.
24:15 - That's super thrilling.
24:16 - Let's just try, really
quickly, a rectangle.
24:24 - Drum roll, please.
24:26 - [DRUM ROLL]
24:29 - Ah, square-- 98% square.
24:32 - Oh, it is so confident.
24:33 - Thank you, neural
network friend.
24:36 - So this is working with
data that matches precisely
24:40 - the training data set.
24:41 - Let me just briefly
show you how you
24:42 - can resize an
image, because what
24:44 - if you wanted to create
something where I'm actually--
24:46 - I could create something where
I'm drawing with the mouse.
24:48 - Ooh, let's do that.
24:49 - We're going to draw
with the mouse,
24:50 - and then I'm going to
draw with pen and paper.
24:53 - We'll see if it works
for one or both of them.
24:57 - I'm going to go
back to 400 by 400.
24:59 - And when I click
the mouse, I'm going
25:01 - to create a separate
graphics object.
25:04 - I'll call it input.
25:07 - That's 64 by 64.
25:10 - And then, I believe, in p5,
there's a way for me to copy
25:13 - one image to another and
reduce its resolution--
25:17 - something like
input.copy(canvas)--
25:23 - something like that.
25:24 - Let's look at the p5 reference.
25:26 - Right here, under loading
and displaying pixels,
25:28 - there's a copy function.
25:30 - Oh, I wonder if I can use
this get function, actually.
25:32 - But let's look at copy--
25:33 - copies a region of the canvas
to another region of the canvas.
25:36 - So it's really-- but it could
also copy from a source image.
25:40 - And I think I can call this
function on a p5 image itself,
25:45 - or in this case,
not a p5 image-- oh,
25:47 - do I want a p5 image or
a p5 graphics object.
25:50 - I don't actually know.
25:52 - Let me keep going with this.
25:54 - But certainly I
want a source image,
25:55 - and I want the
source xy with height
25:57 - to the destination
xy with height.
25:59 - Let's see if I can
make this work.
26:01 - So I want to copy from
the canvas 0, 0, 400,
26:05 - 400 to 0, 0, 64, 64.
26:09 - And actually, I'm just not
going to bother with trying
26:12 - to run the classification.
26:13 - Let me just see, then, if
I draw that input image.
26:19 - Let's see if that works.
26:20 - Oh, and let me put in
the draw function now.
26:26 - If mouse is pressed, line--
26:32 - from the mouse to
the previous mouse.
26:33 - So I could draw
something in the canvas.
26:37 - So this is-- whoa!
26:38 - Whaa-- what is going on?
26:41 - mouseX, mouseX-- we need a Y.
We don't need background here.
26:46 - I need a stroke weight
that's much thicker.
26:50 - And by the way,
[LAUGHS] this is bad.
26:52 - Let's make this
keyPressed now, [LAUGHS]
26:54 - because I have to
draw the mouse.
26:56 - I have to press the mouse to
render the drawing at lower
26:58 - resolution.
27:00 - Ahh.
27:01 - Put background at 255 in
setup, try this again.
27:05 - So this is me drawing.
27:06 - Ultimately, I'm going
to try to draw a square
27:08 - and have it recognize it.
27:09 - Let's press a key.
27:11 - Oh, look at that.
27:13 - It worked.
27:13 - There's my 64 by
64, so that worked.
27:15 - Ah, it's so easy.
27:17 - Ah, beautiful.
27:18 - Oh, [KISS SOUND].
27:19 - I love this.
27:20 - OK, so now let's make
this stroke weight 8.
27:25 - So I make it much thicker.
27:26 - And I don't need to,
when I press the key,
27:29 - classify the image.
27:33 - I want to do this always.
27:34 - Let's make this a function
called classifyImage.
27:39 - And I'm going to
start doing that
27:41 - as soon as the model is loaded--
27:43 - classifyImage.
27:44 - And once I get some
results, I'm going
27:48 - to call classifyImage again.
27:51 - And then I don't want to
console.log the results.
27:53 - I want to see the results
in the actual web page.
27:56 - So very quickly, let me change
the background of the web page.
28:03 - This is, like, the actual only
thing I know how to do in CSS.
28:08 - And let's make it
a little bit gray
28:10 - just so I can see the
canvas more clearly.
28:12 - OK, great.
28:13 - And then we can see it's
logging those results.
28:17 - But I don't want to log them.
28:18 - I want to see the results.
28:22 - I'll make a div to
show the results.
28:26 - I'll start it with it
saying loading model.
28:30 - And then the label is
results index 0 dot label.
28:36 - And the confidence is results
index 0 dot confidence.
28:40 - One of these days,
I'll use something
28:42 - called object destructuring.
28:43 - I got to make a video to
show you how to do that.
28:45 - But I like to write it
in this longhand way.
28:48 - And then let's just put--
oh, and it's not labels.
28:50 - I want it to be the label.
28:51 - Now, I want to see the label
and then also the confidence.
28:59 - And I'm going to do some
stuff to this confidence.
29:01 - I'm going to just make sure it
only shows two digits, number
29:07 - format it, and also
multiply it by 100 so it's
29:11 - kind of like a percentage.
29:12 - I'm going to show it
like a percentage.
29:14 - I think that's right.
29:16 - Let's run it.
29:18 - Loading model-- error,
cannot read property HTML
29:21 - of undefined-- resultsDiv.
29:25 - results-- that should
say resultsDiv.
29:27 - Another thing,
actually, is I don't
29:29 - need to make a new graphics
object every single time.
29:32 - This could be a global variable.
29:40 - Just move that stuff
around, and here we go.
29:42 - Let's try this now.
29:44 - Loading model-- square.
29:45 - It's a square.
29:47 - Let's draw a square and see if
we can make it more confident.
29:51 - Square.
29:52 - Now, I don't need to see
the little tiny image.
29:55 - That's useful here.
29:56 - But I don't need to see
that, so I can take that out.
30:03 - OK, oh, and let me make
that much bigger [LAUGHS]
30:05 - so you can actually
see it, also.
30:08 - I do know a tiny bit more CSS.
30:11 - I think this will do the trick.
30:13 - Let's make it really big.
30:18 - OK, square.
30:19 - All right, let's draw a circle.
30:22 - Oh look at that.
30:23 - [KISS SOUND] It's so beautiful.
30:24 - Oh, I don't have a clear.
30:26 - I need a clear button.
30:27 - I could just run it again.
30:29 - [LAUGHS] Triangle.
30:32 - I need a clear button.
30:33 - [MUSIC PLAYING]
30:40 - So I'm just putting a tiny
little anonymous function
30:43 - as the callback for mouse
press would draw a background.
30:46 - Let's run this again.
30:49 - And circle, square--
[LAUGHS] it's a triangle.
30:57 - (DRAMATIC VOICE)
Oh, I love this.
30:58 - It makes me so
happy that it works.
31:00 - Yes!
31:01 - [LAUGHS]
31:02 - All right, now, for
the grand finale,
31:06 - I will, instead of drawing
the shapes with the mouse,
31:10 - I will now take this
document camera-- of course,
31:13 - any web camera will do.
31:15 - But I will take this document
camera pointed at my notepad
31:18 - and attempt to draw on
my notepad with this pen
31:22 - and see if it will
recognize the shapes.
31:23 - So give me a minute
I set this up.
31:25 - I'm going to duplicate
this, because I want
31:27 - to save this as an example.
31:29 - The only thing I
need to change--
31:31 - well, there's probably a
bunch of things to change,
31:33 - but let's create a video.
31:37 - Video equals
createCapture video.
31:42 - Then I'm going to actually
just resize it to 64 by 64.
31:46 - I think that will
make my life easier.
31:48 - The Clear button is
no longer relevant,
31:50 - so I can comment that out.
31:52 - classifyImage-- I don't
need to do this copying.
31:55 - I can just classify
the video itself.
31:59 - In the draw function, I will
just see image, video 0, 0.
32:05 - And I think that's
all I need to change
32:07 - to go from the drawing in
the canvas to the video.
32:09 - Let's see.
32:10 - What did I miss?
32:11 - Well, first of all, it is
not using my document camera
32:14 - right now.
32:15 - (HIGH-PITCHED VOICE)
Hello, how are you?
32:18 - Let me also stretch out
the video to the canvas
32:20 - so we can see.
32:21 - And by the way, the
answer to life's mystery--
32:24 - am I a circle or a triangle?
32:26 - I don't know.
32:28 - Do I have a tri--
32:29 - I have a triangular head.
32:30 - I'm very triangular.
32:31 - [LAUGHS] Let me try to switch
this to the document camera.
32:35 - And I think a way to
do that is I can just
32:36 - click up here and go to--
32:39 - [HEAVY SIGH] come on, come on--
32:40 - Manage, switch it to this
camera, and run it again.
32:45 - And great-- I've got
my document camera.
32:48 - Here we go, everybody.
32:49 - Drum roll, please.
32:51 - [DRUM ROLL]
32:55 - Square.
32:56 - It's a circle.
32:57 - Eh, circle-- like,
not too confident,
32:59 - but I did get circle.
33:01 - All right, let's try a triangle.
33:08 - Square-- come on.
33:09 - So my suspicion here is that
I might need a thicker marker.
33:13 - Let's try making it
a little thicker.
33:17 - There we go.
33:17 - Look at that-- triangle, 91%.
33:20 - So I think the fact--
33:22 - I probably should,
in my data set,
33:24 - train with variable
stroke weights.
33:27 - If I redid this whole thing and
trained it with variable stroke
33:30 - rate weights, I might
get a better result.
33:32 - But we can see here
triangle, 90%, square, 97%.
33:41 - Now it's time.
33:42 - I'm going to attempt
to draw a circle.
33:49 - Ta-da!
33:49 - [TRIUMPHANT MUSIC PLAYING]
33:50 - OK, I think this Coding
Challenge is complete.
33:53 - I have now shown
you all the steps
33:56 - for collecting a data
set of shapes generated
33:59 - from processing, loading
all of those image files
34:02 - into a p5.js sketch
with ml5 and training
34:06 - a convolutional neural
network with that data set.
34:09 - Then we have looked at how I
can get images from a webcam
34:13 - and show those to a p5.js sketch
that has that model loaded
34:17 - and recognize the shape.
34:19 - Imagine the possibilities
of what you could do.
34:22 - I hope you do something
totally different
34:25 - and surprise me with what
kind of data you use,
34:28 - what kind of
interaction you use,
34:30 - and you make your own
wonderful experiment here.
34:33 - Now, what is next?
34:34 - Something that I'd
really like to do
34:36 - is, what if I were
to draw a cat?
34:44 - Now, that cat is most
definitely a triangular cat.
34:47 - So I feel like that's a
very accurate prediction.
34:50 - But what if I wanted to say cat?
34:52 - Could I collect a data
set of lots of drawings
34:55 - and recognize them?
34:57 - So you might have heard of the
Google Quick, Draw data set.
35:00 - It's definitely a
data set I've referred
35:01 - to in many previous videos.
35:04 - I could do a whole
series now where
35:05 - I could download
that data set and try
35:07 - to train an ml5
convolutional neural network
35:09 - model against it.
35:10 - Luckily for us, Yining Shi,
one of the ml5 contributors,
35:15 - already did this.
35:16 - And in ml5 you can load
a pre-trained model
35:18 - called doodleNet.
35:19 - And so in the next video,
which should hopefully
35:21 - be a very short one, [LAUGHS]
I'm just going to show you,
35:23 - basically, this
exact same sketch.
35:25 - But I'm going to load
Yining Shi's doodleNet model
35:28 - and see if it can-- how it
recognizes my drawings that
35:32 - are not just of simple
shapes like squares circles
35:36 - and triangles.
35:37 - Thanks for watching this video.
35:38 - I hope you enjoyed it.
35:39 - I hope you are able to learn
something and make something
35:42 - creative with it.
35:43 - And I can't wait to see you--
35:44 - what happens in
future videos and all
35:46 - that jazz and jazz hands is
my official new sign-off.
35:49 - No?
35:49 - That's not going to work?
35:50 - What do you think about that?
35:51 - I don't know.
35:51 - Goodbye.
35:52 - [KISS SOUND]
35:53 - [MUSIC PLAYING]

Cleaned transcript:

[BLOWS TRAIN WHISTLE] Hello, and welcome to a 2020 substitute train whistle Coding Train Coding. I am so excited for you to watch this one. I just finished making it. So I'm just recording a little intro here to show you the end result, because this one might be kind of long. So you can see, ultimately, where I get to. I have a p5.js sketch that is loading a neural network, a convolutional neural network, model that I trained myself in this video with my own data to recognize shapes. It only knows about circles, squares, and triangles. But I have this document camera here live and running. You see my hand there. I just drew that circle, and it is guessing with a 75% confidence that it is a circle. Let's now see some other shapes. Here is a triangle 76%. And I can switch this over, and I can look at this square. And boy, is it confident that that's a square. I can even kind of turn it sideways. Oh, it thinks it's a circle now. So there are some flaws. And you will see why those flaws might be there as you watch this video. So what do you need before you get started? I used Processing. You can download that at Processing.org. I used p5.js you can get through Web Editor at editor.p5.js.org. And I am also working with p5.js locally on my computer, which is something you might want to check out my workflow series if that's unfamiliar to you. See you at the end of this video. I no, I won't see you at the end. I mean, I don't see you anyway. I don't know what's going on. Enjoy. Enjoy this Coding Challenge. The first step in this project is collecting a data set. I could certainly draw shapes myself and take pictures of them. But a quick way I can generate a data set for training is just generating it with code. So in this case, I'm going to use Processing, a Javabased programming environment that I use in a lot of my videos. And I have a 128 by 128 window. And I just want to put a circle in the middle of it. So I'm going to say circle, width divided by 2, height divided by 2, and with a diameter of 100. Let's see what I get. There we go. There's a generated circle. Let's make the line thickness a little bit thicker. And then let me make all sorts of properties of that circle random its position, its size, and its color even. [MUSIC PLAYING] Two things I want to change here one is I want to make sure the circle doesn't bleed off of the edges of the canvas itself. So I can adjust it's x, y position based on its size. And I want them to be darker just to make them sort of higher contrast for my training data set. Great. Generating lots of circles then I just need to save them to the hard drive. The saveFrame function will save me a bunch of png's to a folder that I'm calling Data. And then I can use these pound symbols. [LAUGHS] Is that what you call them, or am I just, like, back living in the 1970s? These hashtags simple, you can it'll autonumber them. And I just want to let's just get 100 of them. So I'm going to say a frameCount equals 100, exit. And here's all the circles that I've saved at the data set. So now I just need to do the same thing with squares and triangles. I could certainly try to use a lot more shapes, but I think I just want to get to work with three possible shapes circles, squares, triangles. I was about to just change my code, but I think I might do something a little bit fancy here and write a for loop that'll just do each of these three times. So based off of i is 0, 1, or 2, draw a circle, a rectangle, or a triangle. [MUSIC PLAYING] Something else I want to do is use translate, because I want to actually rotate them slightly, I think, the squares and the triangles, in order to have a data set where they're not all perfectly aligned vertically. [MUSIC PLAYING] So I could draw a triangle any number of ways. I could pick random points. I could draw a perfectly equilateral triangle. I just kind of arbitrarily set the points to draw a triangle. Oh, I think I drew it upside down from what I wanted it to be. Let's see what it looks like. Oh, first of all, I'm [LAUGHS] drawing them all on top of each other. So the background should be drawn with every for loop. And we could see the triangles now, but [LAUGHS] this is silly, but I'm going to make this work that I could only draw a triangle in one direction. And of course, as an exercise, when you do this if you do this yourself and maybe afterwards, I'll even try to make my data set more sophisticated. Oh, boy, I forgot something rectMode center. So the circles the squares are being drawn with the center point, so let me fix that. Also, I don't want to have circles and squares and triangles that are going all the way up to the edge, because I've got a feeling when I start drawing these shapes, I'm going to be drawing them smaller than the sort of camera view. Here's a bunch of circles, bunch of squares. Wait, where are my triangles? (LOUDLY) Where are my triangles? I forgot to include saveFrame triangle. [LAUGHS] And here are a bunch of triangles. Awesome. I've collected my data. How long did that take? Not too long, not too long I'm ready to start training the model. Now I have two projects. I have this processing sketch that generated a lot of shapes and put them in a data folder. I now have a blank, empty p5.js sketch that's just creating a canvas. And a really important thing about that sketch is that index.html is importing, also, the ml5 library at least version 0.6.0. I'll note here that I'm working in Visual Studio Code. I'm not working in the p5 Web Editor, which I normally would do. When I get to the part of me doing my own drawings and trying to classify them, I'll move them to the Web Editor. But right now, because I have a directory of 300 images, even though I could upload them to the p5 Web Editor probably, it's going to be kind of inconvenient. So I want to work with my data locally. So I'm going to develop locally, and I've got a whole workflow [LAUGHS] series of videos that kind of goes through how to do that if that's unfamiliar to you. First things first let me copy my Data folder over to my p5.js sketch. Then I'll add the preload function to load all of the images. [MUSIC PLAYING] Ultimately, I don't love what I just did here. I'm loading 300 images in preload to make sure everything is loaded before the sketch begins. If I were doing this in a different context, I might want to create a loading animation and use callbacks and asynchronous JavaScript. But this is the easiest way to get it going. Ah, but this is incorrect. i is 0, 1, 2, and the actual images, if I look at them, they start, first of all, at number 1, and they have leading 0's, always four digits. So I can use the number format function nf to deal with that. Take i always render it with four digits, no decimal places. And then I'll call that index. Oh, and I'm taking i plus 1. And let's just draw one of those images to make sure it's working. And how am I going to look at this code in the browser? I need to run a local web server. I'm using a global node module HTTP server to do that. But Visual Studio Code has Live Server plugin so many different ways you could do this. [LAUGHS] Let's take a look at it. And there we go. It looks a little pixelated. That's because, remember, the data set I collected was very lowresolution images, 128 by 128. Ultimately, to train the machine learning model in this context, I want to use lowresolution images to have less data storage, faster results. And ultimately, the detail of a highresolution circle is not super meaningful here. Just taking a peek at a square, also there we go. There's one of my squares. All right, I think we're in pretty good shape. Next step create a neural network, an ml5 neural network. Let's call it shapeClassifier. Creating the neural network is as easy as calling ml5.neuralNetwork and passing it some options. So I have to figure out what are the things I need to pass it. It's a JavaScript object with some properties set about the neural network. Probably the most important property here is the shape of the input data. What do I mean by shape? [DING] Well, in this case, for doing an image classification problem with a convolutional neural network, the dimensions of the image are fundamental to how the neural network deals with the data. What is the width of the image? What is the height? This is easy here. I know what it is. I made this data. It's 128 by 128. Also, however, there is a third dimension here. It's not that this is a 3D image. But each image, each pixel of an image, has multiple numbers associated with it a red value, a green value, a blue value, and an alpha value so the channels of the image. And I probably could do this whole project right here with just one channel grayscale. And certainly the fourth channel, alpha, is irrelevant, because the alpha value is 255 for every single one of my pixels. But just because the data is being loaded in this way, I'm going to leave it at 4 and hope to get this to work. And if you want to, as an exercise, make this more efficient or do it in a different way, I encourage you to do so. I also need to specify the task. In most of my ml5 tutorials, I just do the tasks classification or regression. This is a special case, where I want ml5 to configure a convolutional neural network for me. So I'm going to indicate image classification. And I could be really detailed about how I configure that convolutional neural network. And my convolutional neural network videos kind of go through that a bit more. But I'm just going to use the default ml5 settings and see if they work OK. Finally, I want to set debug to true. That will trigger an automatic visualization of the loss function as its training. What is the loss function? I will get to that once we see it graphed on screen. I almost thought it was done, right? configured my neural network. Here's the shape of the data. Here's the task I want to do. And make sure you show me how it's going while you're running. But I have to add the data. I have to tell the neural network, this is the data, you should be working with when you run your training process. Luckily for me, there's a function in ml5 called add data. And what do I add? I add the image and its associated label. Let's look at how that works. [MUSIC PLAYING] The training data set should include the input associated with its target, the image associated with its label. So I can configure an object with an image property that is this actual circle image. ml5 knows about p5 images. I could ml5 can work with raw pixel data, but this is super convenient here, that I can just give it the p5 image I loaded. And then the label, of course, is a string. I wanted to show it to you written out like this just to be clear about exactly what's going on. But I can kind of reduce this. There's no reason why I need separate variables. I can just put these JavaScript objects right into the add data function itself. And once I've done that, what's super convenient is, because I'm having squares and triangles also, I can just duplicate that. (DRAMATIC VOICE) Oh, triangle, why do you have to have a different number of characters than circles and squares? Another really important step here is to call normalized data. This is one of the ultimate conveniences of working with the ml5 library. It will analyze your data, look at the minimums and maximum ranges of pixel values, and then normalize all the inputs to numbers between 0 and 1. Certainly we could do this manually. I've demonstrated that in other videos. But it's a nice convenience that ml5 offers to you. Call normalized data, and then guess what? Now we really are done with training code. Look, this is all the code for training an image classification model in ml5 besides writing shapeClassifier.train. Now, the train function does choochoo [LAUGHS] require two arguments. Well, what a nice confluence of events The Coding Train trains the model. The arguments that I need are any training options. So there's lots of properties and parameters I can set during training. Those are covered in more detail in other ml5 videos that I have. In this case, the only one I really want to specify is epochs. And I'm going to say 50. 50 means I want to send all of the data all 300 images in through the neural network 50 times. And you might be wondering, does the order of the data as I'm adding it matter? In fact, it does. But luckily for us, ml5 does a lot of smart things behind the scenes. And it's going to shuffle the order of the data. You want the data to be in random order, in different order, every training pass. And then I need a callback to let me know when it's done, so I'll say finishedTraining. And let me write that function. And all I'm going to do is console.log that it's finished. For testing purposes, [LAUGHS] I think it would be advisable for me to actually run this once with many fewer images. So I'm want to switch this 100 to 10 just have it load 10 30 images in total. I don't know if we'll get meaningful results with just 30 images, but let's see. I hit Refresh. Why, why, why is nothing happening? Oh, failed to load no. Finished training stop one second. I just lost like a half an hour of my life. [LAUGHS] I can't even tell you what just happened. But this debug true the true shouldn't be in quotes. I need to actually give it the Boolean value true itself. In truth, I think this is a bug in ml5, and this can be fixed, that ml5 will work whether you give true as a string or just the Boolean value true. But just [LAUGHS] it wasn't working. So now that I've found that and fixed that, I am now going to go back and refresh this page and see if it will train with just those 30 images. And there we go. So here I see the configuration of the convolutional neural network. A lot of these terms might be sort of scary and unfamiliar to you. You can go back to my convolutional neural network video series to learn more. And then look at this. Over 50 epochs were getting this loss, a measure of the error during the training process. How close is the model matching, fitting that training data all the way down to 0? So this is a very good sign, that this graph is going down. I'm going to add one more line of code, because what I want to do when it finishes training is I also want to save the model so that I don't have to run the training process again. I'm going to freeze that model. I'm going to put it back to 100 images and run that training process again and maybe take a break and do some meditative deep breathing for a little while. Notice how long it takes even to load all 300 of those images not a very elegant loading progress bar that I've got going on here. I'll let this run. I'll be back in a few minutes. [MUSIC PLAYING] So this is the result I'm getting, which is a little bit odd. First of all, it's running incredibly slow. And oh, now that loss is going down. I'm feeling like I think I might have pushed it a little bit too much with my 128 by 128 images. And I think maybe reducing the resolution to 64 by 64 will give me the same accuracy in my ultimate results but will allow me to sort of train the model much faster. But I'm not exactly sure why it's having such difficulty learning here. And the loss is kind of fluctuating quite a bit. And at 50 epochs, we didn't really get all the way down to the bottom sort of threshold that I'm used to seeing. I'm going to return back to my processing code. I'm going to lower the resolution to 64 by 64. In a way, I want to make the stroke weight thicker. But I think, actually, by lowering the resolution, the stroke weight itself will be relatively thicker. And I think that will make the images a bit more bold and more clear to the neural network, perhaps. And then, also, I don't want them to bleed off the edge. So I am going to make r a random value between 8 and 24. Let's run this. I'm going to delete my old data. I'm going to copy the new data in, go back to my p5 code, change the inputs to 64 by 64. And this is reducing the number of pixels by 4. It's exponential here. Looking through everything, and let me try running it again. At a minimum, it should train much faster now, with the data size being much smaller. And looks like the loss is going down. I'm going to go take a little break and come back in a minute. Ah. So I don't know really if I just got kind of unlucky with that initial data set, but certainly having it run faster would allow me to experiment a bit more. And the ultimate goal of what I'm doing here is not to train the perfect shapeClassifier but to show you the steps and tools along the way for you to experiment with different kinds of data and different ways of doing this. Great. So my model now, because I had the save function, has saved to the Downloads folder of the the default Downloads folder of the browser. Looking at the Downloads folder, you'll see there's lots of model files, because I'm doing this constantly in lots of different experiments. But I think the most recent ones at 1034 am are the ones that I want. Let me grab that. I'm just going to go back to my shapeClassifier I'm going to make a folder called model. I'm going to paste it in here. And then I'm going to rename these without the numbering. What is in those files? All of the information around the architecture of the neural network and the weights of the neural network. And this is topics that I've covered in much more detail in my ml5 series. So if I wanted to now, I could start to add the prediction code to this example I could even have training and prediction all happening in the same web application. But I want to separate those two things. I want to take the frozen saved model that's now completely divorced from the data, and I want to upload that to a p5 Web Editor sketch. The nice thing about this is I could ultimately keep my train doesn't matter so much in this case, but I can keep my training data private. There's ultimately no way to reverseengineer the training data from the trained neural network itself. So that's something that I could be sort of happy about if I was worried about that data uploading to a public web application. So here I am in the p5 Web Editor. First thing I want to do is upload the model. Create a folder called Model Upload File. Grab these three files, drag them in. I also want to make sure that I'm importing the ml5 library itself. So I can just copy that from where I did it before. I need this CDN URL. Paste it in right here. Create the Shape Classifier. I can actually grab the exact same code I had before to initialize the Shape Classifier variable. I don't need debug to be true anymore. I'm not doing any training here. And I also don't need to add any data or call the train function. I could just load the pretrained model. Now, remember the model data itself is saved in three separate files. And I need to give ml5 the names of all of those files. I can never remember [LAUGHS] what the code is for doing this. The easiest place to find out is right in the ml5 documentation under Neural Network, under Loading a pretrained Model. And here we go model details, model, metadata, weights. The file names happen to be the same, so I could just put model details right in here. And then I also need a variable model not a variable, sorry a callback, a variable to define the callback, model loaded for when the model has been loaded. So let's run this, which all it's doing is loading the model. See if I get it to say model loaded in the console with no errors. Excellent. Now I want to pass it in image. So just as a first test, let me draw a shape into the p5 canvas. This is not one that was in the training data set. I'm going to draw my own, and then give it to the neural network and see what results I get back. (DRAMATIC VOICE) And I'm going to have to say my little model prediction prayer and hope that it works. [MUSIC PLAYING] So I've hardcoded [LAUGHS] in a circle right there in the center. This should be a pretty reasonable one for me to get the correct result from the neural network if the training worked well. I'm going to ask it for a prediction when I click the mouse. So I'll say shapeClassifier, classify. And then what I'm giving it now is the canvas. And then I'm going to have another callback for when it's got results back for its classification. Oh, and by the way, canvas it's not going to know what canvas is. I need to make canvas a variable and save createCanvas in that variable that's a reference to the canvas that I'm drawing that I can pass to ml5. I've got a resolution issue here. Oh, and by the way, this should be 64, 64. I accidentally somehow didn't have the right code when I copied it over. But I remember now that the training data was 64 by 64. It's got to match here. [MUSIC PLAYING] So this is some standard boilerplate for the results callback. If there was an error, console.log that error and then jump out of here. Otherwise, let's just look at what the results are. Now, I think I'm going to get an error, because my canvas resolution does not match what the neural network's expecting. So let's just see what that looks like. And I'll click the mouse. Great. Ah. Based on the provided shape, 1, 64, 64, the tensor should have blah, blah, blah, blah, blah, blah, blah, blah, blah, blah, blah, blah, blah. Look at this. It's an actual confusing, weird, esoteric, machine learning error message that we can understand, [LAUGHS] because you're going to get these kind of error messages all the time. And sometimes you're going to be like, why? What's going on? But underneath the hood, the tensorflow.js library which drives ml5 is looking for one image, which is 64 by 64 by 4. And it got something else with 640,000 data points in it. And that's just wrong. So [LAUGHS] I need to get this image into a low resolution. The quickest way for me to do this, to be honest, just for testing purposes, would be for me to change this to 64 by 64, [LAUGHS] if you will indulge me for a second. I'll make the stroke weight a little bit less and, obviously, not as large. Oh, wait. Oh, nope. Also, [LAUGHS] it's drawn in the wrong place. (HIGHPITCHED VOICE) There's my tiny little circle. Let's see what the model says. We got some results back. Drum roll, please. [DRUM ROLL] Ha! It knew it's a circle 99%. That's super thrilling. Let's just try, really quickly, a rectangle. Drum roll, please. [DRUM ROLL] Ah, square 98% square. Oh, it is so confident. Thank you, neural network friend. So this is working with data that matches precisely the training data set. Let me just briefly show you how you can resize an image, because what if you wanted to create something where I'm actually I could create something where I'm drawing with the mouse. Ooh, let's do that. We're going to draw with the mouse, and then I'm going to draw with pen and paper. We'll see if it works for one or both of them. I'm going to go back to 400 by 400. And when I click the mouse, I'm going to create a separate graphics object. I'll call it input. That's 64 by 64. And then, I believe, in p5, there's a way for me to copy one image to another and reduce its resolution something like input.copy(canvas) something like that. Let's look at the p5 reference. Right here, under loading and displaying pixels, there's a copy function. Oh, I wonder if I can use this get function, actually. But let's look at copy copies a region of the canvas to another region of the canvas. So it's really but it could also copy from a source image. And I think I can call this function on a p5 image itself, or in this case, not a p5 image oh, do I want a p5 image or a p5 graphics object. I don't actually know. Let me keep going with this. But certainly I want a source image, and I want the source xy with height to the destination xy with height. Let's see if I can make this work. So I want to copy from the canvas 0, 0, 400, 400 to 0, 0, 64, 64. And actually, I'm just not going to bother with trying to run the classification. Let me just see, then, if I draw that input image. Let's see if that works. Oh, and let me put in the draw function now. If mouse is pressed, line from the mouse to the previous mouse. So I could draw something in the canvas. So this is whoa! Whaa what is going on? mouseX, mouseX we need a Y. We don't need background here. I need a stroke weight that's much thicker. And by the way, [LAUGHS] this is bad. Let's make this keyPressed now, [LAUGHS] because I have to draw the mouse. I have to press the mouse to render the drawing at lower resolution. Ahh. Put background at 255 in setup, try this again. So this is me drawing. Ultimately, I'm going to try to draw a square and have it recognize it. Let's press a key. Oh, look at that. It worked. There's my 64 by 64, so that worked. Ah, it's so easy. Ah, beautiful. Oh, [KISS SOUND]. I love this. OK, so now let's make this stroke weight 8. So I make it much thicker. And I don't need to, when I press the key, classify the image. I want to do this always. Let's make this a function called classifyImage. And I'm going to start doing that as soon as the model is loaded classifyImage. And once I get some results, I'm going to call classifyImage again. And then I don't want to console.log the results. I want to see the results in the actual web page. So very quickly, let me change the background of the web page. This is, like, the actual only thing I know how to do in CSS. And let's make it a little bit gray just so I can see the canvas more clearly. OK, great. And then we can see it's logging those results. But I don't want to log them. I want to see the results. I'll make a div to show the results. I'll start it with it saying loading model. And then the label is results index 0 dot label. And the confidence is results index 0 dot confidence. One of these days, I'll use something called object destructuring. I got to make a video to show you how to do that. But I like to write it in this longhand way. And then let's just put oh, and it's not labels. I want it to be the label. Now, I want to see the label and then also the confidence. And I'm going to do some stuff to this confidence. I'm going to just make sure it only shows two digits, number format it, and also multiply it by 100 so it's kind of like a percentage. I'm going to show it like a percentage. I think that's right. Let's run it. Loading model error, cannot read property HTML of undefined resultsDiv. results that should say resultsDiv. Another thing, actually, is I don't need to make a new graphics object every single time. This could be a global variable. Just move that stuff around, and here we go. Let's try this now. Loading model square. It's a square. Let's draw a square and see if we can make it more confident. Square. Now, I don't need to see the little tiny image. That's useful here. But I don't need to see that, so I can take that out. OK, oh, and let me make that much bigger [LAUGHS] so you can actually see it, also. I do know a tiny bit more CSS. I think this will do the trick. Let's make it really big. OK, square. All right, let's draw a circle. Oh look at that. [KISS SOUND] It's so beautiful. Oh, I don't have a clear. I need a clear button. I could just run it again. [LAUGHS] Triangle. I need a clear button. [MUSIC PLAYING] So I'm just putting a tiny little anonymous function as the callback for mouse press would draw a background. Let's run this again. And circle, square [LAUGHS] it's a triangle. (DRAMATIC VOICE) Oh, I love this. It makes me so happy that it works. Yes! [LAUGHS] All right, now, for the grand finale, I will, instead of drawing the shapes with the mouse, I will now take this document camera of course, any web camera will do. But I will take this document camera pointed at my notepad and attempt to draw on my notepad with this pen and see if it will recognize the shapes. So give me a minute I set this up. I'm going to duplicate this, because I want to save this as an example. The only thing I need to change well, there's probably a bunch of things to change, but let's create a video. Video equals createCapture video. Then I'm going to actually just resize it to 64 by 64. I think that will make my life easier. The Clear button is no longer relevant, so I can comment that out. classifyImage I don't need to do this copying. I can just classify the video itself. In the draw function, I will just see image, video 0, 0. And I think that's all I need to change to go from the drawing in the canvas to the video. Let's see. What did I miss? Well, first of all, it is not using my document camera right now. (HIGHPITCHED VOICE) Hello, how are you? Let me also stretch out the video to the canvas so we can see. And by the way, the answer to life's mystery am I a circle or a triangle? I don't know. Do I have a tri I have a triangular head. I'm very triangular. [LAUGHS] Let me try to switch this to the document camera. And I think a way to do that is I can just click up here and go to [HEAVY SIGH] come on, come on Manage, switch it to this camera, and run it again. And great I've got my document camera. Here we go, everybody. Drum roll, please. [DRUM ROLL] Square. It's a circle. Eh, circle like, not too confident, but I did get circle. All right, let's try a triangle. Square come on. So my suspicion here is that I might need a thicker marker. Let's try making it a little thicker. There we go. Look at that triangle, 91%. So I think the fact I probably should, in my data set, train with variable stroke weights. If I redid this whole thing and trained it with variable stroke rate weights, I might get a better result. But we can see here triangle, 90%, square, 97%. Now it's time. I'm going to attempt to draw a circle. Tada! [TRIUMPHANT MUSIC PLAYING] OK, I think this Coding Challenge is complete. I have now shown you all the steps for collecting a data set of shapes generated from processing, loading all of those image files into a p5.js sketch with ml5 and training a convolutional neural network with that data set. Then we have looked at how I can get images from a webcam and show those to a p5.js sketch that has that model loaded and recognize the shape. Imagine the possibilities of what you could do. I hope you do something totally different and surprise me with what kind of data you use, what kind of interaction you use, and you make your own wonderful experiment here. Now, what is next? Something that I'd really like to do is, what if I were to draw a cat? Now, that cat is most definitely a triangular cat. So I feel like that's a very accurate prediction. But what if I wanted to say cat? Could I collect a data set of lots of drawings and recognize them? So you might have heard of the Google Quick, Draw data set. It's definitely a data set I've referred to in many previous videos. I could do a whole series now where I could download that data set and try to train an ml5 convolutional neural network model against it. Luckily for us, Yining Shi, one of the ml5 contributors, already did this. And in ml5 you can load a pretrained model called doodleNet. And so in the next video, which should hopefully be a very short one, [LAUGHS] I'm just going to show you, basically, this exact same sketch. But I'm going to load Yining Shi's doodleNet model and see if it can how it recognizes my drawings that are not just of simple shapes like squares circles and triangles. Thanks for watching this video. I hope you enjoyed it. I hope you are able to learn something and make something creative with it. And I can't wait to see you what happens in future videos and all that jazz and jazz hands is my official new signoff. No? That's not going to work? What do you think about that? I don't know. Goodbye. [KISS SOUND] [MUSIC PLAYING]
