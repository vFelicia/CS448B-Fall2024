welcome back to game development with pygame this is part 15 of our table based topdown shooter in this video we're gonna be talking about adding some simple visual effects to add some appeal some visual flair to our game and we're also going to really quickly talk about a pesky bug that has snuck into our code and that we hadn't noticed yet so before we start we have a bug to fix so a viewer named Matthew Brown discovered this bug and when it comes up I switch over to our map here he discovered it when he was trying to place walls around the edge of the map and here's what happens right so I've added this wall here I don't and so with it right here if we go over and run the game you'll see there's no problem all right there's the player spawning where we wanted him to spawn but if I go back over to the map and I make this wall a little bit longer let's do it to about right there watch what happens when we run it my player is not in the same place and in fact when it really goes wrong is if you try and make this wall really long watch what happens now whoops let me save it here watch what happens now the player is gone in fact so is the zombie that was supposed to spawn here so what happened well if I start moving you'll see I was over here off the screen and so I'm spawning off the side and if there were walls on this side as well I'd be outside of them so it would be no way to get back onto the screen so something is causing our players position to be changed when it sees these walls so I recommend that before you continue and hear what the answer is plus the video try this on your game see if you have the problem you probably will if you've been following along with the code we've been writing but give a shot at trying to see if you can figure out what is causing it and then and then come back and unpause the video and see if if you found the same solution that I did and so it had me stumped for a couple minutes and then I realized what's happening is in our sprites so let's go look at the player and this is true it's happening with the player and the zombies but look at the player in the init we get the X Y and we set the position to that right and then the update we figure out where we're supposed to be and we set our rectangle to that location but in the first frame we're using the settings that come from the init function and then the init function we create the rectangle but we never set any values for it which means the x and y of the selfdirect are being set to 00 so on the first frame before it has updated the first thing it does is check for collisions right it checks for colliding with walls and if we're at 00 or our rectangles at 00 then when we collide with a wall we're going to be moved to the edge of the wall and that is what is happening is we're being shifted to the edge of the wall so to fix that all we need to do is just make sure that in the init of our sprite when we create the rectangle we just set the selfdirect center to that XY position and we need to do that on the mob as well so this is one of those pesky little bugs that would have been obvious if we had done this earlier but it just happened that since we weren't creating a map with any stuff on the edges it didn't it didn't come into play so now when I run it no problem I spawn right there the wall is there I can't go through it but we don't get any strange behavior on spawn now that we have that out of the way let's talk a little bit about visual effects now it's still a little early in this game to talk too much about that but I thought it'd be fun just to to do a little bit add a little bit of visual appeal to what we have so far and to do that I went to back to our friend Kenny and I are pack that he did of particles and things and I've grabbed a couple of images here called white puffs with numbers on them right and all they are are just some cloud puffs and we're going to use those to create a muzzle flash whenever we shoot a bullet from our gun so I went ahead and went over here on our settings and I made a list of those files just a list of them in a list called muzzle flashes so that I can load them over in our load data code so we're just going to make a list of gun flashes to hold these images once we load them so we're just going to go through that muzzle flashes list and we're going to append it append each of them there's a load join from our image folder the image name and then I remembered to do convert alpha okay so now we'll have all of those loaded and to make them appear we're gonna create another sprite now eventually this might become more of a generic sprite for different kind of effects we want to have and there's a lot more advanced ways to do effects but again we're trying to keep it relatively simple for now oops so we're gonna just add a muzzle flash class and this is going to start out as a generic sprite right we're just going to pass it a position for where we want it to spawn and then we just need to randomize a couple of things we want to randomize which image we use right we also want to randomize the size so that we can sometimes get bigger or smaller flashes now up here I'm going to add R and int because I also want to just pick random integers for this case so we're just going to do a random integer between 20 and 50 and then art we're going to set our image to a scaled image of that so you transform scale we're going to make a choice from game dot gun flashes and we're going to Reese to Gail it to that size that we just chose we do get rekt for the image and we set our position to wherever we said and we've set our rect Center to wherever we said and then we just want to make sure that we can despawn this thing it's not going to live very long right so the spawn time of this is going to be get ticks and then we just need to in our death update just see if it's been long enough to despawn it so what we want to do is say if get ticks spawn time is greater than some number of milliseconds we want it to last so we'll go over here to our settings we're also going to add a flash duration of say 40 milliseconds right this is going to be pretty quick we just wanted to be a slash so if it's been longer than that then cell duck kill okay and that's our muzzle flash so now we just need to spawn one of these whenever we fire a bullet and we do that in class player when we shoot so right here where is where we spawn a bullet and we're just going to also spawn a muzzle flash and the position is going to be this position that we just calculated of where the bullet because we calculated the where the end of the barrel is that the bullets going to spawn we also want to just spawn the muzzle flash there now if we try this out right you see that flash but we have a problem sometimes that flash is underneath the gun and sometimes it's on top and sometimes it's underneath the bullet and sometimes it's on top of it so we need to start introducing the idea of layers so if we can tell our draw code to always draw things in the correct order we can make sure that the muzzle flashes are always on top the bullets are never underneath the player that kind of thing and the place we're going to do that is in the all sprites group right now the all sprites group is just a regular PI game sprite group but there's another kind of sprite group you can use called layered updates it works just the same as a regular sprite group as far as updating drawing all that kind of thing but it has an additional property that if you set a layer property on sprite it'll draw them in the order that you set the layers so for example over here in the settings i'm i've added some some layers right so i want to make sure that the walls are always at the lowest layer so they have the lowest number right the effects are set at little layer 4 so they're going to always be drawn on top of anything that has a lower layer value than 4 it'll always draw those effects the last so that way when we add other effects like dust or fog or smoke or anything else like that we can make sure that it's drawn where we want it to be drawn so all we need to do is assign each of these layers to our rights and the easiest way to do that is in the sprite definition so in the sprite definition now you can set this in a lot of different ways but the easiest way I think is to just add in the player in it a self dot underscore layer it's sort of like a default layer settings right so we know we want the player to be on the player level layer so if you do this here before you call the PI game sprite in it it'll see this property and set the layer to that layer and so on the mob we just want to say Bob layer the bullet we're gonna set to bullet layer and it is underscore layer that's a you can look into the PI game documentation if you want to see why but they just decided to name it that way to indicate it's a special special variable that we're setting at a initialization time while they're now technically this wall layer isn't being used right now because we're using the tiled map to do all of our graphics we're not actually drawing those wall objects but I went ahead and filled it in some of you may still be using that if you ever want to go back to it it'll be ready to go and we won't put this at the effects layer okay so just check back make sure we set it right on each of these underscore layer Orillia okay so now if we go over here and we run this you're gonna see that whenever you shoot those bullets let those model flashers are always appearing on top of the gun looks very nice just gives a little bit of visual flair now moving forward you might think of other places we could use effects like this when a bullet hits a mob or when a mob hits the player when a bullet hits a wall any of those kind of things you can have a little shock wave effects puffs of dust even sprays of blood if you were thinking of making things a little more gory although I think for this video series we're gonna stick to a PG rating so that'll do it for this video we now have a layered drawing function and we can start adding more graphical effects and more visual appeal we have some more work to do on our zombies and their movement style although they're way better than they used to be and we can actually start talking about some more about gameplay as opposed to basic code functions if you have some thoughts or suggestions along those lines please post them in the comments below and I will see you all in the next video as always please hit the like button below and subscribe if you haven't already so that you can see the next video as soon as it comes out thanks and I'll see you next time welcome back to game time with PI game this is part 15 of the Tao based topdown shooter project and in this video we're going to be talking about how to add some simple visual effects to add a little flare a little appeal to our games graphics welcome back to game don't move tie game this is part 15 of the tilebased topdown shooter project and in this video we're going to be talking about how to add some simple visual effects to add a little flare a little appeal to our games graphics you