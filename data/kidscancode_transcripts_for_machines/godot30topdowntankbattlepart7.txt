welcome back this is part 7 of the topdown tank battle tutorial for Godot 3.0 in this installment we're gonna add some health bars to our enemy units so that we can see their current health and we're gonna add some explosions to our bullets that were firing alright let's get started in the last part we made the health bar for the player so that we could see their health decreasing and we added damage to the enemy tank but we didn't make it display so we're gonna add a little health bar for the enemy units that are on the screen and unlike the player where we have it up in the corner we want this to be a little bar that is above the unit as it dries around so you can see how much damage that particular unit has taken so we want it to follow along with them so we're gonna make this as a separate scene that we're gonna save in the UI folder that's going to be something that we can attach to any enemy unit if we wanted to have a health bar so I'm just gonna use a node 2d for this to hold everything I'm gonna call this the unit display and I don't really know yet what things what other things we might have these units display like maybe they have invulnerability or maybe they have you know some special powers or things but one thing we know that they are going to have is a is a health bar so we're gonna add a texture progress here to be their health bar and this will work pretty similarly to how we did it on the player it's just that this is gonna follow them around instead okay so we're going to put the green progress bar in there for the progress texture I'm gonna set it to a hundred value so we can see the whole bar so here's my unit display node that we're gonna attach to the unit and here's the bar so what I really want is I want that bar to be kind of the enemy unit and since it's attached to gonna be attached to the unit that means when the unit moves and rotates so is the bar right as the unit goes around the bar would be doing this too and we don't want that so we're gonna want to make sure that we disable the rotation of that but we do want it to move and follow along with the unit as it moves around so as this moves around the bar follows it around wherever it goes and this is also a little bit large so I'm going to set the scale of this to one half and we'll see how that works we can also adjust it on individual units when we attach it to them if they're bigger or smaller now what do we want this bar to do we're going to attach a script to it and we want this to do kind of the same thing that the one we made for the player did where we have the we're gonna have the bar texture colors I'm gonna copy these over there and the update health bar I am going to copy some of this but we're not going to copy everything so we're not gonna do it exactly the same and maybe these will have more similarities maybe they won't I'm not entirely sure yet but for now we want these to be the health bar we'll just change its texture directly health bar texture health bar dot texture progress is what we want to set to the texture part Express and we want to set the health bar value equals value so that's what that function does now I also want that bar not to display until the enemy takes some damage so when it's at full health I don't want the bar to even be there and so I'm gonna do this I'm gonna I'm gonna get all the children and I'm going to set them to to be invisible when the note first starts up and then we'll enable them as you know depending on what they're displaying as we need to display them so now if I go over to the to an enemy tank and I attach this go to 2d here we want the enemy tank seen and we're going to attach a unit display to it so there's my unit display and if I were to run this what we're not going to see them yet because they are hidden but let me disable that for a second because I want to let's disable that for a second so that we can see what I'm talking about with the rotation so see there's the bar kind of rotating along with the enemy note and I don't like that I don't want that to happen so so what we're going to do in the unit display here is we're going to in its process function we're going to set the global rotation to zero so that way no matter how the parent turns this one will always be not turned and I'm actually going to move this up a little bit to I didn't like how close it was so now we can see this in the in the view but when we hit run yeah there you see it staying on top of the enemy unit so as it turns so let me get over here to the turn so as it turns that bar stays horizontal okay so now all we need to do is have it update when the tank takes a hit so we'll go over to our enemy tank scene and because we're inheriting from the tank script the main tank script we already know that when we take damage we're emitting the signal so in the enemy tank scene we just have to connect that signal so we connect health changed to the unit displays update health bar and that should all be all we need and I'll uncomment this so that we'll have the bars hidden when we start so there is no bar and I'll start shooting it now it's taking damage but what did we forget to do we forgot to show it so we also want to go over here and in the script say that if the value is less than a hundred we want health bar dot show and now I run the main scene when we go over here and shoot it remember it has 50 health so be hitting it with 5 or 5 ok so the other thing I wanted to do this time is talk about explosions so I have two different styles of explosion animations here in a folder in the assets these are actually taken from the original sprite sheet but it's really kind of annoying to cut them all out in the regions and so instead I just used the individual frames because we're gonna make an animated sprite for this so we're gonna make a new scene and it's gonna have one note in it an animated sprite this is going to be called explosion and for this I'm going to make an effects folder this will be the first of several effects that we're gonna make and animated sprite you need to create a sprite frames resource to hold the animations and we're gonna have to there's a smoke explosion and there's a fire explosion that we can use for two different kinds of effects both of them need to be set to about 10 FPS maybe even faster we'll see what we decide to do with those and then they also are going to need the frames dragged in there so you can what you can do is if I'm on the fire there's five frames total I can just drag them over like this and then in smoke select those and drag those over so now I have those two so this explosion will be able to attach to any object as well and will just trigger it to play if it needs to so the first place we're gonna attach one of these is gonna be on the bullets because I want the bullets to look like they're you know exploding when they hit something so let's take one of these explosions and I'm going to attach it to the bullet and we'll go over here to effect explosion so when I have the explosion there but of course I don't want it to be blocking our view of the bullet I don't want to show until the end so I'm gonna set that to hidden by default and then in the code we're just gonna have it trigger we already have an explosion we already have an explosion effect so let me see here where's my root bullet seen here this okay so we already have this explode method that plays when the bullet hits something so what we're going to do instead is have it play the animation so here let's see we want to take this explode and we're gonna say so when the bullet hits something or time runs out it's going to explode so we want to set our velocity equal to zero so it looks like it's stopped moving I want the explosion to happen in that position not to keep moving we're going to hide the sprite so we don't see the bullet itself anymore we're gonna show the explosion and we're gonna play the explosion we're gonna play the smoke one okay and then when the explosion finishes it's going to emit its animation finished and that will be when we cue free okay so here's what that's going to look like yes now whenever I shoot my bullets they have some nice explosions they're a little bit on the large side because you know we want to be able to scale these explosions as well so I'm gonna set the we'll set the default scale for this on the bullet and then we can change it on other things to be a different size if we want see how that looks yeah that's what we want I think the speed is a little on the slow side so we're gonna go back over to the explosion sprite frames and maybe make these 15 we can also alter those on a per explosion basis too if we ever need to okay alright so that's all working the way we want it all right now one last thing I was thinking about doing I'm not entirely sure I want to do it or not but it was in the UI assets that I downloaded is these custom cursors here so if you want to see what it looks like we're gonna go into the map and in the ready we're going to tell it we want to use that as our cursor so that is an input function so input set custom mouse cursor and we're gonna load the one I think looked better was the crosshair black not that line one this one copy that path and then you can paste that in there and then the other parameters you have to this function are which type of cursor it is so arrow means the default pointer style so that's the one we're gonna replace and then where do you want the hotspot or the actual clicking point to be and I'm gonna put zero zero which is not gonna be correct just so you can see that what I mean what what it's talking about so if I hit run you'll see now we have the crosshair but watch where the bullet goes when I click right because what happens is it's using the upper left corner of the crosshair as the hot spot like the tip of the arrow if we were using an arrow so since the cursor is 32 by 32 we want the hotspot to be at 16 sixteen and that's gonna give us the best you know aim where it shoots straight at the center of that crosshair and again I'm not entirely sure yet how much custom cursor stuff I want to do but it's kind of fun to mess around with right now and I think that'll do it for this video as always thanks for watching and I'll see you in the next installment you