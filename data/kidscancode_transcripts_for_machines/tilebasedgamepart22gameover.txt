hello everyone and welcome back to game development with PI game this is part 22 of our topdown zombie shooter and in this video we're going to be adding the game over condition as well as fixing a couple of very minor issues that we need to take care of all right so let's get started okay we're going to start off with a couple of small things one is if you've noticed when we when we run this you know we added that nice little splat sound when we defeat the zombie right but the problem is if I then go and die the game starts over again right that splat is still there alright so each time I restart and the problem is because there that's happening because when we we're creating our map right here when we when we first start the game when we load all our data we make our map right here and we make our map image and that map image is what we're drawing the little splats on and so when we restart we're still using that image that has the splats drawn on it so all we want to do to fix this is we're going to take this code right here that loads the map and we're going to put it in def new here so that way whenever we start a new game we start with the level 1 map ok and then that way we can oops oh the map folder we need to define our map folder here dot map folder and load our tab map from that and that way we'll be able to load other maps when we get to other levels and that's better now she's this guy and then go and let him know me right now it's a clean map when I start okay that was a little one we'd also like to do a couple other things which is we want to keep track of how many zombies are left because that's going to be our level complete condition is you've cleaned out the map and you've killed all the zombies so we just want to be able to display on the screen how many zombies are left so I have added here so we had our title font which is what we did our paws menu in and stuff this HUD font is going to be for our heads up display for displaying any information the font I picked out of the font folder I had with a bunch of different stuff in it and you can download it in the link below so we just want to draw the number of zombies on the screen in our draw section so we're going to go down there and we're going to say here after we draw the help we can draw text and what we want to say is the word zombies it's free and the the value here is just going to be the length of the mobs group okay and then we're going to use the HUD font we're going to size it at around 30 we'll do it in white and I'm going to put it in the upper right hand corner so I'm going to put it at with minus 10 and the y is going to be 10 and we're going to line it northeast okay so let's wrap this around a little bit so it's not so long on the screen there all right and my indenting let's back up the space here there okay so there we go so now I can see how many zombies I have and when I kill one that's going to go down right okay now what should happen when I've killed the last zombie well we already have everything in place for that we just need to trigger it so here in our update we're going to define the GAMEOVER condition and that's just going to be if the length of the mobs group is zero then playing equals false okay if playing equals false then our game loop is going to end all right which is the run function and if the run function ends we will show the game over screen and when the game over screen exits we will loop around and show the new screen or unload the new game and run in a game so we just need to define what we want to do in here in the game over screen well there's a couple things we want to do we want to show some information and we want to wait for the player to press the key so that they can play again okay so I'm just going to fill the screen with black we can make it look fancier later on and we're going to need to draw a couple of things all right so we're going to draw text what we're going to draw is game game over we're going to use the title font we're going to make it big or do it in red I'm going to Center it and I'm going to align it center all right let's do this easy to read and then we also we also want to draw text and say press a key we're also going to use the title font the size we're going to make a bit smaller I'm going to do the color in white I'm going to also Center it in X but in Y I'm going to put it at height times 3/4 so it's 3/4 of the way from the top and we're going to Center that as well all right that looks good my I want it right there okay so now draw those two things on the screen we need to flip the display so we can see it and then we need to wait for a key to get pressed now this is something that I probably am going to want to do on the Start screen as well so I'm just going to define it as a function that we can call anytime we want to just say wait for a key to get pressed okay and then we will define it here now what is it going to do well it's going to have a little loop here so we're going to make a loop called waiting and as long as that is true we're just going to sit here doing nothing so we need to tick the clock so we keep our loop running at a reasonable speed and then we need to check for events and there's two events we could deal with the event right we still want people to be able to X out so we've set weighting equal to false to end this loop where N and we in do these and we do the quit function but otherwise the type of event we care about is a key up event and I think I talked about this earlier in the if you watch the video on the platforming game we want to do a key up event not a key down event that way when the player taps the key we trigger on them letting go of it not on them holding it down otherwise we would start a new game and they already have the key press down which can sometimes make things happen that they don't expect and so this way there we go all right let's see how this goes all right so we'll run it here and we need to run over here and die and oops typo self dot screen all right there we go game over press a key I restart okay now one thing that's going to happen I'm going to hold the arrow key down while I'm running around so that I will be continuing to hold it down when I die okay so I'm still holding it down you see when I let go it restarted even though I might have been letting go because the game ended I haven't even had a chance to look at the game over screen yet so what we can do is just add PG event wait here okay and what that's going to do is it's basically going to clear out it's going to pull out any event that happens at the beginning of this and basically start with a fresh event queue so that when we hold the key down we won't have that problem okay so I'm going to hold the forward key down I'm still holding it down and when I let go see nothing happened but if I tap it again then we get answer that will prevent that little problem from happening all right and the last one little change that we need to make is right now our bullets our bullets are only doing damage depending on what weapon the player is holding right and right now that means if I shoot a bunch of pistol bullets and while the bullet is in the air from the pistol bullet is in the air flying towards the target before it hits the target I pick up the shotgun then when the bullet hits the target it will do a shotgun damage instead of pistol damage even though it was a pistol bullet that I fired and so we need to correct that so what we need to do is in our sprites in our bullet sprite we need to add a damage per bullet so when we spawn the bullet we're just going to pass in what the damage is okay and we'll just store that as a class variable oak damage equals damage and then when we spawn the bullet which is up here in Def shoot right that's where we spawn the bullet then what we want to do is just pass that weapon damage at that time so when we spawn the bullet we add here we want to pass from the weapons dictionary whichever weapon we're holding the damage value all right now that will work though should run now and not give us any error messages I switch to one here right but now we need to actually subtract the bullets damage from the mob when we hit it next right now we're again subtracting the weapon damage so here we go when the bullet hits the mob right we don't want to just subtract the weapon damage we want to subtract the bullets damage which might be which will be assigned to it right so here we need to say so we're not going to do this I'm just going to comment that out so you can see where we are now especially when we're finding the shotgun there's a lot of bullets in the air right and right now what we're doing is we're saying we're getting a list this hits list is a list of the mobs that were hit right and for each of those mobs there might be multiple bullets hitting them so we need two for each mob look at which things hit that and for each of those we subtract the mobs from the mobs health the bullets damage okay and maybe I'll make it totally clear here and call this bullet instead of B that's not clear okay so and in fact why don't we name this mob just to be completely clear for each mob in the hits dictionary we want to take the mobs health and we want to take the mobs boss okay all right so hopefully that's clear so for each Bob that we hit we're going to go through each bullet they hit that mob and subtract that bullets damaged and and then like we did before is that the mobs velocity to zero so you shouldn't see much in the way of difference as far as how it works now but at least when we switch weapons and we have you know the all the shotgun bullets flying out everything they're going to keep their bare damage when they hit about whatever mod they hit you you