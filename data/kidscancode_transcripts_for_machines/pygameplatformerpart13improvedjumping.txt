welcome back to game development with pygame this is part 13 of our platformer development and in this video we are going to improve greatly improve our jumping all right let's take a look at where we are right now it's starting to look pretty good but we do have some problems you can see right there with the jumping where we're snapping to the platforms a little too quickly and it doesn't feel very natural right if I can get it to happen here one thing you'll notice there's actually two different things going on okay there it happened right there one is when I jump up here and I collide with this platform even if my ears just barely touch it my feet are gonna snap to the top of it because that's how we wrote our code so far okay and that's because over here in our collision code we are saying if we hit a platform alright so we test to see if we collided with a platform and if we did we put our Y position at the top of the of the platform so that's why I snapped up to that one yeah I can do it again right so that's why I snapped up to this one but why did I wind up on this one well the problem happens when we collide with more than one platform at once which you can see as soon as my feet we're to get put here I'd actually be touching two platforms at once and if I plot press 2 or if I contact two platforms at once then hits has two platforms in it but we're snapping to our feet two hits number zero the first one in the list well when I collide with both of these how do I know which one's going to be the first in the list the answer is we don't the sprite cloud command doesn't order them in any way so sometimes I'll be standing on this one and sometimes it'll snap to this one and I can't control which it is let's see sometimes I'll stand on the lower one but other times I'll snap up to the higher one so that's very confusing doesn't feel natural so we need to do we need to fix both of those problems okay so what we're going to do is we're going to need to figure out which of the platforms that we're hitting is the lowest no okay so the first thing we're gonna do is we're gonna improve the snapping to the top and basically I only want to snap I don't want to snap to the top as my ears just barely hit the bottom of the platform I want to snap to the top if my feet get high enough to pass the bottom of the platform so here I'm going to say if the players Y position is less than hit 0 rec top bottom and then right so we're gonna we're gonna only snap to the platform if our feet right are higher than the bottom of the platform okay and what that's gonna do is that's gonna look like this okay so find a jump that's a little higher ah there we go see so now see I can't make it onto that platform because my feet can't get high enough but if my feet do get high enough I might not be able to make this jump we'll try another one if my feet do get high enough there we go see ice I do get on to the platform okay so that takes care of that but it doesn't solve the multiple platforms at once problem okay or which one here we go there's a good one right see I can't make this jump because the collision is counting me hitting both of these but this one the top one is actually coming out as it's zero or the first in the list and my feet aren't high enough to snap onto that one anymore so I do definitely want to land on this one so we need to also test to say when we collide we need to find which of the ones we collided with is the lowest and the lowest one is the one we're going to snap our feet to so what we're going to do is we're gonna say if we've hit a platform then we're gonna say for now that the first one is the lowest and then we're just going to look at each of the other hits and see if any of them are lower than that one and if they are then we'll call that one the lowest so if hit rock bottom is left is greater than that first one so if any of the ones in the list is lower than the one then the first one then lowest becomes that one so now well know which one is the lowest and then we can change here where we said hits zero to lowest so now we're gonna make sure we snap our feet to the lowest one if our feet go past it okay so let's try that out and see how the jumping feels now now you can already see we're not doing that that crazy snapping isn't happening anymore alright I barely made it to that one and another thing we could do is we could even write we snap if our feet make it past the bottom of the sprite right like let's see if I can find one that's lined up just right there okay so see if my feet made it past the bottom I snapped at the top so there's still a little bit of a snapping effect but you can see I'm standing on the lowest one right I'm always on the lowest one that I hit which is much better but we could even probably make it a little better if we snap if we make it past the middle instead of right instead of snapping to it there we could snap if we're if our feet make it halfway through the platform right and then they'll be even less of that effect so we could say if our paws rect dot Center Y so let's try that out and see how that looks so now I have to make it high enough that I'm past the center of the platform before I can have my feet beyond it which is going to mean that we might need to increase the number of platforms responding because you can see I'm not able to make very many of these jumps yet or any more but that's okay we can adjust that as well I just want to see how we're looking yeah see this feels much more like I'm jumping to it and landing on it not teleporting through it and we don't have any of that weird snapping going on let's see there I am gonna need either to increase my jump height or I'm going to need to increase or decrease the distance between platforms so I don't wind up stuck like this okay so what we're gonna do is we're gonna improve our jumping a bit and we're gonna make it so that we can have what's called a variable jump right now we jump the same no matter how hard or how long we press the spacebar but if you've played a lot of platformers you know a lot of them like Mario one of the classics has variable jump if you tap the the jump button really quickly you get a you you only jump a little bit but if you hold it down you jump higher and so that's what we're gonna do okay so what we're gonna do here is say so where's my events here we go so key down pressing the spacebar does the player jump okay we're also going to add and actually a just gonna copy and paste this we're gonna add a key up the event for the spacebar okay that way if the key goes up then we're going to cut our jump short okay so if you hold it down you'll get the full jump but if you press it and let go pretty quickly you're gonna cut the jump out and what that'll allow us to do is make our jump actually be higher than it is now and then the player can hold down to get their longer jump okay so now we just need to go define what that jump cut means so we're gonna go over here to sprites and if you remember in our player we did have this jumping variable which if you've been paying if you're paying close attention we never actually do anything with that variable anywhere we never change it to true for anything so we're gonna do that we're gonna say that in in def jump okay when we jump that's going to set jumping equal to true okay and that way we can only jump if we're not already jumping right so if jumping is false then we can jump and jumping becomes true okay which also means that back over here where we hit where we collide with the platform's when we land on a platform we better set jumping back equal to false or we won't be able to jump again so now we can do the jump cut and jump cut is just going to be if if we're jumping right we don't want to do if we're not jumping if we're jumping then as long as our Y velocity right our Y speed remember if we're going upwards so if we're moving upwards our our velocity in Y it's going to be negative so for moving up at a faster speed than minus 3 and minus 3 is just an arbitrary number that I picked it's not too big you can try out different ones and see how you like it but basically we're just gonna set it equal to that so for going up any faster than this and remember if our jump speed our player jump right now go to our settings is set to 16 so when we first hit the spacebar we're gonna be moving upwards at minus 16 right and that's gonna slowly decrease as the as gravity pulls us downwards but if we tap the bar we're gonna move upward at minus 16 but we let go right away then our speed will be less than that source speed is just gonna cut right down to minus 3 so we'll get a very short jump if we only tap the spacebar okay so let's take a look at how this works okay so you can see if I tap it really quickly I get a short jump and if I hold it down I get a long jump so what that means is we can actually go over here and make this even a little bigger because you have to hold down the spacebar to get that full jump that'll make it a option for the player now if I hold down I can get that big jump that's almost to the midpoint of the screen but I can also if I'm trying to do a bunch of quick jumps I have to figure out how long I want to hold him down so that works a lot better right now the letting go that if I hold it if I hold down the spacebar and I don't let go until I'm falling then obviously that hasn't that have any effect because when I'm following my Y velocity is a positive number so yeah so this is if you go back and compare this to how everything was working when we started this video this is way way way way bit better and more comfortable and a lot more fun to play so I hope you enjoyed this I hope you're feeling good about the direction our game is going in play around with it some if you have any suggestions or comments please post them in the comments below and I look forward to seeing you in the next video you