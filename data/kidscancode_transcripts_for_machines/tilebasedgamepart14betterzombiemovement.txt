all right this is part 14 of our tilebased topdown shooter game and in this video we're going to talk about improving the way our really not very intelligent zombies move around so for this video what I've done is I've added a bunch of more zombies here onto the map so that all these zombies will spawn over on the other side of the house by the trees so that when we run our program you can see the main problem we have with our zombies which is they all come running at me and as you can see eventually they're gonna clump up and just become one zombie I can't even tell how many are chasing me all right this is kind of a problem because I can't tell how many zombies I'm fighting but also it just doesn't look good right so we want to have a little bit of behavior on our zombies I don't really want to call it AI because whoever heard of a an intelligent zombie but I want them to have some sort of behavior where they don't just bump into each other and then we can talk about some other things we can have them do but I definitely no want them clumping up like that so what do we want to happen well right now if we go into our mobs here our mobs are went too far down our mobs are just pointing themselves at the player and accelerating in that direction alright so they're just heading straight for or the player and that's fine but that makes them clump up so to make them avoid each other we want them to move away from any mobs any other mobs that have gotten too close to them and to illustrate that let's look at a picture here so I drew a little diagram here so here I've got a couple of different mobs right and so looking at this mob here in the center this green arrow represents that it wants to do to head straight for the player but then it's going to have an avoid radius it's going to have a circle where it's going to look for any other mobs that are inside that circle and those are the ones that are close to it and those mobs are going to generate vectors pushing it away from them so these two red arrows are just pointing directly away from the other mobs and then this one over here this one doesn't affect it at all because it's outside the radius and the size of this radius will be something that we can adjust to get the behavior we want so all three of these are going to be unit vectors so they're just they have a length of one they're just giving us direction all right so we want we have this direction this direction and this direction if we add them up we get this dotted line vector and then we take that dotted line and we multiply it by the mob speed to get the right length and so this is the direction that the mob will accelerate in so it's not gonna head straight for the player it's gonna head sort of towards the player but off to the side and the same thing will happen to these others on these this zombie will be heading sort of in this direction because it'll be wanting to get away from this one and so forth so that'll keep the mobs from getting right on top of each other okay so we're gonna go over to our settings here we've got some mob settings I'm going to add an avoid radius and we're just going to call that we're gonna call that 50 pixels it's a nice round number to pick for now and remember we have that mob mob speed that's the length we're gonna make our acceleration vector so here in the update what we want to do is we want to take our acceleration and we're gonna make our acceleration just be a unit vector to start with right to get that green arrow that I showed you in the picture and then we're going to say avoid mobs so I'm going to define a little method here that's going to go and figure out all those other vectors and give us the sum and then we can say take our acceleration and scale it to whatever our mobs be is okay so now we can just define our of the void mobs function what this is going to do is it's just going to go through and loop through all the mobs right it's going to loop through all the mobs and we don't want to include ourself so we'll skip over the mob that is the zombie that we're currently looking at and then we want to see what the distance is between the two well that's just self dot pause mob pause right that's going to give us the arrow pointing from this mob to the zombie we're concerned with so there's an arrow pointing from the mob towards it so that's the direction we want to move move in because we want to move away from the other mob now if the length of that vector is less than 50 and greater than zero because if two mobs do happen to get on top of each other then their length is going to be zero so we want to take our acceleration and we just want to add that distance normalized which is make it a length of one right so now we that's what's going to get us each of those little red arrows from the diagram all right a let's call it up one more time here so we're looping through saying look at every mob look it's looks at this one too far away looks at this one that's our self we don't look at that looks at this one and says okay our position the mob position gives us this vector which normalized will be a length of one and the same with this one right and then we're just we just keep adding them together to the acceleration we already have we add this one then we add this one and that's going to give us our final direction so we have the final direction and we scale that to length all right and then oh and I noticed I wrote 50 here I meant to say this should be avoid avoid radius right because we want to be able to adjust that if it turns out it's not working very well where we want the mobs to look further away or not so far away so let's take a look at it and see how it turns out okay so I'm gonna run over here to where all these mobs are and remember how it looked last time where they all clumped up together and wound on top of each other and look at that that looks so much better these zombies are clumping up but they are staying spread out it also helps them get around obstacles because they're gonna push each other around and it means that these zombies have become a bit more challenging because as they get close to you they're gonna start to surround you on all sides because they will fan out see that so you got to be really careful not to let them get you in a corner because you're not gonna be able to get out so that looks a lot better okay now another thing we can do to keep the mobs from looking so all the same is adjust their speeds of it give them make some of them a little faster and some of them a little slower right maybe some of the zombies are a little bit more decayed and don't move quite as fast and so we can instead of them all being this mob speed each zombie we spawn will either add or subtract a little bit from that so how about we instead make this a list and we say these are the speeds they could have right some of them will be 150 some of them will be oops some of them will be a hundred maybe 75 maybe 125 right I've just got a range of a few different speeds right and if you want to you can add you know make 150 in there twice you would get it more often that kind of thing so we can spread it out just so it's not totally random you know I could do a Rand range between you know 75 and 150 and then one mob might have a speed of 87 and one mob has a speed of 93 and that kind of thing I just want a few different ranges so I'm gonna just have this little list so over here on my mob I can just say when this mob spawns its self dot speed is gonna be a random choice which means I need to go up here an import choice from random as well alright so speed is going to be choice mobs mob speeds right and then here we just scale it to our self dot speed okay so that way our zombies will have different speeds so let's take a look and see how that looks that's a slow one yeah so you see how some of them are trailing behind a little bit not bad that 75 might be a little too slow okay so you really got to be careful to get them they're gonna try and get on all sides of you and your poor pathetic little gun can only shoot in one direction still not too hard though and that's okay we're not trying to make the game we're not trying to get the final balancing done yet and make the game super hard we're just trying to get the basic functions working and then we will adjust as we go cuz you're never gonna get it perfect right first time and then you're gonna add something and then it's not going to be right anyway so you want to get the mechanics working first before you worry about all the little balance details like how much damage does each bullet and how fast does each zombie run right we're going to wind up adjusting those things anyway as we go okay so that'll do it for this video it was pretty plain 'less it's a pretty small amount of code we added here to give us a big improvement in how our zombies move around the map those of you who've been watching my indepth videos on steering behaviors you probably see where some of this is headed we're gonna want to have these zombies just wander around randomly right now they chase the player from all the way across the map and so we'll want to make it so that the zombies can only chase the player if they're inside a certain range and and so will gradually start adding some more those behaviors to get these zombie zombies to look even better alright and as usual please click the like button below subscribe if you haven't already and I will see you all in the next video you