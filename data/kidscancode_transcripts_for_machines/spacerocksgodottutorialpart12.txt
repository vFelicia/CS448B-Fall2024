welcome to part 12 of space rocks this is the Godot game engine tutorial where we're making an asteroid style game last time we had the enemy start shooting at the player and this time around we need to make those enemy bullets damage the player as well as we're going to make the player be able to damage the enemy and we'll also do some other small things along the way all right let's get started so I started off by adding a damage function to the player this is the player script and that just lets me send it an amount and it will reduce the shield and disable the player if they have and blow them up if they have run out and so we're having the asteroid when it enters just call that damage function and we're going to do that because now we need the enemy bullets to also damage the play now there's a couple different ways we could do this we could put an on area enter here and detect on the player when the bullet enters it and damage the player then but I'm going to go on the enemy bullet and I'm going to do the hit detection there because I might want and I think I will with some of the things I'm thinking about doing I might want the enemy bullet to be able to hit and damaged more than just the player so this way the enemy will detect whatever it hits and send damage to that object that it hits so that means we're just going to on the enemy scene we're going to connect the area enter method ok so we go to our enemies bullet scene here and we take our area enter and we're going to connect that so when something enters well we can do a couple do this a couple different ways we could say if it enters the node named player then we can do damage to it but we could also say if any of the nodes if no your anchor has the method damaged that's what we're going to do so that we can do this with other areas as well so if it has a damage method that means it can be damaged so we're going to pew free and we're going to damage that area and we're going to damage it by whatever damage our bullets are going to do so that's another thing we can add to global so I've added over here on global an enemy bullet damage and so that's how much damage we want to do so on our player or sorry on our enemy bullet we're going to do that much damage okay we'll try that out real quick we are look for the enemy to come out and sure enough my shield is going down when I'm getting hits so now we need to do the same thing for the players bullets hitting the enemy so I've added a bullet damage so the players bullets will do this much damage the enemy will have this much health and the enemy will be worth 100 points when you kill it so then we're going to go to the player bullet or sorry first we'll go to the enemy we're going to just add a damage function to the enemy so now if the enemy takes some damage will reduce its health and if it's health those below zero it's gone and the problem will be now watch what happens when we run this so I haven't done anything with the player bullets yet but now when the enemy appears it's going to kill itself because on the enemy bullet we said it has a damage method to the damage well that means the enemy is killing itself because it's doing its own damage to itself so we're going to solve that by putting the enemy in a group add to group enemies and then on the enemy bullet we're going to check what groups the area we hit is in and if it's an enemy it's not going to count so we'll get groups and see if it has enemies and that should take care of our enemy destroying itself with its own bullets okay now we need to finish up with the player bullets so the player bullets we have said now if it finds an enemy it's going to hit oh and we did this in the wrong place this would give us points every time we hit to the enemy but we only want to give the points when we destroy it so that needs to be over here if the help got down to zero we're going to have the points all right so now since our player bullet does 10 damage and our enemy has 30 health it should take us three hits to kill it okay and I got a hundred points now let's make that enemy explode so we're going to have a an explode signal that we're going to emit when our damage now when our health reaches zero the limits signal explode and we will attach that on the main when we spawn the enemy so that we can create an explosion when that happens just like we did like we did with the asteroids so when we spawn a player on the enemy timer here we're going to add the connect there to explode so we will put that here connect the explode signal to ourselves and we're going to we haven't explode player function we're going to make an explode enemy function again this is probably going to be one of those we can combine some of this code together but I'm not really concerned about doing that yet project hasn't gotten that big yet not a whole lot of code and so it's enough for us to just try and get the stuff working first that's really all I'm concerned with at the moment oh we're going to need to pass the position right so the explode enemies function is going to need a position so we know where to put the explosion so so we'll spawn a new explosion and we'll add it as a child and then we're going to do set pause to whatever position we said we're going to set the animation to be we're going to use that sonic animation which is the bigger one and we're going to and we're going to play it and oh and this is you connect we're connecting a signal from the enemy and then on the enemy we just need to make sure when we emit that signal we need to also pass our position all right let's check this out now get that enemy to come out and then we will shoot it okay so now let's add a little feedback so that we can see when we hit the enemy because right now when the bullet hits it it just sort of the bullet disappears and nothing really happens we're going to make the enemy flash a little bit so we're going to use the N animation node that we've already that we've already added here that's doing our rotate and we're just going to make a new animation so I'm going to make a new animation called hit and the hit animation all we're going to do is we're going to take the sprites modulate parameter and we're going to just modulate the color so it flashes with a red color effect so I'm going to do that and skip over all the clicking and show you the result hey we're back so here's the animation so I've taken the modulate property and made a track for it so we start out with it normal and then if we go I'm doing the steps of 1/100 of a second so four hundredths of a second over I change the modulate to red and I made a keyframe and then I just repeated those and a quick way you can do that is if you move to another spot in the time step and you click on a keyframe you can rightclick and choose duplicate selection and it will duplicate that same frame there and I did that so that we would have a multiple blinks right so every time you run it you're going to get a couple of red flashes and that's all we need so now we just want to play this hit animation whenever the enemy is hit so we'll go back over to our script and right here on our damage function we're going to just say play the hit animation whenever you are damaged so let's try that out yeah there so you have flashes when we hit it okay perfect and then we blow it up so the other thing I wanted to do this time around was experiments more with the enemy shooting because I had an idea last time we made the enemy shoot either a single bullet or a spread of three and both of those were nice but I also wanted to test doing it one other way which is having the enemy shoot a pulse of bullet so three bullets but not all I at the exact same time and for that we're going to need a custom timer so I've made a signal for it pulse timeout is going to be emitted whenever the timer runs out and we just need to make a pulse timer to track that and so we're going to do that in the ready function add it as a child declare it so we're going to do with this timer is we're going to connect its timeout we're going to connect it to timeout signal to a function in that unit another signal and you have to do that because what's going to happen is when we want to fire a pulse of bullets I would do shoot a pulse and we're going to say you can shoot a pulse with any number of bullets in it alright so some number of bullets at a time with some delay between them right and so we're going to count to that number we're going to shoot we're going to shoot one which we've already done which is going to actually make the bullet go and then we're going to call a function called delay for that amount of time or let's call it pulse delay and so we're going to do a pulse delay for that amount of time and then we're going to yield which means stop running this function until a certain until a certain signal is detected and that's the pulse timeout I'm out okay and so that means our delay function I'm going to put this down at the end post delay all the pulse delay does is takes a takes a time amount that we want the timer to wait for and we're going to take the pulse timer and we're going to set the wait time to that can't spell today we're going to take the pulse timer and we're going to set it to timer process mode to zero we're going to start it okay and then you already said that when the pulse timer times out it's going to admit it's going to call this function and this function is going to emit this function is going to admit that pulse timeout signal that this is waiting for that should be emit signal and then we want to say up here on the shoot that we're going to shoot a pulse and we're going to shoot 3 bullets with a tenth of a second delay between them okay and that's going to look like this very nice we will see a problem here the bullets are still hitting the player even though the player has been disabled we set the player to invisible so what we're going to do is we're just going to say if target dot is visible that way when we have when the player has been destroyed we're not still shooting at it and entering having bullets enter its area there we go see you now the nothing for the enemy to shoot at alright so that'll do it for this video that was a really fun one I think the enemy is coming together really well two other things that I just did real quick was I added an accuracy factor this is a number of radians that the when the bullet is fired it will vary by so that it's not ever not shooting in a perfectly straight line so I just added that here in the shoot function when it spawns the bullet I'm adding a random factor there and then so that's just going to make it to the bullets are a little less accurate there's a little bit more variation especially when you're moving to and the other thing I added was this little particle trail okay so you've added a particle to D and I'm just playing around with that I'm not entirely sure that's exactly how I want it but I think it looks okay to start with for now now one other thing we could do is if you want to be really mean to the player you shoot a pulse of the triple spread and then you've got oh really hard alright so for right now that is going to be good enough for the enemy we're going to keep it like that until we start implementing the difficulty levels and start varying this by how far along in the game you've gotten okay I hope you had fun following along this time and I will see you in the next video you