okay welcome back to the topdown tank battle game in Godot 3 this time around we're gonna add a couple of small quick features one one about the tank and one visual effect stay tuned to the end because I do have a little bit of an announcement about the upcoming Godot 3.1 release and I'd love to hear all of your opinions about it but for now let's dive into the code so the first small feature I want to add is I want the driving to be a little faster when your tank is on the road or to put that the opposite way it's slower when you're off road so that way when you drive along the roads you'll be you know you'll be encouraged to drive along the road because you'll get there faster so the way we're going to do that is by checking what tile is underneath our position if the tile that's underneath our position is one of these terrain tiles actually I decided to do it this way because there's fewer terrain tiles then there are Road tiles because of all the curves and everything like that so if we're on one of these non road tiles our speed is going to be lowered otherwise we'll go our current higher speed so we need a list of those tiles so I'm gonna go in my script tab here and I'm gonna create a new script and I'm gonna call this Global's this is going to hold global variables of which we're probably gonna need more later this will just be the first so we're gonna make this script and it's going to have in it a variable called slow terrain and this is a list which I've already made of the tiles that are the terrain so we go back over to 2d here and we're in the tile map you can see right number zero not number one number ten etc alright so I just made a list of the ones that are terrain and like I said there's a lot more Road ones so easier this way so we're gonna save that script and we're gonna add it in the project settings as an auto load so we want to go and pick that script Global's and we want to add it and for the name I'm gonna put this in all caps mainly so that when I'm using it in scripts it stands out it's just a visibility thing personal preference so okay so now what happens is that auto load will be automatically loaded in every scene so whatever script you're using will have access via that Global's name to whatever functions or data is in this script so in our tank I'm gonna go over a tank script now and we're going to add a couple more configuration variables we're gonna add we're gonna add a let's call it offroad friction that's gonna be how how much does being offered slow you down right and that way we can make tanks have different values for that and let's see on the tank here let's set the default for that to 1.5 so basically you'll be doing 50% slower now in the script also what we need to do is we need a reference to the map so that we can access what tile is underneath us okay and the main scene will we'll set that value when the player spawns so down here in our process function or sorry physics process function right if here after we've checked the controls if we have a map set its that variable set then we need to figure out which tile is underneath us so the tile that's underneath us will get the cell for our position using the world to map so we convert our position into map coordinates and then get the cell that's there which is going to be an integer value the number so if that tile is in Global's dot slow terrain then we want to make our velocity and we're gonna just going to divide it by offroad friction actually come to think of it why would I want to do it that way let's multiply it by offroad friction and let's just set the offroad friction to 3/4 all right so so you go 3/4 speed when you are offroad ok so now how do we set that map value well that's going to be in our mean our map script here in the map script we're going to set that in ready so in ready we're going to say set the player's map variable a equal to and I want to set it to the ground tile map all right let's give this a try okay so now I'm driving along going kind of slowly but when I get on the road yeah I'm faster so let's see if I just go in a straight line I speed up when I go across there so now we can set that for different tanks to different values and you'll be able to go a lot faster or a lot slower whether you're on the road or not okay so another small effect I want to make is I want an indicator when a tank's damage is getting a low that will show that it's almost dead right so the or that it's damaged so it has some smoke coming off and so we're gonna use a particle 2d node for that so I'm going to make a new actually I'm going to make a new scene and we're gonna use a particles 2d I'm gonna call this smoke and I'm going to save it in the effects folder so we can attach this to any of the tanks we'll attach it to the to the route tank script or the route tank scene so what do we want this to do so to get started we don't have to get too fancy with this we can really just use the default particle shapes and things and we can always come back and adjust it when we see what it looks like so let's see here I want more than eight particles let's try 50 and see if that's too many or not lifetime we'll see how we feel about that one what do we want explosiveness now we can keep that those are all fine what else do we want to change on here position I'll adjust that when we add it to the tank yeah we'll see about that one these only added to tank but for process material we want to add a new particles material right which generates the default particles which are little square ones just dropping off the screen so we go into that particles material and this is where we're gonna set lots of these flags so let's see let's go through them one by one so for the emission shape I want to use a box so I want them to spawn you know in an area not in one spot so let's make the extents of the Box wider okay let's make gravity V zero because we don't want that all right so now they're spawning first let's see what's spread spread probably want that to be a little bit smaller and we'll mess around with the velocity and stuff let's get the appearance going so for this scale right I want these to be larger but then I also want there to be a scale curve meaning when they spawn well maybe not let's just let's see what it looks like with the color I'm going sort of doing this as we go so for the color we're gonna use a color ramp which is a gradient from one color to another let's make a new gradient let's edit that now we want it to start out as kind of a maybe a grayish color and then I wanted to fade towards black but also with a low alpha yeah that's pretty good now they're all spawning in the same spot and not moving so we can also go to our velocity settings and give it a little bit of a initial velocity because I think that is set very small there we go although why is it going we have our color ramp going the wrong way I wanted this one to be the solid color and then this one over here to be the black lo alpha there we go yeah let's make this one a little lighter okay and let's give it a little tangential acceleration that will make it sort of flow off to the side if it's looking choppy to you and this is from the screen capture it'll be better once we get it all going so there's that so I'm gonna save that and then over in the tank script we're going to attach this to the tank so we're gonna add an instance of the smoke so let's take that smoke and let's flip it 180 degrees I want it to be going off in that direction and let's shift it back towards the back of the tank a little bit okay save that let's look what that looks like on the player there we go so a little bit of smoke looking at these coming out of the back of the engine there that's a good start we'll come back and tweak it later but now we want that to either turn on or off depending on the tanks health so in the tanks script when it's ready we're going to let's see in the hell yeah so when it's ready we're just going to turn it off all right we set the emitting to false because we don't want it to be showing and then it turns on or off depending on your health right so when you take damage we want to turn it on so so let's put that here if health is less than max health let's save your below half then I want to set emitting to true and then when you heal I want to do the opposite all right let's see what that looks like when we run this okay so I haven't taken any damage let's go up here and get hits um when my health gets low oh I'm smoking up did you notice what I forgot so on the smoke our problem is that we are stuck on local coordinates so in the drawing we want to turn off local coordinates local coordinates makes the particles stay attached to the emitter so that when the tank is turning all the smoke turns with it but we want it to trail off and not be attached to the tank anymore let's try that again there we go all right so now I'm leaving off that trail of smoke I probably am gonna play around with this some more and fiddle around with the emission time right how long the particles last maybe the speed they go at but you get the idea right particles you can have a lot of fun just playing around with them and trying a bunch of different settings so I'm going to tweak that offcamera and we can move on to the next step so one other thing I want to do oh we should probably put that below the turret huh let's do that real quick so we want the smoke to be rendering before the turret alright so one of the reasons that it's been a little slower making these is because of the upcoming release of Godot 3.1 and now that 3.1 is in beta I've been spending some time taking a look at the features and I'm trying to decide whether I want to shift this project over to 3.1 right once 3.1 comes out people are going to want to toriel's and examples and things that are targeted towards that now the good news is that the move from 3.0 3.1 isn't going to change a lot about this project the obviously the older videos are going to look different because the UI has changed a little bit the inspector looks a little bit different so I think what I'm gonna do is do an example video of that of 3.1 and sort of get everybody's opinion on what they want me to do if they want me to start working on shifting this over to 3.1 or if you want to stick 3.0 for now and deal with that later feel free to leave your comments in the comments you know let me know what you think what you want me to do about this upcoming new version of Godot thanks for watching and I'll see you next time here I'm just tacking out the end if you want to see a different way to do the particles I added a little red orange there to make it look like there's fire before the smoke comes out again a lot of different ways you can do this I encourage you to play around with the particle nodes yourself and make something that you think looks good you