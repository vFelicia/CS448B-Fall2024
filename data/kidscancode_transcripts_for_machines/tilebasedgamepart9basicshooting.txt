welcome back to game development pi games this is part 9 of our tilebased topdown shooter game and in this video we're gonna actually start adding shooting so now that our Dom bees can chase us we need to give the player a way to fight back so we're going to add a bullet so over here in the settings I'm going to make some variables for the properties of our gun and so first we're gonna set up a bullet image and there is a bullet PNG that I pull it out of the kennyart pack which you can get at the link below it's just a little circular bullet and we're gonna set the bullet speed it's how fast the bullet will travel a little bit much faster than the player which moves at 300 and we're also gonna put a bullet lifetime and that's is this is gonna be how long the bullet lasts so if you fire a bullet it doesn't keep going forever it's going to disappear after 1000 milliseconds one second so now we can go over here to our sprites and we can start defining the sprite and I'm gonna make a little shortcut here I've created a shortcut to pasted in here we're gonna make a bullet and the bullet is going to need some information when it spawns we need to tell it where we want it to be position and what direction it needs to travel in and both of those will be vectors local location for where it will spawn and the direction that it will travel in and then the image is just going to be game dot bullet image which we need to load over in our load data there we are we'll just duplicate this and we will load the bullet image and that's going to be that's going to be the bullet image okay and while we're over here we'll also add a group we're going to want another group to put all of our bullets in okay so now okay so we have our bullets spawning our position is going to be that position that we passed in and we're gonna put our rectangle there our velocity is going to be that direction vector that we passed in which is going to be a direction vector is just a vector with a length of one alright just going to be a unit vector pointing the direction we want the bullet to travel so we need to multiply that by the bullet speed so we know which way to go and then we also need to track our spawn time that way we know when to delete the bullet okay and then the update is just going to be to move move at our velocity update our rectangle to that location and then if it's going to take get ticks spawn time if that is greater than the bullet life time then we delete the bullet okay so that's good enough for now let me fix this capital B here all right so there's our bullet all we need to know about our sprite it's gonna spawn and now we need to spawn it now we have all our key controls up here on our player for when the player is moving so we're just going to add another one here for K space oh and we need one more setting here actually we need a bullet rate this is going to be how often how fast we can shoot if we hold the spacebar down how fast did the bullets get produced we can make that faster slower for a machine gun effect and so on so we need to use that over here to tell whether it's time to shoot or not so we're gonna keep track of them when the last time we shot was all right if that's been long enough then we can spawn a bullet so we need to figure out what direction we're pointing in so we make a unit vector and we just rotate it at the players rotation and then we can spawn a bullet okay and we just pass it the game we pass it the position of the player and we pass it that direction that we just figured out and then we just need to go here and say last shot equals zero so we haven't shot yet when we spawn the player okay so let's try this out we're gonna shoot we have a small typo in our bullet we need to store our game reference so that we can use it down here all right now we're gonna try this out now watch what happens when I shoot well my player is flying right so I'm spawning a bullet but my player is flying at the bullet speed what is going on well here's what's happening so when we shoot when we fire we're telling we're sending our player's position to the bullet right and then the bullet is taking that position and changing it so we're basically using the same position for our player and our bullet so when we update our bullets position it also updates the player's position and that's no good we don't want to do that what we want to do is we want this to be a copy so the vector class you can just if you pass a vector into the vet command it makes a new vector that has the same that's equal to that but isn't the same vector right so if we run this now right now I can shoot I'm holding the button down I'm and you can see how the you can see how the bullets are timing out when they have gone traveled for one whole second right they don't go further than that but we probably don't want them to go through the walls either all right we probably want them to stop when they hit the walls so let's also put here in the bullets update we can use the sprite collide any function because I don't care what wall it hits if it hits any wall all right if it hits any wall then it should just get deleted so that's going to look like this okay so the bullet hits the wall it stops okay now what about making it well before we have it hit the zombie let's have a look at where the bullets spawning right the bullet it's coming out of the center of the player but I'd really like it to look like it's coming out of the gun so that means we need to offset the spawn of the bullet to where the barrel of the gun is relative to the center of the player right so as it turns it's always at the same position relative to the player it's to the player's right a little bit and forward from the center okay so I'm gonna go over here did the settings and I'm gonna make an offset so on the players sprite there's gonna be a barrel offset and this is gonna be a vector representing how far from the center of the sprite the barrel of the gun is and so this is gonna be a vector now we need to figure out exactly where that is and where it's going to look good right and so this is relative to the center so if we imagine the player is before the player rotates he's facing to the right so that means we're gonna want to move some positive number of pixels in the xdirection right just the bullet is forward of the player and it's also down some amount right so let's just move it 20 pixels forward and 20 pixels down or 20 pixels forward and twinkles to the right of the player and and we'll see if that's good enough we'll adjust it once we have it working okay but that also means that if I'm gonna have a vector in my in my settings file I'm going to have to define it here like we've done in the other files okay so we have our so we have our offset and we're going to adjust that but we need to use that over here when we spawn the bullet now what we're gonna do is we're gonna do it in our code where we shoot which was right here okay so when we spawn the bullet instead of sending the position of the player itself we need to add we need to add that offset so we're gonna say the position where we that we want is the player's position it's whatever the player's position is plus the barrel offset rotated to match the players rotation right that way it will be pointing in the direct right direction and then we send that that's the position that we're going to send to the bullet so let's see what that looks like and if we guess some good values for where a bullet will spawn well let's get out of the way of some of these looks like we're too far to the right and we could maybe go a little more forward right notice how it rotates as I move around and it'll always spawns 20 pixels over and 20 pixels forward so let's move it a little bit more let's move it a little bit more forward and a little bit less to the right let's see what that looks like well that looks much better okay so now it looks like the bullets are coming out of the gun when I shoot them and not spawning in midair or coming out of the player alright let's add one other thing to the bullets and that is I would like them to have I would like it to have a little bit of kickback and that means it's when you fire the gun it's gonna push the player back a little bit okay and the kickback is gonna be a speed that it's gonna push us backwards so let's make that let's try 200 and see how that looks so that means when we spawn the bullet here we also want to add we also want to modify the player's velocity so we spawn the bullet and we set the velocity equal to the kickback right in the negative direction also rotated at whatever the player is so now when I fire the gun it should push me backwards I'm gonna get out of the way of these zombies so we have a chance to see it yeah see how I get a little bit of zombies are annoying when you can't get rid of them get over here where they can't chase me let's see I get a little bit of a push backwards when I fire my gun okay so one other thing that would make the shooting look a little nicer is to give the gun a little bit of inaccuracy okay and what that means is every bullet isn't going to come out in a perfectly straight line there's going to be a spread some will go a little bit to the left a little bit to the right and this number will represent how many degrees to the left or right of straight that the bullet will travel so that means when we go over here to our sprites when we spawn the bullet we want to pick a random number between 5 and 5 and add that to our direction okay and so we're gonna take and we're gonna pick a random value and for this I don't want a random value that's an integer I don't want it to just be 5 4 3 2 and so on I want any number between minus 5 and plus 5 including any kind of real number so that means I can go up here and at the top from random I'm gonna import uniform and that's exactly what the uniform random command does is it gives you a real number back that's between your two bounds okay so spread is going to be a uniform between minus the gun spread and the gun spread okay so we go so we now have a random number somewhere between minus 5 and plus 5 so we just take our direction vector and we rotate it by that spread so it'll rotate a little bit to the left or a little bit to the right okay and what that's gonna do is let us see some spread let's see how the bullets are not all going in the same direction just to see it even more and we probably wouldn't want to do this but if you had a really bad inaccurate gun right you can see they're spraying out in all directions okay so that's perfect that's what we want to do so we're going to leave that at 5 so it's just a little bit of variety in there okay last but not least we want these bullets to kill the zombies now just to keep it simple right now we're gonna add in our update section we're just going to do a PG dot sprite that group collide all right we want to collide two groups the mobs group and the bullets group and what do we want to do well we want the we want the mobs that get hit we're going to put false and the bullets they get hit we're gonna put true so the bullets disappear when they into the zombie and the zombie does not disappear but what we're gonna do is for each of those hits we are just gonna say hit kill just for the moment because the mobs don't have a health and the bullets don't have a damage or anything like that yet we're just gonna have one shot kills them just good enough to start with okay and sure enough now the bullets killed a zombie okay well this video is gone really long it's getting harder and harder to keep them to my ten to fifteen minute limit I originally set because there's just so many things I want to do I got excited about doing the the shooting and I have more stuff that I didn't get a chance to yet that we'll do in the next video so hopefully you're enjoying it post your questions below please hit like on the video and subscribe and I will see you in the next one thanks you