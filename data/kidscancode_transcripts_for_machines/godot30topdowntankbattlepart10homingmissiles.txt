welcome back this is part 10 of the topdown tank battle tutorial for Godot 3.0 this time we're going to talk about bullets some more we have our enemy and our player tank shooting but they're only shooting dumb bullets and so this time we're going to add some heatseeking missiles so that we can get some variety and the type of weapons that the enemies can run around with all right let's get started here's our bullet script which is being inherited by both the player and the enemy bullets and we're gonna use a lot of this same code for our heatseeking missile so we're gonna just add some code to this one so that it can hear it from the same place too because really the only difference between the plane bullet and the heat singing bullet is that one can seek a target and so if a bullet doesn't have a target it should behave you know like a regular bullet that travels in a straight line so we're gonna add one more variable here and this is a steer force the steer force is gonna be how agile this missile is how how quickly it can turn and then we're also going to have an acceleration vector that we need to track and we're gonna have a target variable and normally this will be null but we will set it for missiles to the player or whatever whatever thing you're shooting at so then when we spawn the bullet we're going to optionally pass it a target so we'll set this to null by default so that way if there is a target it'll set the value to the target to whatever that was that was passed in now in our process function if again we have no seeking behavior than our velocities gonna be constant we're just going to travel in a straight line but if we have a target we need to find the direction towards that target and turn towards it at whatever our turn speed is so that we can try and head towards it so that's going to be an acceleration so our acceleration our acceleration vector is going to be set to whatever our seek function returns which we're going to write in a minute and that's going to give us an acceleration towards the target so our velocity now gets altered by the acceleration times Delta we will we need to clamp our velocity to the speed because our when we you know when we stop to turn we're gonna be slowing down to turn and head back in the direction towards the towards the target if we didn't do this then we would keep accelerating towards the target and get faster and faster so we want this speed you know heatseeking missile the speed is gonna become the maximum speed that can travel in a straight line and then we need to also change our rotation since we've now turned to point in a different direction we wanted our rotation to match the velocity angle so we were always pointing in the direction we're moving and then we now have our seek function to make and if you go and do some reading up on various steering behaviors you'll know that seek is one of the simpler ones it works by taking by finding your desired direction so this is the vector that we want to be moving in which is going to be the vector towards the target so that's the target position the bullets position normalized time speed right so we want to move towards the target spelled desired wrong there we want to move towards the target at our maximum speed but our steer force now is going to be the amount towards that direction that we can turn so we take the desired the direction we want to go minus the velocity which is the direction we are going normalize that and multiply it by the steer force and that's going to pull us towards the desired direction by whatever our steer steer forces and we return that so now we have our directional steering and we just need to now assign this bullet to an enemy and have it start shooting so now to get this working I've created a new inherited scene from bullet that I've called missile and I'm using this image for it and it's just going to inherit from the bullet GD script now if we go over to our map what I'm gonna do is take this enemy right here and I'm gonna put the missile here in its bullet property and that'll make it fire it but now we need to make a couple changes to the tank script so that it can pass that target along if it needs to and actually we can pass the target to every bullet because if a bullet has its if a bullet has its steer force it to be a plane bullet anyway so we go into our so let's see let's go into our enemy tank script so our enemy tank script has a target that's why it knows to shoot so we're gonna pass that when we call shoot so that means that in our main base tank script our shoot function now needs to accept a target and we'll set that to null by default and we'll pass that along with the signal when we omit it and then that just means we need to go to our map script and then when we get the shoot signal we're also going to be passed a target and we pass that along to the bullet and then the bullet will have a target which we have already set here which when you set here and they we have set here in the start so now our target can be set so we'll go over to our back to our main here and here's the bullet actually the missile let's go and set our properties I've set the speed to 400 the damage to 15 and the steer force to 25 for this missile so this guy should now be shooting missiles at us so let's go to our map and run that I'm gonna drive down to where he is I'm gonna drive past him so you can see these things coming at us there we go see other curving towards us and now obviously the next step is gonna be we can adjust that steer force we can adjust the lifetime of the bullet tell how long they're gonna chase you but they are curving in and if we go over to the other tank we'll be able to see that one it's still going to be firing the plane bullets which have this deer force of zero and they're still going in a straight line okay and so you can see a little variation I've lowered the speed and I'm gonna increase the steer force to 50 so you can see kind of a different bullet behavior or missile behavior I should say so we will go over here and you're gonna see the bullets will be slower but they're gonna have much more maneuverability so they're gonna attract me around corners pretty well so you can get a lot of different bullet behaviors just by adjusting those properties here of speed and steer force and make these missiles behave however you want now another thing I want to do on these missiles is add a bit of flare to them that when I have some of them to have a trail you know smoke trail coming up behind them because these are these aren't just dumb bullets their missiles they're gonna have some kind of smoke trail behind them so we're gonna do that with a particles 2d node so I've added the particles 2d and I'm gonna just quickly walk through what the settings were for it so I've set the amount to 30 the lifetime to 0.4 I've turned local coordinates off because we wanted to win the missile moves I want these to stream out behind it probably turn that on there so yeah so when the missile moves I want these to stream out behind it we have added a texture so I found an animated texture on open game art of an exploit a smoky explosion and it's 24 frames of animation so we're gonna throw that into the texture and set the eight ramps to 24 so that the frames will be chopped up properly I've moved the position accidentally put that back to zero and we also want to put show behind parent right I want it to look like the smoke is coming out from inside the back of the missile not on top of it so I put it back behind there like that and then in the process material we've turned gravity to zero initial velocity to zero I've added a scale curve where we take it from small around 0.2 up to 0.5 so it's going to grow a bit so as it turns into smoke it gets bigger and then we've also said here this is where you set the animation I've just hit the animation speed to 1 and let's take a look at what that looks like there we go so now our missiles have a nice smoke trail behind them now one other thing I wanted to add to shooting while we're working on shooting is a way to fire multiple shots like a spread of bullets and we're gonna set that in the tank script so we're going to thanks rip down we're going to add two new export variables gun shots that's how many how many bullets are gonna shoot and also a float which I'm going to constrain to that called gun spread and I'm gonna default that to zero point two so this is this is how many shots to fire and this is the angle between shots so how spread out are those shots and so now we need to update our shoot function our shoot function is now gonna take a number and I spread now normally that spread that number will be one and if it's one we're doing what we're doing we should be doing what we're doing right now but if num is greater than 1 then we want to do a loop and we want to loop and shoot that many bullets and the only difference between them is going to be the angle between them so so we can call this the I'm just going to use a 4 alpha for an angle the angle we want is negative spread Plus I times 2 times spread divided by a num minus 1 and so where did that complicated formula come from well this is because we want them to be centered so if I have a if I'm shooting three bullets I want the middle one to go straight and then one to the left and one to the right so our angle needs to start at a negative value and then so the first one would be negative whatever angle and then this is going to be 0 over here because I is 0 and then the second one it'll be 1 times and this is going to be adding an additional angle each time so now we have an angle we need to emit actually we can just copy this one so we're going to emit the signal but the signal we emit is going to the difference is going to be the direction is the direction rotated by our alpha so we give it an additional a small additional rotation and then if we didn't so then we just will put an else here for this one and we emit the regular signal if the number of bullets is normal and then we'd have to change anything else because we're emitting the signal it's just we're just going to be emitting three bullets to the main instead of one so let's go back over to our map and I'm going to change the enemy that has the missiles assigned and I'm going to set his shots let's try three and now let's run over going to see him fire three shots oh and we forgot to add it so now when we call shoot we need to pass numb and spread so that's in enemy tank shoot so here in the enemy tank we need pass gun shots and spread okay let's give it a shot you should have three a volley of three missiles every shot there we go and that's gonna kill me real fast cool so now we have this functionality we can customize our enemy tanks and our player for that matter to have multi shots we can have a spray of regular bullets we got a spray of heatseeking missiles all right so I hope this was helpful for you and I look forward to getting back into this I have a bunch of things that we're gonna add in upcoming videos if you have any suggestions or comments please add them in the comments below and I'll see you in the next video you