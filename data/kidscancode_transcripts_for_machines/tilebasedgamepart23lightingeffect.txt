all right welcome back this is part 23 of our top down zombie game and in this episode we're going to add a lighting effect to the game so for this video I thought we'd talk a little bit about doing lighting effects uh this is being a zombie action game it might be nice to be able to have the character running around at night and maybe the zombies are a little harder to see uh something like I did a quick Google image search you know something like this where around where the player is it's lighter and in other parts of the map it's darker right we we we probably want to do a little bit darker than this but you get the idea now there's a lot of different ways to do this um most of the kind of more advanced ones are beyond the capabilities of what you can do in in pi game so we're going to stick to a really simple version of this kind of the most basic version um for this for this uh demonstration so what we're going to do is we're going to need basically to take our game and I'll load it up here and we want to draw basically over the top with a dark color and only have it be transparent or be able to see through it you know in a radius around the player and to do that that we're going to need an image and here's the image so all this is is a gradient where I went into but you can do this in pretty much any image editor you might use paint.net can do it they all have the gradient tool and all I did was select white and as my uh foreground color and transparent as my background color and then I just did a a radial gradient that goes from brightest white at the center and Fades out into transparency so this is going to be the the mask for our light we were going to we're going to place this at the center of where the player is and we're going to use that to sort of be reverse this effect and make this be where we can see everything at full brightness and it'll Fade Into Darkness as it gets here and then everything out outside of this image on the map will be all the way dark okay so we're just going to load that image here in our settings call it the light mask and you can go and make your own or I'll put the link to download the the light mask image in the description below if you want to just go ahead and grab this one that I'm using so let's just go and load that up now so over here in our loading code is where we want to do that but also first I just want to show you real quick I added here in our uh new game code another of these Boolean Flags called night and that's just so that we'll be able to turn on and off the lighting effect and down here in the event code I just added pressing the N key is going to toggle that night mode right so that way we'll be able to test it well and see how it looks right so back up here in our in all of our asset loading do this right before we load the sounds we need two images One image is going to be that solid giant black rectangle that's going to cover the whole screen and if you've ever played a like a military strategy game that had a fog of War it's what it's usually called the fog of war the the part that darkens the areas you can't see so we're just going to call that fog um and that's just going to be a pame surface that's the same size as the screen because it's going to cover the whole screen and then we want to fill that with that night color that dark gray that we chose in our settings and then we need to load the that light mask and the light mask we're just going to do a PG image. load so I'm just going to grab this one right here and the thing we're going to load is the light mask and we also want to uh resize this so that we'll be able to adjust its size right so we're going to scale this by the light radius setting we set as well and then the last thing we need is we're going to need a rectangle so that we can easily place this where we want it to beang all right so now we got everything loaded that we need so now to draw this what we have to do is take this light mask and blend it onto the fog at the location of the player and then take the whole fog and stick it on the screen on top of everything else which means we want to draw it towards the end so we got our draw section we want to draw it after we've drawn all the Sprites and everything but probably before uh we draw our Huds so that we can still see things so we're going to do that here so if Knight is true we're going to render the fog okay and so let's just Define what that process is so render fog needs to do a couple of things right we need to um we need to draw the light mask which is a gradient on to the fog image right now every frame we're going to have to do this because the player moving around so last frame we will drawn the light mask onto the fog so we need to um take the fog and fill it again with our night color and then we need to take figure out where our um circle of light needs to go so we'll take our light re. Center and we'll set it equal to the location of the player right which is we got to apply the camera to the player which gets us erect and we'll use that Center of that okay then onto the fog we're going to blit the light image oh sorry the light mask I mean we're going to spit that at the location okay so now we have our fog image and it's going to be a big dark gray rectangle with a light white uh gradient Circle somewhere right so it's going to look kind of a lot like this now the back it'll be dark but this is what it's going to look like and if we just draw that on the screen we'll see a big white circle on top of our player so what we want to do is when we draw this on the screen right when we lit that fog image onto the screen right we're going to put it at z z because it's going to cover the whole screen so it's going to start in the upper left hand corner we want to use something called a blend mode and and so pame has these special flags that go with um how you draw pixels on top of other pixels and we're going to use the blend multiply okay and that's going to take every pixel that we have on our on our fog image and look at the pixel that's going to be below it and it's going to multiply them together right and so where we're white like if you think of the pixels as being between zero and one right uh zero being black and one being white um and obviously that's for each of the colors let's say let's just to keep it simple let's just say we're doing a black and white picture then when the picture is white when the pixel is white it's one so it's going to take whatever is underneath it and multiply by one which doesn't change it right and if it were zero we'd be multiplying by zero which would make it black so that's basically going to going to combine those two images together the way we want so let's take a look at how it looks now right so here's our game here I'm running around now I'm going to press n and turn on the night effect and there we go now the screen is so dark right and BEC but because we aren't using pure black we're using that dark dark gray 20220 um you can see a little bit of the map back here behind you see a little bit of the screen as if it's not quite fully dark and then our light gradient kind of Blends out to here and it moves as I move around so now we have a much more challenging thing it's hard to see those zombies until they get in range right that's pretty good now you might notice that my frame rate rate up here at the top is um dropping quite a bit um and I did some testing this has something to do with my video recording um happening at the same time you shouldn't see a big frame rate drop like that uh when you're just splitting this black image on there but let me know in the comments below if you do there could be some other things going on uh as well but when I don't have the video recorder running it seems to work fine all right so that's the basics of it now there's a a lot of things you can do over here to make things come out differently right like for example if we wanted a much um less of a or a much lighter Darkness you know you make this 50 instead and then where it's going to blend to is a much lighter color right see at 50 now the darkness out here isn't nearly so dark and depending on what you're going for you know that might work better for you um I like it better when it's super dark change that back to 20 and another thing you can change you can obviously you can change the radius of how far your light shines but I've also made a couple other gradients right and remember this this gradient image is how quickly the you know or Blends from White in the center into the transparency but how quickly this this transition happens can have a lot of different effects effects on how your light effect looks and I've actually made three of them we've been using the medium one I made a hard and a soft edged version as well and I'll show you real quick what those look like right if we do the hard edged one then what's going to happen is we're going to have a much ster transition right it's much more of a just big bright CF ir and you don't have that fuzzy edge around it and it doesn't look quite as natural but again this could be an effect you're going after and then for the last one I'll show you what the soft edged one looks like right and what that one's going to do is blend you know much more you be much more fuzzy as it Blends into there right and so this looks much more like you have a really weak flashlight uh on you okay and you know that's pretty good you might scale it up a little bit make it go out a little bit further since it's uh running out so fast because you really can't see those zombies right now I can't even tell it's running at me until it gets really close right so that can be a much more challenging effect as well so that's our lighting effect now to wrap up let's talk a little bit about some of the limitations of this now obviously we have a a circle around the player right if you wanted it to look much more like the player had a flashlight then you would need more of a cone shaped uh gradient image and you'd have to rotate that as the player rotated which is you know quite a bit more work um I haven't tried that out too much with high game I suspect ECT it would hurt our frame rates a bit to have to try and do that every frame there might be some shortcuts we could come up with to speed it up but that would let you you know only look like you're Shining Light ahead of you the other uh problem we have is that because we're just blitting this light circle on top of the player when I stand next to a wall it's going to light up the inside of the house right because the the circle just doesn't know anything about obstacles right and that is something much more involved you know I have here an example of how you do you know you want something like this where the light comes out of you and goes leaves Shadows around obstacles um another example is here right as you move around your light is blocked by walls and you know while this is doable it's a it's a whole lot more code involved and a whole lot more difficult to do so that we'll have to wait for a another video that might be that might be an indepth video that talks about how you do this uh how you do this visibility effect and make it look good while still not slowing the computer down too much all right P game starts to run into some limitations when you start trying to do stuff like that all right so I hope you like the the light effect I think it looks pretty good and has a good match with our with our zombie game as always thanks for watching and subscribing and I think that we're we're nearing the end of our zombie game project I think we'll uh we'll be calling it done pretty soon maybe maybe add one or two more things but um please feel free to comment in the comments below if you have any suggestions on what kind of things you'd like to see next uh what kind of games you'd like to make uh anything like that please do post it and we can we can figure out what else uh everybody wants to see all right thanks for watching and I'll see you next time byebye