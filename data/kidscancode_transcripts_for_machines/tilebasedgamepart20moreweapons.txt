all right welcome back to a game development with PI game this is part 20 of our tilebased topdown zombie shooter and first of all if you have been following along I want to thank you for sticking with it this long the games really starting to shape up and one popular feature that's been requested that I decided it was time to start talking about was adding more weapons into the game so this time around we're gonna take our little pistol that the player has right now and we're gonna also add a shotgun very popular zombie fighting weapon alright so let's get started okay so in the settings right now we have all this information about how we want our gun to work but if we're gonna have multiple weapons we're gonna have one of different settings for each weapon alright the fire rate might be different for one gun versus another you know big gun will have a bigger kickback that kind of thing so we're gonna need a way to organize all this stuff so that we don't have you know so we have it easy to change and it's and it's organized and it's logically laid out so we're gonna with if we have the concept of having multiple weapons then we should just group all the data for those weapons together right so this is going to become our weapon settings category of our settings file for now I'm going to use the same image for all of the bullets we will talk about changing that later so what we're gonna do is we're gonna make a dictionary called weapons that's going to hold each of the different kinds of weapon okay so to start with well so so we have the pistol right that's the one that we currently are using okay and this is just going to have all the data of that okay so let's see we want to have so each of these keys in the dictionary is going to be one of the settings for the bullet right so let's feed is 500 let's get this over here the bullet lifetime is a thousand I'm gonna keep the settings the same on the gun oops capitalize that bullet let's just call this rate this is the rate of fire of the gun the rate is actually gonna make that slightly bigger I think our gun was shooting too fast as it was and this is gonna be the pistol it's a small start a starting weapon so the kickback we've got the spread which we were using five we've got the damage very important how much damage it does and then I'm also going to have a bullet size here and for now I'm just gonna deal with having large and small large will be the size we're using right now the shotgun we're gonna want to have spray out a bunch of tiny little bullets so tiny pellets so we're gonna use a small size image for those but there we go what else do we need oh I know and one other thing is the bullet count so this is how many bullets does this gun fire right the shotgun is gonna spray out a bunch of small pellets so that number will be bigger but this is this is what the pistol will look like okay and so now I can just duplicate this whole thing I'm just going to duplicate this to make the shotgun okay and so let's see we need to what we need to do oh we have an extra space here so all we're going to do for the shotgun has just changed the values for these okay the shotgun bullets I think you're gonna travel a little bit slower they're going to last less time right it's not as a longrange a weapon the bullet count though is going to be a lot bunch of these little bullets are going to spray out gonna be small the shotgun is gonna have a little bit bigger kickback and a slower rate of fire right you can't shoot it as quickly it does more damage sprays out but you can't repeat fire it as fast the spread is going to be a lot larger because the bullets are going to fly out ahead of the gun and spread out so we want them to spread out and then each bullet itself is going to do a smaller amount of damage right but we're firing 12 of them so we're actually going to be doing six you know one shot can do 60 total damage in theory which is great when you're up close to a zombie you hit it with the full blast of the shotgun it'll do a lot if they're farther away from you they spread out maybe you'll hit a couple of them at the same time that's how we want our shotgun to work so we don't need these individual variables anymore so there we go so we have our Dictionary of settings for all of our different for two different weapons that we are going to be using to begin with now we also need to deal with the sounds and instead of having right this individual this individual sounds where our weapon sounds our weapon sounds is also going to be a dictionary and in this case what we're gonna do is for each type of weapon there's gonna be a list okay right now we're keeping that list just having one in it but if you remember when we first set up the pistol we were talking about having multiple sounds and then you randomly need the shotgun and then you randomly select from them and that lets your makes you're gonna have a little bit more variety and when we get to really polishing up we can do we can add some more things into this these lists okay so we have all our settings we have a sound assigned for each type of gun and we have a bunch of settings each kind of gun so now we just need to over in our load section make sure we're loading those sounds right so we don't get an error message okay so what we're gonna do here is we're gonna fill this in a little differently we're just gonna read through that dictionary we made in the settings so for each weapon and the weapon sounds list there then we're gonna take our dictionary and add an item for it we'll add a key for it and that's going to hold the list and then for each sound in weapons sounds for each sound in that dictionary for each one right because it could be a list we're going to load the sound sound and we're going to set the volume and we're going to add it dot append okay there we go so now we have all of our data created we have all of our sounds loaded for weapons and we're ready to start using them all right and the other thing OOP I just noticed there's an S on there okay so the other thing too is the image right so this bullet image we actually want two of them we want a large and a small so we're going to have bullet images also be a dictionary dictionaries are so useful and bullet images large will be this one that we have been using and bullet images small why did I put curly brackets there bullet images large and bullet images small small is just going to be the same image we're just gonna scale it down so we want bullet images large and we're going to scale it to ten by ten okay and that way we will have both sides bullets ready to go okay now if you run it you should be able to load but when you try and shoot you're gonna get an error message because we've changed around all the weapon data so we can't shoot yet so we need to go over here to our player and the one thing we need to add to the player when it starts is we need to add a variable here to hold what weapon he's carrying so we're gonna say he starts out with the pistol and that's the weapon you start with and now what we'll have to do is we're gonna have to redo our shoot code right right now when we press the spacebar we do all of this stuff but we're gonna have to do some different things for different weapons or and we're going to detect which weapon we have and all that kind of stuff so what we're going to do is we're gonna make a separate function for shooting okay so all pressing the spacebar is going to do is self touch shoot okay and then this stuff here is going to be what it does now we are going to change this around a bit let's undo that a little bit so we still need to match the weapon right but now instead of using this variable it's going to depend on which weapon we have so from our weapons dictionary we're gonna say whichever weapon we have and the key we want to look at is the rate alright so if we've that amount of time then we're gonna do it and the this will stay the same we have a barrel offset but we're keeping the same one we're not changing the players image for different weapons just yet but we can we can do that later but here we don't want to spawn we don't necessarily want to spawn just one bullet right and we also need to kick back so actually let's move the kick back line up here and the amount it kicks you back is going to be dependent on the weapon and we're going to use the whatever the kickback setting is and now because each bolt or each gun can shoot multiple bullets we need to do a little loop here and we're gonna count to whatever the weapon we're holding has in these count bullet count setting and we don't need just don't need these options autocomplete alright so now we're counting to how many there are okay and the spread is going to be different as well right now in the in our bullet when we spawn the bullet figuring out the spread but our problem is different weapons are going to have different spreads so we're gonna calculate the spread before we spawn the bullet and that's going to be just a uniform between whatever weapon we have and it's spread value and we're gonna just copy and paste that here because we want it to be positive or negative so now the bullet now we're going to spawn a bullet slope that game position that we calculated and instead of giving the direction here it's the direction rotated by whatever the spread we just calculated was okay we're gonna play a sound but it's gonna be from the game weapon sounds self dot weapon and then we're gonna spawn a muzzle flash just once we don't need to spawn a muzzle flash for each bullet because when we spawn the twelve bullets for the shotgun that's not going to be good okay so now we've added that when we spawn the bullet we're passing the direction now and we don't need to add the spread so on the bullet down below when we spawn the bullet what we're gonna do is go down to our bullet here we don't need that we don't need let's see the velocity was dirt we're not going to rotate it because we already did rotate it so it's just that and then we also are the bullet speed could be different so we've got to look at whatever weapon the player is holding and look at its bullet speed setting alright and I think oh one other thing the image here so here we've got to use bullet images whichever weapon whichever weapon we have bullet size okay let's give this a shot so we're going to run it up and we forgot over here one other thing is the bullet we have to know when to delete the bullet so we have to check the whoop the bullet lifetime whatever weapon the players holding at lifetime there we go alright and now when we hit the mobs they need to subtract however much the damage the particular bullet does all right so that's in our update over here bullet damage so we have to subtract from whatever weapons of the player whatever weapon the players holding damage there we go all right okay okay so the pistol is working again just like it was before there's a little sound issue happening but I'm going to talk about how to fix that in a minute because first what we want to do is let's just go and see if we go up here to the player again what happens if we have them holding a shotgun instead there we go nice okay so you see the spread of bullets come flying out but notice I'm not doing very much damage right and that's because we're only taking away one bullets worth of damage because in the collision code when we when we had the bullet hit the mob we were only checking if it got hit right so let's see bullet mobs no that's right oh right so when we're doing a group collide here so this hits list then it gives you back is actually not a list it's actually a dictionary and it shows for each mob that got hit a list of the bullets that hit it so we're going through each mob that gets hit and only subtracting once for each mob that got hit but if that mob got hit by more than one bullet we have to multiply this by the length of that mobs list of bullets that hit it right so I'll go through it again it might be a little bit confusing so hits is going to be a dictionary each key of the dictionary will be a mob that got hit right and each piece of data in the dictionary for each key is a list of the bullets that hit that mom so mob number one you know I mean we shoot the shotgun we might hit multiple mobs right and the first mob might get hit with two bullets the second mob gets hit with four bullets right so each so this list is going to go through each mob so each key in the dictionary so for each mob that got hit we need to subtract its health by the damage of each bullet times the number of bullets that hit it so how long that list of bullets that hit it was okay that way it'll take away the right amount of damage for each okay so if I shoot this guy up close with the shotgun yeah see his health went right down and two shots I can get rid of him okay and that's good and the last thing I want to deal with is this little sound issue so if we run this see if I can demonstrate here I'm gonna hold down the spacebar to shoot the shot gun repeatedly okay all right you see how it's not it's not playing every time I shoot and part of that is because the previous you know the previous sound hasn't finished playing you might be able to see this with the pistol as well let's go back to the pistol for a second see how I'm not shooting it's nothing the sound every time it's a little bit erratic okay and that just has to do with you're trying to play a sound and you haven't finished playing that sound and you've already started telling the computer to play another one and it starts to and it starts to be a problem you also might have been noticing this may or may not be happening to you a little bit of lag between the sounds you know when the code says to play the sound and when it actually happens and usually that has to do with the way that PI game buffers sound before it plays it right it tries to make sure it can load the whole sound before it plays it but sometimes that takes too long and so if you if you google this online you'll see there's a lot of tricks that you can do to improve it and one of those is before the PI game in it there is a pre init setting that you can do on the mixer to customize the sound settings and these are the defaults except for this last one which is the buffer size if we make the buffer a bit bigger than the default we can get a better we can get less lag whenever we want to play the sound because the sound will already be in memory and it can just fire it off okay so the other thing we want to do is we want to make sure we're not playing if we're shooting really fast we don't need to we don't want to drop the sounds that we play it right so you're in the shoot before we play the sound okay I'm gonna choose the sound before I play it okay I'm going to choose whichever sound I want to play and if that sound right we can see how many times how many channels is that sound playing on right now and it's already playing on more than two channels then we're gonna stop one of them then we'll play the sound and what that'll do is let it not have too many overlapping copies of the sound playing let's see if you can hear the difference with this it's much more consistent let's go back to the shotgun here we'll go back to the shotgun on the player and see much better and the splat when the zombie dies we'll be yeah see that so between those two things between limiting the number of multiple copies of the sound you play at once and by tweaking that buffer setting which you may need to tweak a little bit more yourself it depends on your particular system you might be able to get get away with 1024 it has to be powers of two by the way and I'll put a little link below you can go look at the documentation for it on the poem documentation if you're curious more about what that means but I think that'll do it for this video we've gone pretty long already but now we've done a lot of work we've got two different kinds of weapons now in the next video we can start getting a way to pick them up because you probably want to start you know the player with the pistol and the shotgun is gonna be one we can find somewhere and maybe you have a way to switch in between them that will have to come a little bit later when we add another item on the map like we did with the health pack right another one of these items we can make a shotgun pickup and I'll let you switch to the to the shotgun item okay as always thanks for watching I hope that this all made sense to you and you're starting to get a good handle on some of the usefulness of Python dictionaries they're really useful you can see by said all this up especially like when we did the the shoot code right we didn't have to have a whole bunch of ifs here saying if they're using the gun use this if they're using the shotgun use this it's all just loading whatever settings each particular weapon has okay I know that'll be really useful we add three more weapons you know three different kinds and this code won't even change a little bit right it'll all be ready to go already and we can just drop in more weapons whenever we want to all right thanks for watching I hope you enjoyed the video please hit the like button below and subscribe if you haven't already and I will see you next time bye you