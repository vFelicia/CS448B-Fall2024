hello fellow scratchers i'm griff patch and welcome back to part five of our twopart series crazy simple ray casting in scratch oh man well that hasn't really played out as i expected but ha not to worry this has been so much fun adding in entities and exploring more complex areas of 2d projection and death sorting has been a blast and if you've got this far then today is going to blow your socks off because we are going to introduce loads of the features you've been asking for collectibles extra enemy types and more importantly getting those enemies to chase us yes that's right so awesome and so this is a great time to save our projects as a new copy for this is episode 5. guys let's get scratching i like to begin each episode by addressing any niggles from the previous episodes and today i will start by pointing out that nano has continued to look a little floaty from day one the reason is that we always expect to see a shadow on the ground by someone's feet nano is no exception many of you noticed that i included one in my youtube thumbnails too so come on then click into the pen sprite and the costume editor if we zoom into nano's feet i'll use the oval tool and select a color of pure black with no outline and then draw a wide oval centered at nano's feet if we click the send to back and then just tidy up the position there and testing the project we can see that this is looking really nice but hold on do you see this this has been a problem for a while too but with the shadows it's now more visible nano's feet appear above the wall interestingly this is only the case when we are far away from them to understand why this is happening we need to see how scratch draws a line between two points we expect a line this long but we get a longer line because scratch adds on a nice rounded end it's this extra half pen width that is making the walls extend down below nano's feet so this should be relatively easy to fix we just reduce the line length by half of the pen width on each side that is res divided by two so still in the pen sprite find the define draw row script we begin our line at a y of the variable height we need to subtract from this half of the pen width so divide res by 2 and pop that back in next we do the same for the bottom of the line but rather than taking away we need to add half of res to it to do this we can just pop a res divided by two in place of the zero cool let's test this out okay here we are and that is looking good yeah super and zooming in and out with the fog slider makes it really clear that this is working perfectly now great now since we are here in the code fixing the wall heights let's just quickly talk about the wall heights themselves i know most of you have kept your walls just the same as mine but watch this you can have so much more fun bring in a multiply block and put the height on the right and return it back from where it came for starters let's multiply this height by 1. testing that and the walls are just as they were but watch the effect of switching this one for a two ha look did you see that the walls are suddenly all tall looking that makes the level feel much bigger and more spacious but why stop there we could use a three wow or four oh man this is huge the level is towering above us either we are now ants or we are in a very formidable maze so what will i set this multiple to i'm going to plumb for 1.5 that just gives ceiling a bit more height but it doesn't push it way above us and i like that so what's next how about we add some more entity types again in the pen sprite open the costume editor we click to choose a new costume what with all this extra height in the level i want a big guy to fill the space and i know just the one frank it is before we can use them though we need them sized correctly if we click into the nano sprite we can grab that 200 by 200 square we drew in episode three to do that we use the selection tool and draw a selection box to overlap the invisible 200x200 box there it is you see hit the copy button and we'll use it again shortly now back into frank's costume let's select all the parts of frank's costume and group them together with the group button and now we can paste in our invisible box oh wow it was actually quite close to the right size wasn't it before we do anything else make the invisible rectangle visible by upping its pen width yep there it is now we can select frank because they're all grouped together and size them down a touch and keep them centered in the middle of the screen but with their feet on the floor that is on the bottom of this square we should add a shadow under their feet too i'm just going to nip into the nano sprite and copy it and paste it back in here we'll need to make it bigger and send it to the back finally select the sizing box again and set the pen width back to 0 to hide it excellent so nano was costume 1 and frank is now costume 2. we need to spawn this new enemy type click into the entities sprite and here we are spawning 25 nanos of costume 1. duplicate the spawn block and we'll add 5 clones of costume 2. cool that was easy let's test that out okay there's loads of nanos there were 25 after all there should be five francs somewhere oh come on frank frank ah something be wrong i should have found one by now so we spawned type twos hold on hold on look here in the define rotate view script oh man we are always drawing type ones that's a bit of a bug this should have been changed to use the type variable and yes look i can see a frank there already yep they were here all along only they were frank's disguised as nanos and very convincingly too you know it would have been much easier to find these franks if we'd been able to see this world map while the game was running with all the entities displayed on it and it isn't hard to do remember how we have set all the ghost effects to 100 to hide the map as it is okay then so click into the stage sprite and we'll make a new variable naming it map ghost no we are not going to be adding ghosts to the level although yes that would be fun this will allow us to toggle the level ghosting effect on and off when green flag clicked set map ghost to 100. things want to start hidden then when m key is pressed set map ghost again but we set it to 100 subtract map ghost we can see this working by tapping the m key over and over it now toggles nicely between 100 and 0. great that's going to make it easy now we just need to tell the other sprites to apply their ghost effects broadcast a new message toggle map first we'll address the player sprite click on them and find some free space when i receive toggle map then set the ghost effect to our variable map ghost i can tap the m key now and there you can see the player is appearing and disappearing obediently now we want the same script in the level sprite so drag one in there and now two in the entities sprite and that's it just those two so let's give this a test click the green flag everything looks normal when things start up but tap the m key hi there we have the map and all the entities wow there are loads of them and of course the players in the middle the fun thing is that i can still drag these entities around the map when it's visible oh that's so cool yeah i can bring them all in and oh yes that one was a frank you know that poses an interesting question shouldn't frank's hitboxes be bigger than nanos because if we move them all over to a wall we can see that frank is now embedded right in it yeah we need their hitbox to be much bigger to fix this make sure we are in the entity sprite oh tidy up that toggle map script that we dragged in and then find with me the when flag clicked script here we set the size of the hitbox for all entities at 225 percent so separate that off and we'll make a duplicate the first we place before the first spawn block this is for nano and 225 was good but before the second spawn this is for frank so set size to something much bigger let's say 400 percent yeah now run that again and press the m key yeah that has given them a lot more body i can find them so much easier and if i move them up against a wall well okay they still overlap a tiny amount but seriously that's not so bad i'll actually stick with this the main thing to consider is that their feet are free of the wall really hey why don't we also change the color of the entities on the map we can match their color to their type somehow um from the looks category bring in a set color effect block i'll make the nanos set color effect to 10 but for frank i can set the color effect to 20. let's see that in action oh nice green for frank's and orange for nanos not bad i can bring them all in to make a cool scene hey gosh this is such a laugh you know we could make a scratch movie maker with this couldn't we say cheese guys love this zoom slider but these nanos don't look pleased perhaps it's because they are sick of being stuck in one place and i can't fault them for that guys would you like to start coming to get me i'm right here we want to slowly move each enemy sprite towards the player like this it's easy to demonstrate by dragging them with the mouse and when you forget all the 3d effects we've added on top all we really need to worry about is moving the 2d sprites in the 2d level after all because of this it should be surprisingly easy to get this to work in the entities sprite then scroll down into some free space we'll trigger our scripts off a fresh when i start as clone block this movement will loop forever and we want each entity to first face the player so point towards player and then we simply move forwards oh wow not by 10 that's far too quick in 3d space just move by 0.5 for starters to get a feel for things well that was easy i'm excited shall we run this project oh my gosh they're coming they are all coming and they're not happy i can see them all on the map and oh oh they are cheating they're coming through the walls this is not fair what chance does that give me no we cannot have this the walls must stop them well if we think right back to episode 1 of this tutorial we spent almost the whole episode adding good collision detection code to our player sprite the good news is we can copy those scripts and use them again for the enemies yay so click into the player sprite and we find the define move and the define try move scripts these are the ones we want start by dragging the try move script into the entity sprite and then follow that up with the define move script perfect back into the entities sprite and we can move these scripts into some free space tied it up now find the little enemy game loop under the when i start as clone we just need to switch out this move step block for the shiny new move custom block we just dragged in use the same distance of 0.5 and then make sure to throw away the old blue move block afterwards yeah here we go run the project okay they're still coming for me all right but pop on the map can you see there are plenty of entities still trapped on the other side of the walls it's working brilliant that was easy we can have a much more balanced game of hide and seek now but hold on there is another issue that is becoming clear these entities don't have any concept of personal space they are literally all over each other this will not do at all is there anything we could do and yes of course if we just take a look at the define try move script that we borrowed from the player the movement collisions are restricted to touching level sprites so that stops them going through walls but if we now scroll to the define spawn script where we're first cloning the entities on the level we have an extra check to prevent the entities overlapping each other when they spawn touching level or touching entity aha right then how about we duplicate this or and take it back to the try move script and now pop it in place of the single touching level block there now the entity will not walk over a level wall or another entity that sounds too good to be true only one way to find out run the project and here they come now this is interesting i think yes they are they are colliding with each other and shuffling around surround me completely this is just so cool of course i never added myself as a collidable object so i can just walk through them but but perhaps if i couldn't walk through them and i got trapped by the enemies that in itself would be a really interesting game i'm just saying wait hold on why are these entities no longer coming after me that's a bit surreal perhaps if i walk around them a bit oh yeah here we go so this nano got free and has come for me i think i can see the problem though do you see how the enemy hitboxes are rotating on the map this never used to happen it's been brought in by the move scripts from the player sprite i believe the rotation is causing the sprites to collide after they are rotated and that prevents them from moving away from each other so find our define move block here it is now we don't want either of these switch costumes or set rotation mode blocks so take them out but leave both the try move blocks and these lower ones get rid of the lot now let's try that again here they come they're not rotating on the map check and as they congregate ah i can edge away and yes i think oh yes i think we were right they are free to split apart and come after me sweet bug squished now we are really gaming there's just a big swarm of entities lurking around the middle of the level and then a spattering of others waiting to jump scare me as i come around the corner ah yes like that man so there's so many directions we could take this game i guess the question is what happens when an enemy touches the player well it could be nothing it could be that we get trapped by them and i can't move perhaps we can even push them around that would be fun what we'll do for now though is to add the concept of player health begin by clicking into the player sprite and find a define player tick script this is our player's main game loop so right at the bottom if touching entities that will be any kind of entity next make a new variable health for all sprites and when we touch an entity change health by 1 ouch then if health is less than one then we do something say game over i guess but for now pop in a broadcast game over and i'll leave it to you for an exercise to do something fun with that in your own time we should just scroll up to the when flag clicked and set health to 100 when the game starts there should we test that out so there's my health at 100 oh but not for long something must have touched me run away we really need to add some sounds when i get hurt i think that would be cool oh man i wish i had a jump key to jump over these nanos that would be so cool to dodge them like that again though we'll need a way of telling the difference between nanos and franks oh well for another time perhaps oh gosh i'm getting surrounded so we've covered enemies quite a bit but what's the point of running around this level without some other goal how about we add something to collect now i was originally going to reuse the entity sprite for this but i've changed my mind now that entities can bump into and block each other you see i don't want my collectibles to block the enemy's path so instead duplicate the entity's sprite entirely and we'll name this one collectibles then in the scripts what do we need to change well we only want to spawn one type of collectible at present so remove the second set color size and spawn blocks we'll also spawn 10 collectibles and the type that can be a costume number three we'll add that costume in a moment and then scroll down to the when i start as clone loop collectibles don't follow the player so remove the point in direction and the move blocks okay so costume number three click into the pen sprite and let's look at the costumes now i'm going to choose a third costume from the library i'm after something nice and bright i think a star will be perfect now i'm going to go back to nano and copy the 200x200 square yet again then back into the star group the whole costume together before pasting the invisible box and give it some pen width now i'll move the star down just a touch so it's under the player's eye line now i want this star to shine so draw a circle around the entire star we can send it to the back to position it nicely in the center of the star and then change the fill to be a circular gradient the left color we make pure white and the right hand color we can switch to transparent like so oh that's going to look great on the dark background that just leaves us to change the square's pen width to zero to hide it and we are good to test oh cool i can see a star in the background there and on closer inspection well we have two of them and they do look nice i'm loving that very much get away nanos these are not yours they are mine well i'm pretty sure they are mine anyway oh i really want to be able to collect these okay that can't be hard can it you don't need griff batch to teach you this one find the when i starters clone for everloop in the collectible sprite we want to check if they are touching the player sprite and now we definitely need a sound i think there's one in the sound library named collect nice that will do fine so if we touch the player start the sound collect then from the control section we want the delete this clone block there it is so play the sound and delete the collectible neat i think that deserves a test ping oh guys you noticed that sorry coming through yes i've still got two health oh i'm dead i'm dead luckily i haven't implemented that yet so it's cool how these collectibles are all scattered around but i have no idea how many there are left to collect so let's make a counter make a new variable naming it stars for all sprites then find the when flag clicked and before we spawn any of these new collectibles we'll set stars to zero then scroll down find the when i start as clone change stars by one now each time we create a new star we'll count it in this variable and consequently when we collect a star we change stars by 1 to count them back down now this star's counter is really boring you might want to spruce it up by following my awesome number counter tutorial from just a few weeks ago there's a link under the video if you can't find it however the good news is this does appear to be working great oh ah they got me there definitely need some sound or graphical feedback to let me know i'm being hurt right come on i'm going to hide the rest of these variables and give this a proper play can i collect all the stars without losing all 100 health and while i do this i'm sorry to say that we have come to the end of another episode is this the end of the raycasting series i'd have to say no because there's still projectiles jumping level progression and minimap end screen and perhaps a look at even texture mapping who knows i'll put a poll on my channel to see what the general consensus is but i do feel that after five weeks of raycasting it may be time to do something a little different next week so if you enjoyed this video please smash the like button and do take a moment to subscribe to the channel to avoid the horrible possibility of being late to my next video if you've been wondering how come some scratchers are getting to see my videos early then that's because they have opted in to join my early access channel membership and they're also enjoying more direct contact with me via priority comments so cool well that's it thank you for watching have a great week ahead and scratch on guys you