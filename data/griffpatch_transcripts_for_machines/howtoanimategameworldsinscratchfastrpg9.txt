hello fellow scratchers today we are going to add the much anticipated animating World tiles to our RPG games animating water and campfires really help to bring our world to life also in this episode we'll take a look at improving our layout of the dungeon tiles lower down in our editor palette as they've always looked well let's be honest a bit of a mess when they should be looking like this so yeah we'll sort that out too so stay tuned for that but let's jump right into those animating tiles you may have already tried laying down some of these water tiles in your worlds but a word of warning to get them to animate you must select the first tile in the animation set that's the one on the left looks like I missed defining some Collision pins I shouldn't be able to walk over this water let me add them in on the first animated tile there we go sorted that pin editor is so cool now animating tiles how can we let scratch know which costumes need animating we could just use an if per tile number or make a list of tiles to animate but I did something a little bit more fun if you look at the name of the costume number 254 the first water edge costume you'll see I've added a greater than eight Chevron 8 to the end this means that the tile should be animated over the next eight costumes the following water tile has just the same greater than 8 added and the campfire at costume 427 that has a greater than five because well it only has five costumes in its animation not eight isn't that super easy to configure next we'll create a clock to keep track of which frames to display when we already have the tick variable counting up by one every game tick 30 times a second now we want one that loops around every eight frames make a new variable named tick 8 for this Sprite only set Tick 8 to the mod of eight animation frames and to slow the animation down to change costumes every four game ticks we divide tick by four rounding the result to the nearest whole number makes things clearer and drop that in to the left of the mod nice now pop that script at the top of the when I receive paint background receiver to ensure this is set before we begin painting the tiles a quick test of the project shows the tick 8 cycling around from 0 to 7 in a loop perfect but we mustn't forget those five frame campfires make another variable tick 5 for this Sprite only and duplicate The Tick 8 script swapping tick 8 for tick 5 and modding by you guessed it five feel free to test that again and see that the second tick five variable also ticks up as expected cycling from zero to four so now to animate those costumes find the Define paint layer script and we need to scroll down to find the switch costume and stamp blocks here we need to check if the costume we switch to is an animating costume that is if the costume name contains a right Chevron a greater than symbol just make sure you do use the costume name and not the number okay great now this may seem counterintuitive but next I'm going to duplicate this if nesting it within the first one only this time we are looking for the more specific greater than eight string instead an eight frame animation if it is then we switch costume to the correct animation frame that is the current costume number summed with the tick 8 variable and to account for the five frame animations too also check for greater than five and some with the tick 5 variable perfect right you may ask why do I bother with this outer check at all it's simply for efficiency you see most tiles don't animate and doing one check first prevents us having to do the following two checks for most of the tiles on our screen making the scripts run faster now carefully drop the script in after switching costumes and before we actually do the stamping nice guys I think we are ready to test this baby out smash the green flag and find that water I'm dead excited to see this and here we are didn't I say this was going to be easy and the campfire is working fine too on its own shorter animation cycle it may be worthwhile quickly switching to turbo mode shiftclicking the green flag to see how fast our game engine is performing as you can see I can still speed around so we have plenty of power left over to continue adding to our game that is awesome I'll turn turbo mode back off right so next up we have some palette layout issues to attend to not only do we still see all the animation frames which would be better served hidden from our palette but the lower down dungeon tile set is not laid out as intended this is because while the top tile sheet was 18 tiles wide the dungeon tile sheet below was only 12 tiles wide so we somehow need to start wrapping this set around after only 12 tiles not the fixed 18 we are used to doing the easiest way to support both of these is to rethink the right hand palette as a small game map of its own to use a palette grid list to lay out the tiles in the palette any way we want the trick then is how to get the costumes into this new palette list in the first place now I have a little secret just like I already named the animating tiles so that we could easily pick them out with scripts so I also named some costumes in advance for helping us lay out the palette grid here we go costume number 19 is named dash dash dash 18 dash dash dash this is a dummy costume it's not used in our game and it simply means that the following costumes should be arranged in rows of 18 tiles so I assume we've created our new palette grid list and we would begin laying out the following costumes in rows of 18 tiles until we reach costume 270 where you'll see I've added another dummy costume named 12 dash dash dash this signals a change to the source Sprite sheet and that the following tiles should now be arranged in rows of 12 tiles so off we go laying out the tiles in Columns of 12. note that this will require us to pad the grid list out with extra blank tiles to keep the layout perfectly in line do you get the idea rather than hard coding scripts to do this work we can now code things up to build the palette grid directly from these costume names shall we give it a go yeah I'm going to add these new scripts at the far left of the tile Sprite as it will run first now make a new costume block scan costume names and run without screen refresh drop it in under the when green flag click script to ensure it does run right away so we'll need a grid list to store the palette tiles in name it palette grid and make it for this Sprite only since only the tile's Sprite needs to use it then delete all off palette grid to ensure it starts empty we want to begin scanning through the tile costumes but rather than start on costume 1 we'll begin on costume 10. I'll explain why in a moment to do this I use the addition block and just enter 10 but we could use a round or whatever you wanted next up I want to keep track of how many columns are expected in the current Sprite sheet make a new variable naming it palette Max or pmax for short for this Sprite only set pmax to zero until we know any different and now we repeat until costume number is less than the number we begin with 10. this will make sense in a moment and if else to check the current costume and follow that with our next costume block okay so this Loops from costume 10 all the way up to the last costume in our Sprite and then because next costume then Loops back to the First costume again at the end the costume number will once again be less than 10 and a loop will end great let's check for the special divider costume names the dash dash dashes if costume name contains dash dash dash okay watch out I used the wrong block there it should have been a costume name don't make the same mistake anyhow we'll handle the processing of the separator in a new custom block scan dash dash dash n n means two digits drop that into the if okay so this needs to look at the costume name again and pull out the next two digit numbers as this tells us the number of columns in the Sprite sheet set pmax to the fourth letter of the current costume name but we need the fifth letter too so set temp TMP to the fifth letter now we're going to join these together by setting P Max to the join of P Max and TMP temp it would be cool to give that a test somehow so temporarily drop in a stop all block to force the project to stop here and then click the green flag ah um so I was expecting pmax to read 18 here but as previously stated I made a booboo looking back in my scripts yes here's the problem costume number should have been costume name such an easy mistake to make run the project again and whoop whoop a p Max of 18. it's joined the one and the eight Splendid we found the costume divider remove that stop or block the next trick is to keep track of where we found this divider in the costume numbers make a new variable name it next for this Sprite only and set next to the current costume number yeah I know next seems like the wrong name for this right now but soon its purpose will become more clear next up then we handle the costumes that are not separator tiles all the other tiles in other words and this is in the else Branch above a new custom block then scan next costume and drop it in the else I'll move the Define block down below so P Max we began by setting this to zero remember so if P Max is less than one then we stop this script skipping over this costume and not adding it to our palette next up we want to know if this is the first tile in a row if costume number is greater than next at this point the next variable was set to the costume before the current one so this is going to be true what we want to do then is ensure the palette grid is padded out with blank values such that we are about to start a new palette row will need a repeat adding empty items to pallet grid how many do we need to add mod by 18. that's the full width of our tile grid and on the left 0 subtract the length of palette grid hey look we can see this working pull out our repeat block and if we run it you'll see it does nothing because the palette list is empty so we are already starting a new row but if I add a few items and then run the script again you'll see that the list gets filled up to item 18. all padded out ready to begin the next palette row cool drop that script back into our if so we have the next palette row all lined up but after the next pmax tiles have been read we'll want to do the same again so change next by pmax only after we've added pmax tiles will this script run again to take us onto the next palette row great all that is left to do then is add the tiles to the palette list add to palette grid the current costume number yay believe it or not we can test that out smash the green flag and 630 items have been inserted into my palette grid list the first half of the list is choker block full but about halfway through you should start to find gaps appearing where the dungeon tiles needed padding out to realign them to the palette very promising so assuming this list is correctly populated the next step is to adapt our pallet stamping code to make use of the palette grid list find the Define paint palette script scrolling down here is where we switch costumes to the current palette's costume number gidx that is grid index but it would be a tad dangerous to change the meaning of grdx now as an offset into the palette grid as we've made assumptions Elsewhere for what this variable is used for instead then scroll up to where we first set grid index here and make a new variable palette index for this Sprite only and now replace the GI DX with the new palette index variable and now that we have the palette index we can set gidx to the item of palette grid palette index this can be dropped in within the inner repeat 5 here before we switch to the current palette tile costume of course we then need to also switch the change gidx for a change palette index so that we cycle through the pallet indexes and do the same for the second change gidx below to a palette index excellent that should do something right smash the green flag and see if the palette is looking good there it is cool and we can scroll around still but there is a problem I can't scroll to the top left as expected but the good news is that the dungeon tiles are looking a lot better so hmm what's up with this top left fencing oh guys here's the problem I left the pallet index being offset from 20. this was to skip to the first actual tile costume but now our grid lists take care of that we just need to begin at palette index one at the top left run that again and beautiful this looks much better scrolling down to the dungeon tiles and they're all there and lined up perfectly what's not to love let's try making use of a few of these tiles drop them into the level yeah working great how about the tile tracing feature using the space key yep that seems to be oh oh dear no left and right worked okay but up and down that doesn't work at all that's because we store the current brush as a costume number but we now need to store the index in our palette grid list make a new variable brush P idx for this Sprite only and when the mouse is down don't just set brush also set brush pidx palette index to the current palette index for this same reason we should also come down here a bit where we check whether this is painting the current brush ready to draw its little outline and rather than looking at the brush we now compare the current palette index with the selected brush palette index that will let us select even empty tiles in the palette grid you can see that working here if I click over to the right yeah okay next up we need to find the tile tracing scripts that's under the Define calculate brush position when we drag across the level we don't want to offset the brush costume now but the brush palette index change both of these and lastly we want to set the actual brush from this to item of palette grid and drop in the updated brush pidx that sounds about right so giving it a test yeah sweet we can trace in all directions now and the brush follows along I can actually begin painting the dungeon tiles right away so cool I really do look forward to exploring more of that in a later episode right now though I want to finish tidying up these palette Scripts if we come back up to the animating water costumes in the palette we still see all eight of the animation frames but we really only want to see the first ones no problem scroll right back over to the Define scan next costume script after we add a costume we want to skip over any animated frames we can luckily borrow some scripts we recently added to the paint layer script scroll down to find the check for costume name including a Chevron the greater than duplicate this and move it back into our scan next costume script of course we don't want the stamp or switch costume to Big from the bottom of there so Chuck those away okay so if we just added an animating tile we keep the first tile but want to skip over the rest to do that we just add eight no one less seven because we want the First costume but not the rest of them and if it's a five frame animation we skip over the remaining four costumes and we run the project look at this this we only see the single first costumes for the animating tiles so cool where's that campfire yep there it is what fun it's probably a good idea to lay down some real tiles and check out we haven't missed anything you do have to be careful with these bottom water tiles as they need to be placed under the edge tiles this takes up layers one and two so you can't place a tree trunk overlapping that you never have enough layers I'll just need to place the tree one tile lower down I guess and bridges over water but hold on hold on I have found a bug the E key should select the tile under the cursor as our current brush but that appears to be broken hmm we'll come back to that in a moment finishing my bridge by hand nice right now though we can't actually walk onto the bridge because the pin collisions are preventing us what a pain but something I am well aware of so don't worry we will fix that in a future episode but talking of fixes before this episode concludes we'll just sort a couple of things firstly the tile picker find the paint editor script at the bottom we test for the E key presses right we are setting the brush to the tile under the cursor but we must now also find the index of that tile in the new palette grid list set brush palette index pidx2 item hash of the palette grid and the tile we want to find is given by brush give that a test and check that the E key now is highlighting the correct tiles in our palette yes super so the other thing we need to fix well try scrolling the palette to the right that works great how about down to the bottom ah I see a problem we can no longer go down far enough to see all the tiles okay fine we need to find a Define scroll palette script and down here at the bottom we fixed the scrolling to the first 19 rows well now we know how many rows are in our palette grid so it's the length of palette grid divided by 18 of course the maximum number of tiles in a row drop that into both the palette d y is greater than and the set palette dy2 blocks and we should be good to go oh boy yes we can go really far down now in fact a whole screen further than we might want but that's no big deal really so I will leave it up to you to fix up if you want to because that's where I leave you today I hope you enjoy this episode if you did then please please smash that like button everyone makes a difference and if you haven't yet then subscribe to the channel so as not to miss the next exciting episode the moment it becomes public those who want that extra bit of grip patch why not join the channel membership to get cool Channel Emoji by obviously it replies to comments and options like early access to videos or downloads of the very projects themselves yeah it's all here if you want it but for today that is it for me I hope you have a great week ahead and scratch on guys foreign