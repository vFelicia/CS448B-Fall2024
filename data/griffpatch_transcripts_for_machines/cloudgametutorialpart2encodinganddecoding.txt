hi I'm drift patch and you're very welcome back to part two of my series on creating multiplayer cloud games in scratch today I'm going to show you how we can greatly improve upon the cloud scripts in our last episode we will be sharing a technique called encoding and decoding to squish all our available updates into a single cloud variable per player see the video comparison playing here I'm very excited to share with you the scripts that make this possible so stay tuned until the end of the video where we really get to put them into action encoding means to convert something into a coded form look at the simple code sheet here with this we can encode a word like bed into a string of numbers 11 14 13 since we can only store numbers in cloud variables this encoding is ideal let's add a new list called code and make it for all sprites and add 10 new rows by clicking on the little plus button add row 10 enter the letter a press ENTER and fill out letters b c d e and f each on a new line now in scratch 3 we have this new block called item number the hash symbol here stands for number we use it to look up the item number of a value in the list see here how we request for B comes back with a number 11 let's extend this to encode all three letters of the word bed create a new variable named encoded for this sprite only the variable starts empty and then we join each of the encoded letters in turn on to the end of this new variable click on the block stack to run it and hey presto you can see that the variable encoded has taken on the value 11 14 13 just like our example cool so we now want to create a script that will do the same thing but for any word that it is given not just for the work bed let's start by completing our code list to include all the other letters that we will need we add the letters G through Z then add in the numbers 0 to 9 and finally to support scratch user names we also add the symbols + . space and on score remembering to press ENTER after each new letter added now make a new custom block label it right and then add an input named vowel and finally add another label to encoded so the full block becomes right Val encoded take the run without screen refresh and click OK we need a new variable named letter hash meaning letter number here now hold on while I build this script up then I'll explain how it works if the input named Val is set to Griff patch then the length of vowel will be 10 as there are 10 letters in the word Griff patch so I'll repeat block loop around ten times once for each letter letter number starts as 1 and then each time round the loop we add one to it this means we can keep track of which letter we are looking at next finally we do the same thing we were doing earlier find the item number of the letter in the code list we were encoding and join it to the end of the variable encoded so once this repeat loop finishes we should have successfully encoded all the letters in the input file let's try it out first setting coded to empty and then write bed 2 encoded now click on this block stack should show no change in the value encoded because bed was also the last thing we tested our encoding on so let's change the word to encode to be glyph match ah much better it updates that's brilliant this is a good sign that it's all working now one final touch before we move on we will mark the end of our encoded word with a 0 0 to let us know that we've reached the end this will allow us to encode more than one value by marking the end of one word and the beginning of the next simply setting coded to join encoded with 0 0 great we have our encoding script and it creates values that the cloud system will happily transmit but this is useless without a script to decode the values again at the other end we'll break this up into two custom blocks want to begin the decode and the other to read out the values start by adding a new custom block called begin decode off and add an input of encoded one without screen refresh ok setting coded to the custom blocks encoded input and set letter number to one add a new second custom block called value equals read from encoded run without screen refresh and ok making you variable named value for this sprite only and add a second new variable named ID X and again make it for this sprite only as before let me quickly put this script together and then we can go over how it works ok the variable value begins empty but we are soon going to fill it up as we decode from the values held in the variable encoded we use a forever loop here but notice the stop this script block within the loop this ensures the loop will not actually run forever but stop what we wanted to the first thing we do in the forever loop is to take the first two letters from the variable encoded and stuff them into the Nouvelle port ID X this will give us the first pair of digits that represent a letter to be decoded we then move on our letter number available so that it will be ready to read the next pair of digits when we need them see how we're moving on by 2 not 1 because we are always reading the digits in pairs now we check to see whether we have finished reading in the full word ID X will be less than 1 both when it reaches 0 0 or if there's no more letters to decode so this is a very good safety net if we have reached the end then simply stop this script here make sure that it is not a stop all scripts lastly if we have not reached the end then we look up the letter represented by the two digits in our code list and join it the end of the variable named value the loop then repeats again reading in new letters until we do indeed reach the end of the word great let's test this decoder drag out the new custom block value week was read from encoded and put it under the begin decode block now click it yes you should be seeing the word bed appear in the value variable if so then I'm so happy well done for following the script so closely I know these are a bit tricky let's try to gain for another word goof match click to encode click the decode great but watch this there's more to these scripts than just encoding a single value let's duplicate the right block from our test and encode two different values one two three and then four five six one after the other and then we click to encode them both we have now encoded both these values into the same encoded variable to get these values back out we first separate the begin decoding from the value reader block here and click the begin decoding block next click the read from encoder block and we should find that the value has become one two three the first of our encoded values click the read lock again and we get four five six the second value we encoded perfect we are making great progress with these custom blocks defined we are well on our way to making a better multiplayer script let's clean it up a bit we don't need these of test blocks anymore now scroll back to our original cloud scripts let's have some fun I feel we've earned it so previously we were storing two values the mouse x and y in two cloud variables this is just not good as we've shown so instead we now use our encoder to write them into a single encoded value start by using our right two encoded block oops almost forgot don't forget to set encoded to blank before that and we want to write out two values to encode so duplicate the right block and we write the values of mouse X and Mouse Y now that we have these as a single encoded value we only need a single cloud variable to store let's create a new cloud verbal called just p1 for player 1 drag in a set block setting our cloud verbal p12 the value of encoded so let's swap out the old code for these four new lines that's the encoding taken care off we now need to rework the decoding script below bring in our begin decode of block and drop in the value of the cloud variable p1 for decoding now because we decode one value at a time it'll simplify the scripting if we now use a set X to block here let's decode the exposition from the cloud variable using our value equals read from encoded block and then set X to the decoded value now duplicate the last two blocks and we'll do the same for the Y position don't forget to swap the set X for a set Y block here now the first moment of truth has come if our scripts work then we should still be able to run this project and have the cat follow our mouse cursor we press the green flag with the mouse and then tap the number one key to assign us to be player one and look at that success we can see the player one cloud variable updating and more importantly right now the player position is correctly being decoded so that the cat is again following our mouse this is great news so our program is working so far but this is now the second moment of truth let's see if it works across web browsers as in my previous video I open a second incognito web browser I load up the same project in my Grif batch account click the green flag on both projects then clicking into the lefthand page I press with the one key to activate it as player one moving the mouse around you can see that the position of the player is mirrored far more accurately now than it was in the last episode in the second window we no longer have the problem where the cat jumps around and the framerate is definitely improved that's so much better we are now seeing the cat update every 1/10 of a second in that window this is as fast as cloud data can go if we want the cat to move smoother than this we'll have to employ some clever programming trick which I will cover in later videos okay so I want to squeeze in one more feature before I finish this episode let's hide all these debug values now add in another write block and drop in the players username then in the decoding section of our code we add another value we could read from encoded block and from the looks panel drag out a say block and in there drop the value variable and let's save the project 5 another window again and give it a try when I press one after clicking in the lefthand window you can see my user name appears in both windows this is great it shows that player 1 on both screens is with branch tutor now if I press the green flag again for both projects and this time click the wonky on the right window you see that player 1 is now shown as Grif patch on both screens achievement unlocked guys awesome work and that is it for this video please subscribe love the video and watch out for part 3 in this series I am Griff patch and thank you for watching scratch on you