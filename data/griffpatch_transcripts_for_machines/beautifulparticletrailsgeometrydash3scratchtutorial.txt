hello fellow scratchers welcome back to this most exciting episode 3 of recreating Geometry Dash in scratch and yes finally we'll be adding those most desirable particle effects the classic geometry dash player rotation and not to mention better Spike hitboxes yeah but man I try to make my tutorials as robust as possible but there are times when a fellow scratcher comments it doesn't work I know it sounds implausible but sometimes the smallest thing like the size of a costume the thickness of a line the position or rotation of a Sprite can lead to unpredictable results therefore before we get into adding the cool new stuff let's go over some of these possible problems and make sure they won't be happening again and hopefully as we do this you might learn a few things too so open our projects from episode 2 and as we begin pop into the file menu and save the project as a fresh new copy for this is episode three guys let's get bug squashing the first bug we're going to cover is the dreaded instant death most often due to the player being positioned too low down when the game begins and the initial floor Collision results in an instant game over now sure we could fix this by adjusting the initial go to XY to raise the player up out of the ground but stick with me because there's actually something a little more Sinister at play here in the level Sprite when the green flag is clicked you'll remember we created our two level Sprite clones and you might assume that these two clones will appear on the screen right away well actually no they won't make an appearance until all the other green flag scripts in our project have had a chance to run and here in the player Sprite we have two such scripts so this means for the first frame of our game the level clones are not visible to the player Sprite ha well without a solid white floor to hold the player up they will surely fall down due to gravity and then the level appears but as you can see the player is now even more embedded in the floor than before and boom instant death bug all over again the solution is to do what we should have done from the start and make sure that the level clones are created before the main game Loop begins broadcast from the level Sprite a new message game on but only after the clones have been created then back in our player Sprite we swap out the two when green flag click blocks and we replace them with when I receive game on event receivers excellent order has been restored let's see if that made a difference and what do you know that did it for me even with a small initial overlap however if you want to be absolutely sure that the positioning is good stop the project make the level Sprite visible on the stage and then drag the player until they are just level with the floor finally copy the current y position into the initial go to XY block like so final test then smash that green flag and double check that all is good bug squashed now this is interesting by forcing the Clones to execute their scripts before our main game Loop we have changed how our collisions play out once again previously after a collision the player was left overlapping the level like this but now we end up getting pushed back out of the war after a collision and this is actually a requested feature oh you're welcome but I'm not quite sure it's so desirable that it also occurs for spikes now it's happening because the game over change X occurs right after the Collision so in effect Scrolls them right back out of the Collision again if we want to fix this just for the spikes then before we broadcast game over here slot in a change X position by but for the opposite direction to the scroll that's zero subtract scroll speed and in theory that should do the trick and a quick test just to confirm it yep Spike collisions are back to normal and our wall collisions are still great well okay the next bug the player might experience is the falling through the floor nasty our player to floor Collision detection strategy is based on collisions not with a whole solid level but with a relatively thin white line and if it's too thin or the wrong color then the player can just drop right through not only that but if the player is falling fast enough it's possible for them to skip right over that thin line missing the Collision altogether don't right then first thing to check is that your white lines are nice and thick if they're just one pixel then I'm afraid they often will not register as being white enough to trigger a collision and that's not great so try to ensure all your lines are at least four pixels wide what's more to ensure they are even solid when they are behind spikes bring the line to the front that will give your player the best chance to always detect a collision next up we'll address the possibility of line skipping now notice that our player is 34 pixels tall that means to skip over a line we'll need a speed y of like negative 34 or more so if we limit this speed then the problem should go away find the player movement script and just after we change speed y by 4 pop in an if block and check if speed Y is less than and let's say negative 28. and if it is then we set speed y back to negative 28 once more that's now a hard limit on the speed hopefully if you had any issues with falling through the floor then this will finally have sorted that out another bug squished hey since we are sorting out all these little quirks you may notice my player is appearing in front of the level but had I dragged the level Sprite last then now the level Sprite would appear in front of the player no we don't want this indeterministic Behavior so in the player Sprite drop in a go to front layer right here at the top sweet anything else worth fixing up the ceiling death bug so okay this is not so much a bug as a mistake on my part I was so into fixing up collisions that I forgot that touching their ceiling in Geometry Dash is actually considered a game over event so if you want that same functionality in your game not to worry it's dead easy in our player movement script after a collision the first check is for the downward collisions of speed y less than zero but otherwise this is a ceiling Collision so rather than just moving out of the Collision replace that custom block with a broadcast to game over it's as simple as that and I wouldn't be in the least bit surprised if you were way ahead of me and had already done just that let me know in the comments if you did right now then we are finally going to add in that player rotation that we've all been so eager to implement Begin by checking the top layer Sprite is set to the allaround rotation mode now that's the first option here then we'll initialize the player in the game on script to start the right way up point in Direction leaving it set to 90 degrees perfect next to make them rotate we'll do this in the player movement script drop in a turn clockwise block as the first block in the script and as for how much I find 14 degrees works well for me and now if you smash that green flag one of two things will happen either you'll be greeted by an oh so sweet rotating player where they bob up and down as they rotate following every Contour of the level or hmm yes sad like me now I'm getting that instant death again well to be honest it's probably a good thing that I did otherwise we wouldn't have this opportunity to see why I am the added rotation on top of me lowering down the player has again caused the Sprite to enter instant death territory well the robust solution is to switch back to nonrotated costumes when looking for level collisions find the game Loop under the game on script and from the motion category find the set rotation style block before calling the player movement script set rotation style to don't rotate yeah I left mine on left and right that will work too but don't rotate is probably better this will keep the Sprite upright for the Collision checks we just need to remember to restore the style afterwards set rotation style to all around so that once again the player will appear to be rotated as requested and this is interesting running the project you'll find we no longer have instant death but we have lost that in doing bobbing up and down effect now we are gliding smoothly across the floor once more oh well not to worry because at the end of the day we should only be rotating when the player is off the ground anyhow right when touching the ground we need to level them off to the nearest flat surface this is round their direction to the nearest 90 degrees so scroll over to the player movement script again the floor collisions are detected here set Direction 2. and we need the current direction to snap this to the nearest 90 degrees we first divide by 90. then drop it into a round block finally we multiply that back up by 90 again to find the nearest multiple of 90. awesome I am so excited to see this in action smash that green flag oh my gosh guys look at that what can I say it's just so fun I especially love how they tumble off platform edges and do a small quarter turn very authentic but hitting these spikes calls to mind another comment that gets raised again and again that the spikes in our Geometry Dash are just too unforgiving in the original game Spikes have a small hitbox at the center and that is the only part that's dangerous to touch that explains my difficulty in jumping over the triple spikes now we could emulate this effect by drawing a little colored box in the middle of each Spike and watching out for the collisions with that instead but I have an alternative instead of reducing the hitbox of each spike in our game we can get the same effect by reducing the hitbox of the player instead do you see let's try that shall we open the player costume Tab and oh gosh we should have given the player costume a proper name player then create a new second costume and using the rectangle tool with a solid fill and no outline draw out a square five grid squares wide and tall holding shift to keep it square it should be 20 by 20 pixels now snap the shape to the center of the canvas cool you can see this hitbox is quite a bit smaller than the player give the costume a name hitbox and even Spike so that we know what it's for okay so where in our code are we looking for a spike Collision in the main game Loop of the player Sprite here it is ah but we have a slight problem to use the hitbox costume with the touching color check here we need to switch costumes before doing the check but that's not possible when the touching block is part of a repeat until like this so we'll have to do the loop check another way pull it out and place it in a fresh new if block instead and if we are touching the spike color then it is game over so move the game over scripts inside the new if block one more thing we also want to stop this script at the end to say that this is now the end of the loop finally drop that all in after the player movement is complete but still within that Loop good Hmm this repeat until with an empty condition will actually just end up repeating forever so I guess we might as well make it official and switch it for a simpler forever Loop that's better now just before we give it a test we need to switch to the player's costume right up here before the game begins if all is well this should run just like it did before we've only rearranged the Collision check after all but now we can look at switching to the hitbox costume to make our collisions more lenient immediately before the color check switch costume 2. the hitbox costume and then right afterwards switch back to the player costume again you see the pattern we just need to be careful to also switch costumes back when we die so switch costume again to player now what do you think looks about right to me hit the green flag it's testing time oh my gosh I got it first time was that a fluke nope I got it again yeah it's so much easier now I really must check that yeah spikes do still work well that's cool I know a lot of you will be very pleased we got this feature in here today but there's still more to come yes last but not least we're going to add movement particles now these transparent blocks fan out behind the player giving the impression of speed and firm contact with the level but they also stop being emitted as soon as the player leaves the ground okay no problem let's begin by making a new Sprite naming it particles and then Zoom right into the costume canvas and we're going to draw a science square with no outline the rectangle is two grid cells wide that's eight by eight pixels snap it to the center and we are ready to code when green flag clicked we go to the front layer and then this is going to be a clone Factory so hide the original Sprite the Clone should be created by the player Sprite so click in there now finding that same old player movement script when we are touching the level and more specifically when we are moving down into a collision here this is where the particles should get emitted so drop in a create clone of block and switch to create a clone of the particle Sprite place it right after we move out of the level great so back into the particle Sprite when I start as a clone every new particle will Begin by running this script individually firstly the particles want to emit from the player so go to player we'll move them into place and then we must make sure the particle is visible show this clone next we need a bit of time to animate the particle so repeat for 10 times and to scroll this particle left we change X by the variable scroll speed of course as always finally once the 10 frames are up we delete this clone to remove it from the screen hey shall we see this in action hit the green flag and there we are a very simplified Scion trail that comes right out of the player's Center good news too the trail stops when we jump in the air hey let's make some improvements from the looks category we want the change effect by block we can fade out the particles over time with the change ghost effect and choose a value of around eight yep that's great how about we move the trail down to begin at the player's feet after the initial goto block change X by and move left with a change X by negative 10 and we move down two using a change y by negative 16. and here we go that's even better the Finishing Touch is to spice it up with a little Randomness to make the particles spray around more for this we need some variables make a new variable speed X and make sure to switch it to for this Sprite only now this actually applies to clones too so each clone will have its own speed X otherwise all the particles will move at the same speed and it won't look any good now make another variable speed y again for this Sprite only we'll initialize the speed variables up here set speed X and a set speed y now these values can be randomized using a pick random block with a value between 0.0 and 4.0 and the speed y can be between 0 and 3.0 hey if you don't know why I added that point zero on the end here then I'd encourage you to try out the block yourself and see what difference it makes comment under the video once you've figured it out okay lastly we apply these variables to the actual movement scripts we add speed x to the existing scroll speed here and bring in a brand new change y by for the speed y variable test that yes Blended this is much improved and is almost there all that's missing is a little variance in the sizes of the particles no problem set size 2 and again use a pick random block good values are between 50 that's half size and 100 that's full size smash that green flag and we are done the particle Trails the rotation the improved hitboxes solid collisions and a whole bunch of other bug fixes wow this is really coming together big time I really can't wait to see how your projects look so drop me a comment and let me know how you are getting along and better still Share the Fun by submitting them to my official scratch Studio linked under the video guys if you're enjoying these videos I'd encourage you to click the like button to show your appreciation and so is not to miss my next exciting video subscribe to the channel now checking that Bell icon to ensure you are the first to know when a new video drops but that is it for today so thank you for watching have a great week ahead and scratch on guys