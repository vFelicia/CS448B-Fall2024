Okay so we've gotten if you watched the last video to the point where we can now run an automated deployment for our nodejs app so let's make this better there's there's kind of a problem with forever even though most people that I know use forever for deployments forever has this problem and that for the word forever does not include if your server has to reboot for some reason if your server if digital Ocean or or Rackspace tends to do this whenever they have problems your servers all get rebooted and now your website's down because forever did not restart your service and so what we're going to actually do is run our noj node.js app as its own system service as its own upstart service and this is kind of like a higher or a midlevel uh Linux thing that we're going to be doing and so this way it'll automatically run whenever it starts so the first thing we're going to do is we're going to ssh in as root so let me exit and let me SSH into my server as Roots actually before I do that I'm going to ssh in as deploy and I'm going to stop my current if I go forever list I've got it running so I'm going to go forever stop all stop my existing forever service now I'm going to log in as root okay so I'm logged in as root and now I'm going to create this file Etsy init node app let me actually go into Etsy init see see on it okay so if I do a file list these are all the services that are starting on boot up um so basically if I create a newcon file a new configuration file then that service will also start so I'm going to copy and paste this code right here and I'm going actually I run this command first I will edit this file with Nano uh I prefer Vim basically Nano and Vim are text editors for your terminal since we don't really have a graphical user interface we have to use a terminal text editor Vim is better but Nano is easier so we'll be using Nano for this example if you're new to that and so now I'm in a file to edit going to copy this code and let's paste it in there we go so this is going to be my configuration file when do we start when file system and networking are started that's when we start our service and then we're going to change directory into home deploy node app that's where we are automatically that's where flight plan is pushing all our stuff to and then we're going to set some environment variables that our node app can listen to so if this is a staging server we would change that to staging and then our Port whatever our node Port is and this is the actual command to run our service uh we're finding node and then we're running bin www so that should make perfect sense to you I'm going to contrl X say y hit enter and there we go now we have a service so I can go start node app and it's running so let me go back over here hit refresh and you remember I stopped the forever service and it's still running cuz I've started this so I can go stop node app and I can hit refresh and it's dead dead service so start node app again and once again that's because it's called node app.on whatever you call the file is what the service name will be so now my service has been created um my next step is going to be give my deploy user the password or the ability to run that command that's really a root level command controlling services and so since my no since my deploy user is a part of the pseudo group I can run pseudo restart node app but it's going to ask for a password and I don't want to do that because I want this to be automated so I'm going to copy this command and I'm going to paste this command in and that will wh what did I do I guess I didn't copy it did I ah ruining everything there we go so now it is I have added that command in I've added that ability in and what that did is if you type viudo this is all these pseudo permissions and what I did is I just appended that to the end of my file so I'm deploy deploy now has the ability to run restart node app uh if you also want to give your deploy script the ability to run start node app and stop node app you can run Asin start node app and then sbin stop note app or if you want it to give the ability to run all um any Services stop start any Services just leave node app off so I'm not going to save this no don't save I only want my my deploy user to be able to passwordless restart the app uh that's as little permissions as I need so now I can exit out let's get out of there and now all I have to do is go adjust my flight plan file my flight plan. JS going to remove these two lines where I'm using forever don't use forever anymore let's use this pseudo restart node app there we go so it's going to EXA pseudo restart node app let's test deploy this fly production and it's moving there you go finish just fine it was actually slightly faster it felt like and my service is still running let's just triple check this and will be done for sure let me go to My Views index Jade welcome to title let's shout tidle yay let's run a deployment fly to production I kind of like the fly command it feels very successful there we go welcome to express and that is deploying with node.js as a service oh yes let's do the real test um let's log in and reboot our server reboot there you go system is going down for reboot now and then let's go and try this it's not working because my server's down server should be up in about five there we go and now it's back and my service is running and I've deployed as a service so hope this helps you out and have a great day